<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>é‚¹é›·</title>
  <subtitle>åˆ¨è¿‡çš„å‘,è‡ªå·±æ…¢æ…¢æ¥å¡«</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="https://www.zoulei.net/"/>
  <updated>2017-12-25T06:10:56.899Z</updated>
  <id>https://www.zoulei.net/</id>
  
  <author>
    <name>ficapy</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>gitlabci yml ç¬”è®°</title>
    <link href="https://www.zoulei.net/2017/12/25/gitlabciyml_note/"/>
    <id>https://www.zoulei.net/2017/12/25/gitlabciyml_note/</id>
    <published>2017-12-25T04:17:56.000Z</published>
    <updated>2017-12-25T06:10:56.899Z</updated>
    
    <content type="html"><![CDATA[<p>ä»¥ä¸‹å†…å®¹æ¥è‡ªGitlabCIå®˜æ–¹æ–‡æ¡£</p>
<h2 id="æœ€åŸºç¡€çš„"><a href="#æœ€åŸºç¡€çš„" class="headerlink" title="æœ€åŸºç¡€çš„"></a>æœ€åŸºç¡€çš„</h2><ul>
<li><p>jobsä½œä¸ºæœ€é¡¶çº§çš„å…ƒç´ ã€‚æ¯ä¸ªjobè‡³å°‘åŒ…å«ä¸€ä¸ªscript</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">job1:</div><div class="line">    script1: pwd</div></pre></td></tr></table></figure>
<p>  æ¯ä¸ªjobçš„æ‰§è¡Œéƒ½æ˜¯å®Œå…¨ç‹¬ç«‹äºå…¶ä»–çš„job</p>
</li>
</ul>
<a id="more"></a>
<h2 id="å…³äºDocker-Imageå’ŒServiceçš„ä½¿ç”¨"><a href="#å…³äºDocker-Imageå’ŒServiceçš„ä½¿ç”¨" class="headerlink" title="å…³äºDocker Imageå’ŒServiceçš„ä½¿ç”¨"></a>å…³äºDocker Imageå’ŒServiceçš„ä½¿ç”¨</h2><ul>
<li><a href="https://docs.gitlab.com/ee/ci/docker/using_docker_build.html">Using Docker Build</a>ã€‚ä¸»è¦è®²è¿°æ€ä¹ˆåœ¨Dockeré‡Œé¢ä½¿ç”¨Dockeræ„å»ºé•œåƒã€‚(æœ€ç®€å•çš„æ˜¯åœ¨æ³¨å†ŒRunnerçš„æ—¶å€™å…±äº«/var/run/docker.sock)</li>
<li><p><a href="https://docs.gitlab.com/ee/ci/docker/using_docker_images.html">Using Docker images</a>ã€‚</p>
</li>
<li><p>æ³¨å†Œçš„æ—¶å€™å¯ä»¥åŒæ—¶è¿è¡ŒServicesã€‚è¿™æ ·åœ¨ä»»åŠ¡æ‰§è¡ŒæœŸé—´å¯ä»¥è®¿é—®services</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">sudo gitlab-runner register \</div><div class="line">    --url &quot;https://gitlab.example.com/&quot; \</div><div class="line">    --registration-token &quot;PROJECT_REGISTRATION_TOKEN&quot; \</div><div class="line">    --description &quot;docker-ruby-2.1&quot; \</div><div class="line">    --executor &quot;docker&quot; \</div><div class="line">    --docker-image ruby:2.1 \</div><div class="line">    --docker-postgres latest \</div><div class="line">    --docker-mysql latest</div></pre></td></tr></table></figure>
</li>
<li><p>serviceå°±æ˜¯ä»»åŠ¡æ‰§è¡Œçš„æ—¶å€™èƒ½å¤Ÿè®¿é—®åˆ°åˆ«çš„å®¹å™¨ã€‚æ¯”å¦‚Mysqlã€Postgresqlã€Redisã€Rabbitmqå•¥çš„</p>
</li>
<li>è®¿é—®serviceå°±å’Œæˆ‘ä»¬ä½¿ç”¨docker-composeå·®ä¸å¤š</li>
</ul>
<h2 id="å…¶ä»–çš„ä¸€äº›Top-Levelè®¾ç½®"><a href="#å…¶ä»–çš„ä¸€äº›Top-Levelè®¾ç½®" class="headerlink" title="å…¶ä»–çš„ä¸€äº›Top-Levelè®¾ç½®"></a>å…¶ä»–çš„ä¸€äº›Top-Levelè®¾ç½®</h2><ul>
<li>before_script: åœ¨æ¯ä¸ªä»»åŠ¡æ‰§è¡Œå‰æ‰§è¡Œ.æ¯”å¦‚é…ç½®å¥½ssh config</li>
<li>after_script: åœ¨æ¯ä¸ªä»»åŠ¡æ‰§è¡Œå®Œæˆåæ‰§è¡Œ.å¥½åƒç”¨å¤„ä¸å¤§</li>
<li>stages: <span style="color:red"><strong> æ¯ä¸ªä»»åŠ¡éƒ½å¯ä»¥å±äºä¸€ä¸ªstage.åŒä¸€ä¸ªstageçš„jobæ˜¯å¹¶è¡Œçš„.ä½†æ˜¯åªæœ‰ä¸€ä¸ªstageæ‰€æœ‰éƒ½æ‰§è¡Œå®Œæ¯•æ‰ä¼šæ‰§è¡Œä¸‹ä¸€ä¸ªstage</strong></span></li>
<li>variables: æ¯ä¸ªjobéƒ½å¯ä»¥ä½¿ç”¨çš„ç¯å¢ƒå˜é‡ã€‚æ­¤å¤„åªèƒ½è¿›è¡Œå¾ˆç®€å•çš„è®¾ç½®ã€‚æ¯”å¦‚æˆ‘å¸Œæœ›å°†å½“å‰æ—¥æœŸç”¨ä¸€ä¸ªå›ºå®šçš„æ ¼å¼è¡¨è¾¾(éœ€è¦ç”¨dateå‘½ä»¤è¿›è¡Œè½¬æ¢),åœ¨è¿™é‡Œæ˜¯è¡Œä¸é€šçš„</li>
<li>cache: </li>
</ul>
<h2 id="å¯é€‰é¡¹æœ€å¤šçš„Jobsé…ç½®æ¥äº†"><a href="#å¯é€‰é¡¹æœ€å¤šçš„Jobsé…ç½®æ¥äº†" class="headerlink" title="å¯é€‰é¡¹æœ€å¤šçš„Jobsé…ç½®æ¥äº†"></a>å¯é€‰é¡¹æœ€å¤šçš„Jobsé…ç½®æ¥äº†</h2><ul>
<li>jobs: å¿…é¡»è¦æœ‰ç‹¬ç«‹çš„åç§°</li>
</ul>
<table>
<thead>
<tr>
<th>Keyword</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>script</td>
<td>å®šä¹‰shellè„šæœ¬</td>
</tr>
<tr>
<td>image</td>
<td>ä½¿ç”¨çš„image.å¯ä»¥è¦†ç›–æ‰å…¨å±€çš„</td>
</tr>
<tr>
<td>services</td>
<td>ä½¿ç”¨docker services,è¦†ç›–æ‰å…¨å±€</td>
</tr>
<tr>
<td>stage</td>
<td>å±äºå“ªä¸ªé˜¶æ®µ</td>
</tr>
<tr>
<td>variables</td>
<td>å®šä¹‰jobçš„ç¯å¢ƒå˜é‡</td>
</tr>
<tr>
<td>only</td>
<td>åªæœ‰æ»¡è¶³æŸæ¡ä»¶çš„æ—¶å€™æ‰ä¼šè¢«æ‰§è¡Œ</td>
</tr>
<tr>
<td>except</td>
<td>æ»¡è¶³æŸæ¡ä»¶çš„æ—¶å€™ä¸æ‰§è¡Œ</td>
</tr>
<tr>
<td>tags</td>
<td>å“ªäº›Runnersèƒ½å¤Ÿæ‰§è¡Œè¯¥ä»»åŠ¡</td>
</tr>
<tr>
<td>allow_failure</td>
<td>å…è®¸ä»»åŠ¡å¤±è´¥ã€‚æ­£å¸¸æƒ…å†µä¸‹å¤±è´¥åˆ™ä¼šä¸è¿›è¡Œåç»­æ­¥éª¤</td>
</tr>
<tr>
<td>when</td>
<td>å®šä¹‰ä»»åŠ¡ä»€ä¹ˆæ—¶å€™æ‰§è¡Œã€‚manualæ‰‹åŠ¨è¿˜æŒºæœ‰ç”¨â”‘(ï¿£Ğ” ï¿£)â”</td>
</tr>
<tr>
<td>artifacts</td>
<td>å°†æ„å»ºç”Ÿæˆçš„æ–‡ä»¶ä¸Šä¼ åˆ°gitlabã€‚å…è®¸ä»gitlabåå°è¿›è¡Œä¸‹è½½</td>
</tr>
<tr>
<td>dependencies</td>
<td>é…åˆartifactsä½¿ç”¨ã€‚å°†ç”Ÿæˆçš„artifactsæ–‡ä»¶è·¨jobä½¿ç”¨    </td>
</tr>
<tr>
<td>cache</td>
<td>ç¼“å­˜æ–‡ä»¶ç»™åç»­jobä½¿ç”¨</td>
</tr>
<tr>
<td>before_script</td>
<td>è¦†ç›–å…¨å±€</td>
</tr>
<tr>
<td>after_script</td>
<td>è¦†ç›–å…¨å±€</td>
</tr>
<tr>
<td>environment</td>
<td><a href="https://docs.gitlab.com/ee/ci/environments.html">æ–‡æ¡£</a></td>
</tr>
<tr>
<td>coverage</td>
<td>ä»£ç è¦†ç›–ç‡è®¾ç½®</td>
</tr>
<tr>
<td>retry</td>
<td>å¦‚æœå¤±è´¥åˆ™é‡è¯•å‡ æ¬¡</td>
</tr>
</tbody>
</table>
<p>é¢å¤–è¯´æ˜:</p>
<ol>
<li>environmenté…åˆdeployä½¿ç”¨.éƒ¨ç½²çš„æ—¶å€™äººä¸ºæ ‡è®°æ˜¯éƒ¨ç½²åˆ°äº†å“ªä¸ªç¯å¢ƒã€‚æ–¹ä¾¿åœ¨gitlabåå°æŸ¥çœ‹å†å²è®°å½•ã€‚åŒæ—¶æ–¹ä¾¿é”™è¯¯çš„æ—¶å€™å¯ä»¥ç›´æ¥åœ¨gitlabåå°å›æ»šéƒ¨ç½²ã€‚å…¶å®è¿™ä¸ªå‚æ•°ä¸è¦ä¹Ÿæ˜¯å¯ä»¥çš„ã€‚æ·»åŠ ä¸Šå»åªæ˜¯æ›´æ–¹ä¾¿ä¸€ç‚¹</li>
<li>artifactså’Œcacheçš„åŒºåˆ«.<ul>
<li>cacheå¯ä»¥åœ¨å…¨å±€ä½¿ç”¨ä¹Ÿå¯ä»¥åœ¨jobå†…éƒ¨ä½¿ç”¨.ä½†æ˜¯artifactsåªèƒ½åœ¨jobå†…éƒ¨ä½¿ç”¨</li>
<li><span style="color:red"><strong>ç‰¹åˆ«æ³¨æ„</strong></span> cacheè·¨è¶Šè¯¥é¡¹ç›®çš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸã€‚è·¨è¶Šä¸åŒçš„pipeline.jobå¼€å§‹ä¹‹å‰ä¼šå…ˆè§£å‹å·²æœ‰çš„cache.è€Œartifactsåªä¼šå†å•ä¸ªpipelineå‘¨æœŸã€‚ä¸”æŸä¸ªstageåˆ›å»ºä¹‹åã€‚åœ¨åç»­çš„stageä¸­æ‰èƒ½å¤Ÿä½¿ç”¨ã€‚artifactsä¼šåŒæ—¶ä¸Šä¼ æ–‡ä»¶åˆ°gitlab(ä¸Šä¼ æ­¥éª¤è¿˜æ˜¯å¿…é¡»çš„)ã€‚</li>
</ul>
</li>
</ol>
<h2 id="YAMLç‰¹æ®Šè¯­æ³•"><a href="#YAMLç‰¹æ®Šè¯­æ³•" class="headerlink" title="YAMLç‰¹æ®Šè¯­æ³•"></a>YAMLç‰¹æ®Šè¯­æ³•</h2><ul>
<li><p>ç”¨anchors(&amp;)ã€aliases(*)ã€merging(&lt;&lt;) æ¥ç®€åŒ–ç¼–å†™(å¤§å¤šæ•°æƒ…å†µä¸‹åº”è¯¥æ²¡å•¥ç”¨)</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">.job_template: &amp;job_definition  # Hidden key that defines an anchor named &apos;job_definition&apos;</div><div class="line">image: ruby:2.1</div><div class="line">services:</div><div class="line">    - postgres</div><div class="line">    - redis</div><div class="line"></div><div class="line">test1:</div><div class="line">&lt;&lt;: *job_definition           # Merge the contents of the &apos;job_definition&apos; alias</div><div class="line">script:</div><div class="line">    - test1 project</div><div class="line"></div><div class="line">test2:</div><div class="line">&lt;&lt;: *job_definition           # Merge the contents of the &apos;job_definition&apos; alias</div><div class="line">script:</div><div class="line">    - test2 project</div></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="å‚è€ƒæ–‡æ¡£"><a href="#å‚è€ƒæ–‡æ¡£" class="headerlink" title="å‚è€ƒæ–‡æ¡£"></a>å‚è€ƒæ–‡æ¡£</h3><p><a href="https://docs.gitlab.com/ee/ci/yaml/README.html">Configuration of your jobs with .gitlab-ci.yml </a><br><a href="https://docs.gitlab.com/ee/ci/docker/using_docker_images.html">Using Docker images</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;ä»¥ä¸‹å†…å®¹æ¥è‡ªGitlabCIå®˜æ–¹æ–‡æ¡£&lt;/p&gt;
&lt;h2 id=&quot;æœ€åŸºç¡€çš„&quot;&gt;&lt;a href=&quot;#æœ€åŸºç¡€çš„&quot; class=&quot;headerlink&quot; title=&quot;æœ€åŸºç¡€çš„&quot;&gt;&lt;/a&gt;æœ€åŸºç¡€çš„&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;&lt;p&gt;jobsä½œä¸ºæœ€é¡¶çº§çš„å…ƒç´ ã€‚æ¯ä¸ªjobè‡³å°‘åŒ…å«ä¸€ä¸ªscript&lt;/p&gt;
  &lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;job1:&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    script1: pwd&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;  æ¯ä¸ªjobçš„æ‰§è¡Œéƒ½æ˜¯å®Œå…¨ç‹¬ç«‹äºå…¶ä»–çš„job&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
    
    </summary>
    
      <category term="devops" scheme="https://www.zoulei.net/categories/devops/"/>
    
    
  </entry>
  
  <entry>
    <title>influxdb ä¸“ä¸šæœ¯è¯­</title>
    <link href="https://www.zoulei.net/2017/12/09/influxdb_glossary/"/>
    <id>https://www.zoulei.net/2017/12/09/influxdb_glossary/</id>
    <published>2017-12-09T00:02:41.000Z</published>
    <updated>2017-12-09T08:52:51.153Z</updated>
    
    <content type="html"><![CDATA[<p>ä»¥ä¸‹å†…å®¹åŸºæœ¬å…¨ç¯‡æ‘˜æŠ„è‡ªv1.3çš„å®˜æ–¹æ–‡æ¡£,å…ˆä»ç†è§£ä¸‹é¢è¿™å¼ ä¸¤å¼ å›¾å¼€å§‹<br><img src="https://ficapy.b0.upaiyun.com/capture/influxdb_glossary.jpg" alt="influxdb_glossary"><br><img src="https://ficapy.b0.upaiyun.com/capture/influxdb_field.jpg" alt="influxdb"><br><a id="more"></a></p>
<h3 id="aggregation-èšåˆ"><a href="#aggregation-èšåˆ" class="headerlink" title="aggregation èšåˆ"></a>aggregation èšåˆ</h3><p>ä½¿ç”¨èšåˆå‡½æ•°å¯¹pointsä¸­çš„setè¿”å›èšåˆç»“æœ</p>
<ul>
<li>count è¿”å›énullçš„field valuesä¸ªæ•°</li>
<li>distinct  è¿”å›å”¯ä¸€field valuesåˆ—è¡¨</li>
<li>integral ç”±è¿‡æ»¤æ¡ä»¶ç»„æˆçš„ç§¯åˆ†</li>
<li>mean  è¿”å›field valuesçš„ç®—æœ¯å¹³å‡å€¼</li>
<li>median è¿”å›field valuesæ’åºåçš„ä¸­ä½æ•°</li>
<li>mode  ä»field valuesåˆ—è¡¨ä¸­è¿”å›æœ€å¸¸ç”¨çš„å€¼</li>
<li>spread æœ€å¤§å‡å»æœ€å°</li>
<li>stddev æ ‡å‡†å·®</li>
<li>sum æ±‚å’Œ</li>
</ul>
<h3 id="batch-æ‰¹é‡"><a href="#batch-æ‰¹é‡" class="headerlink" title="batch æ‰¹é‡"></a>batch æ‰¹é‡</h3><p>ä¸ºäº†å‡å°‘influxdbçš„è´Ÿè½½ï¼Œå»ºè®®å¯¹pointçš„é›†åˆè¿›è¡Œä¸Šä¼ ã€‚ä½¿ç”¨\nåšåˆ†å‰²ã€‚å»ºè®®æ¯æ‰¹åŒ…å«äº”åƒåˆ°ä¸€ä¸‡ä¸ªpoint</p>
<h3 id="continuous-query-CQ-æŒç»­æŸ¥è¯¢"><a href="#continuous-query-CQ-æŒç»­æŸ¥è¯¢" class="headerlink" title="continuous query(CQ) æŒç»­æŸ¥è¯¢"></a>continuous query(CQ) æŒç»­æŸ¥è¯¢</h3><p>å®šæœŸæ‰§è¡Œè‡ªåŠ¨æŸ¥è¯¢å¹¶å°†ç»“æœæŒä¹…åŒ–åˆ°æ•°æ®åº“</p>
<h3 id="database-æ•°æ®åº“"><a href="#database-æ•°æ®åº“" class="headerlink" title="database æ•°æ®åº“"></a>database æ•°æ®åº“</h3><p>å’Œå…³ç³»å‹æ•°æ®åº“å·®ä¸å¤šå§ã€‚</p>
<table>
<thead>
<tr>
<th>å…³ç³»å‹æ•°æ®åº“</th>
<th>influxdb</th>
</tr>
</thead>
<tbody>
<tr>
<td>database</td>
<td>database</td>
</tr>
<tr>
<td>table</td>
<td>measurement</td>
</tr>
<tr>
<td>row</td>
<td>point</td>
</tr>
</tbody>
</table>
<p>ç‰¹åˆ«ç‚¹çš„å°±æ˜¯ã€‚influxdbæœ‰ä¿ç•™ç­–ç•¥</p>
<h3 id="duration-æŒç»­æ—¶é—´"><a href="#duration-æŒç»­æ—¶é—´" class="headerlink" title="duration æŒç»­æ—¶é—´"></a>duration æŒç»­æ—¶é—´</h3><p>ä¿ç•™ç­–ç•¥çš„ä¸€ä¸ªå±æ€§è¡¨ç¤ºæ•°æ®ä¼šä¿å­˜å¤šä¹…ã€‚æ•°æ®è¿‡æœŸä¼šè¢«æ‰§è¡Œè‡ªåŠ¨åˆ é™¤</p>
<h3 id="field-å­—æ®µ"><a href="#field-å­—æ®µ" class="headerlink" title="field å­—æ®µ"></a>field å­—æ®µ</h3><p>å¯¹æ¯”tagæ¥è¯´fieldæ²¡æœ‰è¢«ç´¢å¼•ã€‚åœ¨ä¸€æ®µæ—¶é—´èŒƒå›´å†…æŸ¥è¯¢fieldçš„å€¼éœ€è¦æ‰«ææ‰€æœ‰çš„pointå¾—åˆ°ç»“æœã€‚æ€§èƒ½æ²¡æœ‰tagå¥½</p>
<h3 id="field-key-å­—æ®µçš„key"><a href="#field-key-å­—æ®µçš„key" class="headerlink" title="field key å­—æ®µçš„key"></a>field key å­—æ®µçš„key</h3><p>åœ¨key-valueå¯¹ä¸­è¡¨ç¤ºfieldå­—æ®µçš„key.åªèƒ½æ˜¯stringç±»å‹ã€‚å­˜å‚¨åˆ°metadataä¸­</p>
<h3 id="field-set-å­—æ®µçš„é›†åˆ"><a href="#field-set-å­—æ®µçš„é›†åˆ" class="headerlink" title="field set å­—æ®µçš„é›†åˆ"></a>field set å­—æ®µçš„é›†åˆ</h3><p>æ‰€æœ‰field keyçš„é›†åˆ</p>
<h3 id="field-value-å­—æ®µçš„å€¼"><a href="#field-value-å­—æ®µçš„å€¼" class="headerlink" title="field value å­—æ®µçš„å€¼"></a>field value å­—æ®µçš„å€¼</h3><p>fieldçš„valueã€‚ç±»å‹å¯ä»¥æ˜¯stringsã€floatã€integersã€booleansã€‚fieldçš„å€¼å§‹ç»ˆä¸æ—¶é—´æˆ³ç›¸å…³</p>
<h3 id="function-å‡½æ•°"><a href="#function-å‡½æ•°" class="headerlink" title="function å‡½æ•°"></a>function å‡½æ•°</h3><p>åˆ†ä¸‰ç±»ï¼Œèšåˆã€é€‰æ‹©ã€è½¬æ¢</p>
<h3 id="identifier-æ ‡è¯†"><a href="#identifier-æ ‡è¯†" class="headerlink" title="identifier æ ‡è¯†"></a>identifier æ ‡è¯†</h3><p>emmmâ€¦æŒç»­æŸ¥è¯¢åç§°ã€æ•°æ®åº“åç§°ã€fieldå­—æ®µã€åº¦é‡åç§°ã€ä¿ç•™ç­–ç•¥åç§°ã€è®¢é˜…åç§°ã€æ ‡ç­¾åç§°ã€ç”¨æˆ·å</p>
<h3 id="line-protocol-è¡Œåè®®"><a href="#line-protocol-è¡Œåè®®" class="headerlink" title="line protocol è¡Œåè®®"></a>line protocol è¡Œåè®®</h3><p>åŸºäºæ–‡æœ¬æ ¼å¼å†™å…¥åˆ°influxdb</p>
<h3 id="measurement-åº¦é‡"><a href="#measurement-åº¦é‡" class="headerlink" title="measurement åº¦é‡"></a>measurement åº¦é‡</h3><p>emmmâ€¦å¯ä»¥ç±»æ¯”åˆ°å…³ç³»å‹æ•°æ®åº“çš„table</p>
<h3 id="metastore-å…ƒæ•°æ®å­˜å‚¨"><a href="#metastore-å…ƒæ•°æ®å­˜å‚¨" class="headerlink" title="metastore  å…ƒæ•°æ®å­˜å‚¨"></a>metastore  å…ƒæ•°æ®å­˜å‚¨</h3><p>åŒ…å«å†…éƒ¨ç³»ç»Ÿçš„çŠ¶æ€ä¿¡æ¯ã€‚å…ƒç´ æ®å­˜å‚¨åŒ…å«äº†ç”¨æˆ·ä¿¡æ¯ã€æ•°æ®åº“ä¿¡æ¯ã€ä¿ç•™ä¾§åˆ—ã€åˆ†ç‰‡å…ƒæ•°æ®ã€æŒç»­æŸ¥è¯¢å’Œè®¢é˜…</p>
<h3 id="node-èŠ‚ç‚¹"><a href="#node-èŠ‚ç‚¹" class="headerlink" title="node èŠ‚ç‚¹"></a>node èŠ‚ç‚¹</h3><p>ä¸€ä¸ªç‹¬ç«‹çš„influxdè¿›ç¨‹</p>
<h3 id="now"><a href="#now" class="headerlink" title="now()"></a>now()</h3><p>æœ¬åœ°çš„çº³ç§’æ—¶é—´æˆ³</p>
<h3 id="point-ç‚¹"><a href="#point-ç‚¹" class="headerlink" title="point ç‚¹"></a>point ç‚¹</h3><ul>
<li>åœ¨serisesä¸­ç”±fieldsç»„æˆçš„å•ä¸ªæ•°æ®ã€‚<code>æ¯ä¸ªpointç”±å®ƒçš„serieså’Œæ—¶é—´æˆ³ç»„æˆå”¯ä¸€æ ‡è¯†</code>(é‡ç‚¹)</li>
<li>å¯¹äºä¸€ä¸ªç›¸åŒçš„æ—¶é—´æˆ³å’Œç›¸åŒçš„seriesåªèƒ½ä¿å­˜ä¸€ä¸ªpoint.å¦‚æœç›¸åŒåˆ™æ–°çš„field setè¦†ç›–æ‰æ—§çš„</li>
</ul>
<h3 id="query-æŸ¥è¯¢"><a href="#query-æŸ¥è¯¢" class="headerlink" title="query æŸ¥è¯¢"></a>query æŸ¥è¯¢</h3><p>ä»influxdbä¸­æŸ¥è¯¢åˆ°ç›¸å…³æ•°æ®çš„æ“ä½œ</p>
<h3 id="replication-factor-å¤åˆ¶å› å­"><a href="#replication-factor-å¤åˆ¶å› å­" class="headerlink" title="replication factor å¤åˆ¶å› å­"></a>replication factor å¤åˆ¶å› å­</h3><p>å¯¹é›†ç¾¤æœ‰ç”¨ã€‚O__O â€œâ€¦å¯æ˜¯é›†ç¾¤å¹¶ä¸æ˜¯å…è´¹åŠŸèƒ½,å°†ä¸€ä»½æ•°æ®ä¿ç•™åˆ°é›†ç¾¤ä¸Šå¤šä»½</p>
<h3 id="retention-policy-RP-ä¿ç•™ç­–ç•¥"><a href="#retention-policy-RP-ä¿ç•™ç­–ç•¥" class="headerlink" title="retention policy(RP) ä¿ç•™ç­–ç•¥"></a>retention policy(RP) ä¿ç•™ç­–ç•¥</h3><p>ä»¥æ•°æ®åº“ä½œä¸ºå•ä½ï¼Œåˆ†ä¸‰ä¸ªæ–¹é¢ã€‚ä¿ç•™æ—¶é•¿ï¼Œæ•°æ®å¤šä¹…è¿›è¡Œä¸€æ¬¡åˆ†ç‰‡æ“ä½œã€‚æ•°æ®è®¾ç½®å¤šå°‘ä¸ªå‰¯æœ¬ã€‚é»˜è®¤autogenè¡¨ç¤ºæ°¸ä¸åˆ é™¤ã€ä¸€ä¸ªå‰¯æœ¬é›†(è¡¨ç¤ºæ²¡å‰¯æœ¬)ã€ä¸ƒå¤©è¿›è¡Œä¸€æ¬¡åˆ†ç‰‡</p>
<h3 id="schema-æ¨¡å¼"><a href="#schema-æ¨¡å¼" class="headerlink" title="schema æ¨¡å¼"></a>schema æ¨¡å¼</h3><p>å¦‚ä½•ç»„ç»‡æ•°æ®åˆ°influxdbã€‚åŒ…å«databasesã€retention policiesã€seriesã€measurementsã€tag keysã€tag valuesã€field keys</p>
<h3 id="selector-é€‰æ‹©å™¨"><a href="#selector-é€‰æ‹©å™¨" class="headerlink" title="selector é€‰æ‹©å™¨"></a>selector é€‰æ‹©å™¨</h3><p>ä¸€ä¸ªå‡½æ•°ï¼Œä»ç‰¹å®šèŒƒå›´çš„pointä¸­è¿”å›å•ä¸ª</p>
<ul>
<li>bottom è¿”å›Nä¸ªæœ€å°çš„field value</li>
<li>first  è¿”å›æœ€å¼€å§‹æ—¶é—´çš„field value</li>
<li>last  è¿”å›æœ€è¿‘æ—¶é—´çš„field value</li>
<li>max  è¿”å›æœ€å¤§çš„field value</li>
<li>min  è¿”å›æœ€å°çš„field value</li>
<li>percentile æ ¹æ®ç™¾åˆ†æ¯”è¿”å›</li>
<li>sample  éšæœºè¿”å›</li>
<li>top  è¿”å›æœ€å¤§çš„Nä¸ªfield value</li>
</ul>
<h3 id="series-åºåˆ—"><a href="#series-åºåˆ—" class="headerlink" title="series åºåˆ—"></a>series åºåˆ—</h3><p>ç”±measurementã€tag setã€retention policyç»„æˆ(<code>æ³¨æ„:field setä¸åœ¨é‡Œé¢</code>)</p>
<h3 id="series-cardinality-åºåˆ—åŸºæ•°"><a href="#series-cardinality-åºåˆ—åŸºæ•°" class="headerlink" title="series cardinality åºåˆ—åŸºæ•°"></a>series cardinality åºåˆ—åŸºæ•°</h3><p>å”¯ä¸€çš„seriesæ•°ï¼Œå¦‚æœä¸€ä¸ªmeasurementæœ‰2ä¸ªtag keyã€‚1ä¸ªæœ‰ä¸‰ä¸ªå”¯ä¸€çš„å€¼ã€‚å¦ä¸€ä¸ªæœ‰ä¸¤ä¸ªã€‚é‚£ä¹ˆåºåˆ—åŸºæ•°ä¸º6.å› ä¸ºtagé›†åˆæ˜¯ä¿å­˜åœ¨å†…å­˜ä¸­çš„ã€‚åœ¨é…ç½®é‡Œé¢ä¹Ÿæœ‰é»˜è®¤çš„æ•°é‡é™åˆ¶</p>
<h3 id="server-æœåŠ¡å™¨"><a href="#server-æœåŠ¡å™¨" class="headerlink" title="server æœåŠ¡å™¨"></a>server æœåŠ¡å™¨</h3><p>è¿è¡Œinfluxdbçš„ç¯å¢ƒã€‚åº”è¯¥ä¸€å°æœåŠ¡å™¨åªè¿è¡Œä¸€ä¸ªinfluxdbè¿›ç¨‹</p>
<h3 id="shard-åˆ†ç‰‡"><a href="#shard-åˆ†ç‰‡" class="headerlink" title="shard åˆ†ç‰‡"></a>shard åˆ†ç‰‡</h3><p>åŒ…å«ç¼–ç å’Œå‹ç¼©æ•°æ®ï¼Œä½œä¸ºTSMæ–‡ä»¶ä¿å­˜åˆ°ç£ç›˜ã€‚æ¯ä¸ªåˆ†ç‰‡å±äºå”¯ä¸€çš„ä¸€ä¸ªshard groupã€‚æ¯ä¸ªåˆ†ç‰‡åŒ…å«äº†ç‰¹å®šçš„series</p>
<h3 id="shard-duration-åˆ†ç‰‡æŒç»­æ—¶é—´"><a href="#shard-duration-åˆ†ç‰‡æŒç»­æ—¶é—´" class="headerlink" title="shard duration åˆ†ç‰‡æŒç»­æ—¶é—´"></a>shard duration åˆ†ç‰‡æŒç»­æ—¶é—´</h3><p>ç”±ä¿ç•™ç­–ç•¥ä¸­çš„shard durationå†³å®šã€‚</p>
<h3 id="shard-group-åˆ†ç‰‡ç»„"><a href="#shard-group-åˆ†ç‰‡ç»„" class="headerlink" title="shard group åˆ†ç‰‡ç»„"></a>shard group åˆ†ç‰‡ç»„</h3><p>åˆ†ç‰‡ç»„(ä¿ç•™ç­–ç•¥)-&gt;shard-&gt;data.ä¸ºäº†è‡ªåŠ¨åˆ é™¤æå‡ºäº†è¿™ä¹ˆå¤šæ¦‚å¿µâ”‘(ï¿£Ğ” ï¿£)â”</p>
<h3 id="subscription-è®¢é˜…"><a href="#subscription-è®¢é˜…" class="headerlink" title="subscription è®¢é˜…"></a>subscription è®¢é˜…</h3><p>O__O â€œâ€¦ å¥½åƒå¹¶æ²¡æœ‰ä»€ä¹ˆç”¨ã€‚æ­é…kapactiorä½¿ç”¨ã€‚è®¢é˜…å®ƒçš„æ•°æ®è¿›è¡Œå­˜å‚¨</p>
<h3 id="tag"><a href="#tag" class="headerlink" title="tag"></a>tag</h3><p>å¯¹æ¯”fieldã€‚tagæ˜¯æœ‰ç´¢å¼•çš„</p>
<h3 id="tag-key"><a href="#tag-key" class="headerlink" title="tag key"></a>tag key</h3><p>ç•¥</p>
<h3 id="tag-set"><a href="#tag-set" class="headerlink" title="tag set"></a>tag set</h3><p>ç•¥</p>
<h3 id="tag-value"><a href="#tag-value" class="headerlink" title="tag value"></a>tag value</h3><p>åªèƒ½ä¸ºæ•°å­—ã€‚å­˜å‚¨åˆ°metadata</p>
<h3 id="timestamp-æ—¶é—´æˆ³"><a href="#timestamp-æ—¶é—´æˆ³" class="headerlink" title="timestamp æ—¶é—´æˆ³"></a>timestamp æ—¶é—´æˆ³</h3><p>å’Œpointå…³è”çš„æ—¶é—´æˆ³ï¼Œå¯ä»¥æœ‰å¤šç§æ—¶é—´æ ¼å¼å­˜å‚¨å’ŒæŸ¥è¯¢</p>
<h3 id="transformation-å˜æ¢"><a href="#transformation-å˜æ¢" class="headerlink" title="transformation å˜æ¢"></a>transformation å˜æ¢</h3><p>ç‰¹å®šçš„ç‚¹è¿”å›å€¼å’Œé›†åˆï¼Œå¾—åˆ°çš„ç»“æœä¸èƒ½ç”¨æ¥å†æ¬¡èšåˆ</p>
<ul>
<li>ceiling ç›®å‰è¿˜ä¸æ”¯æŒ(ceil,floor)</li>
<li>cumulative_sum å°†åˆ—è¡¨å˜æˆç´¯åŠ å’Œåˆ—è¡¨(åŸæœ‰1,1,2,2å˜æˆ1,2,4,6)  </li>
<li>derivative å¯¼æ•°</li>
<li>difference å’Œç¬¬ä¸€ä¸ªç»“æœç›¸å‡å¾—åˆ°ä¸åŒ</li>
<li>elapsed  å¾—åˆ°æ—¶é—´æˆ³çš„ä¸åŒ</li>
<li>floor  ç›®å‰è¿˜ä¸æ”¯æŒ</li>
<li>histogram ç›®å‰è¿˜ä¸æ”¯æŒ</li>
<li>moving_average æ»šåŠ¨å¹³å‡å€¼(åŸæœ‰1,2,3å¾—åˆ°1.5,2.5)</li>
<li>non_negative_derivative éè´Ÿå¯¼æ•°</li>
<li>non_negative_difference éè´Ÿä¸åŒ</li>
</ul>
<h3 id="tsm-Time-Structured-Merge-tree"><a href="#tsm-Time-Structured-Merge-tree" class="headerlink" title="tsm(Time Structured Merge tree)"></a>tsm(Time Structured Merge tree)</h3><p>influxdbçš„ä¸“ç”¨å­˜å‚¨æ ¼å¼ã€‚å…è®¸é«˜å‹ç¼©å’Œé«˜é€Ÿå†™å…¥è¯»å–é€Ÿåº¦è¦é«˜äºå·²å­˜åœ¨çš„B+æ ‘æˆ–è€…LSMæ ‘</p>
<h3 id="user"><a href="#user" class="headerlink" title="user"></a>user</h3><ul>
<li>adminç”¨æˆ·å…·æœ‰è¯»å†™æ‰€æœ‰æ•°æ®åº“çš„æƒé™å¹¶ä¸”å¯ä»¥ç®¡ç†ç”¨æˆ·</li>
<li>éadminæœ‰æ¯ä¸ªæ•°æ®åº“çš„è¯»å†™æƒé™(è¢«adminåˆ†é…)</li>
</ul>
<h3 id="value-per-second"><a href="#value-per-second" class="headerlink" title="value per second"></a>value per second</h3><p>åº¦é‡å†™å…¥é€Ÿåº¦,æ¯”å¦‚æ¯ä¸ªpointæœ‰å››ä¸ªfield,æ¯æ‰¹æœ‰5000ä¸ªpoint.å†™å…¥é€Ÿåº¦ä¸ºæ¯ç§’10ä¸ªã€‚é‚£ä¹ˆvalues per secondé€Ÿç‡ä¸º<code>4*5000*10</code></p>
<h3 id="WAL-write-ahead-log-é¢„å†™æ—¥å¿—"><a href="#WAL-write-ahead-log-é¢„å†™æ—¥å¿—" class="headerlink" title="WAL(write ahead log) é¢„å†™æ—¥å¿—"></a>WAL(write ahead log) é¢„å†™æ—¥å¿—</h3><p>ç•¥</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;ä»¥ä¸‹å†…å®¹åŸºæœ¬å…¨ç¯‡æ‘˜æŠ„è‡ªv1.3çš„å®˜æ–¹æ–‡æ¡£,å…ˆä»ç†è§£ä¸‹é¢è¿™å¼ ä¸¤å¼ å›¾å¼€å§‹&lt;br&gt;&lt;img src=&quot;https://ficapy.b0.upaiyun.com/capture/influxdb_glossary.jpg&quot; alt=&quot;influxdb_glossary&quot;&gt;&lt;br&gt;&lt;img src=&quot;https://ficapy.b0.upaiyun.com/capture/influxdb_field.jpg&quot; alt=&quot;influxdb&quot;&gt;&lt;br&gt;
    
    </summary>
    
      <category term="database" scheme="https://www.zoulei.net/categories/database/"/>
    
    
  </entry>
  
  <entry>
    <title>Elasticsearchç¬”è®°</title>
    <link href="https://www.zoulei.net/2017/12/07/ELK/"/>
    <id>https://www.zoulei.net/2017/12/07/ELK/</id>
    <published>2017-12-07T01:18:08.000Z</published>
    <updated>2017-12-07T01:34:28.783Z</updated>
    
    <content type="html"><![CDATA[<p>ä»¥ä¸‹æ˜¯çœ‹<a href="https://www.udemy.com/complete-elasticsearch-masterclass-with-kibana-and-logstash/">udemyçš„Elasticsearchå…¥é—¨æ•™ç¨‹</a>åšçš„ç®€çŸ­ç¬”è®°</p>
<a id="more"></a>
<ol>
<li><p>åŸºç¡€çŸ¥è¯†ã€ä¸‹è½½ã€é…ç½®(1-3)</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">brew cask install java</div><div class="line">ä¸‹è½½elasticsearchã€kibana</div><div class="line">config/kibana é…ç½®æ–‡ä»¶</div><div class="line">bin/elasticsearch   (9200)</div><div class="line">bin/kibana  å¯åŠ¨(5601ç«¯å£)</div></pre></td></tr></table></figure>
<p> Elasticsearch is Document Oriented</p>
<ul>
<li>insert Documents</li>
<li>Delete Documents</li>
<li>Retrieve Documents</li>
<li>Analyze Documents</li>
<li><p>Search Documents</p>
<h4 id="inverted-index"><a href="#inverted-index" class="headerlink" title="inverted index"></a>inverted index</h4><h4 id="JSONå¯¹è±¡-ç»å…¸æ•°æ®åº“çš„Tableæ¨¡å‹è½¬å˜ä¸ºJSONæ¨¡å‹"><a href="#JSONå¯¹è±¡-ç»å…¸æ•°æ®åº“çš„Tableæ¨¡å‹è½¬å˜ä¸ºJSONæ¨¡å‹" class="headerlink" title="JSONå¯¹è±¡(ç»å…¸æ•°æ®åº“çš„Tableæ¨¡å‹è½¬å˜ä¸ºJSONæ¨¡å‹)"></a>JSONå¯¹è±¡(ç»å…¸æ•°æ®åº“çš„Tableæ¨¡å‹è½¬å˜ä¸ºJSONæ¨¡å‹)</h4><p>ElasticSearch | Relational DB<br>â€” | â€”<br>Field   | Column<br>Document    | Row<br>Type    |   Table<br>Index   |   Database</p>
</li>
</ul>
</li>
<li><p>æ•°æ®å­˜å‚¨å¼•æ“ã€åˆ†å¸ƒå¼å·¥ä½œå¼•æ“é›†ç¾¤ï¼Œshard(4-7)</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">PUT /&#123;index&#125;/&#123;type&#125;/&#123;id&#125;</div><div class="line">&#123;</div><div class="line">    &quot;field1&quot;: &quot;value1&quot;,</div><div class="line">    &quot;field2&quot;: &quot;value2&quot;</div><div class="line">    ...</div><div class="line">&#125;</div><div class="line">ç›¸åŒçš„idæ’å…¥ä¼šç”Ÿæˆä¸åŒçš„ç‰ˆæœ¬å·</div><div class="line">æ›´æ–°æ•°æ®çš„åŸç†æ˜¯è¯»å–æ•°æ®åˆå¹¶å†put.åªæ”¯æŒrowçº§åˆ«ï¼Œä¸æ”¯æŒå­—æ®µçº§åˆ«</div><div class="line">DELETE /vehicles/car/123</div><div class="line">&#123;</div><div class="line">    &quot;_index&quot;: &quot;vehicles&quot;,</div><div class="line">    &quot;_type&quot;: &quot;car&quot;,</div><div class="line">    &quot;_id&quot;: &quot;123&quot;,</div><div class="line">    &quot;_version&quot;: 13,</div><div class="line">    &quot;result&quot;: &quot;deleted&quot;,</div><div class="line">    &quot;_shards&quot;: &#123;</div><div class="line">        &quot;total&quot;: 2,</div><div class="line">        &quot;successful&quot;: 1,</div><div class="line">        &quot;failed&quot;: 0</div><div class="line">    &#125;,</div><div class="line">    &quot;_seq_no&quot;: 12,</div><div class="line">    &quot;_primary_term&quot;: 1</div><div class="line">&#125;</div><div class="line">å³ä½¿åˆ é™¤åŒæ ·ä¹Ÿä¸ä¼šçœŸçš„åˆ é™¤æ•°æ®åªä¼šè¿›è¡Œæ ‡è®°ã€‚ç£ç›˜ç©ºé—´ä¸ä¼šç«‹å³é‡Šæ”¾</div></pre></td></tr></table></figure>
<p> mappings and settings.mappingsç±»ä¼¼ä¸æ•°æ®åº“ä¸­çš„schema</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">&quot;settings&quot;: &#123;</div><div class="line">  &quot;index&quot;: &#123;</div><div class="line">    &quot;creation_date&quot;: &quot;1512370059209&quot;,</div><div class="line">    &quot;number_of_shards&quot;: &quot;5&quot;,</div><div class="line">    &quot;number_of_replicas&quot;: &quot;1&quot;,</div><div class="line">    &quot;uuid&quot;: &quot;Obppoj9yT4eQg5oq6Zv5IA&quot;,</div><div class="line">    &quot;version&quot;: &#123;</div><div class="line">      &quot;created&quot;: &quot;6000099&quot;</div><div class="line">    &#125;,</div><div class="line">    &quot;provided_name&quot;: &quot;vehicles&quot;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p> <code>GET business/_search</code></p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">GET business/building/_search</div><div class="line">&#123;</div><div class="line">    &quot;query&quot;:&#123;</div><div class="line">        &quot;term&quot;:&#123;&quot;address&quot;:&quot;pen&quot;&#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line">PUTæ•°æ®åç»è¿‡åˆ†æè¿›è¡Œåˆ†è¯å†™å…¥å†…å­˜ã€‚åˆ°è¾¾ä¸€å®šæ•°é‡åæŒä¹…åŒ–å†™å…¥ç£ç›˜ã€‚ç»„æˆsegmentã€‚ä¸”ä¸å¯å˜</div><div class="line">tokenization -&gt; filter</div><div class="line">1. Remove Stop Words</div><div class="line">2. Lowercasing</div><div class="line">3. Stemming</div><div class="line">4. Synonyms</div></pre></td></tr></table></figure>
<p> Token | Exists in<br> â€” | â€”<br> token   |   1</p>
<p> <img src="https://ficapy.b0.upaiyun.com/capture/elasticsearch_analyzer.jpeg" alt="elasticsearch_analyzer"></p>
</li>
</ol>
<ol>
<li><p>inverted index(8-9)</p>
<p> Data Types for Document Fields</p>
<p> String Fields: text,keyword<br> Numeric Fields: long,integer,short,byte,double,float<br> Date Fields: text,keyword<br> True/False Fields: boolean<br> Binary Fields: binary</p>
<p> - æ³¨æ„ã€‚å’Œæ•™ç¨‹ä¸ä¸€è‡´äº†ã€‚æ•™ç¨‹ä½¿ç”¨çš„5ç‰ˆæœ¬ï¼Œæ–°ç‰ˆæœ¬6è¿›è¡Œäº†ç ´åæ€§å‡çº§ã€‚ä»¥å‰index/type/documentsçš„æ¦‚å¿µåç»­ä¼šå»æ‰typeã€‚åœ¨6é‡Œé¢å•ä¸ªindexé‡Œé¢æ— æ³•å­˜å‚¨å¤šä¸ªtypeã€‚æ•…ä¹Ÿæ— æ³•è®¾ç½®å¤šä¸ªmapping</p>
<ul>
<li>å…³é—­å†™å…¥å†…å®¹æ—¶è‡ªåŠ¨ç”Ÿæˆmappings(dynamic:false/strict)</li>
<li><p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/analysis-analyzers.html">å„ç§analyzeræµ‹è¯•</a></p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">POST _analyze</div><div class="line">&#123;</div><div class="line">&quot;analyzer&quot;: &quot;simple&quot;,</div><div class="line">&quot;text&quot;: &quot;The 2 QUICK Brown-Foxes jumped over the lazy dog&apos;s bone.&quot;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ol>
<ol>
<li><p>search DSL (10-14)</p>
<ul>
<li>Domain Specific Language</li>
<li><p>Query Context &amp; Filter Context</p>
<ol>
<li><p>Query</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">match_all</div><div class="line">&quot;match&quot;: &#123;&quot;name&quot;: &quot;computer&quot;&#125; </div><div class="line">è¿™æŸ¥è¯¢è¯­æ³•ç®€ç›´è®©äººæœ‰ç§ç”Ÿä¸å¦‚æ­»çš„æ„Ÿè§‰</div><div class="line">GET /courses/_search</div><div class="line">&#123;</div><div class="line">&quot;query&quot;: &#123;</div><div class="line">    &quot;bool&quot;: &#123;</div><div class="line">    &quot;must&quot;: [&#123;&quot;match&quot;: &#123;&quot;room&quot;: &quot;c8&quot;&#125;&#125;,</div><div class="line">        &#123;&quot;match&quot;: &#123;&quot;name&quot;: &quot;computer&quot;&#125;&#125;]</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line">&#125;</div><div class="line">must/must_not/should/minimun_should_match</div><div class="line">multi_match/match_phrase /match_phrase_prefix</div><div class="line">range</div></pre></td></tr></table></figure>
</li>
<li><p>Filter</p>
<ul>
<li>ä¸èƒ½å•ç‹¬ä½¿ç”¨</li>
<li>ä¸è¿›è¡Œè¯„åˆ†</li>
<li>ElasticSearchä¼šå¯¹ç»“æœè¿›è¡Œç¼“å­˜</li>
<li>å¯ä»¥å…ˆå¸¸è§„æŸ¥è¯¢å¾—åˆ°è¯„åˆ†ã€‚å†ä½¿ç”¨filterå¯¹ç»“æœè¿‡æ»¤</li>
</ul>
</li>
<li><p>Aggregation</p>
<ul>
<li>endpoint-&gt;_search/_count</li>
<li>bulk indexing</li>
<li>terms:fieldç±»ä¼¼ä¸groupã€aggsæ¥èšåˆã€avgã€maxã€minå‡½æ•°(å¦‚æœéœ€è¦æ ¹æ®èšåˆçš„ç»“æœæ¥æ’åºæ€ä¹ˆåŠ)</li>
<li>å…ˆæ‰§è¡Œqueryã€‚åé¢æ ¹æ®ç»“æœè¿›è¡Œèšåˆ</li>
<li>stats(minã€maxã€avgã€sum)</li>
<li>bucketå’Œmetricçš„æ¦‚å¿µã€‚range  <ul>
<li>å¯¹äºgroup byå¾—åˆ°çš„ç»“æœå†æ¬¡ä½¿ç”¨range(fromã€to)è¿›è¡ŒäºŒæ¬¡åˆ†ç»„ã€‚åˆ†ç»„åå¯ä»¥åµŒå¥—ä½¿ç”¨aggèšåˆ</li>
</ul>
</li>
</ul>
</li>
</ol>
</li>
</ul>
</li>
<li><p>logstash and kibana (15-17)</p>
<ol>
<li><p>logstash</p>
<ul>
<li>inputã€filterã€output(rubyè¯­æ³•)</li>
</ul>
</li>
<li><p>Kibana</p>
<ul>
<li>kibanaéœ€è¦å…ˆè®¾ç½®é»˜è®¤index</li>
<li>Visualizeæ–°å»ºå•ä¸ªè§†å›¾ã€Dashboardç»„åˆå®ƒä»¬</li>
</ul>
</li>
</ol>
</li>
</ol>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;ä»¥ä¸‹æ˜¯çœ‹&lt;a href=&quot;https://www.udemy.com/complete-elasticsearch-masterclass-with-kibana-and-logstash/&quot;&gt;udemyçš„Elasticsearchå…¥é—¨æ•™ç¨‹&lt;/a&gt;åšçš„ç®€çŸ­ç¬”è®°&lt;/p&gt;
    
    </summary>
    
      <category term="database" scheme="https://www.zoulei.net/categories/database/"/>
    
    
  </entry>
  
  <entry>
    <title>influxdbé…ç½®æ–‡ä»¶</title>
    <link href="https://www.zoulei.net/2017/12/01/influxdb_config/"/>
    <id>https://www.zoulei.net/2017/12/01/influxdb_config/</id>
    <published>2017-12-01T14:38:46.000Z</published>
    <updated>2017-12-08T23:59:26.538Z</updated>
    
    <content type="html"><![CDATA[<p>å¼€å§‹ä¸€ä¸ªè½¯ä»¶,ä»è¯»æ‡‚å®ƒçš„é…ç½®æ–‡ä»¶å¼€å§‹ã€‚ä»¥ä¸‹æ˜¯è¯»å–<a href="https://docs.influxdata.com/influxdb/v1.3/administration/config/">3.1é…ç½®æ–‡æ¡£</a>çš„ç¬”è®°<br>æ€»ç»“æ¥è¯´ï¼Œinfluxdbçš„é…ç½®æ–‡ä»¶å¯é…ç½®çš„åœ°æ–¹å‡ ä¹æ²¡æœ‰ã€‚å‚æ•°æ€§èƒ½è°ƒä¼˜è²Œä¼¼ä¸å­˜åœ¨ï¼Œå…¶ä¸­æ˜¯å¦å¼€å¯ï¼Œæ˜¯å¦è®°å½•æ—¥å¿—éƒ½å æ®äº†å¥½å¤šéƒ¨åˆ†ã€‚é¢å¤–éœ€è¦å…³æ³¨çš„æ˜¯dataç« èŠ‚æœ‰ä¸€äº›å…³äºfsyncçš„è®¾ç½®é»˜è®¤æ˜¯0ï¼Œè¿˜æœ‰é»˜è®¤çš„max-series-per-databaseå’Œmax-value-per-tagé»˜è®¤éƒ½å­˜åœ¨é™åˆ¶ã€‚æš‚æ—¶ä¸å¤ªæ¸…æ¥šåŸç†æ˜¯ä»€ä¹ˆ(æ›´æ–°:å› ä¸ºinfluxdbæœ€å¤§çš„è½¯è‚‹å°±åœ¨seriesçš„æ•°é‡ä¸Šã€‚tagçš„æ•°æ®éƒ½ä¿å­˜åœ¨å†…å­˜ã€‚æ‰€ä»¥æœ‰æå¤§çš„é™åˆ¶ã€‚å¯ä»¥çœ‹åˆ°<a href="https://docs.influxdata.com/influxdb/v1.3/guides/hardware_sizing/#general-hardware-guidelines-for-a-cluster">å®˜æ–¹ç¡¬ä»¶è¦æ±‚</a>,100ä¸‡çš„serieséœ€è¦4-6æ ¸å¿ƒCPU,8-32GBå†…å­˜ï¼Œiopsè¦æ±‚1000+ã€‚å¯¹æ¯”ä¸€ä¸‹influxdbæä¾›çš„<a href="https://cloud.influxdata.com/plan-picker">äº‘æœåŠ¡</a>ï¼Œ100ä¸‡çš„serieséœ€è¦æ¯æœˆ1500åˆ€!!!)ã€‚å½“ä¿å­˜å¤§é‡æ•°æ®çš„æ—¶å€™è‚¯å®šä¼šæŠ¥é”™,å¦å¤–é»˜è®¤çš„æ…¢æŸ¥è¯¢æ—¥å¿—æ˜¯æ²¡æœ‰æ‰“å¼€çš„ã€‚å¯¹äºè¯·æ±‚ã€‚é»˜è®¤æ²¡æœ‰é™åˆ¶æœ€å¤§çš„è¿”å›å†…å®¹æ•°ã€‚ä»¥åŠé™åˆ¶å•ä¸ªæŸ¥è¯¢å“åº”çš„æ—¶é—´</p>
<a id="more"></a>
<h1 id="ä½¿ç”¨é…ç½®æ–‡ä»¶"><a href="#ä½¿ç”¨é…ç½®æ–‡ä»¶" class="headerlink" title="ä½¿ç”¨é…ç½®æ–‡ä»¶"></a>ä½¿ç”¨é…ç½®æ–‡ä»¶</h1><ul>
<li>ä½¿ç”¨<code>influxd config</code>æŸ¥çœ‹é»˜è®¤çš„é…ç½®</li>
<li>ä½¿ç”¨<code>influxd -config config_path</code>æˆ–è€…<code>INFLUXDB_CONFIG_PATH</code>å¯åŠ¨</li>
</ul>
<h2 id="ç¯å¢ƒå˜é‡"><a href="#ç¯å¢ƒå˜é‡" class="headerlink" title="ç¯å¢ƒå˜é‡"></a>ç¯å¢ƒå˜é‡</h2><p>é…ç½®ä¼˜å…ˆçº§ä¸º: ç¯å¢ƒå˜é‡ &gt; æ–‡ä»¶é…ç½® &gt; é»˜è®¤è®¾ç½®</p>
<h2 id="å…¨å±€é€‰é¡¹"><a href="#å…¨å±€é€‰é¡¹" class="headerlink" title="å…¨å±€é€‰é¡¹"></a>å…¨å±€é€‰é¡¹</h2><ol>
<li>reporting-disabled  å‘é€æ•°æ®ç»Ÿè®¡ç»™influxdb</li>
<li>bind-address        ç»‘å®šç›‘å¬åœ°å€(RPC)</li>
<li>GOMAXPROCS          æœ€å¤§è¿›ç¨‹æ•°</li>
</ol>
<h2 id="meta"><a href="#meta" class="headerlink" title="[meta]"></a>[meta]</h2><ol>
<li>dir   metaæ•°æ®ä¿å­˜åœ°å€(ä¸€èˆ¬è®¾ç½®ä¸€ä¸ªbase_dir)</li>
<li>retention-autocreate è‡ªåŠ¨åˆ›å»ºä¿ç•™ç­–ç•¥ã€‚é»˜è®¤æ°¸ä¹…ä¿ç•™</li>
<li>logging-enabled  å¼€å¯metaæ—¥å¿—è®°å½•</li>
</ol>
<h2 id="data"><a href="#data" class="headerlink" title="[data]"></a>[data]</h2><ol>
<li>dir  æ•°æ®ä¿å­˜åœ°å€</li>
<li>index-version å†³å®šåˆ†ç‰‡ç´¢å¼•ä¿å­˜å†…å­˜è¿˜æ˜¯ç£ç›˜</li>
<li>wal-dir  é¢„å†™æ—¥å¿—ä¿å­˜åœ°å€</li>
<li>wal-fsync-delay  é¢„å†™æ—¥å¿—åˆ·æ–°å»¶è¿Ÿ(éssdç£ç›˜å»ºè®®0-100ms)</li>
<li>trace-logging-enabled TSMå¼•æ“å’ŒWALæ—¥å¿—</li>
<li>query-log-enabled   æ˜¯å¦è®°å½•æŸ¥è¯¢æ—¥å¿—</li>
<li>cache-max-memory-size    æœ€å¤§ç¼“å­˜å®¹é‡,å æ»¡ä¼šæ‹’ç»å†™å…¥</li>
<li>cache-snapshot-memory-size ç¼“å­˜å¿«ç…§å¤§å°ã€‚æ»¡åä¼šå°†å†…å­˜å†…å®¹å†™å…¥åˆ°TSMæ–‡ä»¶</li>
<li>cache-snapshot-write-cold-duration å¦‚æœä¸€ä¸ªåˆ†ç‰‡æ²¡æœ‰è¢«å†™å…¥æˆ–è€…åˆ é™¤ä¼šè¢«å†™å…¥åˆ°TSMæ–‡ä»¶çš„æ—¶é—´</li>
<li>compact-full-write-cold-duration åŒä¸Šï¼Œæ²¡æœ‰å†™å…¥æˆ–è€…åˆ é™¤çš„å‹ç¼©æ—¶é—´</li>
<li>max-concurrent-compactions  å¹¶å‘å‹ç¼©è¿›ç¨‹æ•°</li>
<li>max-series-per-database   æ¯ä¸ªæ•°æ®åº“æœ€å¤§çš„seriesæ•°é‡ã€‚è¶…è¿‡ä¼š500é”™è¯¯ã€‚0è¡¨ç¤ºæ— é™åˆ¶(ä¸ºä»€ä¹ˆéœ€è¦é™åˆ¶å‘¢ï¼Ÿ)</li>
<li>max-values-per-tag æ¯ä¸ªtagç´¢å¼•çš„å€¼ä¸ªæ•°(åŒç–‘é—®ä¸ºä»€ä¹ˆé™åˆ¶ä¸ºåä¸‡)</li>
</ol>
<h2 id="coordinator"><a href="#coordinator" class="headerlink" title="[coordinator]"></a>[coordinator]</h2><ol>
<li>write-timeout    å†™å…¥è¶…æ—¶æ—¶é—´10ç§’</li>
<li>max-concurrent-queries  æœ€å¤§å¹¶å‘æŸ¥è¯¢æ•°é»˜è®¤æ— é™åˆ¶</li>
<li>query-timeout   æŸ¥è¯¢è¶…æ—¶æ—¶é—´é»˜è®¤æ— é™åˆ¶</li>
<li>log-queries-after æ…¢æŸ¥è¯¢æ£€æµ‹ã€‚ä¸ºæ…¢æŸ¥è¯¢åˆ™è®°å½•æ—¥å¿—</li>
<li>max-select-point æœ€å¤§çš„pointsæ•°é‡ã€‚é»˜è®¤æ— é™åˆ¶</li>
<li>max-select-series  æœ€å¤§çš„seriesæ•°é‡ã€‚é»˜è®¤æ— é™åˆ¶</li>
<li>max-select-buckets   æœ€å¤§çš„GROUP BY time()æ•°é‡ã€‚é»˜è®¤æ— é™åˆ¶</li>
</ol>
<h2 id="retention"><a href="#retention" class="headerlink" title="[retention]"></a>[retention]</h2><ol>
<li>enable  è®¾ç½®ä¸ºfalseåˆ™ç¦æ­¢åˆ é™¤æ•°æ®</li>
<li>check-interval  æ£€æŸ¥å‘¨æœŸé»˜è®¤ä¸‰ååˆ†é’Ÿ</li>
</ol>
<h2 id="shard-precreation"><a href="#shard-precreation" class="headerlink" title="[shard-precreation]"></a>[shard-precreation]</h2><ol>
<li>enable å¼€å¯æ•°æ®åˆ°è¾¾å‰å…ˆåˆ›å»ºshard</li>
<li>check-interval  æ£€æŸ¥å‘¨æœŸ</li>
<li>advance-period  é¢„åˆ›å»ºshardçš„æœ€å¤§æ—¶é—´</li>
</ol>
<h2 id="admin"><a href="#admin" class="headerlink" title="[admin]"></a>[admin]</h2><p>å®˜æ–¹å®Œå…¨åºŸå¼ƒï¼Œä¸å¯ç”¨ã€‚ç”±xxæ›¿ä»£(æ³¨:è¿˜æ˜¯ç”¨grafanaå§)</p>
<h2 id="monitor"><a href="#monitor" class="headerlink" title="[monitor]"></a>[monitor]</h2><p>ç³»ç»Ÿè‡ªèº«ç›‘æ§ã€‚é»˜è®¤æ•°æ®ä¼šä¿å­˜åˆ°_internalæ•°æ®åº“</p>
<ol>
<li>store-enabled  æ˜¯å¦å­˜å‚¨ç›‘æ§ä¿¡æ¯</li>
<li>store-database ä¿å­˜æ•°æ®åº“çš„åç§°</li>
<li>store-interval  è®°å½•é—´éš”ã€‚é»˜è®¤åç§’</li>
</ol>
<h2 id="subscriber"><a href="#subscriber" class="headerlink" title="[subscriber]"></a>[subscriber]</h2><p>è¿™ä¸ªéƒ¨åˆ†æ˜¯æ§åˆ¶Kapacitorå¦‚ä½•æ¥æ”¶æ•°æ®ã€‚åº”è¯¥æ²¡ä»€ä¹ˆç”¨å¤„</p>
<ol>
<li>enabled</li>
<li>http-timeout</li>
<li>insecure-skip-verify</li>
<li>ca-certs</li>
<li>write-concurrency</li>
<li>write-buffer-size</li>
</ol>
<h2 id="http"><a href="#http" class="headerlink" title="[http]"></a>[http]</h2><p>é™¤äº†RPCè°ƒç”¨ã€‚å°±æ˜¯RESTFULæ–¹å¼çš„apiè¯»å†™äº†</p>
<ol>
<li>enable  æ˜¯å¦æ‰“å¼€</li>
<li>bind-address ç»‘å®šåœ°å€</li>
<li>auth-enabled æ‰“å¼€éªŒè¯</li>
<li>realm  JWTéªŒè¯ç›¸å…³</li>
<li>log-enabled è®°å½•æ—¥å¿—</li>
<li>write-tracing åº”è¯¥æ˜¯è°ƒè¯•ä½¿ç”¨ã€‚ä¼šè®°å½•å†™å…¥çš„payload</li>
<li>pprof-enabled å¼€å¯æ€§èƒ½è®°å½•</li>
<li>https-enabled  å¼€å¯https</li>
<li>https-certificate httpsè¯ä¹¦</li>
<li>https-private-key  httpsç§é’¥</li>
<li>shared-secret  ç”¨äºJWTçš„ç­¾åã€‚æƒ³æƒ³å•æœºåº”è¯¥æ˜¯ç”¨ä¸åˆ°çš„</li>
<li>max-row-limit  æœ€å¤§å•æ¬¡å¯ä»¥ä¸Šä¼ çš„pointï¼Œé»˜è®¤æ— é™åˆ¶</li>
<li>max-connection-limit æœ€å¤§å¯è¿æ¥æ•°ï¼Œé»˜è®¤æ— é™åˆ¶</li>
<li>unix-socket-enabled  å¼€å¯unixåŸŸè¿æ¥</li>
<li>bind-socket  ç»‘å®šsocketåŸŸ</li>
<li>max-body-size  æœ€å¤§bodyé•¿åº¦,é»˜è®¤25MBï¼Œè¶…è¿‡å¤§å°è¿”å›http413è¯·æ±‚å®ä½“è¿‡å¤§é”™è¯¯</li>
</ol>
<h2 id="graphite"><a href="#graphite" class="headerlink" title="[[graphite]]"></a>[[graphite]]</h2><p>(service plugin)è®¾ç½®ä¸€ä¸ªæˆ–å¤šä¸ªgraphiteæ•°æ®ç›‘å¬å™¨</p>
<ol>
<li>enabled å¯ç”¨graphite</li>
<li>database   æ•°æ®åº“åç§°</li>
<li>retention-policy ä¿ç•™ç­–ç•¥</li>
<li>bind-address  ç»‘å®šåœ°å€</li>
<li>protocol     åè®®tcpæˆ–udp</li>
<li>consistency-level   ä¸€è‡´æ€§çº§åˆ«</li>
<li>batch-size</li>
<li>batch-pending</li>
<li>batch-timeout</li>
<li>udp-read-buffer</li>
<li>separator</li>
</ol>
<h2 id="collectd"><a href="#collectd" class="headerlink" title="[[collectd]]"></a>[[collectd]]</h2><p>(service plugin)åŒä¸Šï¼Œè®¾ç½®ç›‘å¬collectdæ•°æ®</p>
<ol>
<li>enabled</li>
<li>bind-address</li>
<li>database</li>
<li>retention-policy</li>
<li>typesdb</li>
<li>security-level</li>
<li>auth-file</li>
<li>batch-size</li>
<li>batch-pending</li>
<li>batch-timeout</li>
<li>read-buffer</li>
</ol>
<h2 id="opentsdb"><a href="#opentsdb" class="headerlink" title="[[opentsdb]]"></a>[[opentsdb]]</h2><p>(service plugin)åŒä¸Šï¼Œè®¾ç½®ç›‘å¬opentsdbæ•°æ®</p>
<ol>
<li>enabled</li>
<li>bind-address</li>
<li>database</li>
<li>retention-policy</li>
<li>consistency-level</li>
<li>tls-enabled</li>
<li>certificate</li>
<li>log-point-errors</li>
<li>batch-size</li>
<li>batch-pending</li>
<li>batch-timeout</li>
</ol>
<h2 id="udp"><a href="#udp" class="headerlink" title="[[udp]]"></a>[[udp]]</h2><p>(service plugin)é™¤äº†RPCã€HTTPã€é™„å¸¦UDP</p>
<ol>
<li>enabled</li>
<li>bind-address</li>
<li>database</li>
<li>retention-policy</li>
<li>batch-size</li>
<li>batch-pending</li>
<li>batch-timeout</li>
<li>read-buffer</li>
<li>precision</li>
</ol>
<h1 id="continuous-queries"><a href="#continuous-queries" class="headerlink" title="[continuous_queries]"></a>[continuous_queries]</h1><p>æŒç»­æŸ¥è¯¢</p>
<ol>
<li>enabled  å¼€å¯</li>
<li>query-stats-enabled  é»˜è®¤å…³é—­ï¼Œå°†æ‰§è¡Œç»Ÿè®¡å†™å…¥åˆ°é»˜è®¤çš„ç›‘æ§æ•°æ®åº“  </li>
<li>log-enabled  è®°å½•æ—¥å¿—</li>
<li>run-interval  æŸ¥æ‰¾æ‰§è¡Œé—´éš”</li>
</ol>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;å¼€å§‹ä¸€ä¸ªè½¯ä»¶,ä»è¯»æ‡‚å®ƒçš„é…ç½®æ–‡ä»¶å¼€å§‹ã€‚ä»¥ä¸‹æ˜¯è¯»å–&lt;a href=&quot;https://docs.influxdata.com/influxdb/v1.3/administration/config/&quot;&gt;3.1é…ç½®æ–‡æ¡£&lt;/a&gt;çš„ç¬”è®°&lt;br&gt;æ€»ç»“æ¥è¯´ï¼Œinfluxdbçš„é…ç½®æ–‡ä»¶å¯é…ç½®çš„åœ°æ–¹å‡ ä¹æ²¡æœ‰ã€‚å‚æ•°æ€§èƒ½è°ƒä¼˜è²Œä¼¼ä¸å­˜åœ¨ï¼Œå…¶ä¸­æ˜¯å¦å¼€å¯ï¼Œæ˜¯å¦è®°å½•æ—¥å¿—éƒ½å æ®äº†å¥½å¤šéƒ¨åˆ†ã€‚é¢å¤–éœ€è¦å…³æ³¨çš„æ˜¯dataç« èŠ‚æœ‰ä¸€äº›å…³äºfsyncçš„è®¾ç½®é»˜è®¤æ˜¯0ï¼Œè¿˜æœ‰é»˜è®¤çš„max-series-per-databaseå’Œmax-value-per-tagé»˜è®¤éƒ½å­˜åœ¨é™åˆ¶ã€‚æš‚æ—¶ä¸å¤ªæ¸…æ¥šåŸç†æ˜¯ä»€ä¹ˆ(æ›´æ–°:å› ä¸ºinfluxdbæœ€å¤§çš„è½¯è‚‹å°±åœ¨seriesçš„æ•°é‡ä¸Šã€‚tagçš„æ•°æ®éƒ½ä¿å­˜åœ¨å†…å­˜ã€‚æ‰€ä»¥æœ‰æå¤§çš„é™åˆ¶ã€‚å¯ä»¥çœ‹åˆ°&lt;a href=&quot;https://docs.influxdata.com/influxdb/v1.3/guides/hardware_sizing/#general-hardware-guidelines-for-a-cluster&quot;&gt;å®˜æ–¹ç¡¬ä»¶è¦æ±‚&lt;/a&gt;,100ä¸‡çš„serieséœ€è¦4-6æ ¸å¿ƒCPU,8-32GBå†…å­˜ï¼Œiopsè¦æ±‚1000+ã€‚å¯¹æ¯”ä¸€ä¸‹influxdbæä¾›çš„&lt;a href=&quot;https://cloud.influxdata.com/plan-picker&quot;&gt;äº‘æœåŠ¡&lt;/a&gt;ï¼Œ100ä¸‡çš„serieséœ€è¦æ¯æœˆ1500åˆ€!!!)ã€‚å½“ä¿å­˜å¤§é‡æ•°æ®çš„æ—¶å€™è‚¯å®šä¼šæŠ¥é”™,å¦å¤–é»˜è®¤çš„æ…¢æŸ¥è¯¢æ—¥å¿—æ˜¯æ²¡æœ‰æ‰“å¼€çš„ã€‚å¯¹äºè¯·æ±‚ã€‚é»˜è®¤æ²¡æœ‰é™åˆ¶æœ€å¤§çš„è¿”å›å†…å®¹æ•°ã€‚ä»¥åŠé™åˆ¶å•ä¸ªæŸ¥è¯¢å“åº”çš„æ—¶é—´&lt;/p&gt;
    
    </summary>
    
      <category term="database" scheme="https://www.zoulei.net/categories/database/"/>
    
    
  </entry>
  
  <entry>
    <title>ansibleç¬”è®°</title>
    <link href="https://www.zoulei.net/2017/11/28/ansible-note/"/>
    <id>https://www.zoulei.net/2017/11/28/ansible-note/</id>
    <published>2017-11-28T03:28:42.000Z</published>
    <updated>2017-11-28T03:57:18.299Z</updated>
    
    <content type="html"><![CDATA[<p>ä»¥ä¸‹ä¸ºè§‚çœ‹<a href="https://www.youtube.com/playlist?list=PL7hgvWUGJtUsT74AXZgVhr37riphKjzkD">Ansible-Configuration Management</a>çš„ç¬”è®°ã€‚ä¸é€‚åˆåˆå­¦è€…æŸ¥çœ‹ã€‚å¯ä»¥ä½œä¸ºæ¸©ä¹ ä½¿ç”¨</p>
<a id="more"></a>
<h2 id="Ansibleæ€»ç»“"><a href="#Ansibleæ€»ç»“" class="headerlink" title="Ansibleæ€»ç»“"></a>Ansibleæ€»ç»“</h2><ol>
<li>å•ä¸ªModuleæ˜¯åŸºçŸ³ï¼Œå°†æœºå™¨åˆ†ç»„ï¼Œä¸¥é‡ä¾é å˜é‡</li>
<li>taskç»„æˆä»»åŠ¡</li>
<li>å…¨éƒ¨çš„taskç»„æˆplaybooks.å°†æ‰€æœ‰çš„æœºå™¨å®šä¹‰åˆ°ä¸€ä¸ªç¡®å®šçš„çŠ¶æ€</li>
<li>ä½¿ç”¨roleå¯¹playbooksè¿›è¡Œæ‹†åˆ†.roleæœ‰çº¦å®šå¥½çš„ç›®å½•ç»“æ„</li>
<li>ansible galaxyæ¥åˆ†äº«role.ä½¿ç”¨æ—¶å®Œå…¨ä½¿ç”¨å˜é‡æ¥è¦†ç›–åŸæœ‰å˜é‡,ä¸¥é‡ä¾èµ–ç¤¾åŒºæ°´å¹³(æ¯”å¦‚å›½æƒ…å®‰è£…è®¸å¤šè½¯ä»¶éƒ½éœ€è¦ä½¿ç”¨é•œåƒ,è€Œå¤–å›½ä½œè€…ç¼–å†™roleå¹¶ä¸ä¼šè€ƒè™‘è¿™äº›)</li>
</ol>
<h2 id="ç‰¹ç‚¹"><a href="#ç‰¹ç‚¹" class="headerlink" title="ç‰¹ç‚¹"></a>ç‰¹ç‚¹</h2><ul>
<li>change management(å®šä¹‰ä¸€ä¸ªç‰¹å®šçš„ç³»ç»ŸçŠ¶æ€ï¼Œchange_eventç”¨äºå›è°ƒ)</li>
<li>Provisioning(roleã€‚æœåŠ¡åˆ’åˆ†ã€‚æ¯”å¦‚ä¸€ä¸ªwebserverä¼šä¾æ¬¡æ‰§è¡ŒæŸäº›æ­¥éª¤)</li>
<li>Automation(playbookåŒæ—¶è®¾ç½®ä¸Šåƒå°)</li>
<li>Orchestration(ç¼–æ’å¤šä¸ªtasksè®©å…¶åè°ƒcoordinatesæ‰§è¡Œã€‚å¤šä¸ªç³»ç»Ÿé…ç½®ã€‚è§£å†³taské—´çš„ä¾èµ–æ€§)</li>
</ul>
<h2 id="ä¸ºä»€ä¹ˆä½¿ç”¨å®ƒ"><a href="#ä¸ºä»€ä¹ˆä½¿ç”¨å®ƒ" class="headerlink" title="ä¸ºä»€ä¹ˆä½¿ç”¨å®ƒ"></a>ä¸ºä»€ä¹ˆä½¿ç”¨å®ƒ</h2><ul>
<li>No agents</li>
<li>No database</li>
<li>No residual software</li>
<li>No complex upgrades</li>
<li>é¢˜å¤–è¯ã€‚ä½¿ç”¨yamlæ–‡ä»¶æè¿°è€Œæ— æ³•ä½¿ç”¨ç¼–ç¨‹æ§åˆ¶ã€‚æˆ‘è®¤ä¸ºè¿Ÿæ—©è¯ä¸¸ã€‚åªä¸è¿‡ç›®å‰è¿˜æ²¡æ‰¾åˆ°æ›´å¥½çš„æ›¿ä»£å“</li>
<li>ssh/root/encrypted vault(å…±äº«åˆ°githubä»“åº“æˆæ ‡é…äº†,å‡ ä¹æ‰€æœ‰çš„è½¯ä»¶éƒ½æ˜¯è¿™ä¸ªå¥—è·¯)</li>
<li>easy to extend:http callã€shell commands(æŒºæœ‰ç”¨)ã€scripts(æš‚æ—¶ä¸å¤ªæ‡‚ï¼Œæ„Ÿè§‰æ˜¯æ‰©å……model)ã€Ansible-Galaxy</li>
</ul>
<h2 id="Ansible-æ¶æ„"><a href="#Ansible-æ¶æ„" class="headerlink" title="Ansible æ¶æ„"></a>Ansible æ¶æ„</h2><p><img src="https://ficapy.b0.upaiyun.com/capture/ansible_arch.jpg" alt="Ansible æ¶æ„"></p>
<p>Variables:</p>
<ul>
<li>Host Variables: åœ¨èµ„äº§ä¸­ç»™hostæˆ–è€…groupè®¾ç½®çš„å˜é‡</li>
<li>Facts: ansibleè¿›è¡Œçš„ç¬¬ä¸€æ­¥å°±æ˜¯setupã€‚è·å–æœºå™¨çš„åŸºç¡€ä¿¡æ¯ã€‚æ¯”å¦‚å†…ç½‘ip</li>
<li>Dynamic Variables: æ”¶é›†tasksæ•°æ®æˆ–è€…è¿è¡Œæ—¶è·å–ï¼Ÿæ¯”å¦‚å°†ä¸Šä¸€ä¸ªtaskçš„ç»“æœä½œä¸ºå‚æ•°</li>
</ul>
<p>æ‰§è¡Œè¿‡ç¨‹ä¸­å°†modelå‘é€åˆ°è¿œæ–¹æœºå™¨ä¸´æ—¶ç›®å½•æ‰§è¡Œã€‚è¿”å›jsonç»“æœã€‚ç„¶ååˆ é™¤ä¸´æ—¶ç›®å½•å†…å®¹</p>
<h2 id="å­¦ä¹ ç¯å¢ƒæ­å»º-è§†é¢‘19"><a href="#å­¦ä¹ ç¯å¢ƒæ­å»º-è§†é¢‘19" class="headerlink" title="å­¦ä¹ ç¯å¢ƒæ­å»º(è§†é¢‘19)"></a>å­¦ä¹ ç¯å¢ƒæ­å»º(è§†é¢‘19)</h2><ul>
<li>Vagrantã€Virtualboxã€Ansible</li>
<li>Remoteã€Local(åŸºæœ¬ä¸ä½¿ç”¨Localæ¨¡å¼ã€‚ä»…æœ‰ä¸€æ¬¡æ— æ³•è¿œç¨‹sshæˆ‘ç”¨è¿‡)</li>
</ul>
<h2 id="Inventory-Features"><a href="#Inventory-Features" class="headerlink" title="Inventory Features"></a>Inventory Features</h2><ul>
<li>Behavioral Parameters</li>
<li>Groups</li>
<li>Groups of Groups</li>
<li>Assign Variables</li>
<li>Scaling out using multiple files</li>
<li>Static/Dynamic<br>åˆ†ç»„ã€ç»„åˆã€èµ‹äºˆå˜é‡(å’Œpythoné‡Œé¢å˜é‡ä½œç”¨åŸŸLEGBå·®ä¸å¤š)</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">[db]</div><div class="line">db1.company.com ansible_ssh_user=aarom xx=xx</div><div class="line">db2.company.com</div><div class="line"></div><div class="line">[datacenter-west:children]</div><div class="line">db</div><div class="line"></div><div class="line">[datacenter-west:vars]</div><div class="line">ansible_ssh_user=ansible_user</div><div class="line">xx=xx</div></pre></td></tr></table></figure>
<p>åˆ†ç»„çš„å¥—è·¯(group_varsã€host_varsä¸‹é¢çš„æ–‡ä»¶å¿…é¡»å’Œinventoryç›¸å¯¹åº”)<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">â”œâ”€â”€ group_vars   # å…¨å±€</div><div class="line">â”‚Â Â  â”œâ”€â”€ all</div><div class="line">â”‚Â Â  â”œâ”€â”€ db</div><div class="line">â”œâ”€â”€ host_vars   # å•ä¸ªhost</div><div class="line">â”‚Â Â  â””â”€â”€ web1</div><div class="line">â”œâ”€â”€ inventory_prod</div><div class="line">â”œâ”€â”€ inventory_test</div></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"># variable file example</div><div class="line">---     # æ ‡è®°</div><div class="line"># key-value pairs</div><div class="line">ntp:  ntp-west.company.com</div><div class="line">syslog: logger-west.company.com</div></pre></td></tr></table></figure>
<h2 id="Ad-Hoc-ä¸´æ—¶ä½¿ç”¨"><a href="#Ad-Hoc-ä¸´æ—¶ä½¿ç”¨" class="headerlink" title="Ad-Hoc ä¸´æ—¶ä½¿ç”¨"></a>Ad-Hoc ä¸´æ—¶ä½¿ç”¨</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">ansible -m ping all</div><div class="line">ansible -m shell -a &quot;hostname&quot; all</div><div class="line">ansible -m shell -a &quot;getent passwd | grep deploy&quot; all</div><div class="line">ansible -b -K -m shell -a &quot;whoami&quot; all -vvv -T 30 -c paramiko</div></pre></td></tr></table></figure>
<p>å‚æ•°æ³¨è§£</p>
<ul>
<li>-b becomeå˜æˆæŸç”¨æˆ·ä¸€èˆ¬æ˜¯root</li>
<li>-K é…åˆ-bè¾“å…¥å¯†ç </li>
<li>-m ä½¿ç”¨æŸä¸ªæ¨¡å—</li>
<li>-vvv å’Œssh -vvvä¸€æ ·æŸ¥çœ‹è¯¦ç»†æ—¥å¿—</li>
<li>-T timeout è®¾ç½®è¶…æ—¶</li>
<li>-c é€‰æ‹©è¿æ¥çš„æ¨¡å—. 3.5ä½¿ç”¨é»˜è®¤å€¼æsudoå¯èƒ½ä¼šæœ‰é—®é¢˜</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">ä½¿ç”¨å˜é‡(ä¼°è®¡ä½¿ç”¨janja2æ¨¡æ¿å¼•æ“æ˜¯ä¼špythonçš„äººä½¿ç”¨ansibleçš„å”¯ä¸€ä¼˜åŠ¿äº†-_-)</div><div class="line">ansible webservers -i inventory_prod -m user -a &quot;name=&#123;&#123;username&#125;&#125; password=1234 -b&quot;</div></pre></td></tr></table></figure>
<p>ansible-docå¯ä»¥æŸ¥çœ‹æ–‡æ¡£  </p>
<h2 id="Host-Group-Target-Patterns"><a href="#Host-Group-Target-Patterns" class="headerlink" title="Host/Group Target Patterns"></a>Host/Group Target Patterns</h2><ul>
<li>OR (group1:group2)</li>
<li>NOT (!group2)</li>
<li>Wildcard (web*.ex.com)</li>
<li>Regex (~web[0-9]+)</li>
<li>Complex Patterns AND (group1:&amp;group2) # æ±‚äº¤é›†ã€ä¸­é—´å‡ºç°ä¸€ä¸ª:æœ‰ç‚¹å¥‡è‘©</li>
</ul>
<h2 id="Anaible-Playbooks"><a href="#Anaible-Playbooks" class="headerlink" title="Anaible Playbooks"></a>Anaible Playbooks</h2><ul>
<li>ç»„åˆansible modulesç»„æˆplay,å¤šä¸ªplayç»„æˆplaybooks</li>
<li>logic controls &amp; error handle</li>
<li>include åˆå¹¶å¤šä¸ª</li>
<li>Grab output of task for another task(register)</li>
<li>Debug Module(debug/msg or var)</li>
<li>Promptins for input(ç±»ä¼¼ä¸input,vars_prompt)</li>
<li>Playbook Handlers(notify)<ol>
<li>Tasks with asynchronous execution</li>
<li>Only runs tasks when notified</li>
<li>Tasks Only notify when state=changed</li>
<li>Does not run until all playbook tasks have executed</li>
<li>Most common for restarting services to load changes(if changes are made)</li>
</ol>
</li>
<li>Contitional Clause(when: ansible_os_family == â€œDebianâ€,æ­é…registerä½¿ç”¨)</li>
<li>Jinja2 Template Module(template)</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div></pre></td><td class="code"><pre><div class="line">---</div><div class="line">- hosts: webservres</div><div class="line">  sudo: yes</div><div class="line"></div><div class="line">  vars:</div><div class="line">    http_port: 80</div><div class="line">    doc_dir: /ansible/</div><div class="line">    doc_root: /var/www/html/ansible/</div><div class="line">    max_clients: 5</div><div class="line">  </div><div class="line">  vars_prompt:</div><div class="line">    - name: username</div><div class="line">      prompt: what is your name?</div><div class="line"></div><div class="line">  tasks:</div><div class="line">  - name: Ensure that Apache is installed</div><div class="line">    yum: name=httpd state=present</div><div class="line">    when: ansible_os_family == &quot;RedHat&quot;</div><div class="line"></div><div class="line">  - name: Start Apache Services</div><div class="line">    service: name=httpd enabled=yes state=started</div><div class="line"></div><div class="line">  - name: Deploy configuration File</div><div class="line">    template: src=templates/httpd.j2 dest=/etc/httpd/conf/httpd.conf</div><div class="line">    notify:</div><div class="line">      - Restart Apache</div><div class="line">    </div><div class="line">  - name: Copy Site Files</div><div class="line">      template: src=templates/index.j2 dest=&#123;&#123; doc_root &#125;&#125;/index.html</div><div class="line"></div><div class="line">  handlers:</div><div class="line">    - name: Restart Apache</div><div class="line">      service: name=httpd state=restarted</div><div class="line"></div><div class="line">- hosts: dbservers</div><div class="line">  sudo: yes</div><div class="line"></div><div class="line">  tasks:</div><div class="line">  - name: Ensure MySQL is installed</div><div class="line">    yum: name=mysql-server state=present</div><div class="line">  </div><div class="line">  - name: Start MySQL</div><div class="line">    service: name=mysqld state=started</div><div class="line"></div><div class="line">- hosts: webservers:dbservers</div><div class="line">  sudo: yes</div><div class="line"></div><div class="line">  tasks:</div><div class="line">  - name: Stop IPTABLES NOW!!!</div><div class="line">    service: name=iptables state=stopped</div></pre></td></tr></table></figure>
<p>ansible-playbook -i inventory web_db.yaml</p>
<h2 id="Roles"><a href="#Roles" class="headerlink" title="Roles"></a>Roles</h2><ul>
<li>Predefined directory structure</li>
<li>defaultsã€filesã€handlersã€metaã€tasksã€templatesã€vars</li>
<li>main.yml,ä½¿ç”¨include.varsé™¤å¤–</li>
<li>use tags to define categories within your playbooks</li>
<li><p>Adding Roles to Playbook</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">    ---</div><div class="line">    - hosts: code-dev</div><div class="line">    roles:</div><div class="line">        - server-common</div><div class="line">        - builders</div><div class="line">    gather_facts: no</div><div class="line">    tasks:</div><div class="line">        # Build your extra tasks here like</div><div class="line">    ``` </div><div class="line">- Pre-tasks and Post-tasks(executes plays before or after roles)</div><div class="line">- ```ansible-playbook site.yml -tags &quot;web&quot; -limit atlanta</div></pre></td></tr></table></figure>
</li>
<li><p>ansible galaxy(ansible-galaxy install username.role)</p>
</li>
</ul>
<h2 id="æœ€ä½³å®è·µ"><a href="#æœ€ä½³å®è·µ" class="headerlink" title="æœ€ä½³å®è·µ"></a>æœ€ä½³å®è·µ</h2><p><a href="https://github.com/enginyoyen/ansible-best-practises">ansible-best-practises</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;ä»¥ä¸‹ä¸ºè§‚çœ‹&lt;a href=&quot;https://www.youtube.com/playlist?list=PL7hgvWUGJtUsT74AXZgVhr37riphKjzkD&quot;&gt;Ansible-Configuration Management&lt;/a&gt;çš„ç¬”è®°ã€‚ä¸é€‚åˆåˆå­¦è€…æŸ¥çœ‹ã€‚å¯ä»¥ä½œä¸ºæ¸©ä¹ ä½¿ç”¨&lt;/p&gt;
    
    </summary>
    
      <category term="devops" scheme="https://www.zoulei.net/categories/devops/"/>
    
    
  </entry>
  
  <entry>
    <title>å†…ç½‘æ— ç½‘ç»œç¯å¢ƒåˆå§‹åŒ–çº¿ä¸Šç¯å¢ƒ</title>
    <link href="https://www.zoulei.net/2017/08/13/when_no_network_setup_environment/"/>
    <id>https://www.zoulei.net/2017/08/13/when_no_network_setup_environment/</id>
    <published>2017-08-13T09:18:36.000Z</published>
    <updated>2017-08-13T09:46:27.000Z</updated>
    
    <content type="html"><![CDATA[<p>é‡åˆ°æœ‰äººåæ˜ å¯èƒ½æ˜¯å†…ç½‘ç¯å¢ƒã€‚æ— æ³•è®¿é—®å¤–éƒ¨ç½‘ç»œã€‚å®‰è£…åˆå§‹åŒ–ç¯å¢ƒçš„æ—¶å€™å¥½åƒé¢‡ä¸ºä¸ä¾¿ã€‚å…¶å®åªè¦èƒ½sshä¸Šå»ã€‚è¿™ä¸€åˆ‡éƒ½ä¸æ˜¯é—®é¢˜ã€‚å°±æ˜¯å„ç§è½¬å‘ï¼Œä»¥ä¸‹ä»¥å†…ç½‘ä½¿ç”¨pipå®‰è£…ç¬¬ä¸‰æ–¹ä¾èµ–åŒ…ä¸ºä¾‹è¯´æ˜è¯¥å¦‚ä½•æ“ä½œ</p>
<h2 id="1-æœ¬æœºå¼€å¯ä¸€ä¸ªä¸´æ—¶çš„httpä»£ç†"><a href="#1-æœ¬æœºå¼€å¯ä¸€ä¸ªä¸´æ—¶çš„httpä»£ç†" class="headerlink" title="1.æœ¬æœºå¼€å¯ä¸€ä¸ªä¸´æ—¶çš„httpä»£ç†"></a>1.æœ¬æœºå¼€å¯ä¸€ä¸ªä¸´æ—¶çš„httpä»£ç†</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pip install mitmproxy           # å®‰è£…</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">mitmproxy -p 8899 --ignore .+               #  ä½¿ç”¨</div></pre></td></tr></table></figure>
<p>mitmproxyæ˜¯ä¸€ä¸ªpythonç¼–å†™çš„http/httpsä¸­é—´äººæ¡†æ¶ã€‚è¿™é‡Œæˆ‘ä»¬å•ç‹¬çš„ä½¿ç”¨å®ƒçš„http proxyåŠŸèƒ½ã€‚<br>å‚æ•°på½“ç„¶æ˜¯portç«¯å£çš„æ„æ€äº†ã€‚ç›‘å¬8899ç«¯å£<br>åŠ ä¸Šignoreæ˜¯å› ä¸ºä¸­é—´äººhttpsè¿æ¥éœ€è¦å®¢æˆ·ç«¯å®‰è£…ä¿¡ä»»è¯ä¹¦æ‰å¯ä»¥ã€‚æ­¤å¤„æˆ‘ä»¬åªæ˜¯å•çº¯çš„ä½¿ç”¨ä¸€ä¸‹proxyä¸éœ€è¦ä¸­é—´äººã€‚æ‰€ä»¥æ‰€æœ‰æµé‡ä½¿ç”¨HTTP Connectionéš§é“æ–¹å¼å°±è¾¾æˆç›®çš„äº†ã€‚ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼<code>.+</code>å¿½ç•¥æ‰€æœ‰åŸŸåã€‚è‡³äºä¸ºä»€ä¹ˆä½¿ç”¨httpä¸æ˜¯ç”¨socksã€‚å› ä¸ºhttpä½¿ç”¨æ›´å¹¿æ³›</p>
<h2 id="2-sshä½¿ç”¨è¿œç¨‹ç«¯å£è½¬å‘-å‚è€ƒsshç«¯å£æ˜ å°„"><a href="#2-sshä½¿ç”¨è¿œç¨‹ç«¯å£è½¬å‘-å‚è€ƒsshç«¯å£æ˜ å°„" class="headerlink" title="2.sshä½¿ç”¨è¿œç¨‹ç«¯å£è½¬å‘(å‚è€ƒsshç«¯å£æ˜ å°„)"></a>2.sshä½¿ç”¨è¿œç¨‹ç«¯å£è½¬å‘(å‚è€ƒ<a href="https://ficapy.com/2017/03/12/ssh-port-forward/">sshç«¯å£æ˜ å°„</a>)</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ssh -R 8899:localhost:8899 remote_server</div></pre></td></tr></table></figure>
<p>å°†è¿œç¨‹ä¸»æœºä¸Šçš„8899ç«¯å£æ˜ å°„åˆ°æœ¬æœºçš„8899ç«¯å£</p>
<h2 id="3-è¿œç¨‹ä¸»æœºä½¿ç”¨æœ¬åœ°çš„httpä»£ç†è¿›è¡Œç¯å¢ƒåˆå§‹åŒ–"><a href="#3-è¿œç¨‹ä¸»æœºä½¿ç”¨æœ¬åœ°çš„httpä»£ç†è¿›è¡Œç¯å¢ƒåˆå§‹åŒ–" class="headerlink" title="3.è¿œç¨‹ä¸»æœºä½¿ç”¨æœ¬åœ°çš„httpä»£ç†è¿›è¡Œç¯å¢ƒåˆå§‹åŒ–"></a>3.è¿œç¨‹ä¸»æœºä½¿ç”¨æœ¬åœ°çš„httpä»£ç†è¿›è¡Œç¯å¢ƒåˆå§‹åŒ–</h2><p>å¯ä»¥ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤è¿›è¡Œæµ‹éªŒ</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">curl -x http://localhost:8899 ip.cn</div></pre></td></tr></table></figure>
<p>æ¯”å¦‚ä½¿ç”¨pypiå®‰è£…tornadoæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤å³å¯</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pip install -i https://pypi.tuna.tsinghua.edu.cn/simple --proxy http://localhost:8899 tornado</div></pre></td></tr></table></figure>
<p>æ€è·¯æ˜¯è¿™æ ·ã€‚å…¶å®ƒåŒç†~~~</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;é‡åˆ°æœ‰äººåæ˜ å¯èƒ½æ˜¯å†…ç½‘ç¯å¢ƒã€‚æ— æ³•è®¿é—®å¤–éƒ¨ç½‘ç»œã€‚å®‰è£…åˆå§‹åŒ–ç¯å¢ƒçš„æ—¶å€™å¥½åƒé¢‡ä¸ºä¸ä¾¿ã€‚å…¶å®åªè¦èƒ½sshä¸Šå»ã€‚è¿™ä¸€åˆ‡éƒ½ä¸æ˜¯é—®é¢˜ã€‚å°±æ˜¯å„ç§è½¬å‘ï¼Œä»¥ä¸‹ä»¥å†…ç½‘ä½¿ç”¨pipå®‰è£…ç¬¬ä¸‰æ–¹ä¾èµ–åŒ…ä¸ºä¾‹è¯´æ˜è¯¥å¦‚ä½•æ“ä½œ&lt;/p&gt;
&lt;h2 id=&quot;1-æœ¬æœºå¼€å¯ä¸€ä¸ªä¸´æ—¶çš„httpä»£ç†&quot;&gt;&lt;a href=&quot;#1
    
    </summary>
    
      <category term="ä¼ªæŠ€æœ¯" scheme="https://www.zoulei.net/categories/%E4%BC%AA%E6%8A%80%E6%9C%AF/"/>
    
    
  </entry>
  
  <entry>
    <title>å¼€å‘ç¯å¢ƒä¸­æ•°æ®åº“å¿«é€Ÿå›æ»š</title>
    <link href="https://www.zoulei.net/2017/07/15/develop_quick_restore_postgresql_database/"/>
    <id>https://www.zoulei.net/2017/07/15/develop_quick_restore_postgresql_database/</id>
    <published>2017-07-15T05:24:19.000Z</published>
    <updated>2017-07-15T07:57:36.000Z</updated>
    
    <content type="html"><![CDATA[<p>å¼€å‘ä¸­æ€»ä¼šé‡åˆ°ä¸€äº›æµ‹è¯•éœ€è¦å›æ»šæ•°æ®åº“ã€‚å¸¸è§„çš„å•å…ƒæµ‹è¯•çš„åšæ³•æ˜¯åœ¨å•ä¸ªä¼šè¯ä¸­ä¸çœŸæ­£çš„å†™å…¥åˆ°æ•°æ®åº“ã€‚è€Œæ˜¯æµ‹è¯•å®Œæˆåè¿›è¡Œæ•°æ®åº“å›æ»šã€‚å¤§å¤šæ•°æƒ…å†µä¸‹è¿™æ ·éƒ½æ˜¯æ»¡è¶³è¦æ±‚çš„ã€‚åªæ˜¯æœ‰çš„æ—¶å€™éœ€è¦æ•°æ®åº“çœŸæ­£çš„å†™å…¥åˆ°æ•°æ®åº“ã€‚æ­¤æ—¶rollbackå›æ»šå°±æœ‰äº›ä¹åŠ›äº†ã€‚æ­¤æ—¶ç»™æ•°æ®åº“åšä¸€ä¸ªå¤‡ä»½ï¼Œæµ‹è¯•å®Œæˆåå›æ»šæ˜¯ä¸€ç§ä¸é”™çš„ä¸»æ„ã€‚Postgresqlæ•°æ®åº“çš„å¸¸è§„å¤‡ä»½æˆ‘ä»¬ä¼šä½¿ç”¨pg_dumpå’Œpg_restoreè¿›è¡Œå¯¼å‡ºå’Œæ¢å¤ã€‚æ­¤æ—¶å¦‚ä½•å¿«é€Ÿçš„è¿›è¡Œè¿™ä¸ªæ“ä½œæ˜¯æˆ‘ä»¬å…³æ³¨çš„è¯é¢˜</p>
<p>å¾ˆå¹¸è¿ã€‚å¾ˆé¡ºåˆ©çš„æœåˆ°äº†ç­”æ¡ˆã€‚6å¹´å‰æœ‰äººåœ¨stackexchangeä¸Šæé—®åŒæ ·çš„é—®é¢˜ã€‚å¾—åˆ°äº†ä¸€äº›æœ‰ç”¨çš„å›å¤ã€‚å¤§æ¦‚æœ‰è¿™äº›</p>
<ul>
<li>ä½¿ç”¨æ–‡ä»¶ç³»ç»Ÿçº§å¿«ç…§LVM</li>
<li>ä½¿ç”¨CREATE  DATABASE â€¦ TEMPLATEè¯­æ³•</li>
<li>å°†æ•°æ®åº“æ”¾åœ¨è™šæ‹Ÿæœºé‡Œé¢ã€‚ä½¿ç”¨è™šæ‹Ÿæœºå¿«ç…§</li>
</ul>
<p>å…¶ä¸­æœ€æœ‰æ•ˆçš„æ–¹æ¡ˆæ˜¯äºŒã€‚å› ä¸ºLVMåœ¨ä¸ªäººç¬”è®°æœ¬ä¸Šéš¾ä»¥å®æ–½ã€‚è™šæ‹Ÿæœºæ¢å¤æ—¶é—´è¾ƒæ…¢ã€‚ä¾æ®æ–¹æ¡ˆäºŒäºæ˜¯ä¹æœ‰äººå†™äº†ä¸€ä¸ªå·¥å…· <a href="https://github.com/fastmonkeys/stellar">stellar</a>ã€‚ç²—ç•¥è¯»äº†ä¸€ä¸‹æºç ã€‚å…¶å…·ä½“åŸç†å¤§æ¦‚å¦‚ä¸‹å›¾<br><img src="https://ficapy.b0.upaiyun.com/blogimg/backup_and_restore_flow.jpg" alt="backup_and_restore_flow"></p>
<p>å¤‡ä»½çš„æ—¶å€™ä½¿ç”¨create database â€¦ templateåˆ›å»º2ä¸ªå¤‡ä»½ã€‚æ¢å¤çš„æ—¶å€™åˆ æ‰åŸæœ‰çš„æ•°æ®åº“ã€‚å°†ä¸€ä¸ªå¤‡ä»½é‡å‘½åä¸ºåŸæœ‰çš„åç§°ã€‚å¦å¤–çš„ä¸€ä¸ªå¤‡ä»½å†ç”Ÿæˆä¸€ä¸ªå¤‡ä»½å°±å®Œæˆäº†ã€‚å¦å¤–åˆ é™¤æ–°å»ºæ•°æ®åº“æ“ä½œå‡ä¼šå…³é—­æ‰€æœ‰å·²è¿æ¥çš„æ•°æ®åº“ä¼šè¯ã€‚</p>
<p>å› ä¸ºç±»ä¼¼æ–‡ä»¶ç³»ç»Ÿçº§å¿«ç…§ï¼Œæ‰€ä»¥æ–¹æ³•æå¿«ã€‚æˆ‘æœ¬æœº2Gçš„æ•°æ®åº“æ–‡ä»¶ï¼Œåˆ›å»ºä¸€ä¸ªå¿«ç…§å¤§æ¦‚åç§’é’Ÿå·¦å³ï¼Œæ¢å¤å°±æ›´å¿«äº†ã€‚å½“ç„¶ç¼ºç‚¹ä¹Ÿæ˜¯æœ‰çš„ï¼Œä½ æ¯åˆ›å»ºä¸€ä¸ªå¿«ç…§éƒ½ä¼šæ–°å¢2ä¸ªä¸€æ ·å¤§å°çš„å‰¯æœ¬ï¼Œç›¸å½“çš„å æ®ç¡¬ç›˜ç©ºé—´ï¼Œå¯æ˜¯ä¸ºäº†é€Ÿåº¦è¿™ç‚¹ç¼ºé™·ä¹Ÿå°±å¾®ä¸è¶³é“äº†â”‘(ï¿£Ğ” ï¿£)â”</p>
<p>å¦å¤–ä¸€ä¸ªå°ç¼ºç‚¹ã€‚å› ä¸ºå®ƒå®šä½äºæµ‹è¯•ç¯å¢ƒä¸‹çš„æ•°æ®åº“å¤‡ä»½æ¢å¤ã€‚æ‰€ä»¥åªè¿æ¥ä¸€å°æœºå™¨ã€‚æ¯”å¦‚ä½ ä¸€ä¸ªæ•°æ®åº“åœ¨æœºå™¨A,ä¸€ä¸ªæ•°æ®åº“åœ¨æœºå™¨B.èµ›é«˜~~ï¼Œé‚£ä½ åªèƒ½åœ¨2ä¸ªç›®å½•ä¸‹ä½¿ç”¨2ä¸ªé…ç½®æ–‡ä»¶æ¥å®Œæˆäº†ã€‚å¦‚æœåŒä¸€ä¸ªæœºå™¨ä¸Šçš„å¤šä¸ªæ•°æ®åº“æ˜¯å¯ä»¥ç›´æ¥å¤‡ä»½çš„ã€‚å†å°±æ˜¯æ­¤å·¥å…·æ¯”è¾ƒä¸“æ³¨äºPostgresqlã€‚å¯¹äºMysqlå°±ä¸é‚£ä¹ˆå‹å¥½äº†ã€‚æˆ–è®¸æ˜¯Mysqlçš„å¤‡ä»½æ–¹æ¡ˆä¸ä¸€æ ·</p>
<h3 id="ä½¿ç”¨æ–¹æ³•"><a href="#ä½¿ç”¨æ–¹æ³•" class="headerlink" title="ä½¿ç”¨æ–¹æ³•"></a>ä½¿ç”¨æ–¹æ³•</h3><ol>
<li><code>stellar init</code> æŒ‰ç…§æç¤ºè¾“å…¥æœ¬æœºæ•°æ®åº“è®¿é—®è·¯å¾„ç”Ÿæˆé…ç½®æ–‡ä»¶</li>
<li><code>stellar snapshot</code> ç”Ÿæˆä¸€ä¸ªå¿«ç…§</li>
<li><code>stellar restore &lt;snap1&gt;</code> æ¢å¤</li>
<li>å…¶ä»–è¯·çœ‹ <code>stellar --help</code></li>
</ol>
<p>( âŠ™ o âŠ™ )å•Šï¼ å¤šä¹ˆçˆ½å¿«ï¼Œä¸–ç•ŒçœŸç¾å¦™</p>
<h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p><a href="https://dba.stackexchange.com/questions/3394/is-it-possible-to-quickly-create-restore-database-snapshots-with-postgresql">Is it possible to quickly create/restore database snapshots with PostgreSQL?</a><br><a href="https://github.com/fastmonkeys/stellar">github stellar</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;å¼€å‘ä¸­æ€»ä¼šé‡åˆ°ä¸€äº›æµ‹è¯•éœ€è¦å›æ»šæ•°æ®åº“ã€‚å¸¸è§„çš„å•å…ƒæµ‹è¯•çš„åšæ³•æ˜¯åœ¨å•ä¸ªä¼šè¯ä¸­ä¸çœŸæ­£çš„å†™å…¥åˆ°æ•°æ®åº“ã€‚è€Œæ˜¯æµ‹è¯•å®Œæˆåè¿›è¡Œæ•°æ®åº“å›æ»šã€‚å¤§å¤šæ•°æƒ…å†µä¸‹è¿™æ ·éƒ½æ˜¯æ»¡è¶³è¦æ±‚çš„ã€‚åªæ˜¯æœ‰çš„æ—¶å€™éœ€è¦æ•°æ®åº“çœŸæ­£çš„å†™å…¥åˆ°æ•°æ®åº“ã€‚æ­¤æ—¶rollbackå›æ»šå°±æœ‰äº›ä¹åŠ›äº†ã€‚æ­¤æ—¶ç»™æ•°æ®åº“åšä¸€ä¸ªå¤‡ä»½ï¼Œæµ‹è¯•å®Œæˆåå›æ»š
    
    </summary>
    
      <category term="ä¼ªæŠ€æœ¯" scheme="https://www.zoulei.net/categories/%E4%BC%AA%E6%8A%80%E6%9C%AF/"/>
    
    
  </entry>
  
  <entry>
    <title>Docker CDåˆæ¢-Drone</title>
    <link href="https://www.zoulei.net/2017/07/05/drone/"/>
    <id>https://www.zoulei.net/2017/07/05/drone/</id>
    <published>2017-07-05T13:51:26.000Z</published>
    <updated>2017-07-05T16:21:28.000Z</updated>
    
    <content type="html"><![CDATA[<p>æœ€è¿‘æœ‰ä¸ªå°éœ€æ±‚ï¼Œæˆ‘ä»¬å…¬å¸å†™æ–‡æ¡£æ˜¯é€šè¿‡<a href="https://github.com/lord/slate">slate</a>æ¥çš„ã€‚æ¯ä¸€æ¬¡æ–‡æ¡£ç¼–å†™å®Œæˆä¹‹åéƒ½éœ€è¦æ‰§è¡Œ<code>bundle exec middleman build --clean</code>ç”Ÿæˆé™æ€æ–‡ä»¶ã€‚ç„¶åå†ä½¿ç”¨rsyncæ¥è¿›è¡Œä¸Šä¼ æ“ä½œã€‚è™½ç„¶åªæœ‰2æ­¥ã€‚ä½†æ˜¯åšçš„æ¬¡æ•°å¤šäº†éš¾å…ä¹Ÿè®©äººè§‰å¾—åŒçƒ¦ã€‚èŒç”Ÿäº†è‡ªåŠ¨åŒ–å¤„ç†çš„æƒ³æ³•ã€‚æ¯”è¾ƒç²—æš´çš„æ–¹å¼æœ‰ã€‚æ¯éš”å‡ åˆ†é’Ÿå»æ£€æµ‹ä¸€æ¬¡gitç‰ˆæœ¬åº“æ˜¯å¦æœ‰æ›´æ–°(ä»¥å‰æœ¬äººçœŸè¿™æ ·å®ç°è¿‡)ï¼Œè‡ªå·±å†™ä¸ªå°webç¨‹åºã€‚è®¾ç½®webhookã€‚æ¥æ”¶åˆ°webhookå†æ‹‰å–è¿›è¡Œæ“ä½œ(æˆ‘ä¹Ÿå®ç°è¿‡ï¼Œç›®å‰ä¸€åˆ‡è¿è¡Œè‰¯å¥½)ã€‚ç°åœ¨å°è¯•ä¸‹ä½¿ç”¨å¯æŒç»­é›†æˆçš„å¥—è·¯å»å®ç°ã€‚</p>
<a id="more"></a>
<p>è¯´ä¸€ä¸‹ç¬¬ä¸‰ç§æ–¹æ¡ˆç›¸å¯¹å‰ä¸¤ç§æ–¹æ¡ˆçš„ç‰¹ç‚¹ã€‚</p>
<ul>
<li>é›†ä¸­åŒ–ç®¡ç†ã€‚ç¬¬ä¸€äºŒç§æ–¹æ¡ˆéƒ½éœ€è¦å°†è„šæœ¬æ”¾åœ¨å¯¹åº”çš„åº”ç”¨æœºå™¨ä¸Šé¢ã€‚ç¬¬ä¸‰ç§ä¸éœ€è¦ï¼Œå®ƒé›†ä¸­åŒ–äº†ã€‚æ‰€æœ‰çš„webhookéƒ½åœ¨å¯æŒç»­é›†æˆå¹³å°å¤„ç†ã€‚ç”±å¹³å°å†æ¥æ“æ§åº”ç”¨ã€‚è€Œä¸”æ¯ä¸€æ¬¡è§¦å‘æ“ä½œéƒ½æœ‰è¯¦å°½çš„æ—¥å¿—ã€‚é›†ä¸­åœ¨ä¸€èµ·æ¯”è¾ƒå®¹æ˜“çœ‹å‡ºå“ªé‡Œå‡ºäº†ä»€ä¹ˆé—®é¢˜</li>
<li>ä¸éœ€è¦åœ¨æ¯ä¸€å°åº”ç”¨æœºå¤„ç†webhook(å¤„ç†æ„å‘³ç€æ¯ä¸ªåº”ç”¨æœºéƒ½éœ€è¦ç»‘å®šä¸€ä¸ªåŸŸå)ï¼Œå¯èƒ½å’Œä¸Šé¢çš„é›†ä¸­åŒ–ç®¡ç†çš„ä¼˜ç‚¹æ˜¯ä¸€ä¸ªæ„æ€å§</li>
<li>å¯¹äºä¸€ä¸ªè‰¯å¥½çš„æ¶æ„ã€‚å¯æŒç»­é›†æˆå¹³å°æ¯”é›¶æ•£çš„è„šæœ¬æ— ç–‘æ›´åˆé€‚</li>
<li>ç®—æ˜¯ä¸€ä¸ªç¼ºç‚¹ã€‚å•ç‹¬å†™è„šæœ¬ç‹¬ç«‹å¤„ç†webhookç›¸å¯¹å¯æŒç»­é›†æˆæ›´å®¹æ˜“</li>
</ul>
<h3 id="Droneé…ç½®"><a href="#Droneé…ç½®" class="headerlink" title="Droneé…ç½®"></a>Droneé…ç½®</h3><p>docker-composeæˆ‘éƒ½ä¸å¤§ç”¨äº†ï¼Œç›´æ¥ç”¨docker stack deployæ›¿ä»£ã€‚åè€…ç›¸å¯¹å‰è€…å®é™…æ²¡æœ‰ä»€ä¹ˆåŒºåˆ«ã€‚æˆ–è€…è¯´å‰è€…æ˜¯å› ä¸ºdockerç½‘ç»œé…ç½®æ¬ å‘è¾¾çš„äº§ç‰©ã€‚docker-composeé€‚åˆå•æœºéƒ¨ç½²ï¼Œdocker-swarmé€‚åˆå¤šä¸»æœºã€‚å¼€å¯docker-swarmåªéœ€è¦docker swarm initå¤§æ¦‚å°±å¯ä»¥äº†ï¼Œæ›´è¯¦ç»†çš„çŸ¥è¯†è¯·æŸ¥çœ‹å®˜æ–¹æ–‡æ¡£</p>
<p>drone.yml æ–‡ä»¶å¤§æ¦‚å¦‚ä¸‹<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line">version: &apos;3&apos;</div><div class="line"></div><div class="line">services:</div><div class="line">  drone-server:</div><div class="line">    image: drone/drone:0.7</div><div class="line">    ports:</div><div class="line">      - 82:8000</div><div class="line">    volumes:</div><div class="line">      - /data/github_drone:/var/lib/drone/</div><div class="line">    environment:</div><div class="line">      - DRONE_OPEN=false</div><div class="line">      - DRONE_ADMIN=ficapy</div><div class="line">      - DRONE_GITLAB=true</div><div class="line">      - DRONE_GITHUB_CLIENT=xxxxxxxxx</div><div class="line">      - DRONE_GITHUB_SECRET=xxxxxxxxxx</div><div class="line">      - DRONE_SECRET=xxxpwdxxx</div><div class="line"></div><div class="line">  drone-agent:</div><div class="line">    image: drone/drone:0.7</div><div class="line">    command: agent</div><div class="line">    depends_on:</div><div class="line">      - drone-server</div><div class="line">    volumes:</div><div class="line">      - /var/run/docker.sock:/var/run/docker.sock</div><div class="line">    environment:</div><div class="line">      - DRONE_SERVER=ws://drone-server:8000/ws/broker</div><div class="line">      - DRONE_SECRET=xxxpwdxxx</div><div class="line"></div></pre></td></tr></table></figure></p>
<p>ç„¶åæ‰§è¡Œ<code>docker stack deploy --compose-file=drone.yml drone</code>ï¼Œæ•´ä¸ªç¨‹åºå°±è¿è¡Œèµ·æ¥äº†ã€‚æ­¤å¤„æ˜¯ç›‘å¬81ç«¯å£ã€‚ä»é…ç½®æ–‡ä»¶ä¸­ä¹Ÿå¯ä»¥çŒœä¸€ä¸ªå¤§æ¦‚ã€‚äº†è§£ä¸‹droneçš„æµç¨‹ã€‚serviceä¸»è¦ç”¨æ¥å“åº”æµè§ˆå™¨ç«¯çš„è¯·æ±‚ã€‚æ¥æ”¶åˆ°è¯·æ±‚åä½¿ç”¨websocketå’Œagenté€šä¿¡ç”¨æ¥ä¸‹å‘ä»»åŠ¡è·å–ç»“æœã€‚agenté€šè¿‡/var/run/docker.sockæ¥å’Œdocker daemonè¿›è¡Œé€šä¿¡ã€‚æ‰§è¡Œåˆ›å»ºå®¹å™¨ã€‚æ‰§è¡Œå‘½ä»¤ç­‰ä¸€ç³»åˆ—è¿‡ç¨‹ã€‚</p>
<p>æœ‰å‡ ç‚¹éœ€è¦æ³¨æ„çš„</p>
<ul>
<li>æœ€å¥½æŒ‡å®šç®¡ç†å‘˜ç”¨æˆ·DRONE_ADMINï¼Œå› ä¸ºæœ‰äº›æ“ä½œéœ€è¦adminæƒé™</li>
<li>DRONE_OPENè®¾ç½®ä¸ºtrueçš„æ—¶å€™æ‰€æœ‰çš„ç”¨æˆ·éƒ½èƒ½æˆæƒåä½¿ç”¨ä½ çš„Droneè¿›è¡Œé›†æˆæµ‹è¯•ã€‚è¿™å¾€å¾€æ˜¯ä½ ä¸æ„¿æ„çš„ï¼Œä¸ªäººçš„è¯‰æ±‚å¾€å¾€æ˜¯ç§æœ‰çš„</li>
<li>githubå’Œgitlabåœ¨ä¸€ä¸ªdroneä¸èƒ½åŒæ—¶ä½¿ç”¨ï¼Œæ‰€ä»¥æˆ‘éƒ¨ç½²äº†ä¸¤å¥—ï¼Œä½¿ç”¨äº†ä¸åŒçš„åŸŸå</li>
<li>èµ·ç äº†è§£OAuthæµç¨‹å’Œwebhookçš„è¿‡ç¨‹ï¼Œæ‰èƒ½æ›´å¥½çš„ç†è§£æ•´å¥—æµç¨‹</li>
<li>å…¶ä»–äº‹å®œå¯ä»¥æŸ¥çœ‹Droneçš„<a href="http://docs.drone.io/installation/">å®‰è£…æ–‡æ¡£</a></li>
</ul>
<p>ä¹‹æ‰€ä»¥ç›‘å¬81ç«¯å£ï¼Œæ˜¯å› ä¸ºæˆ‘ä½¿ç”¨çš„Caddyå½“åšå‰ç½®webæœåŠ¡å™¨ã€‚é…ç½®å¦‚ä¸‹Caddyfile</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">drone.ficapy.com &#123;</div><div class="line">    proxy / dockerhost:81 &#123;</div><div class="line">        websocket</div><div class="line">        transparent</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>å¯¹åº”çš„docker-composeæ–‡ä»¶å¦‚ä¸‹</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">version: &quot;3&quot;</div><div class="line"></div><div class="line">services:</div><div class="line">  Caddy:</div><div class="line">    image: &quot;abiosoft/caddy&quot;</div><div class="line">    volumes:</div><div class="line">      - /root/caddy/Caddyfile:/etc/Caddyfile</div><div class="line">      - /root/.caddy:/root/.caddy</div><div class="line">    ports:</div><div class="line">      - &quot;80:80&quot;</div><div class="line">      - &quot;443:443&quot;</div><div class="line">    extra_hosts:</div><div class="line">      - &quot;dockerhost:$&#123;dockerhost&#125;&quot;</div></pre></td></tr></table></figure>
<p>æ­¤å¤„ä½¿ç”¨äº†ç¯å¢ƒå˜é‡dockerhostï¼Œæˆ‘å°†å®ƒå†™å…¥äº†zshrcé…ç½®æ–‡ä»¶ä¸­<code>export dockerhost=&quot;172.17.0.1&quot;</code>,ä¸éš¾çœ‹å‡ºåªæ˜¯ä¸ºäº†è½¬å‘è¯·æ±‚, å’Œdroneä¸€æ ·ã€‚æ‰§è¡Œ<code>docker stack deploy --compose-file=caddy_compose.yml caddy</code>å¯åŠ¨</p>
<h3 id="æŒç»­é›†æˆéƒ¨ç½²"><a href="#æŒç»­é›†æˆéƒ¨ç½²" class="headerlink" title="æŒç»­é›†æˆéƒ¨ç½²"></a>æŒç»­é›†æˆéƒ¨ç½²</h3><p>å½“ä½¿ç”¨Droneï¼Œå¹¶æˆæƒä¹‹åã€‚Droneä¼šè‡ªåŠ¨ç»™ä½ çš„é¡¹ç›®åŠ ä¸Šwebhookåœ°å€ã€‚æˆ‘ä»¬åœ¨é¡¹ç›®æ ¹ç›®å½•æ”¾ç½®.drone.ymlæ–‡ä»¶åä¼šä½¿ç”¨dockerè‡ªåŠ¨æ„å»º</p>
<p>å®ç°æœ¬æ–‡å¼€å¤´è¯´çš„éœ€æ±‚.drone.ymlæ–‡ä»¶å¦‚ä¸‹<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">pipeline:</div><div class="line">  build:</div><div class="line">    image: ruby:2.3</div><div class="line">    commands:</div><div class="line">      - bundle config mirror.https://rubygems.org https://gems.ruby-china.org</div><div class="line">      - bundle install</div><div class="line">      - apt-get update &amp;&amp; apt-get install nodejs rsync -y &amp;&amp; bundle exec middleman build --clean</div><div class="line">      - rsync -r --rsh=&apos;ssh -o LogLevel=ERROR -o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null -o IdentitiesOnly=yes -i /data/id_rsa -p 22&apos; build/* user@host:~/docs --progress --delete</div><div class="line">    volumes:</div><div class="line">      - /data:/data</div><div class="line">    when:</div><div class="line">      branch: master</div></pre></td></tr></table></figure></p>
<p>åœ¨ä½¿ç”¨ä¹‹å‰ã€‚æˆ‘ç°åœ¨/dataç›®å½•ä½¿ç”¨ssh-agentç”Ÿæˆäº†å¯†åŒ™å¯¹ã€‚åœ¨ç›®æ ‡ä¸»æœºä¸Šæ”¾ä¸Šå…¬é’¥ï¼Œè®©æˆ‘ä»¬èƒ½å¤Ÿsshè¿æ¥è¿œç«¯ä¸»æœºã€‚ç„¶åå®¹å™¨åˆ›å»ºçš„æ—¶å€™å°†å¯†åŒ™æŒ‚è½½åˆ°å®¹å™¨ç›®å½•(æ­¤å¤„éœ€è¦ç®¡ç†å‘˜æƒé™å°†é¡¹ç›®è®¾ç½®ä¸ºå¯ä¿¡)ã€‚ç„¶åå°±é¡ºç†æˆç« äº†ã€‚æ­å»ºç¯å¢ƒï¼Œç”Ÿæˆé™æ€æ–‡ä»¶ï¼ŒrsyncåŒæ­¥å°±å®Œæˆäº†ã€‚</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;æœ€è¿‘æœ‰ä¸ªå°éœ€æ±‚ï¼Œæˆ‘ä»¬å…¬å¸å†™æ–‡æ¡£æ˜¯é€šè¿‡&lt;a href=&quot;https://github.com/lord/slate&quot;&gt;slate&lt;/a&gt;æ¥çš„ã€‚æ¯ä¸€æ¬¡æ–‡æ¡£ç¼–å†™å®Œæˆä¹‹åéƒ½éœ€è¦æ‰§è¡Œ&lt;code&gt;bundle exec middleman build --clean&lt;/code&gt;ç”Ÿæˆé™æ€æ–‡ä»¶ã€‚ç„¶åå†ä½¿ç”¨rsyncæ¥è¿›è¡Œä¸Šä¼ æ“ä½œã€‚è™½ç„¶åªæœ‰2æ­¥ã€‚ä½†æ˜¯åšçš„æ¬¡æ•°å¤šäº†éš¾å…ä¹Ÿè®©äººè§‰å¾—åŒçƒ¦ã€‚èŒç”Ÿäº†è‡ªåŠ¨åŒ–å¤„ç†çš„æƒ³æ³•ã€‚æ¯”è¾ƒç²—æš´çš„æ–¹å¼æœ‰ã€‚æ¯éš”å‡ åˆ†é’Ÿå»æ£€æµ‹ä¸€æ¬¡gitç‰ˆæœ¬åº“æ˜¯å¦æœ‰æ›´æ–°(ä»¥å‰æœ¬äººçœŸè¿™æ ·å®ç°è¿‡)ï¼Œè‡ªå·±å†™ä¸ªå°webç¨‹åºã€‚è®¾ç½®webhookã€‚æ¥æ”¶åˆ°webhookå†æ‹‰å–è¿›è¡Œæ“ä½œ(æˆ‘ä¹Ÿå®ç°è¿‡ï¼Œç›®å‰ä¸€åˆ‡è¿è¡Œè‰¯å¥½)ã€‚ç°åœ¨å°è¯•ä¸‹ä½¿ç”¨å¯æŒç»­é›†æˆçš„å¥—è·¯å»å®ç°ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="Docker" scheme="https://www.zoulei.net/categories/Docker/"/>
    
    
  </entry>
  
  <entry>
    <title>ç†è§£metaclass</title>
    <link href="https://www.zoulei.net/2017/03/24/python_metaclass/"/>
    <id>https://www.zoulei.net/2017/03/24/python_metaclass/</id>
    <published>2017-03-24T01:34:48.000Z</published>
    <updated>2017-05-31T08:46:35.000Z</updated>
    
    <content type="html"><![CDATA[<p>metaclassä¸€ç›´è¢«å½’ç±»ä¸ºæ¯”è¾ƒé«˜æ·±çš„å†…å®¹ï¼Œå†™ä»£ç ä¹Ÿå¾ˆå°‘ä¼šä½¿ç”¨åˆ°metaclassã€‚ç„¶è€Œå¦‚æœä½ çœ‹æŸäº›é¡¹ç›®çš„æºä»£ç ï¼Œè¿˜æ˜¯ä¼šè¢«ç»•åˆ°metaclassé‡Œé¢å»ã€‚èŠ±ä¸€äº›æ—¶é—´ç†è§£ä¸‹metaclasså¾ˆæœ‰ç”¨çš„ï¼Œå› ä¸ºå®ƒçœŸçš„èƒ½æŠŠä¸€æ¡çº¿ä¸²èµ·æ¥ï¼Œç¯ç¯ç›¸æ‰£ï¼Œæ‰€ä»¥æœ‰æ‰å®çš„åŸºç¡€æ˜¯æŒæ¡metaclassçš„å‰æï¼Œæœ¬æ–‡ä»£ç åŸºäºpython3.5</p>
<a id="more"></a>
<p>ä½ åªéœ€è¦ç†è§£ä»¥ä¸‹2ç‚¹</p>
<ol>
<li>metaclasså’Œ<code>__new__</code>ã€<code>__init__</code>å¹¶æ²¡æœ‰éå¸¸éå¸¸æ·±çš„å…³ç³»</li>
<li>type(name, bases, dict)ç”Ÿæˆäº†ä¸€ä¸ªobjectç±»ï¼Œäº†è§£ä¸‰ä¸ªå‚æ•°åˆ†åˆ«æŒ‡ä»£äº†ä»€ä¹ˆ</li>
</ol>
<p>äº†è§£pythonä¸­æœ‰è¿™æ ·ä¸€æ¡å…³ç³»é“¾type-&gt;object-&gt;instance,é€šå¸¸æˆ‘ä»¬å†™ç±»é»˜è®¤ä¼šç»§æ‰¿è‡ªobjectã€‚ä»å…³ç³»é“¾å°±èƒ½çŸ¥é“typeèƒ½å¤Ÿç”Ÿæˆobjectã€‚ä»£ç å¦‚ä¸‹</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span><span class="params">(type)</span>:</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__new__</span><span class="params">(cls, name, bases, attrs)</span>:</span></div><div class="line">        attrs.pop(<span class="string">'e'</span>)</div><div class="line">        print(<span class="string">'1'</span>, cls, name, bases, attrs)</div><div class="line">        cls.a = <span class="number">1</span></div><div class="line">        <span class="keyword">return</span> super().__new__(cls, name, bases, attrs)</div><div class="line"></div><div class="line">    <span class="comment"># def __call__(self, *args, **kwargs):</span></div><div class="line">    <span class="comment">#     print('3')</span></div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, name, bases, attrs)</span>:</span></div><div class="line">        self.b = <span class="number">2</span></div><div class="line">        print(<span class="string">'2'</span>, self, name, bases, attrs)</div><div class="line"></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span><span class="params">(metaclass=A)</span>:</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__new__</span><span class="params">(cls, *args, **kwargs)</span>:</span></div><div class="line">        print(<span class="string">'4'</span>, args, kwargs)</div><div class="line">        cls.c = <span class="number">4</span></div><div class="line">        <span class="keyword">return</span> super().__new__(cls)</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">e</span><span class="params">(self)</span>:</span></div><div class="line">        <span class="keyword">pass</span></div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__call__</span><span class="params">(self, *args, **kwargs)</span>:</span></div><div class="line">        print(<span class="string">'5'</span>)</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, d)</span>:</span></div><div class="line">        self.d = d</div><div class="line">        print(<span class="string">'6'</span>)</div><div class="line"></div><div class="line"></div><div class="line">b = B(<span class="number">6</span>)</div><div class="line">print(hasattr(b, <span class="string">'a'</span>))</div><div class="line">print(b.b)</div><div class="line">print(b.c)</div><div class="line">print(b.d)</div><div class="line">print(hasattr(b, <span class="string">'e'</span>))</div></pre></td></tr></table></figure>
<p>å¯ä»¥å°è¯•æ³¨é‡Šæ‰B(12)ï¼ŒAä¾æ—§ä¼šè¢«æ‰“å°ï¼Œè§‚å¯Ÿargså’Œkwargsçš„è¾“å‡ºã€‚å¯¹æ¯”Aå’ŒBçš„ä¸åŒï¼Œä½ ä¼šå‘ç°metaclassçš„ç”¨å¤„ï¼Œ<strong>ä½¿ç”¨metaclassçš„æ—¶å€™ï¼ŒBçš„æ‰€æœ‰å±æ€§ä¼šè¢«å½“åšå‚æ•°ä¼ é€’ç»™A</strong>ï¼Œé‚£ä¹ˆæˆ‘ä»¬èƒ½å¤Ÿå°†è¿™äº›ä¼ è¿‡æ¥çš„å‚æ•°é¢„å¤„ç†ç„¶åæŒ‚åœ¨åˆ°ç±»çš„å±æ€§ä¸Šé¢è¿”å›ã€‚ä»¥ä¾›åç»­Bä½¿ç”¨ã€‚ç›®å‰åœ¨æˆ‘é‡åˆ°çš„webå¼€å‘ä¸­ä½“ç°çš„æœ€å¸¸è§çš„å°±æ˜¯ORMå’Œè¡¨å•éªŒè¯ã€‚</p>
<p>æˆ‘ä»¬çŸ¥é“<code>__new__</code>åˆ›å»ºä¸€ä¸ªå¯¹è±¡ã€‚<code>__init__</code>å¯¹åˆ›å»ºåçš„å¯¹è±¡è¿›è¡Œèµ‹å€¼ç­‰åˆå§‹åŒ–æ“ä½œã€‚ä»–ä»¬çš„ä¼ å‚argså’Œkwargsæ˜¯æ²¡æœ‰åŒºåˆ«çš„ã€‚ä½†æ˜¯åœ¨<code>__new__</code>é˜¶æ®µï¼Œèƒ½å¤Ÿå¯¹attrsè¿›è¡Œä¿®æ”¹ä»è€Œhookå¯¹è±¡çš„åˆ›å»ºæµç¨‹ï¼Œé™¤æ­¤ä¹‹å¤–æ„Ÿè§‰åªèƒ½ç”¨newä¸èƒ½ç”¨initçš„åœºæ™¯æ˜¯å¾ˆå°‘çš„ã€‚ç›®å‰çœ‹åˆ°çš„ä¾‹å­è®°å¾—çš„å¯èƒ½åªæœ‰ç”¨newå®ç°å•ä¾‹ã€‚å¯¹äºå†…ç½®ä¸å¯å˜å¯¹è±¡æ¯”å¦‚intç”¨newå˜æ›´åˆå§‹åŒ–é€»è¾‘</p>
<p>æœ€åä¾‹ä¸¾ä¸€ä¸ªORMçš„ä¾‹å­(è§å‚è€ƒ)<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Field</span><span class="params">(object)</span>:</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, name, column_type)</span>:</span></div><div class="line">        self.name = name</div><div class="line">        self.column_type = column_type</div><div class="line"></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">StringField</span><span class="params">(Field)</span>:</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, name)</span>:</span></div><div class="line">        super(StringField, self).__init__(name, <span class="string">'vachar(100)'</span>)</div><div class="line"></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">ModelMetaclass</span><span class="params">(type)</span>:</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__new__</span><span class="params">(cls, name, bases, attrs)</span>:</span></div><div class="line">        <span class="keyword">if</span> name != <span class="string">'Model'</span>:</div><div class="line">            mappings = &#123;k: v.name <span class="keyword">for</span> k, v <span class="keyword">in</span> attrs.items() <span class="keyword">if</span> isinstance(v, Field)&#125;</div><div class="line">            <span class="keyword">for</span> k <span class="keyword">in</span> mappings.keys():</div><div class="line">                attrs.pop(k)</div><div class="line">            attrs[<span class="string">'__mappings__'</span>] = mappings</div><div class="line">            attrs[<span class="string">'__table__'</span>] = name</div><div class="line"></div><div class="line">        <span class="keyword">return</span> type.__new__(cls, name, bases, attrs)</div><div class="line"></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Model</span><span class="params">(dict, metaclass=ModelMetaclass)</span>:</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, **kwargs)</span>:</span></div><div class="line">        super().__init__(**kwargs)</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__getattr__</span><span class="params">(self, key)</span>:</span></div><div class="line">        <span class="keyword">try</span>:</div><div class="line">            <span class="keyword">return</span> self[key]</div><div class="line">        <span class="keyword">except</span> KeyError:</div><div class="line">            <span class="keyword">raise</span> AttributeError(<span class="string">r"'Model' object has no attribute &#123;key&#125;"</span>.format(key=key))</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__setattr__</span><span class="params">(self, key, value)</span>:</span></div><div class="line">        self[key] = value</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">save</span><span class="params">(self)</span>:</span></div><div class="line">        fields, params, args = [], [], []</div><div class="line">        <span class="keyword">for</span> k, v <span class="keyword">in</span> self.__mappings__.items():</div><div class="line">            fields.append(v)</div><div class="line">            params.append(<span class="string">'?'</span>)</div><div class="line">            args.append(getattr(self, k, <span class="keyword">None</span>))</div><div class="line">        sql = <span class="string">'insert into &#123;table_name&#125; (&#123;fields&#125;) values (&#123;values&#125;)'</span>.format(table_name=self.__table__,</div><div class="line">                                                                             fields=<span class="string">','</span>.join(fields),</div><div class="line">                                                                             values=<span class="string">','</span>.join(params))</div><div class="line">        print(<span class="string">'SQL: &#123;sql&#125;'</span>.format(sql=sql))</div><div class="line">        print(<span class="string">'ARGS: &#123;args&#125;'</span>.format(args=args))</div><div class="line"></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserModel</span><span class="params">(Model)</span>:</span></div><div class="line">    user_name = StringField(<span class="string">'username'</span>)</div><div class="line">    email = StringField(<span class="string">'email'</span>)</div><div class="line">    password = StringField(<span class="string">'password'</span>)</div><div class="line"></div><div class="line"></div><div class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</div><div class="line">    user = UserModel(user_id=<span class="number">123</span>, user_name=<span class="string">'hhh'</span>, email=<span class="string">'a@a.a'</span>, password=<span class="string">'asdfa'</span>, x=<span class="string">'y'</span>)</div><div class="line">    user.save()</div><div class="line">    </div></pre></td></tr></table></figure>    </p>
<p>ä¸‹ç¯‡ä¼šåˆ†æmetaclassåœ¨WTFormsä¸­çš„åº”ç”¨</p>
<h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p><a href="https://blog.ionelmc.ro/2015/02/09/understanding-python-metaclasses/">Understanding Python metaclasses æ›´è¯¦ç»†çš„ä»‹ç»</a><br><a href="http://www.jianshu.com/p/9dfa40bf2a62">pythonå®ç°ORM</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;metaclassä¸€ç›´è¢«å½’ç±»ä¸ºæ¯”è¾ƒé«˜æ·±çš„å†…å®¹ï¼Œå†™ä»£ç ä¹Ÿå¾ˆå°‘ä¼šä½¿ç”¨åˆ°metaclassã€‚ç„¶è€Œå¦‚æœä½ çœ‹æŸäº›é¡¹ç›®çš„æºä»£ç ï¼Œè¿˜æ˜¯ä¼šè¢«ç»•åˆ°metaclassé‡Œé¢å»ã€‚èŠ±ä¸€äº›æ—¶é—´ç†è§£ä¸‹metaclasså¾ˆæœ‰ç”¨çš„ï¼Œå› ä¸ºå®ƒçœŸçš„èƒ½æŠŠä¸€æ¡çº¿ä¸²èµ·æ¥ï¼Œç¯ç¯ç›¸æ‰£ï¼Œæ‰€ä»¥æœ‰æ‰å®çš„åŸºç¡€æ˜¯æŒæ¡metaclassçš„å‰æï¼Œæœ¬æ–‡ä»£ç åŸºäºpython3.5&lt;/p&gt;
    
    </summary>
    
      <category term="python" scheme="https://www.zoulei.net/categories/python/"/>
    
    
  </entry>
  
  <entry>
    <title>tornadoè¡¨å•éªŒè¯</title>
    <link href="https://www.zoulei.net/2017/03/23/tornado_wtforms/"/>
    <id>https://www.zoulei.net/2017/03/23/tornado_wtforms/</id>
    <published>2017-03-23T12:17:29.000Z</published>
    <updated>2017-03-23T12:41:33.000Z</updated>
    
    <content type="html"><![CDATA[<p>å·¥ä½œä¸­çœ‹åˆ°æœ‰ä¸€äº›ä¸å¥½çš„ä»£ç ï¼Œæƒ³äº†ä¸ªåŠæ³•ä¼˜åŒ–äº†ä¸€ä¸‹ï¼Œäºæ˜¯æœ‰äº†è¿™ç¯‡åšæ–‡ã€‚æœ¬æ–‡ä¸»è¦è®²tornadoçš„è¡¨å•éªŒè¯ï¼Œä½¿ç”¨çš„æ˜¯wtformsã€‚æœ¬æ–‡æœ€ç»ˆè¾¾åˆ°çš„æ•ˆæœæ˜¯ä½¿ç”¨self.xxè·å–postä¼ é€’è¿‡æ¥çš„å€¼ã€‚</p>
<a id="more"></a>
<p>é¦–å…ˆæ˜¯å°†wtformsåµŒå…¥tornadoã€‚åšæ³•å¯ä»¥å‚è€ƒ<a href="https://github.com/truemped/tornadotools/blob/master/tornadotools/forms.py">https://github.com/truemped/tornadotools/blob/master/tornadotools/forms.py</a>ï¼Œæˆ‘çš„åšæ³•ç±»ä¼¼ï¼Œå¯ä»¥çœ‹æœ€ä¸‹é¢çš„ä»£ç ã€‚è¿™æ ·ç»§æ‰¿ä¸€ä¸‹å°±èƒ½å¤Ÿä½¿ç”¨wtformsçš„è¡¨å•éªŒè¯äº†ã€‚èƒ½å¤Ÿä½¿ç”¨çš„ç»“æœæ˜¯å¾ˆå¤šäººå†™è¿™æ ·çš„ä»£ç </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">self.xx1 = self.form.xx1.data</div><div class="line">self.xx2 = self.form.xx2.data</div><div class="line">self.xx3 = self.form.xx3.data</div><div class="line">:</div><div class="line">:</div></pre></td></tr></table></figure>
<p>ç„¶åè¿™æ ·å†™äº†20è¡Œ(ä¸é»‘ï¼Œé¡¹ç›®é‡ŒçœŸæœ‰è¿™æ ·çš„)ã€‚å†™çš„äººä¹Ÿç¡®å®æ˜¯å¾ˆè®¤çœŸå•Šï¼ï¼Œæ”¹è¿›çš„æ–¹æ³•å¾ˆç®€å•ã€‚è°ƒç”¨self.xx1çš„æ—¶å€™è‡ªåŠ¨å–å€¼self.form.xx1.dataã€‚èƒ½åšæˆè¿™æ ·çš„æ–¹æ³•æŒºå¤šã€‚å¾ˆå¤šæ—¶å€™ä¼šå¯¼è‡´self.xxxä½¿ç”¨IDEæ— æ³•è¡¥å…¨ã€‚æˆ‘ä¸ªäººè®¤ä¸ºå¥½çš„ä»£ç è‚¯å®šèƒ½å¤Ÿæ–¹ä¾¿çš„è¡¥å…¨å’Œæç¤ºï¼Œæ¯•ç«Ÿè¿™æ ·èƒ½å®æ‰“å®çš„æå‡ç ä»£ç çš„å¿ƒæƒ…ï¼Œè¯•æƒ³ä¸€ä¸‹ä½ è¦è¾“å…¥20ä¸ªå•è¯ï¼Œå¾ˆå¯èƒ½ä¸€ä¸å°å¿ƒå°±è¾“å…¥é”™è¯¯äº†ã€‚æ”¹è¿›çš„æ–¹æ³•å°±æ˜¯ä½¿ç”¨<code>__getattribute__</code>,é…åˆç±»ç»§æ‰¿ï¼Œå…¼é¡¾è‡ªåŠ¨è¡¥å…¨ä¹Ÿä¸ç”¨è·‘å»å†™self.form.xxx.dataäº†</p>
<ol>
<li><code>__getattr__</code>ï¼Œå½“å±æ€§ä¸å­˜åœ¨çš„æ—¶å€™ä¼šè°ƒç”¨</li>
<li><code>__getattribute__</code>,æ— è®ºå±æ€§æ˜¯å¦å­˜åœ¨éƒ½ä¼šè¢«è°ƒç”¨</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div></pre></td><td class="code"><pre><div class="line">import tornado.ioloop</div><div class="line">import tornado.web</div><div class="line"></div><div class="line">from wtforms import validators, fields</div><div class="line">from wtforms import Form</div><div class="line">from wtforms.fields.core import UnboundField</div><div class="line"></div><div class="line"></div><div class="line">class MultiDict(dict):</div><div class="line">    def getlist(self, key):</div><div class="line">        return self[key]</div><div class="line"></div><div class="line">    def setlist(self, key, value):</div><div class="line">        self[key] = value</div><div class="line"></div><div class="line"></div><div class="line">class BaseForm(Form):</div><div class="line">    def __init__(self, handler=None, obj=None, prefix=&apos;&apos;, **kwargs):</div><div class="line">        if handler is None:</div><div class="line">            return</div><div class="line">        formdata = MultiDict()</div><div class="line">        if handler.request.method == &apos;POST&apos;:</div><div class="line">            for name in handler.request.arguments.keys():</div><div class="line">                formdata.setlist(name, handler.get_arguments(name))</div><div class="line">        else:</div><div class="line">            for name in handler.request.query_arguments.keys():</div><div class="line">                formdata.setlist(name, handler.request.query_arguments[name])</div><div class="line">        Form.__init__(self, formdata, obj=obj, prefix=prefix, **kwargs)</div><div class="line"></div><div class="line"></div><div class="line">class LoginForm(BaseForm):</div><div class="line">    email = fields.StringField(</div><div class="line">        validators=[validators.Email(), validators.required(), validators.length(min=5, max=64)])</div><div class="line">    password = fields.PasswordField(validators=[validators.required()])</div><div class="line"></div><div class="line"></div><div class="line">class MainHandler(tornado.web.RequestHandler, LoginForm):</div><div class="line">    def __getattribute__(self, item):</div><div class="line">        ret = object.__getattribute__(self, item)</div><div class="line">        if isinstance(ret, UnboundField):</div><div class="line">            form = object.__getattribute__(self, &apos;form&apos;)</div><div class="line">            return getattr(form, item).data</div><div class="line">        return ret</div><div class="line"></div><div class="line">    def post(self):</div><div class="line">        self.form = LoginForm(self)</div><div class="line">        print(self.email)</div><div class="line">        self.write(&quot;Hello, world&quot;)</div><div class="line"></div><div class="line"></div><div class="line">def make_app():</div><div class="line">    return tornado.web.Application([</div><div class="line">        (r&quot;/&quot;, MainHandler),</div><div class="line">    ])</div><div class="line"></div><div class="line"></div><div class="line">if __name__ == &quot;__main__&quot;:</div><div class="line">    app = make_app()</div><div class="line">    app.listen(8888)</div><div class="line">    tornado.ioloop.IOLoop.current().start()</div></pre></td></tr></table></figure>
<p>å®Œç¾è§£å†³é—®é¢˜,å¿ƒæƒ…ç¬é—´èˆ’ç•…äº†â”‘(ï¿£Ğ” ï¿£)â”</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;å·¥ä½œä¸­çœ‹åˆ°æœ‰ä¸€äº›ä¸å¥½çš„ä»£ç ï¼Œæƒ³äº†ä¸ªåŠæ³•ä¼˜åŒ–äº†ä¸€ä¸‹ï¼Œäºæ˜¯æœ‰äº†è¿™ç¯‡åšæ–‡ã€‚æœ¬æ–‡ä¸»è¦è®²tornadoçš„è¡¨å•éªŒè¯ï¼Œä½¿ç”¨çš„æ˜¯wtformsã€‚æœ¬æ–‡æœ€ç»ˆè¾¾åˆ°çš„æ•ˆæœæ˜¯ä½¿ç”¨self.xxè·å–postä¼ é€’è¿‡æ¥çš„å€¼ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="python" scheme="https://www.zoulei.net/categories/python/"/>
    
    
  </entry>
  
  <entry>
    <title>sshç«¯å£æ˜ å°„</title>
    <link href="https://www.zoulei.net/2017/03/12/ssh-port-forward/"/>
    <id>https://www.zoulei.net/2017/03/12/ssh-port-forward/</id>
    <published>2017-03-12T03:40:30.000Z</published>
    <updated>2017-06-01T07:30:20.000Z</updated>
    
    <content type="html"><![CDATA[<p>å¼€å‘ä¸­ç»å¸¸ä¼šéœ€è¦ç”¨åˆ°ç«¯å£æ˜ å°„è¿™ç§äº‹æƒ…ã€‚ä»¥å‰è§‰å¾—å¥½å®¹æ˜“æ··æ·†ã€‚å…¶å®ç”¨ä¹ æƒ¯äº†å°±ä¼šå‘ç°å¦‚æ­¤ç®€å•â”‘(ï¿£Ğ” ï¿£)â”ï¼Œä¸‹é¢è”ç³»åˆ°æˆ‘æ—¥å¸¸ä½¿ç”¨åˆ°çš„ä¸€äº›sshæ˜ å°„å®ä¾‹è®²è§£ä¸€ä¸‹</p>
<a id="more"></a>
<ol>
<li><p>-Då‚æ•°ï¼Œæä¾›ä¸€ä¸ªsocket5çº§åˆ«çš„ä»£ç†ã€‚</p>
<p> è¿™ä¸ªåœ¨å¾ˆå¤šå¹´ä»¥å‰ç¿»å¢™çš„æ—¶å€™è¿˜æ˜¯å¾ˆå¥½ç”¨çš„ã€‚ä¸è¿‡éƒ½å·²ç»æˆä¸ºäº†å†å²ã€‚æœ‰ä»£ç†ä½¿ç”¨ç»éªŒçš„å¼€å‘è€…éƒ½èƒ½å¾ˆå¿«ç†è§£è¿™ä¸ªç©æ„</p>
</li>
<li><p>-L(local forward)æœ¬åœ°è½¬å‘</p>
<p> æ¯”å¦‚ä½ ç°åœ¨éœ€è¦è¿æ¥åˆ°æ­£å¼ç¯å¢ƒçš„æ•°æ®åº“,é‚£ä¹ˆä½ ä¸éœ€è¦å…ˆsshåˆ°æ­£å¼ç¯å¢ƒå†è¾“å…¥æ•°æ®åº“å‘½ä»¤ã€‚æˆ‘çš„åšæ³•æ˜¯é€‰æ‹©ç”¨å›¾å½¢ç•Œé¢æŸ¥çœ‹æ•°æ®åº“ã€‚å‘½ä»¤æ˜¯è¿™æ ·çš„ </p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ssh -L  6789:192.168.10.10:5432 prod</div></pre></td></tr></table></figure>
<p> å«ä¹‰å°±æ˜¯å°†æœ¬åœ°6789ç«¯å£æ¥å—åˆ°çš„è¯·æ±‚è½¬å‘åˆ°ç”Ÿäº§ç¯å¢ƒprodä¸Šé¢çš„192.168.10.10:5432ï¼Œè¿™æ ·æœ¬åœ°GUIæ•°æ®åº“ç®¡ç†ç¨‹åºå°±èƒ½å¤Ÿç›´æ¥è¿æ¥æœ¬åœ°6789ç«¯å£æ˜¾ç¤ºçº¿ä¸Šæ•°æ®äº†ã€‚å¯ä»¥çœ‹å‡ºå®ƒçš„ä½œç”¨å°±æ˜¯å°†æœ¬åœ°ç«¯å£çš„è¯·æ±‚è½¬å‘çš„æœåŠ¡å™¨ä¸Šé¢</p>
</li>
<li><p>-R(Remote forward)è¿œç¨‹è½¬å‘</p>
<p> è¿™ä¸ªå°±æ˜¯å’Œæœ¬åœ°è½¬å‘ç›¸åã€‚åœ¨è¿æ¥çš„æœåŠ¡å™¨ä¸Šæ‰“å¼€ä¸€ä¸ªç«¯å£ï¼Œæ˜ å°„åˆ°è‡ªå·±çš„ç«¯å£ã€‚æ­¤æ—¶æ•°æ®æµæ˜¯æœåŠ¡å™¨ç«¯å£æ¥æ”¶åˆ°çš„æ•°æ®ä¼ åˆ°äº†æœ¬åœ°ã€‚æ¯”å¦‚ä½ éœ€è¦ä¸€ä¸ªå…¬ç½‘ip(æ˜¾ç„¶æˆ‘ä»¬çš„åŠå…¬ç¯å¢ƒéƒ½æ˜¯æ²¡æœ‰å…¬ç½‘ipçš„)æ¥è°ƒè¯•ä½ çš„webåº”ç”¨ï¼Œæ¯”å¦‚ä½ æœ¬åœ°å†™äº†ä¸ªwebç¨‹åºç›‘å¬8989ç«¯å£ï¼Œä½ è¿œç¨‹æœåŠ¡å™¨ä¸Šæœ‰å…¬ç½‘ipã€‚ä½ éœ€è¦æŠŠwebç¨‹åºä¸´æ—¶åˆ†äº«åˆ°å…¬ç½‘ç»™åˆ«äººå°è¯•ä½¿ç”¨ã€‚æ‰§è¡Œä»¥ä¸‹å‘½ä»¤</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ssh -R 4321:127.0.0.1:8989 prod</div></pre></td></tr></table></figure>
<p> è¿™æ ·åˆ«äººè®¿é—®prod_ip:4321å°±ä¼šæ˜ å°„åˆ°ä½ æœ¬åœ°çš„8989ç«¯å£ä¸Šã€‚</p>
</li>
<li><p>åŠ©è®°</p>
<p> åˆšå¼€å§‹å¯èƒ½è§‰å¾—ç«¯å£æ¯”è¾ƒå®¹æ˜“æ··æ·†ã€‚åªéœ€è¦è®°ä½xx:xxï¼Œå‰é¢æ˜¯å…¥å£ï¼Œåé¢æ˜¯å‡ºå£ã€‚æœ¬åœ°è½¬å‘çš„æ—¶å€™æ•°æ®æ˜¯ä»æœ¬åœ°å‘åˆ°è¿œç¨‹ã€‚æ‰€ä»¥6789æ˜¯æœ¬åœ°ç«¯å£ã€‚è¿œç¨‹è½¬å‘çš„æ—¶å€™æ•°æ®æ˜¯ä»è¿œç¨‹å‘åˆ°æœ¬åœ°ã€‚æ‰€ä»¥8989æ˜¯æœ¬åœ°ç«¯å£</p>
</li>
<li><p>è¾…åŠ©å‚æ•°åŠå·¥å…·</p>
<p> å‡å¦‚ä½ åªéœ€è¦ç«¯å£æ˜ å°„ä¸éœ€è¦è¿›å…¥ç»ˆç«¯æ‰§è¡Œå‘½ä»¤ã€‚å¯ä»¥å¢åŠ -Nfå‚æ•°ï¼Œ-Nä¸ºä¸è¿›å…¥äº¤äº’å¼ç»ˆç«¯ã€‚fä¸ºåå°æ‰§è¡Œã€‚å‡å¦‚ä½ éœ€è¦é•¿æœŸä½¿ç”¨ï¼Œé‚£å°±ä½¿ç”¨autosshï¼Œå’Œsshä¸€ä¸ªå¥—è·¯ã€‚å°±ä¸ä¸¾ä¾‹äº†</p>
</li>
</ol>
<h2 id="æ‰©å±•"><a href="#æ‰©å±•" class="headerlink" title="æ‰©å±•"></a>æ‰©å±•</h2><p>å…¶å®æœ¬åœ°è½¬å‘å’Œè¿œç¨‹è½¬å‘å·²ç»å½¢æˆäº†ä¸€ä¸ªåŒå‘çš„æ•°æ®æµåŠ¨ã€‚è¿™æ ·æˆ‘ä»¬å°±èƒ½å¤Ÿå®ç°ä¸€äº›çœ‹èµ·æ¥å¾ˆé«˜çº§çš„åŠŸèƒ½ã€‚æ¯”å¦‚è®¿é—®å†…ç½‘æœºå™¨(æ²¡æœ‰å…¬ç½‘ipï¼Œä¸èƒ½å¤Ÿè¢«ç›´æ¥è®¿é—®åˆ°)ã€‚åªè¦å†…ç½‘æœºå™¨èƒ½å¤Ÿä½¿ç”¨sshè®¿é—®åˆ°å¤–éƒ¨æœºå™¨ï¼Œè€Œè¿™å°å¤–éƒ¨æœºå™¨æˆ‘ä»¬èƒ½å¤Ÿè¿›è¡Œè®¿é—®ã€‚é‚£ä¹ˆæ­¤æ—¶å°±æ˜¯æ­é…æœ¬åœ°è½¬å‘å’Œè¿œç¨‹è½¬å‘çš„æ—¶å€™äº†ã€‚(æ³¨æ„ï¼Œå¦‚æœå¤–éƒ¨æœºå™¨èƒ½å¤Ÿå’Œå†…éƒ¨æœºå™¨åŒå‘è®¿é—®é‚£ä¹ˆä¼šæ›´ç®€å•)</p>
<p>æ€è·¯å°±æ˜¯ä½¿ç”¨å†…ç½‘æœºå™¨è®¿é—®å¤–éƒ¨æœºå™¨ï¼Œä½¿ç”¨è¿œç¨‹ç«¯å£æ˜ å°„ï¼Œå°†æœ¬æœºçš„22ç«¯å£æ˜ å°„åˆ°å¤–éƒ¨æœºå™¨çš„ä»»ä¸€ç«¯å£ä¸Šã€‚ä¹‹ååœ¨å¤–éƒ¨æœºå™¨å°±èƒ½å¤Ÿä½¿ç”¨ssh localhost -p xxè®¿é—®åˆ°å†…ç½‘æœºå™¨äº†ã€‚ç„¶è€Œè¿™éœ€è¦æˆ‘ä»¬å…ˆç™»å½•åˆ°å¤–éƒ¨æœºå™¨å†ä½¿ç”¨localhostç™»é™†åˆ°å†…ç½‘ã€‚æ­¤æ—¶æˆ‘ä»¬å¯ä»¥æ›´ç®€å•çš„ä½¿ç”¨~/.ssh/configé…ç½®æ–‡ä»¶å®Œæˆ</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">Host demo</div><div class="line">    user    ficapy</div><div class="line">    HostName    localhost</div><div class="line">    ProxyCommand ssh prod -W %h:7890</div></pre></td></tr></table></figure>
<p>ssh demoåä¼šå…ˆè¿æ¥å¤–éƒ¨æœºå™¨prod,å†å°†è¯·æ±‚è½¬å‘åˆ°localhost:7890ä¸Šå®Œæˆå¯¹å†…éƒ¨æœºå™¨çš„ç™»é™†ã€‚<br>å‡å¦‚å†…éƒ¨æœºå™¨å’Œå¤–éƒ¨æœºå™¨å¯ä»¥åŒå‘è®¿é—®ï¼Œé‚£ä¹ˆå°±ä¸éœ€è¦è¿œç¨‹ç«¯å£è½¬å‘ï¼Œåªéœ€è¦è¿™æ ·</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">Host demo</div><div class="line">    User ficapy</div><div class="line">    HostName å†…ç½‘æœºå™¨ip</div><div class="line">    ProxyCommand ssh prod -W %h:%p</div></pre></td></tr></table></figure>
<h3 id="æ›´å‘çˆ¹çš„æƒ…å†µ"><a href="#æ›´å‘çˆ¹çš„æƒ…å†µ" class="headerlink" title="æ›´å‘çˆ¹çš„æƒ…å†µ"></a>æ›´å‘çˆ¹çš„æƒ…å†µ</h3><p>åœ¨ä¸¥æ ¼çš„ç¯å¢ƒä¸‹ï¼Œå‡å¦‚ç¦ç”¨äº†sshåè®®ã€‚ä¸å…è®¸ä»å†…éƒ¨sshåˆ°å¤–éƒ¨ã€‚åªå…è®¸å¯¹å¤–å‘é€httpã€httpsè¯·æ±‚ã€‚æ­¤æ—¶sshã€ngrok1.7ç‰ˆæœ¬ã€frpè¿™ç§æ˜¯æ— æ³•ä½¿ç”¨çš„ã€‚æ¨èä½¿ç”¨pagekiteè‡ªå»ºï¼Œäº¦æˆ–è€…ä½¿ç”¨é€Ÿåº¦æš´æ…¢çš„ngrokä»˜è´¹ç‰ˆ<br>é‡åˆ°è¿‡ä¸€ä¸ªé—®é¢˜ã€‚æµ‹è¯•æœºä¸Šéœ€è¦è®¿é—®10.19.2.96çš„1234å’Œ5053ç«¯å£ã€‚å¤„ç†æ–¹æ¡ˆæ˜¯å°†10.19.2.96æ­¤ipç»‘å®šåˆ°ç½‘å¡ä¸Šé¢é…åˆsshè½¬å‘ï¼Œ<code>sudo ifconfig en0 10.19.15.34 netmask 255.255.255.0 up</code>ã€‚ç„¶å<code>ssh -NL 10.19.15.34:1234:10.19.15.34:1234 -L 10.19.15.34:5053:10.19.15.34:5053 dev</code>å°±å¯ä»¥äº†</p>
<h3 id="æ”¶é›†çš„sshé…ç½®æ–‡ä»¶ï¼ˆæ›´å¥½çš„è¿æ¥åˆ°è¿œç«¯æœåŠ¡å™¨ï¼‰"><a href="#æ”¶é›†çš„sshé…ç½®æ–‡ä»¶ï¼ˆæ›´å¥½çš„è¿æ¥åˆ°è¿œç«¯æœåŠ¡å™¨ï¼‰" class="headerlink" title="æ”¶é›†çš„sshé…ç½®æ–‡ä»¶ï¼ˆæ›´å¥½çš„è¿æ¥åˆ°è¿œç«¯æœåŠ¡å™¨ï¼‰"></a>æ”¶é›†çš„sshé…ç½®æ–‡ä»¶ï¼ˆæ›´å¥½çš„è¿æ¥åˆ°è¿œç«¯æœåŠ¡å™¨ï¼‰</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">Host	   *</div><div class="line">	Port          		 22</div><div class="line">    User          		 root</div><div class="line">    IdentityFile  		 ~/.ssh/id_rsa</div><div class="line">    ConnectTimeout 		15</div><div class="line">    ConnectionAttempts 	3</div><div class="line">    ServerAliveInterval 	20</div><div class="line">    ServerAliveCountMax 	5		</div><div class="line">    # å¤šæ¡è¿æ¥å…±äº«</div><div class="line">    ControlMaster   	auto</div><div class="line">    ControlPath     	/tmp/ssh_mux_%h_%p_%r</div><div class="line">    # é•¿è¿æ¥(é€€å‡ºæœåŠ¡å™¨åè¿æ¥ä¾ç„¶å¯é‡ç”¨)</div><div class="line">    ControlPersist  	4h</div><div class="line">    # å‡å°‘å»¶è¿Ÿ</div><div class="line">    GSSAPIAuthentication 	no</div></pre></td></tr></table></figure>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;å¼€å‘ä¸­ç»å¸¸ä¼šéœ€è¦ç”¨åˆ°ç«¯å£æ˜ å°„è¿™ç§äº‹æƒ…ã€‚ä»¥å‰è§‰å¾—å¥½å®¹æ˜“æ··æ·†ã€‚å…¶å®ç”¨ä¹ æƒ¯äº†å°±ä¼šå‘ç°å¦‚æ­¤ç®€å•â”‘(ï¿£Ğ” ï¿£)â”ï¼Œä¸‹é¢è”ç³»åˆ°æˆ‘æ—¥å¸¸ä½¿ç”¨åˆ°çš„ä¸€äº›sshæ˜ å°„å®ä¾‹è®²è§£ä¸€ä¸‹&lt;/p&gt;
    
    </summary>
    
      <category term="DevOps" scheme="https://www.zoulei.net/categories/DevOps/"/>
    
    
  </entry>
  
  <entry>
    <title>ä½¿ç”¨acme.shå¿«é€Ÿæ­å»ºhttps</title>
    <link href="https://www.zoulei.net/2017/03/05/acme.sh_quick_start/"/>
    <id>https://www.zoulei.net/2017/03/05/acme.sh_quick_start/</id>
    <published>2017-03-05T09:19:27.000Z</published>
    <updated>2017-07-29T15:18:25.000Z</updated>
    
    <content type="html"><![CDATA[<p>letsencryptåˆšå‡ºæ¥çš„æ—¶å€™å†™äº†ä¸€ç¯‡å®ƒçš„è®¤è¯ç­¾å‘åŸç†ã€‚è‡ªé‚£è¿‡åå°±æ²¡æœ‰çœŸæ­£çš„å»å®è·µè¿‡äº†ã€‚æœ€è¿‘æœ‰éƒ¨ç½²HTTPSçš„éœ€æ±‚å°±åˆè€ƒå¯Ÿäº†ä¸€ç•ªã€‚å‘ç°acme.shç°å¸¸å¥½ç”¨å•Š~~~ï¼Œæ¥ä¸€ç¯‡æ°´æ–‡è®°å½•ä¸‹æµ‹è¯•éƒ¨ç½²HTTPSçš„å®Œæ•´è¿‡ç¨‹å§</p>
<a id="more"></a>
<p><a href="media/README-1.md">README</a></p>
<p>é¦–å…ˆæœ‰2ç§è®¤è¯æ–¹å¼ï¼Œç”Ÿæˆä¸€ä¸ªæŒ‡å®šçš„æ–‡ä»¶è®©letsencryptè®¿é—®ã€‚æˆ–è€…ç”Ÿæˆä¸€ä¸ªDNSè®°å½•è®©letsencryptè®¿é—®ã€‚ç¬¬ä¸€ç§æ–¹å¼æœ‰éå¸¸å¤§çš„å±€é™æ€§ã€‚æ¯”å¦‚ä½ çš„80ç«¯å£æ­£åœ¨è¢«ä½¿ç”¨ã€‚é‚£ä¹ˆä½ éœ€è¦å…ˆè®¾ç½®DNSè§£æï¼Œå†ä¿®æ”¹ä¸‹nginxçš„é…ç½®è®©ç½‘å€èƒ½å¤Ÿè¢«æ­£å¸¸è®¿é—®åˆ°ã€‚è¿™å°±æ˜¾å¾—å¾ˆéº»çƒ¦äº†ã€‚ä¸»æµçš„DNSæœåŠ¡æä¾›å•†éƒ½å·²ç»æä¾›äº†APIæ¥å£ï¼Œä½¿ç”¨DNSçš„ä¼˜åŠ¿å°±æ˜¯ï¼š</p>
<ol>
<li>ä»»ä½•ç”µè„‘éƒ½èƒ½ç›´æ¥ç”Ÿæˆè¯ä¹¦æ–‡ä»¶ï¼Œä¸éœ€è¦ä¾èµ–æœ¬æœºèƒ½å¤Ÿè¢«å¤–éƒ¨è®¿é—®</li>
<li>ä¸éœ€è¦å¯¹nginxåšä»»ä½•è®¾ç½®</li>
</ol>
<p>ä»¥ä¸‹è®°å½•ä¸‹æˆ‘ä½¿ç”¨ä¸€ä¸ªä¸´æ—¶çš„digitaloceanæœºå™¨ä»0å¼€å§‹éƒ¨ç½²httpsçš„æ­¥éª¤(å‡è®¾æµ‹è¯•urlä¸ºssl.ficapy.com,æ“ä½œç¯å¢ƒä¸ºosx)</p>
<p>æˆ‘è¿˜æ˜¯è¦å®‰åˆ©ä¸‹ï¼Œä¸´æ—¶ä½¿ç”¨digitaloceanæµ‹è¯•ä½¿ç”¨å‘½ä»¤è¡Œå·¥å…·tugboatç°å¸¸å¥½å•Š</p>
<ol>
<li><p>å®‰è£…tugboatç”¨å‘½ä»¤è¡Œå¿«é€Ÿåˆ›å»ºæœºå™¨ä»¥åŠæµ‹è¯•å®Œæˆååˆ é™¤</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">gem install tugboat</div></pre></td></tr></table></figure>
</li>
<li><p>å°†digitaloceançš„apiå†™å…¥è®©tugboatèƒ½å¤Ÿæ­£å¸¸ä½¿ç”¨,å¹¶æ‰§è¡Œä¸€äº›åˆå§‹åŒ–è®¾ç½®</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">tugboat authorize</div></pre></td></tr></table></figure>
</li>
<li><p>æ ¹æ®åˆå§‹åŒ–é»˜è®¤è®¾ç½®åˆ›å»ºä¸€ä¸ªvps</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">tugboat create temp</div></pre></td></tr></table></figure>
</li>
<li><p>sshç™»é™†</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">tugboat ssh temp</div></pre></td></tr></table></figure>
</li>
<li><p>å®‰è£…acme.sh</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">curl https://get.acme.sh | sh</div></pre></td></tr></table></figure>
</li>
<li><p>å‚ç…§acme.shæ–‡æ¡£å°†dnsçš„apiä¿¡æ¯ä½œä¸ºç¯å¢ƒå˜é‡å†™å…¥(è®°å¾—æ‰§è¡Œsource ~/.bashrc)</p>
</li>
<li><p>ç”Ÿæˆè¯ä¹¦</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">acme.sh --issue --dns dns_cf -d ssl.ficapy.com --debug</div></pre></td></tr></table></figure>
</li>
<li><p>å°†è¯ä¹¦æ”¾ç½®åˆ°ä½ç½®å¹¶è®¾ç½®nginxé‡å¯å‘½ä»¤</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">acme.sh --installcert -d ssl.ficapy.com \</div><div class="line">           --keypath       /etc/nginx/ssl/ssl.ficapy.com.key  \</div><div class="line">           --fullchainpath /etc/nginx/ssl/ssl.ficapy.com.pem \</div><div class="line">           --reloadcmd     &quot;service nginx force-reload&quot;</div></pre></td></tr></table></figure>
</li>
<li><p>å¼ºåˆ¶æµ‹è¯•ç»­çº¦(è¯¥æ“ä½œä¼šè‡ªåŠ¨æ‰§è¡Œæ³¨å†Œè¿‡çš„äº‹ä»¶ï¼Œä¸€èˆ¬å°±æ˜¯é‡å¯nginxå’¯ï¼Œç»­çº¦keyæ˜¯ä¸ä¼šå˜çš„ï¼Œå˜çš„æ˜¯fullchain.ceræ–‡ä»¶)</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">acme.sh --renew-all --force</div></pre></td></tr></table></figure>
</li>
<li><p>ç”Ÿæˆdhparamæ–‡ä»¶</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">openssl dhparam -out /etc/nginx/ssl/dhparam.pem 2048</div></pre></td></tr></table></figure>
</li>
<li><p>ä½¿ç”¨ç”Ÿæˆä¸€ä¸ªæ ‡å‡†çš„nginxé…ç½®æ–‡ä»¶å¹¶æ”¾å…¥/etc/nginx/site-enablesç›®å½•ï¼Œç¤ºä¾‹å¦‚ä¸‹</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">    server &#123;</div><div class="line">    listen 443 ssl;</div><div class="line"></div><div class="line">    server_name ssl.ficapy.com;</div><div class="line">    # certs sent to the client in SERVER HELLO are concatenated in ssl_certificate</div><div class="line">    ssl_certificate /etc/nginx/ssl/ssl.ficapy.com.pem;</div><div class="line">    ssl_certificate_key /etc/nginx/ssl/ssl.ficapy.com.key;</div><div class="line">    ssl_session_timeout 1d;</div><div class="line">    ssl_session_cache shared:SSL:50m;</div><div class="line"></div><div class="line"></div><div class="line">    # Diffie-Hellman parameter for DHE ciphersuites, recommended 2048 bits</div><div class="line">    ssl_dhparam /etc/nginx/ssl/dhparam.pem;</div><div class="line"></div><div class="line">    # intermediate configuration. tweak to your needs.</div><div class="line">    ssl_protocols TLSv1 TLSv1.1 TLSv1.2;</div><div class="line">    ssl_ciphers &apos;ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-AES128-SHA256:ECDHE-RSA-AES128-SHA256:ECDHE-ECDSA-AES128-SHA:ECDHE-RSA-AES256-SHA384:ECDHE-RSA-AES128-SHA:ECDHE-ECDSA-AES256-SHA384:ECDHE-ECDSA-AES256-SHA:ECDHE-RSA-AES256-SHA:DHE-RSA-AES128-SHA256:DHE-RSA-AES128-SHA:DHE-RSA-AES256-SHA256:DHE-RSA-AES256-SHA:ECDHE-ECDSA-DES-CBC3-SHA:ECDHE-RSA-DES-CBC3-SHA:EDH-RSA-DES-CBC3-SHA:AES128-GCM-SHA256:AES256-GCM-SHA384:AES128-SHA256:AES256-SHA256:AES128-SHA:AES256-SHA:DES-CBC3-SHA:!DSS&apos;;</div><div class="line">    ssl_prefer_server_ciphers on;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>æœ€åå°±æ˜¯æµè§ˆå™¨è®¿é—®ä»¥ä¸‹æµ‹è¯•å®Œæ¯•å•¦ã€‚å¦‚æœå‡ºç°é”™è¯¯å¯ä»¥æŸ¥çœ‹nginxçš„æ—¥å¿—/var/log/error.logï¼Œè‚¯å®šæ˜¯å“ªä¸€æ­¥å‡ºé—®é¢˜å•¦ï¼Œæœ€åå°±æ˜¯æµ‹è¯•å®Œæ¯•ååˆ é™¤vpså•¦<code>tugboat destory temp</code></p>
</li>
</ol>
<p>é¢å¤–è¯´ä¸€ä¸‹å…¶ä»–çš„å§ã€‚æœ€å¼€å§‹æˆ‘è¯•è¿‡é˜¿é‡Œäº‘dnsçš„apiï¼Œç”¨çš„æ˜¯å­è´¦å·ã€‚ç»“æœå­è´¦å·æ˜¯æ— æ³•åŒ…å«(æ³¨æ„)dnsçš„æ“ä½œæƒé™çš„ï¼Œå°±æ€»æ˜¯å¤±è´¥ã€‚åæ¥ä¸ç”¨å­è´¦å·ï¼Œç›´æ¥ç”¨åŸè´¦å·çš„apiå¯†åŒ™å°±å®Œå…¨æ²¡é—®é¢˜å•¦~~~ã€‚å¦å¤–å„å¤§äº‘å¹³å°å¤§å¤šéƒ½æœ‰è´Ÿè½½å‡è¡¡å™¨ï¼Œç„¶åå¯ä»¥å¡«å†™httpsè¯ä¹¦ã€‚è¿™ç§å°±ä¸å¤ªé€‚åˆletsencryptè¿™ç§çŸ­æœŸè¯ä¹¦äº†ã€‚å¦åˆ™æ€»ä¸Šå»æ¢è¯ä¹¦ä¸è¢«éº»çƒ¦æ­»ã€‚å¦‚æœåœ¨è¿™ç§è´Ÿè½½å‡è¡¡å™¨ä¸Šä¸è®¾ç½®httpsè¯ä¹¦ã€‚é‚£ä¹ˆå°±éœ€è¦åœ¨è´Ÿè½½å‡è¡¡å™¨æ¯ä¸€å°æœºå™¨éƒ½è®¾ç½®ä¸Šhttpsè¯ä¹¦ï¼Œå—¯æƒ³æƒ³ä¹ŸæŒºå¤´å¤§å•Š~~~ï¼Œæ‰€ä»¥è¿™ç§è‡ªåŠ¨åŒ–æ–¹å¼åªæ¯”è¾ƒé€‚åˆåœ¨ä¸€å°æœºå™¨ä¸Šç”Ÿæˆå¹¶ç»´æŠ¤è¯ä¹¦</p>
<p>å†é¢å¤–ï¼Œå“ªä¸ªæ—¶å€™å†™ä¸ªAnsibleçš„playbookå°±å¥½å“’ï¼Œå¯èƒ½ä¼šæ›´åŠ æ–¹ä¾¿â”‘(ï¿£Ğ” ï¿£)â”</p>
<h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p><a href="https://github.com/pearkes/tugboat">github tugboat</a><br><a href="https://mozilla.github.io/server-side-tls/ssl-config-generator/">mozilla ssl-config-generator</a><br><a href="https://ruby-china.org/topics/31983">ä½¿ç”¨ acme.sh ç»™ Nginx å®‰è£… Letâ€™ s Encrypt æä¾›çš„å…è´¹ SSL è¯ä¹¦</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;letsencryptåˆšå‡ºæ¥çš„æ—¶å€™å†™äº†ä¸€ç¯‡å®ƒçš„è®¤è¯ç­¾å‘åŸç†ã€‚è‡ªé‚£è¿‡åå°±æ²¡æœ‰çœŸæ­£çš„å»å®è·µè¿‡äº†ã€‚æœ€è¿‘æœ‰éƒ¨ç½²HTTPSçš„éœ€æ±‚å°±åˆè€ƒå¯Ÿäº†ä¸€ç•ªã€‚å‘ç°acme.shç°å¸¸å¥½ç”¨å•Š~~~ï¼Œæ¥ä¸€ç¯‡æ°´æ–‡è®°å½•ä¸‹æµ‹è¯•éƒ¨ç½²HTTPSçš„å®Œæ•´è¿‡ç¨‹å§&lt;/p&gt;
    
    </summary>
    
      <category term="DevOps" scheme="https://www.zoulei.net/categories/DevOps/"/>
    
    
  </entry>
  
  <entry>
    <title>ä½¿ç”¨pre-commitæ”¹è¿›ä»£ç é£æ ¼</title>
    <link href="https://www.zoulei.net/2017/03/04/pre_commit/"/>
    <id>https://www.zoulei.net/2017/03/04/pre_commit/</id>
    <published>2017-03-04T04:52:37.000Z</published>
    <updated>2017-03-04T10:44:07.000Z</updated>
    
    <content type="html"><![CDATA[<p>å¾ˆæ—©å°±ä½¿ç”¨è¿‡autopep8æ¥è‡ªåŠ¨æ ¼å¼åŒ–ä»£ç ï¼Œä½¿ç”¨IDEçš„æ—¶å€™ä¹Ÿä¼šç»å¸¸ä½¿ç”¨æ ¼å¼åŒ–ä»£ç åŠŸèƒ½è®©ä»£ç æ›´ç¬¦åˆè§„èŒƒä¸€ç‚¹ã€‚å¯æ˜¯è¿™éƒ½ä¸æ˜¯è‡ªåŠ¨åŒ–çš„ï¼Œæˆ–è€…è¯´æ˜¯å¼ºåˆ¶çš„ã€‚ä¸ºäº†ä¿æŒå›¢é˜Ÿçš„è‰¯å¥½ä»£ç é£æ ¼æ„Ÿè§‰æ¯ä¸ªåŒäº‹åœ¨æäº¤ä»£ç ä¹‹å‰éƒ½è‡ªåŠ¨è¿›è¡Œæ ¼å¼åŒ–æˆ–è€…é£æ ¼æ£€æŸ¥æ˜¯ä¸€ä¸ªä¸é”™çš„ä¸»æ„ï¼Œäºæ˜¯æ‰¾åˆ°äº†<a href="http://pre-commit.com/">pre-commit</a></p>
<p>åŸç†ä¹Ÿè¿˜æ˜¯å¾ˆç®€å•çš„ï¼Œgitè‡ªèº«æä¾›äº†ä¸€äº›hookåŠŸèƒ½ï¼ŒæŸ¥çœ‹git/hooksç›®å½•ä¸‹ä¼šå‘ç°æœ‰ä¸€äº›sampleæ–‡ä»¶ï¼Œè¿™æ ·åœ¨æ‰§è¡Œcommitã€pushã€mergeçš„æ—¶å€™éƒ½æ˜¯å¯ä»¥è¿›è¡Œä¸€äº›ç®€å•çš„æ£€æŸ¥ç­‰åŠŸèƒ½çš„ã€‚ç„¶è€Œè¿™ä¸ªè®¾å®šæœ‰ä¸€ä¸ªç¼ºç‚¹ã€‚æ²¡ä¸€ä¸ªhookåªèƒ½æ‰§è¡Œä¸€ä¸ªæ–‡ä»¶çš„å†…å®¹ï¼Œæ‰€ä»¥è¦ä¹ˆå°†å„ç§åŠŸèƒ½æ”¾åœ¨ä¸€ä¸ªæ–‡ä»¶é‡Œé¢ï¼Œæˆ–è€…æ¯ä¸ªåŠŸèƒ½éƒ½æ”¾ç½®åœ¨å„è‡ªçš„æ–‡ä»¶é‡Œé¢ã€‚æœ€åç”±ä¸€ä¸ªæ–‡ä»¶ä¸€èµ·æ‰§è¡Œã€‚pre-commitå°±è§£å†³äº†æˆ‘ä»¬çš„è¿™ä¸ªæ–‡ä»¶ã€‚å°†ä¸åŒçš„ä»»åŠ¡åˆ†å‰²æˆå•ä¸ªæ–‡ä»¶ã€‚ç„¶ååªéœ€è¦æ·»åŠ åˆ«äººå…±äº«çš„è„šæœ¬å°±èƒ½å¤Ÿå¾ˆå¿«çš„è¿›è¡Œcommit hookäº†ï¼Œç®€è¦ä½¿ç”¨æ–¹æ³•ä¾‹ä¸¾å¦‚ä¸‹</p>
<ol>
<li><p>åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹ç¼–å†™é…ç½®æ–‡ä»¶(.pre-commit-config.yaml)</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">-   repo: git://github.com/pre-commit/pre-commit-hooks</div><div class="line">    sha: v0.7.1</div><div class="line">    hooks:</div><div class="line">    -   id: trailing-whitespace</div><div class="line">    -   id: autopep8-wrapper</div></pre></td></tr></table></figure>
</li>
<li><p>è¿›è¡Œåˆå§‹åŒ–<code>pre-commit install</code>å°±å¯ä»¥äº†ï¼Œä»¥åæ¯æ¬¡æ‰§è¡Œcommitçš„æ—¶å€™å°±ä¼šæ‰§è¡Œæ£€æŸ¥ã€‚é…ç½®æ–‡ä»¶çš„repoåœ°å€å³ä¸ºç¬¦åˆpre-commitæ¡†æ¶çš„åœ°å€ï¼Œidå³ä¸ºæä¾›çš„åŠŸèƒ½~~ï¼Œè¿˜æ˜¯å¾ˆå¥½ç†è§£çš„ã€‚ä¾‹å¦‚ä»¥ä¸Šæä¾›çš„autopep8-wrapperå°±å¯èƒ½å¤Ÿé…ç½®pep8è§„èŒƒè¿›è¡Œä¸€äº›ä»£ç é£æ ¼æ£€æŸ¥ï¼Œå¦‚æœä¸ç¬¦åˆé£æ ¼å°±ä¼šè‡ªåŠ¨æ ¼å¼åŒ–ã€‚pep8å·¥å…·çš„é»˜è®¤é…ç½®æ–‡ä»¶æ˜¯<code>~/.config/pep8</code></p>
</li>
</ol>
<h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p><a href="http://blog.sideci.com/2015/12/14/style-guide-of-python-and-lint-tool/">About style guide of python and linter tool. pep8, pyflakes, flake8, haking, Pyling.</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;å¾ˆæ—©å°±ä½¿ç”¨è¿‡autopep8æ¥è‡ªåŠ¨æ ¼å¼åŒ–ä»£ç ï¼Œä½¿ç”¨IDEçš„æ—¶å€™ä¹Ÿä¼šç»å¸¸ä½¿ç”¨æ ¼å¼åŒ–ä»£ç åŠŸèƒ½è®©ä»£ç æ›´ç¬¦åˆè§„èŒƒä¸€ç‚¹ã€‚å¯æ˜¯è¿™éƒ½ä¸æ˜¯è‡ªåŠ¨åŒ–çš„ï¼Œæˆ–è€…è¯´æ˜¯å¼ºåˆ¶çš„ã€‚ä¸ºäº†ä¿æŒå›¢é˜Ÿçš„è‰¯å¥½ä»£ç é£æ ¼æ„Ÿè§‰æ¯ä¸ªåŒäº‹åœ¨æäº¤ä»£ç ä¹‹å‰éƒ½è‡ªåŠ¨è¿›è¡Œæ ¼å¼åŒ–æˆ–è€…é£æ ¼æ£€æŸ¥æ˜¯ä¸€ä¸ªä¸é”™çš„ä¸»æ„ï¼Œäºæ˜¯æ‰¾åˆ°äº†&lt;a href=&quot;
    
    </summary>
    
      <category term="python" scheme="https://www.zoulei.net/categories/python/"/>
    
    
  </entry>
  
  <entry>
    <title>supervisoré‡åˆ°çš„å‘</title>
    <link href="https://www.zoulei.net/2016/12/25/supervisor_may_be_sucks/"/>
    <id>https://www.zoulei.net/2016/12/25/supervisor_may_be_sucks/</id>
    <published>2016-12-25T12:01:43.000Z</published>
    <updated>2017-01-11T08:02:14.000Z</updated>
    
    <content type="html"><![CDATA[<p>å†™å‡ æ¡è‡ªå·±ç”¨supervisoré‡åˆ°çš„ä¸€äº›å°å‘</p>
<ol>
<li><a href="https://python3wos.appspot.com/">Python 3 Wall</a>çš„åæ´¾ä»£è¡¨ï¼Œä¸€ç›´ä¸èƒ½ä½¿ç”¨python3å®‰è£…</li>
<li>å¯¹ä¸­æ–‡è¾“å‡ºæ”¯æŒå¥‡å·®ï¼Œä¼°è®¡æ˜¯ä½¿ç”¨python2é€ æˆçš„ï¼Œä¸¾ä¸ªä¾‹å­ï¼Œå‡å¦‚ä½ è¦åœ¨python2é‡Œé¢printè¾“å‡ºä¸€ä¸ªunicodeä¸­æ–‡å­—ç¬¦ã€‚æˆ‘è¯•äº†å„ç§åŠæ³•ï¼Œå‡æ— è§£(å’Œsupervisorä½¿ç”¨å­è¿›ç¨‹è¿è¡Œç¨‹åºçš„ç­–ç•¥æœ‰å…³),å¥½åœ¨ä½¿ç”¨loggingæ¨¡å—è¾“å‡ºä¸­æ–‡å±…ç„¶æ²¡å•¥é—®é¢˜-_-ï¼Œæ­£å¼è¿è¡Œç¯å¢ƒä¹Ÿæ˜¯å…¨éƒ¨ä½¿ç”¨loggingä»£æ›¿print</li>
<li>å³ä½¿ç”¨python3ï¼Œè¾“å‡ºä¸­æ–‡ä¹Ÿä¼šé‡åˆ°é—®é¢˜,éœ€è¦åœ¨é…ç½®æ–‡ä»¶æ·»åŠ <code>environment=LANG=&quot;en_US.utf8&quot;, LC_ALL=&quot;en_US.UTF-8&quot;, LC_LANG=&quot;en_US.UTF-8&quot;</code>è§£å†³</li>
<li>å†™é…ç½®æ–‡ä»¶çš„æ—¶å€™ä¸€ä¸ªå˜é‡ä¸èƒ½é…ç½®å¤šè¡Œ,æˆ‘ä¸€å¼€å§‹å› ä¸ºenvironmentå¤ªé•¿ã€‚å†™äº†2è¡Œï¼Œå¯¼è‡´åé¢çš„æ²¡ç”Ÿæ•ˆï¼ŒæŠ˜è…¾å¥½ä¹…</li>
<li>ä¿®æ”¹supervisoré…ç½®æ–‡ä»¶åï¼Œå¦‚æœé…ç½®æ–‡ä»¶é”™äº†ï¼Œä¸ä¼šæŠ¥é”™ï¼è€Œä¸”supervisoræ²¡æœ‰å·¥å…·èƒ½å¯¹é…ç½®æ–‡ä»¶çš„æ­£ç¡®æ€§è¿›è¡Œæ£€æŸ¥ï¼Œç°å¸¸æ“è›‹å•Šï¼</li>
<li>supervisorå¯ä»¥æ£€æŸ¥åˆ°å¼‚å¸¸è‡ªåŠ¨é‡å¯å¹¶è®¾ç½®æœ€å¤§é‡å¯æ¬¡æ•°ï¼Œå¯æ˜¯æœ‰æ—¶å€™ä¼šé€ æˆæ— é™é‡å¯è¿™ç§æƒ…å†µã€‚å› ä¸ºé‡å¯åç«‹åˆ»é€€å‡ºæ‰ä¼šè§¦å‘æœ€å¤§é‡å¯æ¬¡æ•°æœºåˆ¶ï¼Œå‡å¦‚ç¨‹åºä¸€ç›´æ˜¯è¿è¡Œäº†ååˆ†é’Ÿè‡ªåŠ¨é€€å‡ºã€‚é‚£ä¹ˆä¼šé€ æˆæ— é™é‡å¯ï¼Œå¯ä»¥ä½¿ç”¨å®ƒçš„apiå†™ä¸€ä¸ªè„šæœ¬ç›‘æ§è¿™ç§æƒ…å†µï¼Œè¿›è¡Œè­¦å‘Š</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> xmlrpc.client</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">list_time</span><span class="params">(name: str, interval: int, times: int)</span>:</span></div><div class="line">    s = xmlrpc.client.ServerProxy(<span class="string">'http://localhost:9001'</span>)</div><div class="line">    <span class="keyword">if</span> s.supervisor.getProcessInfo(name).get(<span class="string">'statename'</span>) != <span class="string">'RUNNING'</span>:</div><div class="line">        <span class="keyword">return</span> <span class="keyword">False</span></div><div class="line">    context = s.supervisor.readLog(<span class="number">0</span>, <span class="number">10</span> * <span class="number">1024</span> * <span class="number">100</span>)</div><div class="line">    context = filter(<span class="keyword">lambda</span> x: name <span class="keyword">in</span> x <span class="keyword">and</span> <span class="string">'spawn'</span> <span class="keyword">in</span> x, context.splitlines())</div><div class="line">    context = map(<span class="keyword">lambda</span> x: datetime.strptime(x[:<span class="number">19</span>], <span class="string">'%Y-%m-%d %H:%M:%S'</span>), context)</div><div class="line">    context = list(filter(<span class="keyword">lambda</span> x: x + timedelta(minutes=interval) &gt; datetime.now(), context))</div><div class="line">    <span class="keyword">return</span> (len(context) &gt; times) <span class="keyword">and</span> len(context)</div></pre></td></tr></table></figure>
<h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p><a href="http://in355hz.iteye.com/blog/1860787">ä¹Ÿè°ˆ Python çš„ä¸­æ–‡ç¼–ç å¤„ç†</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;å†™å‡ æ¡è‡ªå·±ç”¨supervisoré‡åˆ°çš„ä¸€äº›å°å‘&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a href=&quot;https://python3wos.appspot.com/&quot;&gt;Python 3 Wall&lt;/a&gt;çš„åæ´¾ä»£è¡¨ï¼Œä¸€ç›´ä¸èƒ½ä½¿ç”¨python3å®‰è£…&lt;/li&gt;
&lt;li&gt;å¯¹ä¸­æ–‡è¾“å‡ºæ”¯æŒå¥‡å·®ï¼Œ
    
    </summary>
    
      <category term="python" scheme="https://www.zoulei.net/categories/python/"/>
    
    
  </entry>
  
  <entry>
    <title>åŠè‡ªåŠ¨åˆ·ç½‘ç»œè¯¾ç¨‹</title>
    <link href="https://www.zoulei.net/2016/11/08/network_course_pass/"/>
    <id>https://www.zoulei.net/2016/11/08/network_course_pass/</id>
    <published>2016-11-08T14:04:28.000Z</published>
    <updated>2016-11-08T14:04:33.000Z</updated>
    
    <content type="html"><![CDATA[<p>åˆ·ä¸€ä¸ªç½‘ç»œè¯¾ç¨‹ï¼Œå¾ˆå¸¸è§çš„é‚£ç§ï¼Œæ’­æ”¾è§†é¢‘ç»Ÿè®¡è§‚çœ‹æ—¶é•¿ã€‚ä¸è¿‡è¯¥ç³»ç»Ÿæ¯”è¾ƒå¼±ï¼Œå³ä½¿åˆ‡æ¢åˆ°åˆ«çš„é¡µé¢ä¸€æ ·ä¹Ÿä¼šè®¡ç®—æ—¶é•¿ã€‚é™åˆ¶æ¡ä»¶åªæ˜¯å¶å°”ä¼šå‡ºç°ä¸€äº›é—®ç­”é¢˜è®©è§†é¢‘æš‚åœä¸”ä¸€ä¸ªè§†é¢‘æ’­æ”¾å®Œæˆåä¸ä¼šè‡ªåŠ¨æ’­æ”¾ä¸‹ä¸€ä¸ªè§†é¢‘ã€‚æœ€å¼€å§‹æ˜¯æ‰“ç®—ç›´æ¥æ¨¡æ‹Ÿå‘é€httpè¯·æ±‚ï¼Œä¸è¿‡åé¢æ„Ÿè§‰æˆ–è®¸æœ‰å‘å°±é€‰äº†å¦å¤–ä¸€ç§åŠæ³•ã€‚è®²è¯¾è‚¯å®šæ˜¯æœ‰å£°éŸ³çš„ï¼Œç”¨ç¨‹åºå»æ•è·å£°éŸ³ï¼Œå¦‚æœäº”ç§’é’Ÿæ²¡æœ‰å£°éŸ³åˆ™è®¤ä¸ºæœ‰é—®ç­”é¢˜å‡ºç°æˆ–è€…è¯¥ç« èŠ‚è®²å®Œäº†ã€‚</p>
<a id="more"></a>
<h3 id="æ¨¡æ‹Ÿè¯·æ±‚æ³•"><a href="#æ¨¡æ‹Ÿè¯·æ±‚æ³•" class="headerlink" title="æ¨¡æ‹Ÿè¯·æ±‚æ³•"></a>æ¨¡æ‹Ÿè¯·æ±‚æ³•</h3><p>é€šè¿‡chromeå¼€å‘è€…å·¥å…·å¯ä»¥çŸ¥é“æ¯60ç§’ä¼šå‘é€ä¸€ä¸ªè¯·æ±‚ï¼Œå¤§æ¦‚å¦‚ä¸‹(æŸäº›ä¿¡æ¯*å·æ›¿ä»£)<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">POST /home/scorm/rte?cmd=submit&amp;token=68&amp;uid=null&amp;cwid=20&amp;eplanid=17245&amp;dig=************ HTTP/1.1</div><div class="line">Host: ******</div><div class="line">Connection: keep-alive</div><div class="line">Content-Length: 58</div><div class="line">Pragma: no-cache</div><div class="line">Cache-Control: no-cache</div><div class="line">Origin: *********</div><div class="line">X-Requested-With: ShockwaveFlash/23.0.0.205</div><div class="line">User-Agent: Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/54.0.2840.71 Safari/537.36</div><div class="line">Content-Type: text/xml</div><div class="line">Accept: */*</div><div class="line">Referer: *****htmlv1player_template_index.swf?1478605419919</div><div class="line">Accept-Encoding: gzip, deflate</div><div class="line">Accept-Language: zh-CN,zh;q=0.8</div><div class="line">Cookie: *********</div><div class="line"></div><div class="line">cmd:submit</div><div class="line">token:68</div><div class="line">uid:null</div><div class="line">cwid:20</div><div class="line">eplanid:17245</div><div class="line">dig:*****</div></pre></td></tr></table></figure></p>
<p>å¯ä»¥çœ‹åˆ°cookieä¿¡æ¯ç™»å½•åå°±ä¼šæœ‰ï¼Œè¦æ‹¼å‡‘å‡ºä»¥ä¸Šä¿¡æ¯åªéœ€è¦çŸ¥é“digæ˜¯å¦‚ä½•äº§ç”Ÿçš„ã€‚ä»X-Requested-With: ShockwaveFlash/23.0.0.205æˆ‘ä»¬å°±èƒ½çœ‹å‡ºæ¥æ˜¯flashå‘é€çš„ï¼Œç„¶åä¸‹è½½é¡µé¢çš„swfæ–‡ä»¶è¿›è¡Œåç¼–è¯‘å°±èƒ½çŸ¥é“digäº§ç”Ÿçš„é€»è¾‘ã€‚æŠŠswfæ–‡ä»¶æ”¾å…¥<a href="http://www.showmycode.com/">http://www.showmycode.com/</a>å°±èƒ½çœ‹åˆ°äº§ç”Ÿçš„é€»è¾‘äº†ã€‚ä¸è¿‡æˆ‘ä¸ä¼šasï¼Œä»–äº§ç”Ÿçš„ä»£ç ä¹Ÿå¼‚å¸¸ç³Ÿç³•ï¼Œæˆªå–ä¸€æ®µå¦‚ä¸‹<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">md5String = (md5String + _md5PrivateKey);</div><div class="line">md5String = MD5.hash(md5String);</div><div class="line">req = new URLRequest((_serviceUrlHasQuery) ? ((((((((((_serviceUrl + &quot;&amp;cmd=submit&amp;token=&quot;) + _token) + &quot;&amp;uid=&quot;) + _uid) + &quot;&amp;cwid=&quot;) + _cwid) + &quot;&amp;eplanid=&quot;) + _cplanid) + &quot;&amp;dig=&quot;) + md5String) : ((((((((((_serviceUrl + &quot;?cmd=submit&amp;token=&quot;) + _token) + &quot;&amp;uid=&quot;) + _uid) + &quot;&amp;cwid=&quot;) + _cwid) + &quot;&amp;eplanid=&quot;) + _cplanid) + &quot;&amp;dig=&quot;) + md5String));</div><div class="line">req.method = URLRequestMethod.POST;</div><div class="line">req.contentType = &quot;text/xml&quot;;</div><div class="line">_currentSubmitData = xml;</div><div class="line">req.data = xml;</div><div class="line">_urlLoader.load(req);</div></pre></td></tr></table></figure></p>
<p>å¦‚æœä½ å¯¹aséå¸¸ç†Ÿæ‚‰çœ‹èµ·æ¥ä¼°è®¡æ²¡å•¥é—®é¢˜ã€‚å¯æ˜¯æœ‰æ›´å¥½çš„æ–¹æ¡ˆã€‚å¼€æºè½¯ä»¶<a href="https://github.com/jindrapetrik/jpexs-decompiler">jpexs-decompiler</a>.è€Œä¸”å±…ç„¶æœ‰ä¸­æ–‡è¯­è¨€åŒ…ã€‚å¾ˆç‰›çš„ä¸€ç‚¹å°±æ˜¯å®ƒèƒ½å¤Ÿç›´æ¥ç¼–è¾‘ç¼–åç¼–è¯‘åçš„ä»£ç å†é‡æ–°æ‰“åŒ…ï¼Œå¯ä»¥çœ‹çœ‹å®ƒç”Ÿæˆçš„ä»£ç <br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line">this._token++;</div><div class="line">md5String = this._token + &quot;&quot; + this._uid + &quot;&quot; + this._cwid + &quot;&quot; + this._cplanid + &quot;&quot; + tmpTime;</div><div class="line">xml = &quot;&lt;request lastAccess=\&quot;&quot; + this._lastAccess + &quot;\&quot; sessionTime=\&quot;&quot; + tmpTime + &quot;\&quot;&gt;&quot;;</div><div class="line">for each(tmpObj in tmpHash)</div><div class="line">&#123;</div><div class="line">   if(tmpHash[&quot;sco_&quot; + tmpObj.id] == null)</div><div class="line">   &#123;</div><div class="line">      tmpObj2 = this._tracksHash[&quot;sco_&quot; + tmpObj.id];</div><div class="line">      if(tmpObj2 != null)</div><div class="line">      &#123;</div><div class="line">         xml = xml + &quot;&lt;item id=\&quot;&quot; + tmpObj2.id + &quot;\&quot; score=\&quot;&quot; + tmpObj2.score + &quot;\&quot; time=\&quot;&quot; + tmpObj2.time + &quot;\&quot;/&gt;&quot;;</div><div class="line">         tmpHash[&quot;sco_&quot; + tmpObj.id] = tmpObj2;</div><div class="line">         md5String = md5String + tmpObj2.id + tmpObj2.score;</div><div class="line">      &#125;</div><div class="line">   &#125;</div><div class="line">&#125;</div><div class="line">for each(objTemp in tmpHash)</div><div class="line">&#123;</div><div class="line">   xml = xml + &quot;&lt;item id=\&quot;&quot; + objTemp.id + &quot;\&quot; complete=\&quot;&quot; + objTemp.complete + &quot;\&quot; type=\&quot;obj\&quot;/&gt;&quot;;</div><div class="line">&#125;</div><div class="line">xml = xml + &quot;&lt;/request&gt;&quot;;</div><div class="line">this._cmd = &quot;submit&quot;;</div><div class="line">md5String = md5String + this._md5PrivateKey;</div><div class="line">ExternalInterface.call(&quot;console.log&quot;,md5String);</div><div class="line">md5String = MD5.hash(md5String);</div><div class="line">req = new URLRequest(!!this._serviceUrlHasQuery?this._serviceUrl + &quot;&amp;cmd=submit&amp;token=&quot; + this._token + &quot;&amp;uid=&quot; + this._uid + &quot;&amp;cwid=&quot; + this._cwid + &quot;&amp;eplanid=&quot; + this._cplanid + &quot;&amp;dig=&quot; + md5String:this._serviceUrl + &quot;?cmd=submit&amp;token=&quot; + this._token + &quot;&amp;uid=&quot; + this._uid + &quot;&amp;cwid=&quot; + this._cwid + &quot;&amp;eplanid=&quot; + this._cplanid + &quot;&amp;dig=&quot; + md5String);</div><div class="line">req.method = URLRequestMethod.POST;</div><div class="line">req.contentType = &quot;text/xml&quot;;</div><div class="line">this._currentSubmitData = xml;</div><div class="line">req.data = xml;</div><div class="line">this._urlLoader.load(req);</div></pre></td></tr></table></figure></p>
<p>è¿™æ ·çœ‹èµ·æ¥å°±å¾ˆå®¹æ˜“ç†è§£äº†ï¼Œå†™æˆpythonä»£ç å¤§æ¦‚å°±æ˜¯è¿™æ ·å­(åç¼–è¯‘åå¯ä»¥çœ‹åˆ°key)<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># Request Payload</span></div><div class="line"><span class="comment"># &lt;request lastAccess="ch_00_02" sessionTime="60"&gt;&lt;/request&gt;</span></div><div class="line"><span class="comment"># &lt;response success="true"&gt;</span></div><div class="line"><span class="comment"># &lt;item complete="0" id="ch_00_02" score="0.0" time="2249" /&gt;</span></div><div class="line"><span class="comment"># &lt;/response&gt;</span></div><div class="line"><span class="comment"># &lt;?xml version="1.0" encoding="UTF-8"?&gt;&lt;response success="true"&gt;&lt;item complete="0" id="ch_00_02" score="0.0" time="2249"/&gt;&lt;/response&gt;</span></div><div class="line"></div><div class="line"><span class="comment"># http://***?cmd=submit&amp;token=5&amp;uid=null&amp;cwid=67&amp;eplanid=17242&amp;dig=*****</span></div><div class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> md5</div><div class="line">pri = <span class="string">'#Huaxia$RTE-*PP'</span></div><div class="line">a = <span class="string">'1null671724260#Huaxia$RTE-*PP'</span></div><div class="line">b = md5(a).hexdigest()</div></pre></td></tr></table></figure><br>å¦å¤–å¦‚æœé‡åˆ°ä»€ä¹ˆç–‘æƒ‘å¯ä»¥ç›´æ¥<code>ExternalInterface.call(&quot;console.log&quot;,md5String);</code>è¿™æ ·èƒ½å¤Ÿè¾“å‡ºå˜é‡ã€‚é‡æ–°æ‰“åŒ…ä¸ºswfï¼Œå†ç”¨fiddleræ›¿æ¢æ‰è¯·æ±‚çš„swfæ–‡ä»¶ä¸ºè‡ªå·±æ‰“åŒ…çš„æ–‡ä»¶ï¼Œè¿™æ ·å°±èƒ½çœ‹åˆ°è°ƒè¯•è¾“å‡ºäº†ã€‚æ„Ÿæ…¨ä¸‹è¿™ä¸ªå·¥å…·çœŸå¥½ç”¨ï¼Œä¸è¿‡æœ¬äººä¸æ˜¯æå‰ç«¯çš„ï¼Œè€Œä¸”flashä¹Ÿå·²ç»æ²¡è½åˆ°æ²¡æœ‰å»æ·±å…¥çš„å¿…è¦â”‘(ï¿£Ğ” ï¿£)â”</p>
<h3 id="åˆ¤æ–­è§†é¢‘æ˜¯å¦æ’­æ”¾å®ŒæˆåŠè‡ªåŠ¨åŒ–"><a href="#åˆ¤æ–­è§†é¢‘æ˜¯å¦æ’­æ”¾å®ŒæˆåŠè‡ªåŠ¨åŒ–" class="headerlink" title="åˆ¤æ–­è§†é¢‘æ˜¯å¦æ’­æ”¾å®ŒæˆåŠè‡ªåŠ¨åŒ–"></a>åˆ¤æ–­è§†é¢‘æ˜¯å¦æ’­æ”¾å®ŒæˆåŠè‡ªåŠ¨åŒ–</h3><p>æˆ‘åˆ¤æ–­çš„ä¾æ®æ˜¯æ²¡æœ‰å£°éŸ³äº†ï¼Œéœ€è¦è§£å†³çš„å°±æ˜¯è·å–å½“å‰éŸ³é‡å¤§å°çš„é—®é¢˜ã€‚æœ€å¼€å§‹æƒ³çš„æ˜¯ä½¿ç”¨ç³»ç»Ÿçš„å‘½ä»¤è¡Œæ¥å£ï¼Œæ— å¥ˆå¹¶æ²¡æœ‰æ‰¾åˆ°ï¼Œè€Œåçœ‹åˆ°äº†ä½¿ç”¨è™šæ‹ŸéŸ³é¢‘æ¥å£<a href="https://github.com/mattingalls/Soundflower">Soundflower</a>,è™½ç„¶2å¹´æ²¡æ›´æ–°è¿‡äº†ï¼ŒæƒŠå¥‡çš„æ˜¯èƒ½æ­£å¸¸ä½¿ç”¨ã€‚å®‰è£…ä¸Šä¹‹ååœ¨soundé‡Œé¢çš„inputå’Œoutputä¼šå¤šå‡º2ä¸ªè®¾å¤‡ï¼Œå¦‚å›¾<img src="https://ficapy.b0.upaiyun.com/blogimg/soundflower.png" alt="soundflower">,å½“ä½ éœ€è¦æ•è·ç³»ç»Ÿå£°éŸ³çš„æ—¶å€™å°†inputå’Œoutputå‡é€‰ä¸ºåŒä¸€ä¸ª(è¿™æ ·ä¼šå¯¼è‡´æœºå™¨æ²¡æœ‰å£°éŸ³è¾“å‡ºï¼Œéœ€è¦é€‰æ‹©åŒä¸€ä¸ªçš„åŸå› æˆ‘è§‰å¾—æ˜¯ä»£ç ä¸­æ ¹æ®inputçš„æ–‡ä»¶æè¿°ç¬¦æ¥è·å¾—output,æ‰€ä»¥éœ€è¦å°†inputå’Œoutputé€‰ä¸ºåŒä¸€ä¸ª)ï¼Œç„¶è€Œæˆ‘å•ç‹¬å¼€äº†ä¸€ä¸ªwindowsè™šæ‹Ÿæœºï¼Œè™šæ‹Ÿæœºå¯ä»¥é€‰æ‹©ä½¿ç”¨å“ªä¸ªè¾“å…¥è¾“å‡ºéŸ³é¢‘æ¥å£ï¼Œå¯¹äºè™šæ‹Ÿæœºçš„è¾“å‡ºæˆ‘é€‰æ‹©äº†soundflowerï¼Œåœ¨ç³»ç»Ÿè®¾ç½®é‡Œé¢æˆ‘é€‰æ‹©äº†ç›¸åŒçš„soundeflowerä½œä¸ºè¾“å…¥ã€‚å¯æ˜¯é€‰æ‹©äº†æ­£å¸¸çš„æ¥å£ä½œä¸ºè¾“å‡ºã€‚å¦‚æ­¤æˆ‘å¬ä¸åˆ°è™šæ‹Ÿæœºå‘å‡ºçš„å£°éŸ³ï¼ŒåŒæ—¶æœ¬æœºå‘å‡ºçš„å£°éŸ³åˆå¯ä»¥æ­£å¸¸æ”¶å¬ï¼Œå®Œç¾~~~<br>ä»£ç å¦‚ä¸‹<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line">import time</div><div class="line">import pyaudio</div><div class="line">import audioop</div><div class="line">from collections import deque</div><div class="line">from subprocess import Popen</div><div class="line"></div><div class="line">FORMAT = pyaudio.paInt16</div><div class="line">CHANNELS = 2</div><div class="line">RATE = 44100</div><div class="line">CHUNK = 1024</div><div class="line"></div><div class="line">audio = pyaudio.PyAudio()</div><div class="line"></div><div class="line">stream = audio.open(format=FORMAT, channels=CHANNELS,</div><div class="line">                    rate=RATE, input=True,</div><div class="line">                    frames_per_buffer=CHUNK)</div><div class="line"></div><div class="line">flag = time.time()</div><div class="line">queue = deque(maxlen=5)</div><div class="line">while True:</div><div class="line">    data = stream.read(CHUNK)</div><div class="line">    if time.time() - flag &gt; 1:</div><div class="line">        flag = time.time()</div><div class="line">        rms = audioop.rms(data, 2)</div><div class="line">        print rms</div><div class="line">        queue.append(rms)</div><div class="line">        if len(queue) == 5 and sum(queue) == 0:</div><div class="line">            Popen(&quot;&quot;&quot;/usr/bin/osascript -e &apos;display notification &quot;look here&quot; &apos;&quot;&quot;&quot;, shell=True)</div></pre></td></tr></table></figure></p>
<p>å½“äº”ç§’é’Ÿæ²¡æœ‰å£°éŸ³å°±åœ¨å±å¹•å³ä¸Šè§’å¼¹å‡ºä¸€ä¸ªæç¤ºæ¡†æé†’ä½ å»ç‚¹å‡»ã€‚æœ¬æ–‡ç”¨äºosxç³»ç»Ÿï¼Œå…¶ä»–ç³»ç»ŸæŒ‰ç…§è¿™ä¸ªæ€è·¯åº”è¯¥ä¹Ÿèƒ½å®ç°</p>
<h3 id="å…¶ä»–"><a href="#å…¶ä»–" class="headerlink" title="å…¶ä»–"></a>å…¶ä»–</h3><p>å½“ç„¶è¿™ä¸ªç³»ç»Ÿè¿˜æœ‰å¾ˆ<code>è´´å¿ƒ</code>çš„åœ°æ–¹ï¼Œå¯¹äºè§†é¢‘è®²è§£ä¸­å‡ºç°çš„é—®ç­”é¢˜ï¼Œå…¶å®åœ¨å‰ç«¯é¡µé¢ä¸­å·²ç»ç»™å‡ºäº†ç­”æ¡ˆï¼Œæ‰“å¼€webæ§åˆ¶å°ï¼ŒæŸ¥çœ‹ä¸€ä¸‹å°±æœ‰å“’ã€‚<br>ç„¶åè¿˜ä¸å…è®¸å¤åˆ¶ç²˜è´´ã€‚è¿™ä¸ªåŒæ ·ç›´æ¥åœ¨æ§åˆ¶å°é‡Œé¢å¤åˆ¶å°±å¥½äº†ï¼Œä¹Ÿæ²¡å¿…è¦ç¦ç”¨jså•¥çš„~~</p>
<h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p><a href="http://www.christianengvall.se/record-audio-soundflower/">record-audio-soundflower</a><br><a href="http://stackoverflow.com/questions/26478315/getting-volume-levels-from-pyaudio-for-use-in-arduino">getting-volume-levels-from-pyaudio-for-use-in-arduino</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;åˆ·ä¸€ä¸ªç½‘ç»œè¯¾ç¨‹ï¼Œå¾ˆå¸¸è§çš„é‚£ç§ï¼Œæ’­æ”¾è§†é¢‘ç»Ÿè®¡è§‚çœ‹æ—¶é•¿ã€‚ä¸è¿‡è¯¥ç³»ç»Ÿæ¯”è¾ƒå¼±ï¼Œå³ä½¿åˆ‡æ¢åˆ°åˆ«çš„é¡µé¢ä¸€æ ·ä¹Ÿä¼šè®¡ç®—æ—¶é•¿ã€‚é™åˆ¶æ¡ä»¶åªæ˜¯å¶å°”ä¼šå‡ºç°ä¸€äº›é—®ç­”é¢˜è®©è§†é¢‘æš‚åœä¸”ä¸€ä¸ªè§†é¢‘æ’­æ”¾å®Œæˆåä¸ä¼šè‡ªåŠ¨æ’­æ”¾ä¸‹ä¸€ä¸ªè§†é¢‘ã€‚æœ€å¼€å§‹æ˜¯æ‰“ç®—ç›´æ¥æ¨¡æ‹Ÿå‘é€httpè¯·æ±‚ï¼Œä¸è¿‡åé¢æ„Ÿè§‰æˆ–è®¸æœ‰å‘å°±é€‰äº†å¦å¤–ä¸€ç§åŠæ³•ã€‚è®²è¯¾è‚¯å®šæ˜¯æœ‰å£°éŸ³çš„ï¼Œç”¨ç¨‹åºå»æ•è·å£°éŸ³ï¼Œå¦‚æœäº”ç§’é’Ÿæ²¡æœ‰å£°éŸ³åˆ™è®¤ä¸ºæœ‰é—®ç­”é¢˜å‡ºç°æˆ–è€…è¯¥ç« èŠ‚è®²å®Œäº†ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="ä¼ªæŠ€æœ¯" scheme="https://www.zoulei.net/categories/%E4%BC%AA%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="python" scheme="https://www.zoulei.net/tags/python/"/>
    
  </entry>
  
  <entry>
    <title>Flaskè·¯ç”±æœºåˆ¶</title>
    <link href="https://www.zoulei.net/2016/09/11/flask_routing_note/"/>
    <id>https://www.zoulei.net/2016/09/11/flask_routing_note/</id>
    <published>2016-09-11T14:06:12.000Z</published>
    <updated>2016-09-11T14:11:49.000Z</updated>
    
    <content type="html"><![CDATA[<p>Flaskå¸…æ°”çš„Hello Worldç¤ºä¾‹è®©äººå°è±¡æ·±åˆ»ã€‚å…¶ä¸­ä½¿ç”¨è£…é¥°å™¨çš„è·¯ç”±å†™æ³•åŠŸä¸å¯æ²¡ï¼Œç”šè‡³ä»¥å‰çœ‹è¿‡ä¸€ä¸ªç³»åˆ—<a href="http://ains.co/blog/things-which-arent-magic-flask-part-1.html">æ²¡é‚£ä¹ˆç¥å¥‡</a>ï¼Œè®²äº†app.routeã€‚æ˜¯çš„ï¼Œå®ƒå¥½åƒå¹¶æ²¡æœ‰é‚£ä¹ˆç¥å¥‡ï¼Œæˆ‘ä¹Ÿæ¥è§£æä¸€ä¸‹ğŸ˜†</p>
<a id="more"></a>
<p>Flaskçš„è·¯ç”±æ˜¯å¯¹werkzeugè¿›è¡Œäº†ç®€å•çš„åŒ…è£…ï¼Œåšæˆäº†app.routeè£…é¥°å™¨å’Œblueprintã€‚å…¶å®werkzeugä¸­æœ‰ä¸€æ®µdocstringå°±èƒ½åæ˜ å‡ºflaskçš„è·¯ç”±æœºåˆ¶(MapAdapter.dispatch)<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> werkzeug.wrappers <span class="keyword">import</span> Request, Response</div><div class="line"><span class="keyword">from</span> werkzeug.wsgi <span class="keyword">import</span> responder</div><div class="line"><span class="keyword">from</span> werkzeug.routing <span class="keyword">import</span> Map, Rule</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">on_index</span><span class="params">(request)</span>:</span></div><div class="line">    <span class="keyword">return</span> Response(<span class="string">'Hello from the index'</span>)</div><div class="line"></div><div class="line">url_map = Map([Rule(<span class="string">'/'</span>, endpoint=<span class="string">'index'</span>)])</div><div class="line">views = &#123;<span class="string">'index'</span>: on_index&#125;</div><div class="line"></div><div class="line"><span class="meta">@responder</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">application</span><span class="params">(environ, start_response)</span>:</span></div><div class="line">    request = Request(environ)</div><div class="line">    urls = url_map.bind_to_environ(environ)</div><div class="line">    <span class="keyword">return</span> urls.dispatch(<span class="keyword">lambda</span> e, v: views[e](request, **v),</div><div class="line">                         catch_http_exceptions=<span class="keyword">True</span>)</div></pre></td></tr></table></figure></p>
<p>werkzeugè·¯ç”±çš„å…¨éƒ¨å®ç°éƒ½åœ¨routing.pyæ–‡ä»¶å½“ä¸­ï¼Œçœ‹å®ƒå°±å¤Ÿäº†ã€‚è·¯ç”±çš„åŸºæœ¬åŠŸèƒ½å¯ä»¥è¯´æ˜¯</p>
<ol>
<li>ç»™å‡ºä¸€ä¸ªURLï¼ŒåŒ¹é…åˆ°å®ƒå¯¹åº”çš„å¤„ç†å‡½æ•°ï¼Œ</li>
<li>ç»™å‡ºå‡½æ•°èƒ½åæ¨æ„é€ å‡ºURL</li>
</ol>
<h2 id="Rule"><a href="#Rule" class="headerlink" title="Rule"></a>Rule</h2><p>ä¸€ä¸ªRuleå°±æ˜¯ä¸€æ¡URLåŒ¹é…è§„åˆ™,å®ƒçš„æ¨¡å¼å¦‚ä¸‹<code>&lt;converter(arguments):name&gt;</code>,ä½¿ç”¨æ­£åˆ™åŒ¹é…æ‰¾å‡ºæˆ‘ä»¬éœ€è¦çš„ä¿¡æ¯<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">_rule_re = re.compile(r&apos;&apos;&apos;</div><div class="line">    (?P&lt;static&gt;[^&lt;]*)                           # static rule data</div><div class="line">    &lt;</div><div class="line">    (?:</div><div class="line">        (?P&lt;converter&gt;[a-zA-Z_][a-zA-Z0-9_]*)   # converter name</div><div class="line">        (?:\((?P&lt;args&gt;.*?)\))?                  # converter arguments</div><div class="line">        \:                                      # variable delimiter</div><div class="line">    )?</div><div class="line">    (?P&lt;variable&gt;[a-zA-Z_][a-zA-Z0-9_]*)        # variable name</div><div class="line">    &gt;</div><div class="line">&apos;&apos;&apos;, re.VERBOSE)</div></pre></td></tr></table></figure></p>
<p>å¤§æ¦‚æ˜¯è¿™ä¹ˆä¸ªæ ·å­ruleåŒ¹é…<br><img src="https://ficapy.b0.upaiyun.com/blogimg/werkzeug_rule_re.png" alt="werkzeug_rule_re"><br>convertè§„åˆ™åŒ¹é…<br><img src="https://ficapy.b0.upaiyun.com/blogimg/werkzeug_converter_args_re.png" alt="werkzeug_converter_args_re"><br>å¾ˆå®¹æ˜“æƒ³åˆ°ä½¿ç”¨è¿™2ä¸ªæ­£åˆ™èƒ½å¤ŸåŒ¹é…ä¸€ä¸ªURLï¼Œä¸€çœ‹ä»–æ˜¯å¦åŒ¹é…æŸä¸ªruleï¼Œå…¶æ¬¡å¦‚æœåŒ¹é…é‚£ä¹ˆæå–å‡ºruleä¸­çš„å‚æ•°å’Œå€¼,æ¯”å¦‚<code>/&lt;int:id&gt;</code>å°±èƒ½åŒ¹é…<code>/16</code>è¿™ä¸ªurlä¸”å¾—åˆ°id=16ã€‚è¿™2ä¸ªå‡½æ•°å°±æ˜¯matchå’Œbuildäº†<br>ä»…ä»…æœ‰å®ƒä»¬æ˜¯ä¸å¤Ÿçš„ã€‚æˆ‘ä»¬éœ€è¦çš„ä¸ä»…ä»…æ˜¯ä¸€æ¡Ruleï¼Œæˆ‘ä»¬éœ€è¦çš„æ˜¯æ‰€æœ‰Ruleçš„é›†åˆã€‚å½“æˆ‘ä»¬æ¯åˆ›å»ºä¸€ä¸ªRuleçš„æ—¶å€™å°†å®ƒåŠ å…¥åˆ°é›†åˆä¸­ã€‚æ‰€ä»¥å®ƒæä¾›äº†get_ruleså’Œbindæ–¹æ³•</p>
<p>Ruleå¯¹è±¡åŒæ—¶æœ‰2ä¸ªéå¸¸é‡è¦çš„å±æ€§endpointå’Œ_regex(ç¼–è¯‘åçš„æ­£åˆ™).endpointä¸ç”¨è¯´åŒ¹é…è¿”å›å®ƒï¼Œæ ¹æ®å®ƒè¿”å›æ„å»ºå¥½çš„URLï¼ŒåŒ¹é…åŠŸèƒ½åˆ™æ˜¯ç”±_regexå¯¹è±¡æä¾›çš„ã€‚å¦å¤–æœ‰å‡ ä¸ªå¯¹è±¡ç»§æ‰¿è‡ªRule<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">Subdomain           self.subdomain</div><div class="line">Submount            self.rule = self.path + self.rule</div><div class="line">EndpointPrefix      self.endpoint = self.prefix + self.endpoint</div></pre></td></tr></table></figure></p>
<p>å¯ä»¥çœ‹å‡ºè¿™ä¸‰ä¸ªå¯¹è±¡éƒ½æ˜¯å¯¹Ruleçš„å±æ€§è¿›è¡Œäº†å°å¹…åº¦ä¿®æ”¹,å…¶ä¸­subdomainå’Œsubmountä¿®æ”¹çš„æœ€ç»ˆç»“æœå°±æ˜¯æ”¹å˜äº†_regexå¯¹è±¡</p>
<p>è¯´ä¸€ä¸‹Subdomain,å­åŸŸåã€‚è¿™ç©æ„å„¿å¥½åƒå¹¶ä¸å¸¸ç”¨ï¼Œä¸€èˆ¬ä¸€ä¸ªå­åŸŸåå°±æ˜¯å•ç‹¬ä¸€ä¸ªé¡¹ç›®äº†ï¼Œä¸å¤§ä¼šå‡ ä¸ªå­åŸŸåæ··åˆåœ¨ä¸€ä¸ªé¡¹ç›®é‡Œé¢ã€‚å¦‚æœè¦ä½¿ç”¨å­åŸŸåéœ€è¦è®¾ç½®SERVER_NAMEã€‚ç¤ºä¾‹å¦‚ä¸‹<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</div><div class="line">app = Flask(__name__)</div><div class="line">app.config[<span class="string">'SERVER_NAME'</span>] = <span class="string">'app.local:5000'</span></div><div class="line"><span class="meta">@app.route('/',subdomain='blog')</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span><span class="params">()</span>:</span></div><div class="line">    <span class="keyword">return</span> <span class="string">'Hello'</span></div><div class="line">app.run(<span class="string">'app.local'</span>)</div></pre></td></tr></table></figure><br>ç„¶åå°±æ˜¯åœ¨hosté‡Œé¢æ·»åŠ å°±å¯ä»¥æ­£å¸¸è°ƒè¯•å­åŸŸåäº†<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">127.0.0.1 app.local</div><div class="line">127.0.0.1 blog.app.local</div></pre></td></tr></table></figure></p>
<h2 id="Map"><a href="#Map" class="headerlink" title="Map"></a>Map</h2><p>Mapçš„ä½œç”¨å°±æ˜¯å°†æ‰€æœ‰çš„Ruleç»„åˆåœ¨ä¸€èµ·,æ‰€ä»¥addå‡½æ•°æ˜¯å¿…é¡»çš„,Ruleå¯¹è±¡ä¸­çš„matchå’Œbuildéƒ½åªæ˜¯é’ˆå¯¹è‡ªå·±çš„ï¼ŒMapä¸­æä¾›çš„matchå’Œbuildåˆ™æ˜¯é’ˆå¯¹æ‰€æœ‰Ruleçš„ã€‚æ¯”å¦‚åœ¨Flaskä¸­å†™app.routeå¿…ç„¶ä¼šè°ƒç”¨addï¼Œå°†è¯¥Ruleæ·»åŠ åˆ°Mapä¸­ã€‚ä»£ç å¦‚ä¸‹(0.1ç‰ˆæœ¬)<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">add_url_rule</span><span class="params">(self, rule, endpoint, **options)</span>:</span></div><div class="line">    options[<span class="string">'endpoint'</span>] = endpoint</div><div class="line">    options.setdefault(<span class="string">'methods'</span>, (<span class="string">'GET'</span>,))</div><div class="line">    self.url_map.add(Rule(rule, **options))</div><div class="line">    </div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">route</span><span class="params">(self, rule, **options)</span>:</span></div><div class="line">  <span class="function"><span class="keyword">def</span> <span class="title">decorator</span><span class="params">(f)</span>:</span></div><div class="line">      self.add_url_rule(rule, f.__name__, **options)</div><div class="line">      self.view_functions[f.__name__] = f</div><div class="line">      <span class="keyword">return</span> f</div><div class="line">  <span class="keyword">return</span> decorator</div></pre></td></tr></table></figure><br>ä»£ç ä¸­self.url_map = Map(),å¯ä»¥çœ‹åˆ°app.routeåšäº†2ä»¶äº‹æƒ…ï¼ŒåŠ å…¥åˆ°Mapä¸­ï¼ŒåŠ å…¥åˆ°äº†view_functionså­—å…¸ä¸­(endpointå¯¹åº”å‡½æ•°,è¿™æ®µä»£ç å’Œæ–‡ç« å¼€å¤´çš„ä»£ç æ˜¯å¾ˆç›¸ä¼¼çš„)</p>
<p>Mapå¯¹è±¡ä¸­æœ‰2ä¸ªå±æ€§ä¹Ÿæ˜¯æ¯”è¾ƒé‡è¦çš„,_rulesåˆ—è¡¨å’Œ_rules_by_endpointå­—å…¸ã€‚å‰è€…å­˜æ”¾æ‰€æœ‰Ruleå¯¹è±¡ï¼ŒåŒ¹é…çš„æ—¶å€™ç”¨æ¥éå†ï¼Œåè€…ä¸ºendpointåˆ°Ruleçš„æ˜ å°„ã€‚ç”¨æ¥buildé‡ç»„URL</p>
<p>ç°åœ¨å†æ¥çœ‹çœ‹Flaskä¸­çš„dispatchåˆ†å‘é€»è¾‘<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">dispatch_request</span><span class="params">(self)</span>:</span></div><div class="line">    <span class="string">"""Does the request dispatching.  Matches the URL and returns the</div><div class="line">    return value of the view or error handler.  This does not have to</div><div class="line">    be a response object.  In order to convert the return value to a</div><div class="line">    proper response object, call :func:`make_response`.</div><div class="line">    """</span></div><div class="line">    <span class="keyword">try</span>:</div><div class="line">        endpoint, values = self.match_request()</div><div class="line">        <span class="keyword">return</span> self.view_functions[endpoint](**values)</div><div class="line">    <span class="keyword">except</span> HTTPException, e:</div><div class="line">        handler = self.error_handlers.get(e.code)</div><div class="line">        <span class="keyword">if</span> handler <span class="keyword">is</span> <span class="keyword">None</span>:</div><div class="line">            <span class="keyword">return</span> e</div><div class="line">        <span class="keyword">return</span> handler(e)</div><div class="line">    <span class="keyword">except</span> Exception, e:</div><div class="line">        handler = self.error_handlers.get(<span class="number">500</span>)</div><div class="line">        <span class="keyword">if</span> self.debug <span class="keyword">or</span> handler <span class="keyword">is</span> <span class="keyword">None</span>:</div><div class="line">            <span class="keyword">raise</span></div><div class="line">        <span class="keyword">return</span> handler(e)</div></pre></td></tr></table></figure><br>åŒ¹é…è¯·æ±‚å¾—åˆ°endpointå†ä»view_functionä¸­å¾—åˆ°å¯¹åº”çš„å¤„ç†å‡½æ•°æ‰§è¡Œ</p>
<h2 id="Blueprint"><a href="#Blueprint" class="headerlink" title="Blueprint"></a>Blueprint</h2><p>@app.routeè™½ç„¶å¤Ÿç‚«é…·ï¼Œå¯æ˜¯å®ƒç»ä¸é€‚åº”äºå¤§é¡¹ç›®ã€‚å› ä¸ºæ³¨å†Œçš„endpointå°±æ˜¯å‡½æ•°çš„åç§°ï¼Œåœ¨å¤§é¡¹ç›®ä¸­ç»å¯¹ä¼šå­˜åœ¨é‡åå‡½æ•°çš„ã€‚Blueprintçš„è§£å†³åŠæ³•å°±æ˜¯<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">blueprint = Blueprint(&apos;public&apos;, __name__, static_folder=&apos;../static&apos;)</div><div class="line">@blueprint.route(&apos;/&apos;, methods=[&apos;GET&apos;, &apos;POST&apos;])</div><div class="line">def index()</div><div class="line"></div><div class="line">app.register_blueprint(blueprint)</div></pre></td></tr></table></figure></p>
<p>è¿™æ ·å®ƒæ³¨å†Œçš„endpointå°±ä¼šå˜æˆpublic.indexï¼Œè§£å†³äº†é‡åé—®é¢˜</p>
<p>æœ‰äººé—®ä¸ºä»€ä¹ˆendpointä¸ç›´æ¥ä½¿ç”¨å¯¹åº”çš„å‡½æ•°ï¼Œè€Œè¦ä½¿ç”¨å­—ç¬¦ä¸²ã€‚æˆ‘è®¤ä¸ºæ˜¯ä½¿ç”¨url_forç­‰æ„å»ºURLå‡½æ•°çš„æ—¶å€™éœ€è¦å®ƒæ˜¯å­—ç¬¦ä¸²ï¼Œå› ä¸ºä½¿ç”¨è£…é¥°å™¨åfunc = deactor(func)ï¼Œä½ ä½¿ç”¨@app.routeä¹‹åæ³¨å†Œçš„funcå’Œä½ ç°åœ¨çš„funcä¸æ˜¯åŒä¸€ä¸ªå¯¹è±¡ã€‚æ„å»ºå‡½æ•°å°†æ— æ³•ä½¿ç”¨,è¿™ä¹Ÿå‘Šè¯‰äº†æˆ‘ä»¬,ä»»ä½•æ—¶å€™å…¶ä»–çš„è£…é¥°å™¨éƒ½éœ€è¦å†™åœ¨@app.routeä¸‹é¢,å› ä¸ºå¦‚æœå†™åœ¨ä¸Šé¢ï¼Œä½ æ³¨å†Œçš„é‚£ä¸ªå‡½æ•°æ˜¯ä¸åŒ…å«ä¸Šé¢çš„è£…é¥°å™¨çš„ï¼Œæ³¨å®šäº†ä¸Šé¢çš„è£…é¥°å™¨æ— æ³•æ‰§è¡Œ</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;Flaskå¸…æ°”çš„Hello Worldç¤ºä¾‹è®©äººå°è±¡æ·±åˆ»ã€‚å…¶ä¸­ä½¿ç”¨è£…é¥°å™¨çš„è·¯ç”±å†™æ³•åŠŸä¸å¯æ²¡ï¼Œç”šè‡³ä»¥å‰çœ‹è¿‡ä¸€ä¸ªç³»åˆ—&lt;a href=&quot;http://ains.co/blog/things-which-arent-magic-flask-part-1.html&quot;&gt;æ²¡é‚£ä¹ˆç¥å¥‡&lt;/a&gt;ï¼Œè®²äº†app.routeã€‚æ˜¯çš„ï¼Œå®ƒå¥½åƒå¹¶æ²¡æœ‰é‚£ä¹ˆç¥å¥‡ï¼Œæˆ‘ä¹Ÿæ¥è§£æä¸€ä¸‹ğŸ˜†&lt;/p&gt;
    
    </summary>
    
      <category term="Flask" scheme="https://www.zoulei.net/categories/Flask/"/>
    
    
      <category term="Flask" scheme="https://www.zoulei.net/tags/Flask/"/>
    
  </entry>
  
  <entry>
    <title>Flaskæ’ä»¶åŸç†</title>
    <link href="https://www.zoulei.net/2016/09/05/flask_plugin_note/"/>
    <id>https://www.zoulei.net/2016/09/05/flask_plugin_note/</id>
    <published>2016-09-04T23:38:32.000Z</published>
    <updated>2016-09-11T14:08:21.000Z</updated>
    
    <content type="html"><![CDATA[<p>Flaskçš„æ’ä»¶è¿˜æŒºå¤š,ç”¨è¿‡çš„éƒ½çŸ¥é“æ¯”å¦‚flask-sqlalchemy,å®‰è£…çš„æ—¶å€™æ˜¯ä½¿ç”¨pip install flask-sqlalchemyï¼Œä½¿ç”¨çš„æ—¶å€™å°±æˆäº†from flask.ext.sqlalchemy import SQLAlchemyã€‚ä½¿ç”¨çš„æ˜¯flask.extè€Œä¸æ˜¯flask_sqlalchemyã€‚æ„Ÿè§‰è¿˜æœ‰ç‚¹ç‰›æ°å•Š-_-ï¼Œä¸è¿‡ä»…ä»…æ˜¯çœ‹èµ·æ¥é«˜å¤§ä¸Šï¼Œå¹¶æ²¡æœ‰ä»€ä¹ˆåµç”¨ã€‚<a href="https://github.com/pallets/flask/issues/1135">åœ¨2016å¹´4æœˆ13å·æ­£å¼è¢«ç§»å‡ºæ”¯æŒäº†</a>ï¼Œå·²ç»ç›´æ¥å‘å‡ºä¸å»ºè®®ä½¿ç”¨çš„è­¦å‘Šã€‚æœ¬æ–‡è¿˜æ˜¯æ¥ç‚’ä¸€ä¸‹ç°é¥­ï¼Œçœ‹çœ‹å®ƒèƒŒåçš„é€»è¾‘</p>
<a id="more"></a>
<p>æ¯”å¦‚flask-sqlalchemyåŸæœ¬æ˜¯ä½¿ç”¨from flask_sqlalchemy import [anything]ä½¿ç”¨çš„ï¼Œè¢«å˜æˆäº†from flask.ext.sqlalchemy import [anything]ã€‚è¿™æ˜¯ä¸€ç§å¯¹äºimportçš„hookã€‚æˆ‘ä»¬çŸ¥é“è¦å¯¼å…¥ä¸€ä¸ªæ¨¡å—ï¼Œä¸ä½¿ç”¨importå£°æ˜ä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œå¯ä»¥ä½¿ç”¨__import__å‡½æ•°ï¼Œè¿”å›å¾—åˆ°çš„ä¹Ÿæ˜¯ä¸€ä¸ªæ¨¡å—å¯¹è±¡</p>
<h2 id="import-hook"><a href="#import-hook" class="headerlink" title="import hook"></a>import hook</h2><p>ä¸‹æ–‡ç®€è¿°ï¼Œå¦‚æœéœ€è¦äº†è§£æ¯”è¾ƒè¯¦ç»†çš„èµ„æ–™å¯ä»¥æŸ¥çœ‹åæ–‡ç»™å‡ºçš„å‚è€ƒé“¾æ¥(python2å’Œ3çš„importæœºåˆ¶æ˜¯ç•¥æœ‰åŒºåˆ«çš„)<br>importå£°æ˜ä¸»è¦åšäº†2ä»¶äº‹æƒ…ï¼ŒæŸ¥æ‰¾æ¨¡å—ï¼ŒåŠ è½½æ¨¡å—ã€‚æˆ‘ä»¬è¯´çš„hookå‘ç”Ÿåœ¨ç¬¬ä¸€æ­¥æŸ¥æ‰¾æ¨¡å—ã€‚æŸ¥æ‰¾æ¨¡å—çš„æ­¥éª¤æ˜¯</p>
<ol>
<li>æŸ¥æ‰¾sys.modulesç¼“å­˜</li>
<li>åœ¨sys.meta_pathä¸­ä¾æ¬¡æ‰§è¡Œfinderå¯¹è±¡,æ‰¾åˆ°å°±è¿”å›è‡ªèº«,æ‰€æœ‰çš„éƒ½æ²¡æœ‰æ‰¾åˆ°åˆ™ä¼šæŠ¥é”™<br>æ³¨æ„:sys.path_hooksä¸­çš„finderä¼šè¢«sys.meta_pathè°ƒç”¨æ‰§è¡Œ(sys.meta_pathå’Œsys.path_hookéƒ½å¯ä»¥å‚ä¸import hooksæ­¥éª¤)</li>
</ol>
<h2 id="ç²¾ç®€ç‰ˆæœ¬å®ç°"><a href="#ç²¾ç®€ç‰ˆæœ¬å®ç°" class="headerlink" title="ç²¾ç®€ç‰ˆæœ¬å®ç°"></a>ç²¾ç®€ç‰ˆæœ¬å®ç°</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> sys</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">ExtensionImporter</span><span class="params">(object)</span>:</span></div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">install</span><span class="params">(self)</span>:</span></div><div class="line">        sys.meta_path[:] = [x <span class="keyword">for</span> x <span class="keyword">in</span> sys.meta_path <span class="keyword">if</span> self != x] + [self]</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">find_module</span><span class="params">(self, fullname, path=None)</span>:</span></div><div class="line">        <span class="keyword">if</span> fullname.startswith(<span class="string">'flask.ext.'</span>):</div><div class="line">            <span class="keyword">return</span> self</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">load_module</span><span class="params">(self, fullname)</span>:</span></div><div class="line">        <span class="keyword">if</span> fullname <span class="keyword">in</span> sys.modules:</div><div class="line">            <span class="keyword">return</span> sys.modules[fullname]</div><div class="line"></div><div class="line">        modname = fullname.split(<span class="string">'.'</span>)[<span class="number">-1</span>]</div><div class="line"></div><div class="line"></div><div class="line">        realname = <span class="string">'flask_'</span> +  modname</div><div class="line">        <span class="keyword">try</span>:</div><div class="line">            __import__(realname)</div><div class="line">        <span class="keyword">except</span> ImportError:</div><div class="line">            <span class="keyword">raise</span> ImportError(<span class="string">'No module named %s'</span> % fullname)</div><div class="line"></div><div class="line">        module = sys.modules[fullname] = sys.modules[realname]</div><div class="line">        <span class="keyword">if</span> <span class="string">'.'</span> <span class="keyword">not</span> <span class="keyword">in</span> modname:</div><div class="line">            setattr(sys.modules[<span class="string">'flask.ext'</span>], modname, module)</div><div class="line"></div><div class="line">        <span class="keyword">return</span> module</div></pre></td></tr></table></figure>
<p>ExtensionImporteræ˜¯ä¸€ä¸ªfinderå¯¹è±¡,å½“æ‰§è¡Œimport flask.extæ—¶ä¼šæŠŠå®ƒåŠ å…¥åˆ°sys.meta_pathåˆ—è¡¨ï¼Œåç»­çš„importéƒ½ä¼šå…ˆæ‰§è¡Œå®ƒï¼Œåˆ¤æ–­æ»¡è¶³è¦æ±‚åå°±ä¼šä½¿ç”¨__import__å¯¼å…¥ç„¶ååŠ å…¥åˆ°sys.modulesï¼Œè¿™æ ·å°±å®ç°äº†flask.ext.sqlalchemyå¯¼å…¥</p>
<p>ä¸ºä»€ä¹ˆä¼šè¢«åºŸé™¤å‘¢ã€‚ä¸‹é¢æ˜¯æˆ‘çŒœæµ‹çš„ã€‚é¦–å…ˆæœ¬æ¥è¿™ä¸ªä¸œè¥¿æ²¡æœ‰å®è´¨çš„ä½œç”¨ï¼Œå°±æ˜¯çœ‹ç€ç‚«é…·è€Œå·²ã€‚æˆ‘ä»¬å¯ä»¥è®¤ä¸ºæ‰€æœ‰çš„æ‰©å±•å¯¼å…¥éƒ½ä¼šä½¿ç”¨flask.ext.xxxï¼Œä½†æ˜¯è¿™å¯¹ç¬¬ä¸‰æ–¹æ‰©å±•åº“æ˜¯æœ‰è¦æ±‚çš„ï¼Œé‚£å°±æ˜¯åŒ…åå¿…é¡»ä¸ºflask_xxxæ‰è¡Œï¼Œæˆ‘çŒœæµ‹æœ‰çš„ç¬¬ä¸‰æ–¹åº“æœªå¿…éµå®ˆè¿™ä¸ªè§„åˆ™(å¦åˆ™exthook.pyä¸­ä¹Ÿä¸ä¼šå‡ºç°['flask_%s', 'flaskext.%s'flaskext.å¦å¤–ä¸€ç§å½¢å¼)ï¼Œè¿™å°±è¯´æ˜äº†æœ‰çš„ä½œè€…ä½¿ç”¨äº†flaskextxxxè¿™ç§åŒ…åã€‚å‡ºç°äº†ç¬¬äºŒç§éš¾å…å°±ä¼šå‡ºç°å¦å¤–çš„ã€‚å½“ä½¿ç”¨è€…å‘ç°å¹¶éæ‰€æœ‰çš„ç¬¬ä¸‰æ–¹æ‰©å±•éƒ½ä½¿ç”¨flask.extå¯¼å…¥çš„æ—¶å€™ã€‚ç¤¾åŒºä¹Ÿè§‰å¾—æ²¡å¿…è¦ç»´æŒäº†ï¼Œæ¯•ç«Ÿç¬¬ä¸€ä¸ªå†™è¿™ä¸ªä»£ç çš„äººæ˜¯ä¸æ˜¯å› ä¸ºåˆšåˆšäº†è§£äº†importæœºåˆ¶ï¼Œè§‰å¾—å¾ˆç‚«é…·å†™ä¸Šå»çš„å‘¢-_-,å¦å¤–è¿™ç§èŠ±å“¨çš„è®¾è®¡ä¹Ÿå¯èƒ½å¯¹ä»£ç è‡ªåŠ¨è¡¥å…¨åŠŸèƒ½äº§ç”Ÿäº†è´Ÿé¢å½±å“ã€‚soï¼Œæœ€åè¿˜æ˜¯å›åˆ°äº†åŸæ¥çš„ä½ç½®ï¼Œç›´æ¥ä½¿ç”¨import flask_sqlalchemyå¯¼å…¥å§</p>
<h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p><a href="https://docs.python.org/3/reference/import.html#import-hooks">å®˜æ–¹import hookæ–‡æ¡£</a><br><a href="https://github.com/Liuchang0812/slides/tree/master/pycon2015cn">pycon2015 importæ¼”è®²</a><br><a href="https://github.com/mitsuhiko/flask-sqlalchemy">flask-sqlalchemy</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;Flaskçš„æ’ä»¶è¿˜æŒºå¤š,ç”¨è¿‡çš„éƒ½çŸ¥é“æ¯”å¦‚flask-sqlalchemy,å®‰è£…çš„æ—¶å€™æ˜¯ä½¿ç”¨pip install flask-sqlalchemyï¼Œä½¿ç”¨çš„æ—¶å€™å°±æˆäº†from flask.ext.sqlalchemy import SQLAlchemyã€‚ä½¿ç”¨çš„æ˜¯flask.extè€Œä¸æ˜¯flask_sqlalchemyã€‚æ„Ÿè§‰è¿˜æœ‰ç‚¹ç‰›æ°å•Š-_-ï¼Œä¸è¿‡ä»…ä»…æ˜¯çœ‹èµ·æ¥é«˜å¤§ä¸Šï¼Œå¹¶æ²¡æœ‰ä»€ä¹ˆåµç”¨ã€‚&lt;a href=&quot;https://github.com/pallets/flask/issues/1135&quot;&gt;åœ¨2016å¹´4æœˆ13å·æ­£å¼è¢«ç§»å‡ºæ”¯æŒäº†&lt;/a&gt;ï¼Œå·²ç»ç›´æ¥å‘å‡ºä¸å»ºè®®ä½¿ç”¨çš„è­¦å‘Šã€‚æœ¬æ–‡è¿˜æ˜¯æ¥ç‚’ä¸€ä¸‹ç°é¥­ï¼Œçœ‹çœ‹å®ƒèƒŒåçš„é€»è¾‘&lt;/p&gt;
    
    </summary>
    
      <category term="Flask" scheme="https://www.zoulei.net/categories/Flask/"/>
    
    
      <category term="Flask" scheme="https://www.zoulei.net/tags/Flask/"/>
    
  </entry>
  
  <entry>
    <title>tmux</title>
    <link href="https://www.zoulei.net/2016/09/02/tmux_note/"/>
    <id>https://www.zoulei.net/2016/09/02/tmux_note/</id>
    <published>2016-09-02T07:43:22.000Z</published>
    <updated>2016-09-04T07:33:07.000Z</updated>
    
    <content type="html"><![CDATA[<p>è‡ªscreenä¹‹åtmuxæ—©å·²èº«åè¿œæ‰¬ï¼Œç„¶è€Œè¿™ä¸ªä¸œè¥¿å¯¹äºä¸€èˆ¬äººæ¥è¯´å¥½åƒå¹¶æ²¡æœ‰ä»€ä¹ˆåµç”¨ï¼Œå¥½åƒè¿˜æ¯”è¾ƒéº»çƒ¦ã€‚è¿™ä¹Ÿæ˜¯æˆ‘ä»¥å‰çš„çœ‹æ³•ã€‚ä¸»è¦åŸå› å°±æ˜¯iterm2å·²ç»éå¸¸å®Œç¾äº†ã€‚iterm2çš„å¥½ç”¨ä¸€å®šç¨‹åº¦ä¸Šæ©ç›–äº†tmuxçš„å…‰è¾‰ã€‚å› ä¸ºiterm2æ˜¯å¼€ç®±å³ç”¨,tmuxä¸é…ç½®ä¸ä¸€å®šç”¨çš„èˆ’æœã€‚ç›´åˆ°æŸä¸€å¤©æˆ‘åœ¨youtubeä¸Šçœ‹åˆ°äº†2ä¸ªè§†é¢‘ï¼Œæˆ‘çŸ¥é“æˆ‘è¯¥æ”¹æ”¹äº†:)<br><img src="https://ficapy.b0.upaiyun.com/blogimg/gotbletu_tmux.png" alt="gotbletu_tmux"><br>æˆ‘ä¸ªäººä¹Ÿæ˜¯åˆšå…¥é—¨,ä¸‹é¢ä»‹ç»ä¸€äº›åŸºæœ¬çŸ¥è¯†ï¼Œå¸Œæœ›å¯¹è¯»è€…æœ‰æ‰€å¸®åŠ©.</p>
<a id="more"></a>
<h2 id="åŸºæœ¬æ¦‚å¿µ"><a href="#åŸºæœ¬æ¦‚å¿µ" class="headerlink" title="åŸºæœ¬æ¦‚å¿µ"></a>åŸºæœ¬æ¦‚å¿µ</h2><ul>
<li>tmuxåˆ†å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯ï¼Œè¿™ä¸ªdockerè¿™ç§æ˜¯å¾ˆç›¸ä¼¼çš„ï¼Œæˆ‘ä»¬æ“ä½œçš„åªæ˜¯é’ˆå¯¹å®¢æˆ·ç«¯ï¼ŒæœåŠ¡ç«¯ä»¥å®ˆæŠ¤è¿›ç¨‹è¿è¡Œï¼Œè¿™æ ·å®ç°äº†æˆ‘ä»¬é€€å‡ºåä¸‹æ¬¡å†è¿›å…¥ä¾æ—§ä¿æŒäº†è¿è¡ŒçŠ¶æ€</li>
<li>session:æ¯”å¦‚ä½ åœ¨å…¬å¸æœ‰ä¸ªå·¥ä½œç¯å¢ƒï¼Œåœ¨å®¶é‡Œåˆæ˜¯å¦å¤–ä¸€ä¸ªå·¥ä½œç¯å¢ƒã€‚è¿™2ä¸ªç¯å¢ƒå·®åˆ«éå¸¸å¤§ã€‚é‚£ä¹ˆå°±ä½¿ç”¨2ä¸ªä¸åŒçš„session</li>
<li>window:ä½ åœ¨å·¥ä½œç¯å¢ƒä¸­è¦æ‰“å¼€å¤šä¸ªè½¯ä»¶ï¼ŒèŠå¤©çš„ã€BTä¸‹è½½çš„ã€å¬æ­Œçš„etc</li>
<li>pane:ä¸€ä¸ªè½¯ä»¶è¦åˆ†æˆå¤šä¸ªåŒºåŸŸè¾“å‡º</li>
<li>å½“ç„¶ä¸€èˆ¬æ¥è¯´è¶Šå°‘æ˜¯è¶Šæ–¹ä¾¿åˆ‡æ¢çš„ã€‚å°±ä¸ªäººæ¥è¯´ä¸€ä¸ªsessionå°±å¤Ÿäº†,ä¸»è¦åˆ‡æ¢æ¥è‡ªäºwindowå’Œpane</li>
<li>tmuxä¸»è¦æ¥è¯´æœ€é‡è¦çš„å°±æ˜¯å¯¹å„ä¸ªçª—å£çš„åˆ‡æ¢æ’åˆ—ç®¡ç†ï¼Œå„ç§é”®ä½ç»‘å®šä¹Ÿæ˜¯ç”¨äºå¯¹çª—å£çš„åˆ‡æ¢</li>
</ul>
<h2 id="windows-paneåŸºæœ¬è®¾ç½®"><a href="#windows-paneåŸºæœ¬è®¾ç½®" class="headerlink" title="windows,paneåŸºæœ¬è®¾ç½®"></a>windows,paneåŸºæœ¬è®¾ç½®</h2><p>å’Œvimä¸€æ ·tmuxä¹Ÿæ˜¯ä½¿ç”¨ä¸€ä¸ªä¸»è¦çš„prefix keyï¼Œå…ˆè¾“å…¥prefix keyä¹‹åå†è¾“å…¥ç»‘å®šçš„å­—æ¯æ‰§è¡Œæ“ä½œ.ä¸‹é¢å°±å°†æˆ‘ä»å¤šä¸ªåœ°æ–¹copyæ¥çš„é…ç½®è§£é‡Šä¸€ç•ª-_-</p>
<p>è®¾ç½®æˆC-a,åŒæ—¶è§£ç»‘åŸæ¥çš„C-b,æœ€åçš„bind açš„ä½œç”¨å°±æ˜¯:C-aæœ¬æ¥æ˜¯å›åˆ°è¡Œé¦–çš„å¿«æ·é”®ï¼Œè¢«tmuxä½¿ç”¨ä¹‹åä½¿ç”¨æ­¤è®¾å®šå˜æˆäº†C-a-aåˆ°è¡Œé¦–</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">set -g prefix ^a</div><div class="line">unbind ^b</div><div class="line">bind a send-prefix</div></pre></td></tr></table></figure>
<p>ä¹‹åå°±æ˜¯å¯¹windowå’Œpaneçš„å¿«æ·é”®è®¾å®šï¼Œæœ¬äººä½¿ç”¨vimç›¸ä¼¼çš„å¿«æ·é”®è®¾å®šã€‚è¿™ä¸ªå¥½åƒæ²¡å•¥å¥½è¯´çš„ï¼Œæ¯”å¦‚hjklåœ¨paneä¸­ç§»åŠ¨,sã€våˆ†å±ï¼Œä½¿ç”¨&lt;ã€&gt;ã€+ã€_å¯¹paneè¿›è¡Œå¤§å°çš„æ”¹å˜ï¼Œä½¿ç”¨C-uã€C-dè¿›è¡Œäº¤æ¢ï¼Œä½¿ç”¨qã€C-qè¿›è¡Œå…³é—­paneå’Œwindowï¼Œä¸¾ä¸ªä¾‹å­</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">bind k selectp -U</div><div class="line">bind -r &lt; resize-pane -L 10</div><div class="line">bind ^u swapp -U</div><div class="line">bind q killp</div></pre></td></tr></table></figure>
<p>ä½¿ç”¨-r(recursion)å°±èƒ½å¤Ÿè¾“å…¥ä¸€æ¬¡&lt;ä¹‹åé©¬ä¸Šå¤šæ¬¡è¾“å…¥&lt;ã€&gt;æœ‰æ•ˆ,è¿™å¯¹äºè°ƒæ•´å¤§å°æ—¶æ˜¯éå¸¸æœ‰ç”¨çš„ã€‚ã€‚ã€‚,æ²¡æœ‰è¢«é‡å†™çš„é…ç½®åŸºæœ¬éƒ½æ˜¯éå¸¸å¥½è®°çš„å•è¯,cã€nã€wã€dè®°è¿™äº›éƒ½æ˜¯æ¯«ä¸è´¹åŠ›çš„</p>
<h2 id="é¼ æ ‡ã€å¤åˆ¶åŠæ¸…å±è®¾ç½®"><a href="#é¼ æ ‡ã€å¤åˆ¶åŠæ¸…å±è®¾ç½®" class="headerlink" title="é¼ æ ‡ã€å¤åˆ¶åŠæ¸…å±è®¾ç½®"></a>é¼ æ ‡ã€å¤åˆ¶åŠæ¸…å±è®¾ç½®</h2><p>å¦‚æœä½ ä¸è¿›è¡Œå…¶ä»–è®¾ç½®å¯èƒ½ç”¨å‡ ä¸‹åŠ¨ä¸€ä¸‹é¼ æ ‡ä¸Šä¸‹ç¿»ä¸€ä¸‹ï¼Œå°±ä¼šé«˜å‘¼WTFã€‚æ¯•ç«Ÿå®Œå…¨ä¸åŠ¨é¼ æ ‡çš„å¤§ç¥ä¸å¤šï¼Œæˆ‘è¿˜æ˜¯æ‰“å¼€é¼ æ ‡è®¾ç½®å§,è¿™æ ·ä¹Ÿèƒ½åŒæ—¶ä½¿ç”¨é¼ æ ‡è¿›è¡Œä¸Šä¸‹æ»‘åŠ¨äº†ï¼Œå…¶æ¬¡å¤åˆ¶ä¹Ÿå’Œä»¥å‰ä¸ä¸€æ ·äº†ï¼Œç‰¹åˆ«æ˜¯å¦‚æœä½ åˆ†äº†2ä¸ªç«–å‘çš„pane,è¿™æ ·å’Œä»¥å‰ä¸€æ ·ç”¨é¼ æ ‡å¤åˆ¶å°±å‡ºé—®é¢˜äº†ï¼Œå½“ç„¶ä½ å¯ä»¥ç”¨z(zoom)å…¨å±å½“å‰çš„paneï¼Œç„¶åç”¨é¼ æ ‡å¤åˆ¶ã€‚ç„¶è€Œä¸€ä¸ªvimå…šæ˜¯ä¸ä¼šè¿™æ ·åšçš„T_Tã€‚ä¸‹é¢æ˜¯è®¾ç½®</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">setw -g mouse on</div><div class="line">#set vi mode for copy mode</div><div class="line">setw -g mode-keys vi</div><div class="line"></div><div class="line"># more settings to make copy-mode more vim-like</div><div class="line">unbind [</div><div class="line">bind Escape copy-mode</div><div class="line">unbind p</div><div class="line">bind p paste-buffer</div><div class="line">bind -t vi-copy &apos;v&apos; begin-selection</div><div class="line">bind -t vi-copy &apos;y&apos; copy-selection</div><div class="line"></div><div class="line"># Buffers to/from Mac clipboard, yay tmux book from pragprog</div><div class="line">bind C-c run &quot;tmux save-buffer - | reattach-to-user-namespace pbcopy&quot;</div><div class="line">bind C-v run &quot;tmux set-buffer $(reattach-to-user-namespace pbpaste); tmux paste-buffer&quot;</div></pre></td></tr></table></figure>
<p>è¿™æ ·å¤åˆ¶å¥½åƒå˜å¾—å¤æ‚äº†ã€‚ã€‚ã€‚éœ€è¦å…ˆè¿›å…¥é€‰æ‹©æ¨¡å¼C-a-ESC-vé€‰æ‹©éœ€è¦å¤åˆ¶çš„å†…å®¹åå†æ‰§è¡Œyå¤åˆ¶åˆ°tmuxçš„ç¼“å†²åŒºï¼Œå¦å¤–åƒtmuxå’Œvimè¿™ç§çš„ç²˜è´´æ¿æ˜¯ç‹¬ç«‹çš„,å’Œosxç³»ç»Ÿçš„ç²˜è´´æ¿ä¸å…±é€š,å¦‚æœè¦å†å¤åˆ¶åˆ°ç³»ç»Ÿç²˜è´´æ¿ï¼Œæ­¤æ—¶å†ä½¿ç”¨C-a-C-c,å¥½åƒæ˜¯æ¯”è¾ƒå¤æ‚å•Šã€‚ã€‚ä½ å¯ä»¥æŒ‰ä½optionå†ç”¨é¼ æ ‡é€‰æ‹©ä¹Ÿæ˜¯ç›´æ¥å¤åˆ¶åˆ°ç³»ç»Ÿç²˜è´´æ¿ï¼Œè¦è®©vimå’Œtmuxå’Œç³»ç»Ÿç²˜è´´æ¿é€šç”¨ï¼Œä½ éœ€è¦<code>brew install reattach-to-user-namespace</code>å®‰è£…ã€‚å¦å¤–iterm2å…¶å®æ˜¯å¯ä»¥è®©ä»–ä»¬å…±ç”¨çš„ï¼Œä¸‹å›¾é€‰ä¸­Applications in terminal may access clipboardä¹Ÿèƒ½è¾¾åˆ°åŒæ ·çš„æ•ˆæœï¼Œä¸è¿‡ä¸‹é¢çš„å‚è€ƒæ–‡ç« æœ‰è¯´æœ‰ç¼ºç‚¹-_-æˆ‘å°±å¬äº†ä»–çš„äº†<br><img src="https://ficapy.b0.upaiyun.com/blogimg/iterm_access_clipboard.png" alt="iterm_access_clipboard"></p>
<p>å†å°±æ˜¯é…ç½®é‡è½½å’Œæ¸…å±</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">#bind -n C-l send-keys &apos;C-l&apos;</div><div class="line">bind -n C-k send-keys -R \; send-keys C-l \; clear-history</div><div class="line"># reload config (prefix r)</div><div class="line">bind r source ~/.tmux.conf \; display &quot;Configuration reloaded!&quot;</div></pre></td></tr></table></figure>
<p>å°±å¥½åƒcommand+kå®Œå…¨æ¸…å±ï¼Œtmuxä¹Ÿå¯ä»¥ï¼Œä¸è¿‡éœ€è¦é…ç½®(è¿™ä¸ªå®Œç¾æ¸…å±å‘½ä»¤æ‰¾äº†å¾ˆä¹…),-nè¡¨ç¤ºä¸éœ€è¦å…ˆæŒ‰prefix keyç›´æ¥ä½¿ç”¨C-kå°±è°ƒç”¨äº†ï¼Œå¦å¤–ä¸è¦å°†C-lè®¾ç½®ä¸ºæ¸…å±,ä¼šè®©TABè¡¥å…¨å¤±æ•ˆ</p>
<h2 id="çŠ¶æ€æ "><a href="#çŠ¶æ€æ " class="headerlink" title="çŠ¶æ€æ "></a>çŠ¶æ€æ </h2><p>é…ç½®ä¸€ä¸ªå¥½çœ‹çš„çŠ¶æ€æ å¥½åƒè¿˜æ˜¯æ¯”è¾ƒå›°éš¾çš„,æˆ‘æ¯”è¾ƒå·æ‡’å°±ç›´æ¥ä½¿ç”¨äº†<a href="https://github.com/erikw/tmux-powerline">tmux-powerline</a>å’Œ<a href="https://github.com/seebi/tmux-colors-solarized/blob/master/tmuxcolors-256.conf">tmux-colors-solarized</a>,ä¸‹é¢æ˜¯æ•ˆæœ<br><img src="https://ficapy.b0.upaiyun.com/blogimg/tmux_statusbar.png" alt="tmux_statusbar"><br>æ³¨æ„é…ç½®powerlineçš„æ—¶å€™å¯èƒ½éœ€è¦åœ¨~/.zshrcä¸­åŠ å…¥<code>PS1=&quot;$PS1&quot;&#39;$([ -n &quot;$TMUX&quot; ] &amp;&amp; tmux setenv TMUXPWD_$(tmux display -p &quot;#D&quot; | tr -d %) &quot;$PWD&quot;)&#39;</code>æœ‰çš„æ—¶å€™ä¿®æ”¹é…ç½®å¯èƒ½éœ€è¦tmux kill-serveråé‡æ–°è¿›å…¥æ‰èƒ½çœ‹åˆ°æ•ˆæœ</p>
<p>åœ¨çŠ¶ä½“æ çš„é…ç½®ä¼šçœ‹åˆ°è¿™ç§<code>set-option -g status-bg colour235</code>,colour235æ˜¯ä»€ä¹ˆé¬¼é¢œè‰²ã€‚çœŸæ˜¯ä¸å¥½çŒœå•Šï¼Œå¯ä»¥å•ç‹¬å¼€ä¸€ä¸ªpaneæ‰“å°è¾“å‡ºæ‰€æœ‰256ç§é¢œè‰²ï¼Œè‡ªå·±å¯¹æ¯”ä¿®æ”¹æˆå–œæ¬¢çš„é¢œè‰²</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">for i in &#123;0..255&#125; ; do</div><div class="line">    printf &quot;\x1b[38;5;$&#123;i&#125;mcolour$&#123;i&#125;\n&quot;</div><div class="line">done</div></pre></td></tr></table></figure>
<h2 id="å…¶ä»–"><a href="#å…¶ä»–" class="headerlink" title="å…¶ä»–"></a>å…¶ä»–</h2><p>æˆ‘ä»¬è®¾ç½®å¥½äº†ä¹‹åå¯èƒ½éœ€è¦åœ¨æ‰“å¼€itermä¹‹åå°±ç›´æ¥è¿›å…¥tmux,å¦åˆ™å²‚ä¸æ˜¯ç™½å¿™æ´»~(â‰§â–½â‰¦)/~å•¦å•¦å•¦ï¼Œå¾ˆç®€å•,åœ¨itermçš„è®¾ç½®é¡µprofilesâ†’Generalâ†’Send text at startä¸­å¡«å…¥<code>tmux attach -t init || tmux new -s init</code>,æ›´æœ‰ç”¨çš„æ˜¯åœ¨æˆ‘ä»¬è¿œç¨‹åˆ°vpsä¸Šçš„æ—¶å€™ç›´æ¥è¿›å…¥åˆ°tmux,è®¾ç½®ä¸€ä¸ªåˆ«åå¦‚ä¸‹<code>alias hg=&quot;ssh -t hg \&quot;bash -c &#39;tmux a -t init || tmux new -s init&#39;\&quot;&quot;</code>è¿™æ ·æˆ‘ä»¬æ‰§è¡Œhgçš„æ—¶å€™å°±æ–°å»ºä¸€ä¸ªsessionæˆ–è€…è¿æ¥åˆ°å·²æœ‰çš„session</p>
<p>å¦‚æœæˆ‘ä»¬æœ¬åœ°å¼€ä¸€ä¸ªtmuxï¼Œç„¶åè¿œç¨‹è¿æ¥vpsï¼Œvpså†è¿è¡Œtmuxï¼Œè¿™ä¼šé€ æˆåµŒå¥—ä½¿ç”¨ã€‚ç‰¹åˆ«æ˜¯å½“ä½ çš„prefix keyè¿˜æ˜¯ä¸€æ ·çš„æ—¶å€™ã€‚ã€‚ã€‚æ‚²å‚¬äº†ï¼Œä½ æ‰€è¾“å…¥çš„å¿«æ·é”®åªä¼šè¢«æœ¬åœ°çš„tmuxå¤„ç†è€Œä¸ä¼šè¢«è¿œç¨‹çš„tmuxå“åº”ï¼Œè¦å¤„ç†è¿™ä¸ªé—®é¢˜å¯ä»¥å°†2è€…çš„prefix keyè®¾ç½®æˆä¸ä¸€æ ·,æ¯”å¦‚ä¸€ä¸ªä¸ºaå¦å¤–ä¸€ä¸ªä¸ºsã€‚æˆ–è€…ä½¿ç”¨itermå•ç‹¬å¼€ä¸€ä¸ªçª—å£ï¼Œæˆ‘æ›´æ¨èåè€…,å› ä¸ºè®¾ç½®æˆä¸åŒçš„prefix keyè¾“å…¥å¿«äº†å¯èƒ½å°±è¾“å…¥æ··æ·†å•¦ã€‚</p>
<p>å¦å¤–,ä½¿ç”¨äº†tmuxæ˜¾è‘—å¢åŠ äº†iterm2çš„è€—ç”µé‡,ä¼°è®¡æ˜¯æˆ‘è®¾ç½®çš„é‚£ä¸ªçŠ¶æ€æ æ˜¾ç¤ºä¸Šä¼ ä¸‹è½½æµé‡å¯¼è‡´çš„ï¼Œæ¯å‡ ç§’åˆ·æ–°æ‰§è¡Œä¸€æ¬¡shellæˆ–è®¸æŒºè€—ç”µ.</p>
<p><a href="https://github.com/ficapy/dotfiles/blob/master/.tmux.conf">æˆ‘çš„tmuxé…ç½®</a></p>
<h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p><a href="https://danielmiessler.com/study/tmux/">A tmux Primer</a><br><a href="https://www.youtube.com/playlist?list=PL5BE1545D8486D66D">gotbletu youtube playlist</a><br><a href="https://evertpot.com/osx-tmux-vim-copy-paste-clipboard/">Making the clipboard work between iTerm2, tmux, vim and OS X.</a><br><a href="http://superuser.com/questions/285381/how-does-the-tmux-color-palette-work">How does the tmux color palette work?</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;è‡ªscreenä¹‹åtmuxæ—©å·²èº«åè¿œæ‰¬ï¼Œç„¶è€Œè¿™ä¸ªä¸œè¥¿å¯¹äºä¸€èˆ¬äººæ¥è¯´å¥½åƒå¹¶æ²¡æœ‰ä»€ä¹ˆåµç”¨ï¼Œå¥½åƒè¿˜æ¯”è¾ƒéº»çƒ¦ã€‚è¿™ä¹Ÿæ˜¯æˆ‘ä»¥å‰çš„çœ‹æ³•ã€‚ä¸»è¦åŸå› å°±æ˜¯iterm2å·²ç»éå¸¸å®Œç¾äº†ã€‚iterm2çš„å¥½ç”¨ä¸€å®šç¨‹åº¦ä¸Šæ©ç›–äº†tmuxçš„å…‰è¾‰ã€‚å› ä¸ºiterm2æ˜¯å¼€ç®±å³ç”¨,tmuxä¸é…ç½®ä¸ä¸€å®šç”¨çš„èˆ’æœã€‚ç›´åˆ°æŸä¸€å¤©æˆ‘åœ¨youtubeä¸Šçœ‹åˆ°äº†2ä¸ªè§†é¢‘ï¼Œæˆ‘çŸ¥é“æˆ‘è¯¥æ”¹æ”¹äº†:)&lt;br&gt;&lt;img src=&quot;https://ficapy.b0.upaiyun.com/blogimg/gotbletu_tmux.png&quot; alt=&quot;gotbletu_tmux&quot;&gt;&lt;br&gt;æˆ‘ä¸ªäººä¹Ÿæ˜¯åˆšå…¥é—¨,ä¸‹é¢ä»‹ç»ä¸€äº›åŸºæœ¬çŸ¥è¯†ï¼Œå¸Œæœ›å¯¹è¯»è€…æœ‰æ‰€å¸®åŠ©.&lt;/p&gt;
    
    </summary>
    
      <category term="linux" scheme="https://www.zoulei.net/categories/linux/"/>
    
    
  </entry>
  
  <entry>
    <title>fasdå’Œfzf</title>
    <link href="https://www.zoulei.net/2016/08/29/fasd&amp;fzf/"/>
    <id>https://www.zoulei.net/2016/08/29/fasd&amp;fzf/</id>
    <published>2016-08-29T13:55:24.000Z</published>
    <updated>2016-08-30T07:24:19.000Z</updated>
    
    <content type="html"><![CDATA[<p>æ¥2ä¸ªæ—¥å¸¸ä½¿ç”¨å‘½ä»¤è¡Œå·¥å…·ç©ä¸€ç©ï¼Œå‰ä¸€ä¸ªæ˜¯ç›®å½•å¿«é€Ÿè·³è½¬ï¼Œåä¸€ä¸ªæ˜¯ä½¿ç”¨cursesæ¨¡ç³ŠæŸ¥æ‰¾</p>
<a id="more"></a>
<h2 id="fasd"><a href="#fasd" class="headerlink" title="fasd"></a><a href="https://github.com/clvv/fasd">fasd</a></h2><p>ç›®å½•å¿«é€Ÿè·³è½¬å·¥å…·æŒºå¤šçš„autojump,z.æˆ‘æœ€å¼€å§‹ç”¨çš„æ˜¯zï¼Œç”¨é•¿äº†æ„Ÿè§‰å¥½åƒæœ‰bug,ç„¶åå°±æ¢fasd.<code>å¥½åƒ</code>æ„Ÿè§‰å¥½ç”¨é‚£ä¹ˆä¸€ç‚¹ç‚¹ã€‚è¿™ç§å·¥å…·åŸç†éƒ½å·®ä¸å¤šã€‚å¯¹ä½ çš„å†å²è¾“å…¥è¿›è¡Œç»Ÿè®¡ï¼Œæ”¾å…¥æ•°æ®åº“ã€‚ç„¶åæ ¹æ®ä½ è¾“å…¥çš„ç»“æœä»æ•°æ®åº“åŒ¹é…è¾¾åˆ°å¿«é€Ÿcdçš„ç»“æœã€‚å®‰è£…å¥½åç›´æ¥è¾“å…¥fasd,å°±å¯ä»¥çœ‹åˆ°å¾—åˆ†ä»¥åŠç›®å½•/æ–‡ä»¶ã€‚ä»å®ƒçš„åŸç†ä¹Ÿèƒ½å¯ä»¥çœ‹å‡ºæ¥ã€‚å®ƒåªèƒ½å¯¹æœ‰è®°å½•çš„å¿«é€Ÿåˆ‡æ¢(ä»ä½ å®‰è£…è¿™ä¸ªè½¯ä»¶å¼€å§‹è®°å½•)ã€‚å¯¹äºä¸€ä¸ªæ–°çš„ç›®å½•é¦–æ¬¡è®¿é—®è¿˜æ˜¯éœ€è¦ç”¨cdã€‚è¿™ä¸ªè½¯ä»¶ä¸ªå¸¸ç”¨çš„å‘½ä»¤ä¹Ÿå°±2ä¸ª<br>zå’Œvï¼Œåˆ†åˆ«ä»£è¡¨åˆ‡æ¢ç›®å½•å’Œä½¿ç”¨$EDITORæ‰“å¼€æ–‡ä»¶.æ‰€ä»¥:</p>
<ul>
<li>å½“ä½ éœ€è¦å¿«é€Ÿcdåˆ°ä»¥å‰æ‰“å¼€è¿‡çš„ç›®å½•ç”¨z,å½“ä½ é¦–æ¬¡æ‰“å¼€ä¸€ä¸ªç›®å½•ç”¨cd(æˆ–è€…æ‰“å¼€å½“å‰ç›®å½•)ï¼›</li>
<li>å½“ä½ éœ€è¦ç”¨vimæ‰“å¼€ä»¥å‰æ‰“å¼€çš„æ–‡ä»¶ç”¨v,é¦–æ¬¡æ‰“å¼€æˆ–ç¡®å®šç›®å½•vim</li>
<li>å®ƒçœŸçš„å¾ˆæ–¹ä¾¿äº†,æˆ‘çœ‹åˆ°æœ‰äº›äººæŠŠå®ƒå’Œfzfåˆèµ·æ¥ä¸€èµ·ç”¨ã€‚æˆ‘æƒ³äº†å¾ˆä¹…ï¼Œé™¤äº†è£…é€¼é™ä½æ•ˆç‡ã€‚æˆ‘æ²¡æƒ³åˆ°æœ‰ä»€ä¹ˆç”¨</li>
</ul>
<h2 id="fzf"><a href="#fzf" class="headerlink" title="fzf"></a><a href="https://github.com/junegunn/fzf">fzf</a></h2><p>è¿™æ¬¾è½¯ä»¶å¯¹äºæé«˜å‘½ä»¤è¡Œæ•ˆç‡ä¹Ÿæ˜¯å¾ˆç‰›é€¼,è€Œä¸”çœ‹githubä¸Šé¢çš„æäº¤è®°å½•ï¼Œä¾æ—§éå¸¸æ´»è·ƒ(å¯¹äºä¸€ä¸ªå°ç™½æ²¡ä»€ä¹ˆæ¯”é¡¹ç›®çš„æ´»è·ƒæ›´é‡è¦äº†ï¼Œå› ä¸ºå®ƒæ„å‘³ç€ä½ å¯èƒ½é‡åˆ°çš„å‘å‰äººéƒ½å¯èƒ½å·²ç»è¶Ÿè¿‡).è€Œä¸”è¿™ä¸ªé¡¹ç›®çš„ä½œè€…å¥½åƒéå¸¸è‡ªä¿¡,é¡¹ç›®è¯´æ˜é‡Œé¢å±…ç„¶åªåˆ—ä¸¾äº†ä¼˜ç‚¹ï¼Œä¸æ¯«æ²¡æœ‰ç¼ºç‚¹.</p>
<p>è¿™æ˜¯ä¸€æ¬¾å®‰è£…ä¸Šå»å°±èƒ½è®©ä½ çœ¼å‰ä¸€äº®çš„è½¯ä»¶ã€‚æ¯”å¦‚Ctrl+Rï¼Œå®Œç¾æ›¿æ¢äº†shellé»˜è®¤çš„å†å²è®°å½•åŠŸèƒ½,å½“è¾“å…¥æŒ‡ä»¤çš„æ—¶å€™ä½¿ç”¨ctrl+Tå°±èƒ½åˆ—å‡ºå½“å‰ç›®å½•ä¸‹æ‰€æœ‰çš„æ–‡ä»¶ã€‚å½“ç„¶è¿™åªæ˜¯åˆ—ä¸¾çš„2ä¸ªæœ€å¸¸ç”¨çš„åŠŸèƒ½,å®é™…ä¸Šï¼Œå®ƒçš„æ½œåŠ›è¿œä¸æ­¢è¿™ä¹ˆç‚¹ï¼Œå¦‚æœä½ ç”¨è¿‡osxä¸Šè¢«äººå¹æˆç¥çš„alfred,é‚£ä¹ˆfzfçš„æ¦‚å¿µå¯èƒ½å’Œå®ƒæœ‰ä¸€å®šçš„ç›¸ä¼¼æ€§(å–å¾—ä¸€äº›ç»“æœ,ç„¶åä½¿ç”¨åˆ—è¡¨æ’é™¤å‡ºæ¥),ä¸¾ä¸ªä¾‹å­,IDEä¸­æˆ‘ä»¬ç»å¸¸ä½¿ç”¨å…¨å±€æ›¿æ¢,ç”¨ä»¥ä¸‹å‘½ä»¤ä¹Ÿèƒ½æå®š<br><code>grep -rn &#39;python&#39;| fzf -m | awk -F &#39;:&#39; &#39;{print $1}&#39; | xargs -L 1 sed -i -e &#39;s/python/hello/g&#39;</code><br>æ•ˆæœå¦‚ä¸‹<img src="https://ficapy.b0.upaiyun.com/blogimg/fzf_grep_sed.gif" alt="fzf_grep_sed"><br>è§£é‡Šä¸€ä¸‹ï¼Œ</p>
<ol>
<li>ä½¿ç”¨grepé€’å½’åŒ¹é…å½“å‰ç›®å½•å«æœ‰pythonçš„æ–‡ä»¶,-rä¸ºé€’å½’ï¼Œ-nä¸ºæ˜¾ç¤ºè¡Œå·ã€‚</li>
<li>ä½¿ç”¨fzfæ˜¾ç¤ºå‡ºæ¥,-mä¸ºå¤šè¡Œæ¨¡å¼,ä½¿ç”¨tabä¸ºé€‰æ‹©æˆ–è€…å–æ¶ˆé€‰æ‹©ã€‚</li>
<li>ä½¿ç”¨awkå¯¹é€‰æ‹©çš„çš„ç»“æœè¿›è¡Œå¤„ç†,-Fä¸ºé€‰æ‹©åˆ†éš”ç¬¦ï¼Œç»“æœä¸ºå¤šä¸ªç›®å½•</li>
<li>ä½¿ç”¨xargså¯¹ç»“æœæ‰§è¡Œsedæ›¿æ¢,-Lä¸ºå¯¹æ¯ä¸€ä¸ªéç©ºè¡Œæ‰§è¡Œåç»­å‘½ä»¤(Call utility for every number non-empty lines read.  A line ending with a space continues to the next non-empty line)</li>
<li>å¦å¤–grepçš„æ•ˆç‡æ˜¯éå¸¸é«˜çš„,å¦‚æœä½ ç›´æ¥ç”¨sedè¿›è¡Œå…¨å±€æ›¿æ¢-_-æ–‡ä»¶ä¸€å¤šè¿˜æ˜¯å¾ˆèŠ±è´¹æ—¶é—´æ»´,æ¯”å¦‚è¿™ç§<code>sed -i -- &#39;s/foo/bar/g&#39; **/*(D.)</code></li>
</ol>
<h3 id="ç¼ºç‚¹"><a href="#ç¼ºç‚¹" class="headerlink" title="ç¼ºç‚¹"></a>ç¼ºç‚¹</h3><p>è™½ç„¶ä½œè€…æ²¡æœ‰åˆ—ä¸¾å‡ºæ¥,æˆ‘è¿˜æ˜¯å°±æˆ‘çš„ä¸ªäººæ„Ÿè§‰è¯´ä¸€ä¸‹</p>
<ol>
<li>è ¢åˆ°å®¶çš„åŒ¹é…æ•ˆæœ,ä½ å¾ˆéš¾ç†è§£å®ƒæ˜¯æ ¹æ®ä»€ä¹ˆç»™ä½ åŒ¹é…çš„,æ”¾ä¸€å¼ å›¾<img src="http://ficapy.b0.upaiyun.com/blogimg/fzf_match.png" alt="fzf_match">ï¼Œå°±è¿™åŒªå¤·æ‰€æ€çš„åŒ¹é…ï¼Œä½ ä¸å¾—ä¸ä½¿ç”¨^$!ç­‰é¢å¤–çš„è§„åˆ™æˆ–è€…å¤šè¾“å…¥ä¸€äº›å­—ç¬¦ç„¶åä¸Šä¸‹é”®é€‰æ‹©</li>
<li>çœ‹ç€ç‚«é…·,æœ‰æ—¶å€™æ²¡å¿…è¦é‚£ä¹ˆç‚«é…·ï¼Œæ¯”å¦‚ä½¿ç”¨zçš„æ—¶å€™tabå¦‚æœæœ‰å¤šä¸ªé€‰æ‹©ï¼Œè¿™ä¸ªæ—¶å€™å¦‚æœä½ ç”¨fzfæ›¿ä»£ï¼Œä»–ä¼šä½¿ç”¨curseså…¨å±è®©ä½ é€‰æ‹©,å…¶å®æ•´ä¸ªè¿‡ç¨‹å·²ç»å¤šè¾“å…¥äº†å¥½å¤šå­—ç¬¦.</li>
</ol>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>fasdå’Œfzfçš„å¾ˆå¥½ç”¨ï¼Œè€Œä¸”å®ƒä»¬éƒ½ä¸éœ€è¦ä»»ä½•é…ç½®éƒ½èƒ½è®©ä½ æ„Ÿåˆ°é«˜æ•ˆ!å¯¹äºfzfå¦‚æœä½ èŠ±æ—¶é—´é…ç½®æ˜¯æœ‰ç‰¹åˆ«å¤šç©æ³•çš„ï¼Œå¯ä»¥å‚ç…§å®˜ç½‘<a href="https://github.com/junegunn/fzf/wiki/examples">fzf_examples</a>å’Œ<a href="https://www.youtube.com/playlist?list=PLqv94xWU9zZ2fMsMMDF4PjtNHCeBFbggD">gotbletuçš„è§†é¢‘æ•™ç¨‹</a>ä½“éªŒå®ƒçš„å¼ºå¤§ã€‚å¦å¤–ï¼Œå¦‚æœä½ å–œæ¬¢è¿™2ä¸ªè½¯ä»¶ï¼Œé‚£ä¹ˆä½ ä¸€å®šä¼šå–œæ¬¢<a href="https://github.com/zsh-users/zsh-autosuggestions">zsh-autosuggestions</a>è¯•ä¸€è¯•å§~~</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;æ¥2ä¸ªæ—¥å¸¸ä½¿ç”¨å‘½ä»¤è¡Œå·¥å…·ç©ä¸€ç©ï¼Œå‰ä¸€ä¸ªæ˜¯ç›®å½•å¿«é€Ÿè·³è½¬ï¼Œåä¸€ä¸ªæ˜¯ä½¿ç”¨cursesæ¨¡ç³ŠæŸ¥æ‰¾&lt;/p&gt;
    
    </summary>
    
      <category term="linux" scheme="https://www.zoulei.net/categories/linux/"/>
    
    
  </entry>
  
  <entry>
    <title>ä½¿ç”¨shellä¿®æ”¹osxçš„CapsLockæ˜ å°„</title>
    <link href="https://www.zoulei.net/2016/08/29/use_shell_modifier_capslock_map_on_osx/"/>
    <id>https://www.zoulei.net/2016/08/29/use_shell_modifier_capslock_map_on_osx/</id>
    <published>2016-08-29T03:24:33.000Z</published>
    <updated>2016-08-29T03:49:10.000Z</updated>
    
    <content type="html"><![CDATA[<p>å¯¹äºå‘½ä»¤è¡Œçˆ±å¥½è€…,å¾ˆå¤šäººä¼šé€‰æ‹©å°†é»„é‡‘é”®ç›˜ä½ç½®CapsLockæ›¿æ¢æˆCtrl,æœ‰äº›äººé€‰æ‹©ä»…ä»…æ˜¯å’Œé»˜è®¤çš„Ctrlè¿›è¡Œæ›¿æ¢ï¼Œæœ‰äº›äººæ›´æç«¯ï¼Œç›¸å½“äºå»æ‰CapsLocké”®å¢åŠ ä¸€ä¸ªCtrlä½ç½®ã€‚æˆ‘é€‰æ‹©åè€…ã€‚æœ‰æ—¶å€™ä¼šæƒ³ã€‚å‡å¦‚éœ€è¦è¾“å…¥å¤§æ®µæ–‡å­—çš„æ—¶å€™ä¸€ç›´æŒ‰ä½Shiftå²‚ä¸æ˜¯è›‹ç–¼ã€‚æœç´¢äº†ä¸‹ï¼Œç½‘ä¸ŠçœŸæœ‰è¿™ä¸ªé—®é¢˜ã€‚è€Œä¸”æœ‰äººè¿˜ç»™å‡ºäº†ç­”æ¡ˆã€‚æˆ‘å°±è½¬å‘ä¸€ä¸‹å¥½äº†-_-</p>
<ul>
<li>é¦–å…ˆä½ è¦çŸ¥é“åœ¨ä½ çš„<code>system preferencesâ†’keyboardâ†’modifiers keys</code>æ˜¯å¯ä»¥ä¿®æ”¹CapsLockæ˜ å°„<br>åˆ°Ctrlçš„</li>
<li>å…¶æ¬¡ä½¿ç”¨applescriptå¯ä»¥ç¼–è¾‘è„šæœ¬å¯¹GUIç•Œé¢è¿›è¡Œæ“ä½œ(ç³»ç»Ÿè¿˜è‡ªå¸¦ä¸€ä¸ªScript Editor,ä¸å¾—ä¸åæ§½ä¸€ä¸‹,è„šæœ¬çœŸä¸ç¾è§‚)</li>
<li>è„šæœ¬ç¼–å†™åæ‰§è¡Œéœ€è¦åˆ°å®‰å…¨è®¾ç½®é‡Œé¢æ·»åŠ è®¸å¯æƒé™(<code>system preferencesâ†’security&amp;privacyâ†’accessibility</code>,ç”±äºæˆ‘ä½¿ç”¨çš„æ˜¯iTerm,å°†å®ƒåŠ å…¥å°±å¥½äº†)</li>
</ul>
<p>æœ€åå¥‰ä¸Šè„šæœ¬(æ·»åŠ è‡³~/.zshrc,!!!!ä»…å¯¹è‹±æ–‡ç³»ç»Ÿæœ‰æ•ˆ,ä¸­æ–‡ä¼°è®¡æ”¹ä¸€ä¸‹ä¹Ÿèƒ½ç”¨)<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line">caps () &#123;</div><div class="line">	osascript &gt; /dev/null &lt;&lt;EOF</div><div class="line">    tell application &quot;System Preferences&quot;</div><div class="line">        reveal anchor &quot;keyboardTab&quot; of pane &quot;com.apple.preference.keyboard&quot;</div><div class="line">    end tell</div><div class="line">    tell application &quot;System Events&quot; to tell window 1 of process &quot;System Preferences&quot;</div><div class="line">        click button 1 of tab group 1</div><div class="line">        tell sheet 1</div><div class="line">            tell pop up button 4</div><div class="line">                click</div><div class="line">                delay 0.1</div><div class="line">                if value is &quot;â‡ª Caps Lock&quot; then</div><div class="line">                    click menu item 2 of menu 1</div><div class="line">                    log &quot;Change Caps Lock&quot;</div><div class="line">                else</div><div class="line">                    click menu item 1 of menu 1</div><div class="line">                    log &quot;Restore Caps Lock&quot;</div><div class="line">                end if</div><div class="line">            end tell</div><div class="line">            click button &quot;OK&quot;</div><div class="line">        end tell</div><div class="line">    end tell</div><div class="line">    quit application &quot;System Preferences&quot;</div><div class="line">EOF</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p><a href="http://superuser.com/questions/495956/controlling-modifier-key-behavior-via-the-terminal-on-mac">Controlling modifier key behavior via the terminal on mac</a><br><a href="http://apple.stackexchange.com/questions/103621/run-applescript-from-bash-script">Run AppleScript from bash script</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;å¯¹äºå‘½ä»¤è¡Œçˆ±å¥½è€…,å¾ˆå¤šäººä¼šé€‰æ‹©å°†é»„é‡‘é”®ç›˜ä½ç½®CapsLockæ›¿æ¢æˆCtrl,æœ‰äº›äººé€‰æ‹©ä»…ä»…æ˜¯å’Œé»˜è®¤çš„Ctrlè¿›è¡Œæ›¿æ¢ï¼Œæœ‰äº›äººæ›´æç«¯ï¼Œç›¸å½“äºå»æ‰CapsLocké”®å¢åŠ ä¸€ä¸ªCtrlä½ç½®ã€‚æˆ‘é€‰æ‹©åè€…ã€‚æœ‰æ—¶å€™ä¼šæƒ³ã€‚å‡å¦‚éœ€è¦è¾“å…¥å¤§æ®µæ–‡å­—çš„æ—¶å€™ä¸€ç›´æŒ‰ä½Shiftå²‚ä¸æ˜¯è›‹ç–¼ã€‚æœç´¢äº†ä¸‹ï¼Œç½‘
    
    </summary>
    
      <category term="ä¼ªæŠ€æœ¯" scheme="https://www.zoulei.net/categories/%E4%BC%AA%E6%8A%80%E6%9C%AF/"/>
    
    
  </entry>
  
</feed>
