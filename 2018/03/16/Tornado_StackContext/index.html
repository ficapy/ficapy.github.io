
<!DOCTYPE html>
<html lang="zh-cn">
    
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="é‚¹é›·">
    <title>Tornado ä¹‹StackContext - é‚¹é›·</title>
    <meta name="author" content="ficapy">
    
    
    
        <link rel="alternate" type="application/atom+xml" title="RSS" href="/atom.xml">
    
    <meta name="description" content="yieldè¿™ä¸ªå…³é”®å­—åœ¨2001å¹´2.2ç‰ˆæœ¬çš„æ—¶å€™å°±å‡ºç°äº†ã€‚2006åŠ å…¥yield.sendåŠŸèƒ½ã€‚ç„¶è€Œç›´åˆ°2006å¹´2.5ç‰ˆæœ¬æ‰çœ‹åˆ°ä½¿ç”¨åœ¨contextmanagerä¸Šï¼Œtornado 2011å¹´æ‰ç”¨å®ƒå®ç°äº†ç¥å¥‡çš„gené€»è¾‘ã€‚ä»¤æˆ‘æ²¡æƒ³åˆ°çš„æ˜¯  yieldå‡ºç°çš„è¿™ä¹ˆæ—© yieldå‰å®³ä¸€ç‚¹çš„åº”ç”¨(contentmanager)å±…ç„¶è¿‡äº†äº”å¹´æ‰åŠ å…¥åˆ°æ ‡å‡†åº“ã€‚ tornadoçš„1.0.0ç‰ˆæ ¹æœ¬å’Œyieldæ²¡æœ‰">
<meta property="og:type" content="blog">
<meta property="og:title" content="Tornado ä¹‹StackContext">
<meta property="og:url" content="https://www.zoulei.net/2018/03/16/Tornado_StackContext/index.html">
<meta property="og:site_name" content="é‚¹é›·">
<meta property="og:description" content="yieldè¿™ä¸ªå…³é”®å­—åœ¨2001å¹´2.2ç‰ˆæœ¬çš„æ—¶å€™å°±å‡ºç°äº†ã€‚2006åŠ å…¥yield.sendåŠŸèƒ½ã€‚ç„¶è€Œç›´åˆ°2006å¹´2.5ç‰ˆæœ¬æ‰çœ‹åˆ°ä½¿ç”¨åœ¨contextmanagerä¸Šï¼Œtornado 2011å¹´æ‰ç”¨å®ƒå®ç°äº†ç¥å¥‡çš„gené€»è¾‘ã€‚ä»¤æˆ‘æ²¡æƒ³åˆ°çš„æ˜¯  yieldå‡ºç°çš„è¿™ä¹ˆæ—© yieldå‰å®³ä¸€ç‚¹çš„åº”ç”¨(contentmanager)å±…ç„¶è¿‡äº†äº”å¹´æ‰åŠ å…¥åˆ°æ ‡å‡†åº“ã€‚ tornadoçš„1.0.0ç‰ˆæ ¹æœ¬å’Œyieldæ²¡æœ‰">
<meta property="og:updated_time" content="2018-03-17T04:01:17.534Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Tornado ä¹‹StackContext">
<meta name="twitter:description" content="yieldè¿™ä¸ªå…³é”®å­—åœ¨2001å¹´2.2ç‰ˆæœ¬çš„æ—¶å€™å°±å‡ºç°äº†ã€‚2006åŠ å…¥yield.sendåŠŸèƒ½ã€‚ç„¶è€Œç›´åˆ°2006å¹´2.5ç‰ˆæœ¬æ‰çœ‹åˆ°ä½¿ç”¨åœ¨contextmanagerä¸Šï¼Œtornado 2011å¹´æ‰ç”¨å®ƒå®ç°äº†ç¥å¥‡çš„gené€»è¾‘ã€‚ä»¤æˆ‘æ²¡æƒ³åˆ°çš„æ˜¯  yieldå‡ºç°çš„è¿™ä¹ˆæ—© yieldå‰å®³ä¸€ç‚¹çš„åº”ç”¨(contentmanager)å±…ç„¶è¿‡äº†äº”å¹´æ‰åŠ å…¥åˆ°æ ‡å‡†åº“ã€‚ tornadoçš„1.0.0ç‰ˆæ ¹æœ¬å’Œyieldæ²¡æœ‰">
<meta name="twitter:creator" content="@aec4d">
    
    
        
    
    
        <meta property="og:image" content="https://ficapy.b0.upaiyun.com/blogimg/logo.jpg"/>
    
    
    
    
    <!--STYLES-->
    <link rel="stylesheet" href="/assets/css/style-yrst5vo1nxaxbp2g3v9na2wg1lixlpr3ghbjdvskeixmu79deycecx3rh4bt.min.css">
    <!--STYLES END-->
    
    
</head>

    <body>
        <div id="blog">
            <!-- Define author's picture -->


    
        
            
        
    

<header id="header" data-behavior="4">
    <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
    <div class="header-title">
        <a class="header-title-link" href="/ ">é‚¹é›·</a>
    </div>
    
        
            <a  class="header-right-picture "
                href="#about">
        
        
            <img class="header-picture" src="https://ficapy.b0.upaiyun.com/blogimg/logo.jpg" alt="ä½œè€…çš„å›¾ç‰‡"/>
        
        </a>
    
</header>

            <!-- Define author's picture -->



        
    

<nav id="sidebar" data-behavior="4">
    <div class="sidebar-container">
        
            <div class="sidebar-profile">
                <a href="/#about">
                    <img class="sidebar-profile-picture" src="https://ficapy.b0.upaiyun.com/blogimg/logo.jpg" alt="ä½œè€…çš„å›¾ç‰‡"/>
                </a>
                <h4 class="sidebar-profile-name">ficapy</h4>
                
                    <h5 class="sidebar-profile-bio"><p>author.bio</p>
</h5>
                
            </div>
        
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link "
                             href="/ "
                            
                        >
                    
                        <i class="sidebar-button-icon fa fa-lg fa-home"></i>
                        <span class="sidebar-button-desc">é¦–é¡µ</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link "
                             href="/all-categories"
                            
                        >
                    
                        <i class="sidebar-button-icon fa fa-lg fa-bookmark"></i>
                        <span class="sidebar-button-desc">åˆ†ç±»</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link "
                             href="/all-tags"
                            
                        >
                    
                        <i class="sidebar-button-icon fa fa-lg fa-tags"></i>
                        <span class="sidebar-button-desc">æ ‡ç­¾</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link "
                             href="/all-archives"
                            
                        >
                    
                        <i class="sidebar-button-icon fa fa-lg fa-archive"></i>
                        <span class="sidebar-button-desc">å½’æ¡£</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link open-algolia-search"
                             href="#search"
                            
                        >
                    
                        <i class="sidebar-button-icon fa fa-lg fa-search"></i>
                        <span class="sidebar-button-desc">æœç´¢</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link "
                             href="#about"
                            
                        >
                    
                        <i class="sidebar-button-icon fa fa-lg fa-question"></i>
                        <span class="sidebar-button-desc">å…³äº</span>
                    </a>
            </li>
            
        </ul>
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link " href="https://github.com/ficapy" target="_blank">
                    
                        <i class="sidebar-button-icon fa fa-lg fa-github"></i>
                        <span class="sidebar-button-desc">GitHub</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link " href="https://twitter.com/c4dae" target="_blank">
                    
                        <i class="sidebar-button-icon fa fa-lg fa-twitter"></i>
                        <span class="sidebar-button-desc">Twitter</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link " href="mailto:c4d@outlook.com" target="_blank">
                    
                        <i class="sidebar-button-icon fa fa-lg fa-envelope-o"></i>
                        <span class="sidebar-button-desc">é‚®ç®±</span>
                    </a>
            </li>
            
        </ul>
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link "
                             href="/atom.xml"
                            
                        >
                    
                        <i class="sidebar-button-icon fa fa-lg fa-rss"></i>
                        <span class="sidebar-button-desc">RSS</span>
                    </a>
            </li>
            
        </ul>
        
    </div>
</nav>

            
            <div id="main" data-behavior="4"
                 class="
                        hasCoverMetaIn
                        ">
                
<article class="post" itemscope itemType="http://schema.org/BlogPosting">
    
    
        <div class="post-header main-content-wrap text-left">
    
        <h1 class="post-title" itemprop="headline">
            Tornado ä¹‹StackContext
        </h1>
    
    <div class="post-meta">
    <time itemprop="datePublished" datetime="2018-03-16T16:14:25+08:00">
	
		    3æœˆ 16, 2018
    	
    </time>
    
        <span>å‘å¸ƒåœ¨ </span>
        
    <a class="category-link" href="/categories/Tornado/">Tornado</a>


    
</div>

</div>
    
    <div class="post-content markdown" itemprop="articleBody">
        <div class="main-content-wrap">
            <p>yieldè¿™ä¸ªå…³é”®å­—åœ¨2001å¹´2.2ç‰ˆæœ¬çš„æ—¶å€™å°±å‡ºç°äº†ã€‚2006åŠ å…¥yield.sendåŠŸèƒ½ã€‚ç„¶è€Œç›´åˆ°2006å¹´2.5ç‰ˆæœ¬æ‰çœ‹åˆ°ä½¿ç”¨åœ¨contextmanagerä¸Šï¼Œtornado 2011å¹´æ‰ç”¨å®ƒå®ç°äº†ç¥å¥‡çš„gené€»è¾‘ã€‚ä»¤æˆ‘æ²¡æƒ³åˆ°çš„æ˜¯</p>
<ol>
<li>yieldå‡ºç°çš„è¿™ä¹ˆæ—©</li>
<li>yieldå‰å®³ä¸€ç‚¹çš„åº”ç”¨(contentmanager)å±…ç„¶è¿‡äº†äº”å¹´æ‰åŠ å…¥åˆ°æ ‡å‡†åº“ã€‚</li>
<li>tornadoçš„1.0.0ç‰ˆæ ¹æœ¬å’Œyieldæ²¡æœ‰ä¸€æ¯›é’±å…³ç³»</li>
<li>tornadoæœ€å…ˆå¼•å…¥yieldå±…ç„¶å¹¶ä¸æ˜¯å®ç°äº†gen</li>
</ol>
<p>yieldæœ€å…ˆåœ¨tornadoé‡Œé¢å±•éœ²å¤´è§’æ˜¯åœ¨<span style="color:red"><strong><a href="https://github.com/tornadoweb/tornado/commit/721e25d0acc68d751073261bec150ac12a9f88ab">è¿™ä¸ªcommit</a></strong></span>é‡Œé¢ã€‚å¤§ç¥å°±æ˜¯å¤§ç¥ï¼Œè™½ç„¶è¿™ä¸ªä»£ç ä»…ä»…åªæœ‰å‡ åè¡Œã€‚å¯æ˜¯æˆ‘è§‰å¾—æ€è·¯å¾ˆæ–°å¥‡ï¼Œè†œæ‹œğŸ˜€(ä»£ç åŸºäºv1.0.0å’Œv1.1.0)</p>
<a id="more"></a>
<p>å»ºè®®æ‰“å¼€è¯¥commitï¼Œå…ˆçœ‹ä¸€çœ‹å®ƒåšäº†ä»€ä¹ˆäº‹æƒ…ã€‚é™¤å»æµ‹è¯•ç”¨ä¾‹ï¼Œå®ƒæ”¹åŠ¨çš„åœ°æ–¹å¯è°“éå¸¸å°‘äº†</p>
<h3 id="èµ·å› "><a href="#èµ·å› " class="headerlink" title="èµ·å› "></a>èµ·å› </h3><p>è§‚å¯Ÿä¸‹é¢çš„ä»£ç (å¯ä»¥å°†tornadoçš„æºç åœ¨1.0.0ç‰ˆæœ¬å’Œ1.1.0ç‰ˆæœ¬åˆ‡æ¢å‘ç°ä¸åŒï¼Œåœ¨1.0.0ç‰ˆæœ¬å®¢æˆ·ç«¯æ— æ³•å¾—åˆ°å“åº”ï¼Œ1.1.0ç‰ˆæœ¬å®¢æˆ·ç«¯å¾—åˆ°500é”™è¯¯)<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> tornado.ioloop</div><div class="line"><span class="keyword">import</span> tornado.web</div><div class="line"><span class="keyword">import</span> tornado.httpserver</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Index</span><span class="params">(tornado.web.RequestHandler)</span>:</span></div><div class="line"><span class="meta">    @tornado.web.asynchronous</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span><span class="params">(self)</span>:</span></div><div class="line">        tornado.ioloop.IOLoop.instance().add_callback(self.callback)</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">callback</span><span class="params">(self,*args)</span>:</span></div><div class="line">        <span class="keyword">raise</span> Exception(<span class="string">"Error"</span>)</div><div class="line"></div><div class="line">application = tornado.web.Application(handlers=[(<span class="string">'/'</span>, Index)])</div><div class="line">tornado.httpserver.HTTPServer(application).listen(<span class="number">8888</span>)</div><div class="line">tornado.ioloop.IOLoop.instance().start()</div></pre></td></tr></table></figure><br>è¿™æ˜¯ä¸€ä¸ªå¼‚æ­¥çš„httpå“åº”ã€‚åœ¨æ¥å—åˆ°è¯·æ±‚ä¹‹åæ‰§è¡Œgetå‡½æ•°ä½“ï¼Œæœ€ç»ˆå®ƒå°†self.callbackåŠ å…¥åˆ°IOLoopå¾ªç¯åˆ—è¡¨ï¼Œgetå‡½æ•°ç»“æŸã€‚å› ä¸ºå­˜åœ¨asynchronousè£…é¥°å™¨ï¼Œæ‰€ä»¥å¹¶æ²¡æœ‰ä¸»åŠ¨è°ƒç”¨self.finish()ã€‚å¾…IOLoopæ‰§è¡Œself.callbackå›è°ƒæ—¶ã€‚æ­¤æ—¶å¹¶å‡½æ•°å†…éƒ¨è§¦å‘äº†å¼‚å¸¸ã€‚<span style="color:red"><strong>ä½†æ˜¯è¿™ä¸ªå¼‚å¸¸å·²ç»å’Œgetå‡½æ•°æ²¡æœ‰ä»»ä½•å…³ç³»ï¼Œå› æ­¤getå‡½æ•°æ— æ³•æ•è·åˆ°è¿™ä¸ªå¼‚å¸¸</strong></span><br>å¯¹æ¯”ä¸€ä¸‹getå‡½æ•°ä½“è‡ªèº«è§¦å‘å¼‚å¸¸ã€‚ç”±web.RequestHandler._executeè°ƒç”¨getå‡½æ•°ã€‚æ­¤æ—¶å®ƒå°†æ•è·å¼‚å¸¸å¹¶è°ƒç”¨self._handle_request_exception.æœ€ç®€æµç¨‹å¦‚ä¸‹<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">_execute</span><span class="params">(self, transforms, *args, **kwargs)</span>:</span></div><div class="line">    self._transforms = transforms</div><div class="line">    <span class="keyword">try</span>:</div><div class="line">        getattr(self, self.request.method.lower())(*args, **kwargs)</div><div class="line">        <span class="keyword">if</span> self._auto_finish <span class="keyword">and</span> <span class="keyword">not</span> self._finished:</div><div class="line">            self.finish()</div><div class="line">    <span class="keyword">except</span> Exception, e:</div><div class="line">        self._handle_request_exception(e)</div></pre></td></tr></table></figure><br>self._handler_request_exceptionçš„æµç¨‹ä¹Ÿæ¯”è¾ƒç®€å•è¾“å‡ºå¼‚å¸¸è°ƒç”¨æ ˆã€‚è¿”å›å®¢æˆ·ç«¯500é”™è¯¯ï¼Œè¯¥httpæµç¨‹ç»“æŸ</p>
<p>å¯æ˜¯å¯¹äºä¸€ä¸ªå›è°ƒï¼Œå®ƒçš„å¼‚å¸¸ç”±IOLoopæ•è·ï¼Œç„¶è€Œå¯æ‚²çš„æ˜¯å®ƒæ•è·åˆ°å¼‚å¸¸å´å¹¶ä¸èƒ½ç¡®å®šæ˜¯è°æ·»åŠ åˆ°IOLoopé‡Œé¢çš„ï¼Œå¼‚å¸¸æ•è·ä¹‹åæ˜¯ä¸æ˜¯åªç”¨è¾“å‡ºè°ƒç”¨æ ˆå°±å¥½ã€‚æ‰€ä»¥éœ€æ±‚å‡ºæ¥äº†ï¼Œå¯¹äºå‡¡æ˜¯ç”±getæ“ä½œä¸‹é¢åŠ å…¥åˆ°IOLoopçš„å›è°ƒï¼Œæˆ‘ä»¬æœŸå¾…èƒ½å’Œgetçš„å¼‚å¸¸å¤„ç†é€»è¾‘ä¸€è‡´</p>
<h3 id="å†å²ä¸Šè¿™ä¸ªé—®é¢˜æ˜¯æ€ä¹ˆå¤„ç†çš„"><a href="#å†å²ä¸Šè¿™ä¸ªé—®é¢˜æ˜¯æ€ä¹ˆå¤„ç†çš„" class="headerlink" title="å†å²ä¸Šè¿™ä¸ªé—®é¢˜æ˜¯æ€ä¹ˆå¤„ç†çš„"></a>å†å²ä¸Šè¿™ä¸ªé—®é¢˜æ˜¯æ€ä¹ˆå¤„ç†çš„</h3><p>è¿™è‚¯å®šæ˜¯ä¸€ä¸ªéå¸¸å¸¸è§çš„é—®é¢˜ï¼Œå½“æ‰§è¡Œ<code>ioloop.IOLoop.instance().add_callback</code>ä¹‹åã€‚callbackå‡½æ•°è§¦å‘çš„å¼‚å¸¸æ·»åŠ å›è°ƒçš„å‡½æ•°æ— æ³•æ„ŸçŸ¥ã€‚æœ€å®¹æ˜“æƒ³åˆ°çš„æ–¹æ³•å°±æ˜¯æˆ‘ä»¬æŠŠcallbackæ•´ä½“åŠ ä¸Šå¼‚å¸¸æ•æ‰é€»è¾‘<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">callback</span><span class="params">(self,*args)</span>:</span></div><div class="line">        <span class="keyword">try</span>:</div><div class="line">                ...</div><div class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</div><div class="line">                self._handle_request_exception(e)</div></pre></td></tr></table></figure><br>ä½†æ˜¯è¿™ä¹ˆæ¶å¿ƒçš„æ–¹æ³•æ˜æ˜¾æ˜¯ä¸å¯å–çš„ã€‚æ„å‘³ç€æˆ‘ä»¬æ¯å†™ä¸€ä¸ªå›è°ƒé€»è¾‘éƒ½éœ€è¦åœ¨å¤–éƒ¨åŠ ä¸Štry..exceptã€‚åœ¨1.0.0ç‰ˆæœ¬æä¾›äº†ä¸€ä¸ªè£…é¥°å™¨å‡½æ•°æä¾›ç±»ä¼¼çš„åŠŸèƒ½async_callback,æ‰€ä»¥ä¸Šé¢çš„å†™æ³•åªéœ€è¦å°†<code>tornado.ioloop.IOLoop.instance().add_callback(self.callback)</code>å˜æ›´æˆ<code>tornado.ioloop.IOLoop.instance().add_callback(self.async_callback(self.callback))</code>å°±å¯ä»¥äº†ã€‚è™½ç„¶æ–¹æ³•å¾ˆä¸å¥½ï¼Œå¯æ˜¯ä¸´æ—¶è§£å†³äº†é—®é¢˜ï¼Œåœ¨1.1.0ç‰ˆæœ¬å°±å¼•å…¥äº†StackContexté€»è¾‘ï¼Œè§£å†³äº†è¿™ä¸ªé—®é¢˜</p>
<h3 id="é¢„å¤‡çŸ¥è¯†Yield"><a href="#é¢„å¤‡çŸ¥è¯†Yield" class="headerlink" title="é¢„å¤‡çŸ¥è¯†Yield"></a>é¢„å¤‡çŸ¥è¯†Yield</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">gen_fn</span><span class="params">()</span>:</span></div><div class="line">    result = <span class="keyword">yield</span> <span class="number">1</span></div><div class="line">    print(<span class="string">"result of yueld: "</span>+result)</div><div class="line">    result2 = <span class="keyword">yield</span>  <span class="number">2</span></div><div class="line">    print(<span class="string">"result of 2nd yield: "</span> + result2)</div><div class="line">    <span class="keyword">return</span> <span class="string">'we are done'</span></div><div class="line"></div><div class="line">caller = gen_fn()</div><div class="line">x = caller.send(<span class="keyword">None</span>)</div><div class="line">print(x)</div><div class="line">y = caller.send(<span class="string">'joe'</span>)</div><div class="line">print(y)</div><div class="line"><span class="keyword">try</span>:</div><div class="line">    caller.send(<span class="string">"bob"</span>)</div><div class="line"><span class="keyword">except</span> StopIteration:</div><div class="line">    print()</div></pre></td></tr></table></figure>
<ol>
<li>å¯¹äºä¸€ä¸ªç”Ÿæˆå™¨æ¥è¯´ï¼Œè°ƒç”¨å®ƒ(gen())å¹¶ä¸ä¼šç«‹å³è¢«æ‰§è¡Œã€‚åªæ˜¯ç”Ÿæˆäº†ä¸€ä¸ªç”Ÿæˆå™¨å¯¹è±¡</li>
<li>nex(g)ç­‰åŒäºg.send(None)ã€‚æ‰€ä»¥å¯¹äºç”Ÿæˆå™¨åªéœ€è¦æŒæ¡sendå‡½æ•°å°±å¯ä»¥äº†</li>
<li>send(value)è¿”å›çš„æ˜¯yieldå³è¾¹çš„å€¼ï¼ŒåŒæ—¶valueèµ‹å€¼ç»™yieldå·¦è¾¹çš„å¯¹è±¡ï¼Œ<span style="color:red"><strong>åƒä¸‡ä¸è¦è¢«ç¬¬ä¸€æ¬¡çš„send(None)è¯¯å¯¼ï¼Œè®¤ä¸ºç»è¿‡ç¬¬ä¸€æ¬¡send(None)åresultçš„å€¼ä¸ºNone</strong></span>,ä½ å¯ä»¥åœ¨å¿ƒç›®ä¸­å°†æ²¡ä¸€ä¸ªyieldåˆ’ä¸Šç«–çº¿ï¼Œè¿è¡Œåˆ°é‚£é‡Œå°±è¿”å›ï¼Œç„¶åä¸‹ä¸€æ¬¡sendçš„å€¼è¢«èµ‹å€¼ç»™yieldå·¦è¾¹</li>
<li>ä¸Šä¾‹ä¸­<code>we are done</code>æ²¡æœ‰è¢«æ‰“å°ï¼Œå› ä¸ºä¸æ–­çš„è¢«sendåç”Ÿæˆå™¨ä¼šè§¦å‘StopIterationå¼‚å¸¸ã€‚æœ€ç»ˆè¢«except StopIterationæ‰€æ•è·ã€‚å¯æ˜¯ä»–å¹¶æ²¡æœ‰å°†æ•è·çš„å€¼è¾“å‡ºï¼Œå› è€Œæ²¡æœ‰è¢«æ˜¾ç¤ºå¤„ç†ã€‚åŒæ—¶python2ä¸å…è®¸åœ¨ç”Ÿæˆå™¨æ‰§è¡Œreturnï¼Œæ‰€ä»¥åœ¨tornadoä¸­ç»å¸¸çœ‹åˆ°raise gen.Return(value)è¿™ç§å†™æ³•ï¼Œå®ƒå®è´¨å°±æ˜¯è§¦å‘StopIterationå¼‚å¸¸ï¼Œç„¶åè¢«exceptæ•è·åå¾—åˆ°å€¼ï¼Œå®Œæˆä¼ é€’è¿‡ç¨‹ï¼Œåˆ°äº†python3è¯­æ³•å°±ç›´æ¥å…è®¸æ‰§è¡Œreturnäº†</li>
</ol>
<h3 id="é¢„å¤‡çŸ¥è¯†-with"><a href="#é¢„å¤‡çŸ¥è¯†-with" class="headerlink" title="é¢„å¤‡çŸ¥è¯† with"></a>é¢„å¤‡çŸ¥è¯† with</h3><p>pythonæœ‰å¾ˆå¤šé­”æœ¯æ–¹æ³•(å¯ä»¥å‚è€ƒ<a href="https://pycoders-weekly-chinese.readthedocs.io/en/latest/issue6/a-guide-to-pythons-magic-methods.html">è¿™ç¯‡æ–‡ç« </a>)ã€‚å…¶ä¸­å¦‚æœä¸€ä¸ªç±»å­˜åœ¨<code>__enter__</code>å’Œ<code>__exit__</code>æ–¹æ³•ã€‚é‚£ä¹ˆå½“ä½¿ç”¨withè¯­å¥ä¹‹åã€‚ä¼šæ‰§è¡Œ<code>__enter__</code>åå¾—åˆ°å¯¹è±¡è¿”å›ç»™<code>with as</code>åé¢çš„å˜é‡ã€‚åœ¨é€€å‡ºçš„æ—¶å€™æ‰§è¡Œ<code>__exit__</code>æ–¹æ³•ï¼Œæœ€å¸¸è§çš„å°±æ˜¯æˆ‘ä»¬ä½¿ç”¨<code>with open() as f</code>å»æ‰“å¼€ä¸€ä¸ªæ–‡ä»¶äº†ï¼Œå¤„ç†å®Œæˆåè‡ªåŠ¨å…³é—­æ–‡ä»¶ï¼Œé¿å…äº†å†…å­˜æ³„æ¼ã€‚ä»”ç»†æƒ³ä¸€ä¸‹ï¼Œå…¶å®ç”¨è£…é¥°å™¨æ˜¯å¾ˆå®¹æ˜“å®ç°çš„ã€‚å¯æ˜¯withè¯­å¥è¿˜æœ‰ä»¥ä¸€ä¸ªå¾ˆå¤§çš„ä¼˜ç‚¹ï¼ŒPythonçš„ç¼–ç æ˜¯åŸºäºç¼©è¿›æ¥å†³å®šä»£ç å—çš„ï¼Œè£…é¥°å™¨æ˜¯ä½œç”¨åœ¨å‡½æ•°ä¸Šï¼Œè€Œwithæ˜¯å½“è·³å‡ºå®ƒçš„ç¼©è¿›åˆ™æ‰§è¡Œ<code>__exit__</code>(å¯èƒ½æè¿°çš„ä¸å¤ªå¥½)ï¼Œå¾ˆå¤šæƒ…å†µä¸‹withè¦æ¯”è£…é¥°å™¨çš„å†™æ³•ä¼˜ç¾å¾ˆå¤šã€‚</p>
<p>å°†withå’Œyieldè”åˆèµ·æ¥ä½¿ç”¨è¿˜çœŸçš„æ˜¯æŒºç¥å¥‡çš„ã€‚from contextlib import contextmanagerï¼Œè¯¥æ¨¡å—å°†withè¯­å¥åšåˆ°äº†è£…é¥°å™¨çš„æ•ˆæœã€‚æ¯”å¦‚è®¡ç®—ä¸€ä¸ªwithè¯­å¥ä¸‹é¢çš„æ‰§è¡Œæ—¶é—´<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> time</div><div class="line"><span class="keyword">from</span> contextlib <span class="keyword">import</span> contextmanager</div><div class="line"></div><div class="line"><span class="meta">@contextmanager</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">timeit</span><span class="params">()</span>:</span></div><div class="line">    start = time.time()</div><div class="line">    <span class="keyword">try</span>:</div><div class="line">        <span class="keyword">yield</span></div><div class="line">    <span class="keyword">finally</span>:</div><div class="line">        print(<span class="string">"elapsed time: &#123;&#125;"</span>.format(time.time() - start))</div><div class="line"></div><div class="line"><span class="keyword">with</span> timeit():</div><div class="line">    time.sleep(<span class="number">1</span>)</div></pre></td></tr></table></figure><br>ä½œä¸ºä¸æ˜ç™½å®ƒå®ç°çš„äººï¼Œä¹Ÿèƒ½å¤Ÿå¾ˆå®¹æ˜“çœ‹å‡ºæ¥ã€‚yieldå°†timeitåˆ’åˆ†ä¸ºäº†ä¸¤éƒ¨åˆ†ã€‚å‰é¢çš„ç›¸å½“äºæ‰§è¡Œ<code>__enter__</code>åŠ¨ä½œï¼Œåé¢çš„ç›¸å½“äºæ‰§è¡Œ<code>__exit__</code>åŠ¨ä½œã€‚</p>
<p>æƒ³è±¡ä¸€ä¸‹å®ƒçš„å†…éƒ¨contextmanagerè£…é¥°å™¨æ˜¯å¦‚ä½•å®ç°çš„ã€‚é¦–å…ˆè¢«è£…é¥°çš„å‡½æ•°timeitæ˜¯ä¸€ä¸ªç”Ÿæˆå™¨ã€‚å› æ­¤ï¼Œåœ¨æ‰§è¡Œ<code>__enter__</code>çš„æ—¶å€™åªéœ€è¦æ‰§è¡Œsend(None)æ“ä½œå°±èƒ½åˆ°è¾¾yieldçš„å³è¾¹å¹¶æš‚åœï¼Œå†<code>__exit__</code>çš„æ—¶å€™å†æ¬¡æ‰§è¡Œsend(None)ï¼Œæ­¤æ—¶æ‰§è¡Œåˆ°äº†finallyè¯­å¥å¹¶è§¦å‘StopIterationå¼‚å¸¸ï¼Œæµç¨‹ç»“æŸã€‚æ•´ä¸ªè¿‡ç¨‹å¯ä»¥è¿™æ ·è®¤ä¸º<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">contextmanager</span><span class="params">(func)</span>:</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">inner</span><span class="params">(*args, **kwargs)</span>:</span></div><div class="line">        g = func(*args,**kwargs)</div><div class="line">        <span class="class"><span class="keyword">class</span> <span class="title">w</span><span class="params">()</span>:</span></div><div class="line">            <span class="function"><span class="keyword">def</span> <span class="title">__enter__</span><span class="params">(self)</span>:</span></div><div class="line">                g.send(<span class="keyword">None</span>)</div><div class="line"></div><div class="line">            <span class="function"><span class="keyword">def</span> <span class="title">__exit__</span><span class="params">(self, exc_type, exc_val, exc_tb)</span>:</span></div><div class="line">                <span class="keyword">try</span>:</div><div class="line">                    g.send(<span class="keyword">None</span>)</div><div class="line">                <span class="keyword">except</span> Exception:</div><div class="line">                    print(<span class="string">"4"</span>)</div><div class="line">        <span class="keyword">return</span> w()</div><div class="line">    <span class="keyword">return</span> inner</div><div class="line"></div><div class="line"><span class="meta">@contextmanager</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">log</span><span class="params">()</span>:</span></div><div class="line">    <span class="keyword">try</span>:</div><div class="line">        print(<span class="string">"1"</span>)</div><div class="line">        <span class="keyword">yield</span></div><div class="line">        <span class="keyword">raise</span> Exception(<span class="string">"E"</span>)</div><div class="line">    <span class="keyword">finally</span>:</div><div class="line">        print(<span class="string">"3"</span>)</div><div class="line"></div><div class="line"><span class="keyword">with</span> log():</div><div class="line">    print(<span class="string">"2"</span>)</div></pre></td></tr></table></figure><br>æ˜¯å¦è¿˜æ˜¯æ„Ÿè§‰ç›¸å¯¹æ¯”è¾ƒç®€å•å‘¢</p>
<h3 id="StackContextçš„å®ç°"><a href="#StackContextçš„å®ç°" class="headerlink" title="StackContextçš„å®ç°"></a>StackContextçš„å®ç°</h3><p>åœ¨èµ·å› éƒ¨åˆ†ï¼Œè§£é‡Šäº†callbackä¸­ä¼šå­˜åœ¨çš„é—®é¢˜(æœŸå¾…RequestHandler.geté‡Œé¢æ‰€æœ‰ç›¸å…³å†…å®¹å‘ç”Ÿé”™è¯¯éƒ½ä¼šå¯¼è‡´è¿”å›500é”™è¯¯ç»™å®¢æˆ·ç«¯)ã€‚1.0ç‰ˆæœ¬çš„è§£å†³æ–¹æ¡ˆå°±æ˜¯ç»™æ¯ä¸ªå›è°ƒå‡½æ•°å¥—ä¸Šä¸€ä¸ªè£…é¥°å™¨ã€‚è§¦å‘é”™è¯¯çš„æ—¶å€™å°±å¯ä»¥è¿”å›500äº†ï¼Œæ„Ÿè§‰ä¸å¤ªå¥½è®²è¿°è¿™æ®µå¤©æ‰èˆ¬çš„ä»£ç äº†ğŸ˜•<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> contextlib</div><div class="line"></div><div class="line">_state = ()</div><div class="line"></div><div class="line"><span class="meta">@contextlib.contextmanager</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">StackContext</span><span class="params">(context_factory)</span>:</span></div><div class="line">    <span class="keyword">global</span> _state</div><div class="line">    old_contexts = _state</div><div class="line">    <span class="keyword">try</span>:</div><div class="line">        _state = old_contexts + (context_factory,)</div><div class="line">        <span class="keyword">with</span> context_factory():</div><div class="line">            <span class="keyword">yield</span></div><div class="line">    <span class="keyword">finally</span>:</div><div class="line">        _state = old_contexts</div><div class="line"></div><div class="line"><span class="meta">@contextlib.contextmanager</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">ErrorCapture</span><span class="params">()</span>:</span></div><div class="line">    <span class="keyword">try</span>:</div><div class="line">        <span class="keyword">yield</span></div><div class="line">    <span class="keyword">except</span> Exception:</div><div class="line">        <span class="keyword">pass</span></div><div class="line"></div><div class="line"><span class="keyword">with</span> StackContext(ErrorCapture):</div><div class="line">    print(_state)</div><div class="line">    <span class="keyword">raise</span> Exception(<span class="string">"Error"</span>)</div><div class="line">print(_state)</div></pre></td></tr></table></figure><br>è¿™ä¸ªåœ°æ–¹StackContextæ˜¯ä¸€ä¸ªå·¥å‚æ¨¡å¼ï¼Œå®ƒä¼ å…¥çš„å‚æ•°context_factoryä¹Ÿæ˜¯ä¸€ä¸ªè¢«contextlib.contextmanagerè£…é¥°çš„å¯¹è±¡ã€‚åœ¨StackContextçš„å†…éƒ¨å®ƒåˆæ‰§è¡Œäº†withè¯­å¥æ¥åˆå§‹åŒ–æˆ‘ä»¬çš„context_factoryï¼Œemmm.è¿™ä¸ªå…¶å®å’Œå¤šå±‚åµŒå¥—è£…é¥°å™¨å¹¶æ²¡æœ‰å¤ªå¤§çš„åŒºåˆ«ï¼Œå®ƒå®ç°äº†ä»€ä¹ˆæ•ˆæœå‘¢ï¼Œåœ¨è°ƒç”¨with StackContext(context_factory)çš„æ—¶å€™å°†context_factoryåŠ å…¥åˆ°è€çš„é‡Œé¢ã€‚<span style="color:red"><strong>æ³¨æ„ï¼Œå½“å‰çš„context_factoryå’Œ1.0.0ç‰ˆæœ¬é‡Œé¢çš„async_callbackæ•ˆæœæ˜¯ä¸€æ ·æ ·çš„ï¼Œåœ¨withçš„è¯­å¥å—ä¸‹é¢ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨_stateå˜é‡ã€‚å½“è·³å‡ºwithä¹‹å_stateå°±è¢«æ¢å¤åˆ°åŸæ¥çš„æ ·å­</strong></span>ã€‚</p>
<p>é‚£ä¹ˆæˆ‘ä»¬è¯¥å¦‚ä½•ä½¿ç”¨è¿™ä¸ª_stateå˜é‡å‘¢ï¼Œæ³¨æ„åˆ°withè¯­å¥è¿›å…¥çš„æ—¶å€™ä¼šåŠ å…¥context_factoryï¼Œé€€å‡ºçš„æ—¶å€™ä¼šæ¸…é™¤ã€‚è¿™æ„å‘³ç€åœ¨withä¸‹é¢çš„ä»£ç å—é‡Œé¢æˆ‘ä»¬å¯ä»¥å®‰å…¨çš„ä½¿ç”¨å®ƒ<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">wrap</span><span class="params">(fn)</span>:</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">wrapped</span><span class="params">(callback, contexts)</span>:</span></div><div class="line">        <span class="keyword">with</span> contextlib.nested(*[i() <span class="keyword">for</span> i <span class="keyword">in</span> contexts]):</div><div class="line">            callback()</div><div class="line">    contexts = _state</div><div class="line">    result = functools.partial(wrapped, fn, contexts)</div><div class="line">    <span class="keyword">return</span> result</div></pre></td></tr></table></figure><br>è¿™é‡Œï¼Œæˆ‘ä»¬æ·»åŠ ä¸€ä¸ªè£…é¥°å™¨ã€‚åœ¨IOLoopä¸­æ‰€æœ‰éœ€è¦æ·»åŠ å›è°ƒçš„åœ°æ–¹å‡ç”±wrapåŒ…è£…èµ·æ¥<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">     def add_callback(self, callback):</div><div class="line">         &quot;&quot;&quot;Calls the given callback on the next I/O loop iteration.&quot;&quot;&quot;</div><div class="line">-        self._callbacks.add(callback)</div><div class="line">+        self._callbacks.add(stack_context.wrap(callback))</div><div class="line">         self._wake()</div><div class="line">`</div></pre></td></tr></table></figure></p>
<p>é‚£ä¹ˆï¼Œåœ¨å®ƒè¢«è°ƒç”¨çš„æ—¶å€™å®é™…æ‰§è¡Œçš„æ˜¯wrappedå‡½æ•°ï¼Œå®ƒä¼šå…ˆè°ƒç”¨with contextlib.nested(*[i() for i in contexts]).æ­¤æ­¥éª¤æ¢å¤äº†with StackContextæ—¶æœŸåŠ å…¥çš„å¯¹è±¡(å³äººä»¬å¸¸è¯´çš„ä¸Šä¸‹æ–‡)ã€‚å¯¹äºå¼‚å¸¸æ•è·æ¥è¯´ï¼Œå°±æ˜¯èƒ½å¤Ÿæ­£ç¡®çš„æ•è·callbackçš„å¼‚å¸¸å¹¶ä¸”è¿”å›500ç»™å®¢æˆ·ç«¯ã€‚å¦å¤–ï¼Œæœ€å¼€å§‹çš„æ—¶å€™æ•è·RequestHandle.getçš„å¼‚å¸¸æ˜¯åœ¨_executeå¥—ä¸Štryâ€¦except,å°†ä»–å˜åŠ¨ä¸ºwith StackContextå°±å¥½äº†ã€‚è¿™é‡Œåº”è¯¥è°¨è®°ä¸‹é¢ä¸¤ç‚¹</p>
<ul>
<li>Tornadoçš„è¿è¡Œæ˜¯å•çº¿ç¨‹çš„,with StackContextè¿è¡Œçš„è¿‡ç¨‹ä¸­ä¸å¯èƒ½å­˜åœ¨åˆ«çš„æ­¥éª¤å¦å¤–å»æ”¹å˜äº†_stateçš„å€¼(è¿™ä¸ªå€¼å¾ˆé‡è¦)</li>
<li>StackContextæ˜¯å¯ä»¥è¿›è¡ŒåµŒå¥—çš„</li>
</ul>
<h3 id="æ”¹è¿›"><a href="#æ”¹è¿›" class="headerlink" title="æ”¹è¿›"></a>æ”¹è¿›</h3><p>å½“ç„¶ä»¥ä¸Šåªæ˜¯ä¸ºäº†è¡¨è¿°åŸç†è®²è§£çš„æœ€ç®€ä»£ç ï¼Œå®é™…ä¸Šæºç ä¸­ç•¥æœ‰ä¸åŒã€‚é¦–å…ˆè€ƒè™‘å¤šçº¿ç¨‹çš„æƒ…å†µï¼Œåœ¨å•çº¿ç¨‹ä¸­_stateçš„æ”¹åŠ¨æ˜¯å¾ˆæ˜¾ç„¶çš„ï¼Œæ‰§è¡Œ<code>with StackContext</code>å³å…è®¸æ”¹åŠ¨ã€‚åœ¨å¤šçº¿ç¨‹ä¸­å°±ä¸å¤ªä¸€æ ·äº†ã€‚å¤šçº¿ç¨‹ä¸­å¦‚æœä¹Ÿæ‰§è¡Œäº†<code>with StackContext</code>æ“ä½œï¼Œé‚£ä¹ˆæœ‰å¯èƒ½é€ æˆ_stateè¢«æ”¹åŠ¨ã€‚å› æ­¤ï¼Œ_stateè¢«ç»§æ‰¿è‡ªthread.localå¯¹è±¡ã€‚é‚£ä¹ˆä¸åŒçº¿ç¨‹å†…çš„ä¿®æ”¹æ˜¯äº’ç›¸ç‹¬ç«‹çš„<br>å…¶æ¬¡å¦‚æœä¸€ä¸ªå‡½æ•°å·²ç»è¢«wrappedåŒ…è£…ï¼Œé‚£ä¹ˆå°±ä¸å¿…è¦å†æ¬¡è¿›è¡ŒåŒ…è£…äº†(æƒ³è±¡ä¸€ä¸‹é€’å½’è°ƒç”¨add_callback)ã€‚å¯¹äºä¸å­˜åœ¨çš„<code>with StackContext</code>ä¹Ÿéœ€è¦è€ƒè™‘ï¼Œå¦‚æœæ‰§è¡Œcontextlib.nestedçš„å‚æ•°ä¸ºç©ºï¼Œæ— ç–‘æ˜¯ä¼šæŠ¥é”™çš„ã€‚<br>å…¶ä»–æœ‰çš„ç‹¬ç«‹çš„è¿è¡Œçš„æ¨¡å—ä¸å¸Œæœ›è¢«å·²å­˜åœ¨çš„_stateå½±å“ï¼Œå› æ­¤ç‹¬ç«‹è®¾ç½®äº†NullContext<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@contextlib.contextmanager</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">NullContext</span><span class="params">()</span>:</span></div><div class="line">    old_contexts = _state.contexts</div><div class="line">    <span class="keyword">try</span>:</div><div class="line">        _state.contexts = ()</div><div class="line">        <span class="keyword">yield</span></div><div class="line">    <span class="keyword">finally</span>:</div><div class="line">        _state.contexts = old_contexts</div></pre></td></tr></table></figure><br>å¦‚æœä¸å¸Œæœ›è¢«_stateå¹²æ‰°ï¼Œé‚£ä¹ˆåœ¨å‰é¢åŠ ä¸Š<code>with StackContext(NullContext)</code>ã€‚_stateå³è¢«ç½®ä¸ºç©ºã€‚æ˜¾ç„¶add_callbackä¼ å…¥çš„contextsä¸ºç©ºã€‚åœ¨å®ƒè¢«æ‰§è¡Œçš„æ—¶å€™ï¼Œä¹Ÿå’Œwithè¯­å¥æ²¡ä»€ä¹ˆäº‹æƒ…äº†</p>
<h3 id="åº”ç”¨"><a href="#åº”ç”¨" class="headerlink" title="åº”ç”¨"></a>åº”ç”¨</h3><p>æˆ‘æœ€å¼€å§‹çœ‹åˆ°çš„åº”ç”¨æ˜¯è¿™ä¸ª,<a href="https://gist.github.com/Hackforid/7130a5d59463186e217e">åœ¨Tornadoé‡Œé¢ä½¿ç”¨Sqlalchemy</a>ã€‚é»˜è®¤Sqlalchemyå­˜åœ¨sessionmakerä¸€ä¸ªå·¥å‚å‡½æ•°ï¼Œå®ƒä¼šç¡®å®šå¦‚ä½•ç”Ÿæˆä¸€ä¸ªsessionä¼šè¯å¯¹è±¡ä»¥ä¾›ä½¿ç”¨ã€‚é»˜è®¤çš„æƒ…å†µæ˜¯ä½¿ç”¨çº¿ç¨‹idï¼Œè¿™å¯¹äºå¤šçº¿ç¨‹ç¯å¢ƒéå¸¸éå¸¸æ–¹ä¾¿ã€‚å› ä¸ºå¤šçº¿ç¨‹webæ¡†æ¶ä¸­æ¯ä¸€ä¸ªHTTPè¯·æ±‚çš„å¤„ç†éƒ½æ˜¯åœ¨ç‹¬ç«‹çš„çº¿ç¨‹å†…è¿›è¡Œçš„ï¼Œé‚£ä¹ˆä¸€ä¸ªhttpå¤„ç†ç”Ÿå‘½å‘¨æœŸå¯¹åº”ä¸€ä¸ªsqlalchemyçš„sessionç”Ÿå‘½å‘¨æœŸéå¸¸å®Œç¾ã€‚<br>å¯æ˜¯åœ¨Tornadoè¿™ç§å•çº¿ç¨‹çš„æ¡†æ¶ä¸­å‘ç”Ÿäº†å˜åŒ–ï¼Œå› ä¸ºå®ƒä¸å¥½ç¡®å®šæ¯ä¸€ä¸ªhttpçš„ç”Ÿå‘½å‘¨æœŸæ ‡è¯†ã€‚StackContextç»™äº†æˆ‘ä»¬æ–¹æ³•ï¼Œè™½ç„¶èµ·å› æ˜¯callbackçš„å¼‚å¸¸å¤„ç†ï¼Œå¯æ˜¯æˆ‘ä»¬ä¸€æ ·å¯ä»¥å‚ç…§å®ƒçš„å¥—è·¯ï¼Œåœ¨_executeæ‰§è¡ŒæœŸé—´å†™å…¥å˜é‡ï¼Œåœ¨å•ä¸ªhttpç”Ÿå‘½å‘¨æœŸå‡å¯ä»¥è®¿é—®å˜é‡ï¼Œhttpå®Œç»“åæ¸…é™¤å®ƒã€‚ä»£ç å¯ä»¥å‚è€ƒç»™å‡ºçš„gisté“¾æ¥</p>
<h3 id="ç”¨ä¾‹"><a href="#ç”¨ä¾‹" class="headerlink" title="ç”¨ä¾‹"></a>ç”¨ä¾‹</h3><p>ä¸‹é¢ç»™ä¸€ä¸ªæ•´ç¯‡æ–‡ç« çš„ä»£ç æ€»ç»“<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">try</span>:</div><div class="line">    <span class="keyword">from</span> contextlib <span class="keyword">import</span> nested</div><div class="line"><span class="keyword">except</span> ImportError:</div><div class="line">    <span class="keyword">from</span> contextlib <span class="keyword">import</span> ExitStack, contextmanager</div><div class="line"></div><div class="line"><span class="meta">    @contextmanager</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">nested</span><span class="params">(*contexts)</span>:</span></div><div class="line">        <span class="keyword">with</span> ExitStack() <span class="keyword">as</span> stack:</div><div class="line">            <span class="keyword">for</span> ctx <span class="keyword">in</span> contexts:</div><div class="line">                stack.enter_context(ctx)</div><div class="line">            <span class="keyword">yield</span> contexts</div><div class="line"><span class="keyword">import</span> functools</div><div class="line"></div><div class="line"><span class="meta">@contextmanager</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">StackContext</span><span class="params">(context_factory)</span>:</span></div><div class="line">    <span class="keyword">global</span> _state</div><div class="line">    old_contexts = _state</div><div class="line">    <span class="keyword">try</span>:</div><div class="line">        _state = old_contexts + (context_factory,)</div><div class="line">        <span class="keyword">with</span> context_factory():</div><div class="line">            <span class="keyword">yield</span></div><div class="line">    <span class="keyword">finally</span>:</div><div class="line">        _state = old_contexts</div><div class="line"></div><div class="line"></div><div class="line"><span class="meta">@contextmanager</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">ErrorCapture</span><span class="params">()</span>:</span></div><div class="line">    <span class="keyword">try</span>:</div><div class="line">        <span class="keyword">yield</span></div><div class="line">    <span class="keyword">except</span> Exception:</div><div class="line">        <span class="keyword">pass</span></div><div class="line"></div><div class="line">_state = ()</div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">wrap</span><span class="params">(fn)</span>:</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">wrapped</span><span class="params">(callback, contexts)</span>:</span></div><div class="line">        <span class="keyword">with</span> nested(*[i() <span class="keyword">for</span> i <span class="keyword">in</span> contexts]):</div><div class="line">            callback()</div><div class="line"></div><div class="line">    contexts = _state</div><div class="line">    result = functools.partial(wrapped, fn, contexts)</div><div class="line">    <span class="keyword">return</span> result</div><div class="line"></div><div class="line"></div><div class="line">loop_list = []</div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">call_back</span><span class="params">()</span>:</span></div><div class="line">    print(<span class="string">"WTF"</span>)</div><div class="line">    print(get_current_request_id())</div><div class="line"></div><div class="line"></div><div class="line">g = &#123;&#125;</div><div class="line"></div><div class="line"><span class="meta">@contextmanager</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">ThreadRequestContext</span><span class="params">(**data)</span>:</span></div><div class="line">    <span class="keyword">global</span> g</div><div class="line">    <span class="keyword">try</span>:</div><div class="line">        g = data</div><div class="line">        <span class="keyword">yield</span></div><div class="line">    <span class="keyword">finally</span>:</div><div class="line">        g.clear()</div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_current_request_id</span><span class="params">()</span>:</span></div><div class="line">    <span class="keyword">return</span> g[<span class="string">'request_id'</span>]</div><div class="line"></div><div class="line"></div><div class="line">global_data = &#123;<span class="string">"request_id"</span>: <span class="number">12</span>&#125;</div><div class="line"><span class="keyword">with</span> StackContext(functools.partial(ThreadRequestContext, **global_data)):</div><div class="line">    <span class="keyword">with</span> StackContext(ErrorCapture):</div><div class="line">        loop_list.append(wrap(call_back))</div><div class="line">        print(get_current_request_id())</div><div class="line"></div><div class="line"><span class="keyword">for</span> i <span class="keyword">in</span> loop_list:</div><div class="line">    i()</div></pre></td></tr></table></figure></p>

            
        </div>
    </div>
    <div id="post-footer" class="post-footer main-content-wrap">
        
        <div class="post-actions-wrap">
    <nav>
        <ul class="post-actions post-action-nav">
            <li class="post-action">
                
                    <a class="post-action-btn btn btn--default tooltip--top" href="/2018/03/17/tornado_gen_engine/"  data-tooltip="Tornado ä¹‹gen.engine">
                
                    <i class="fa fa-angle-left"></i>
                    <span class="hide-xs hide-sm text-small icon-ml">ä¸Šä¸€ç¯‡</span>
                </a>
            </li>
            <li class="post-action">
                
                    <a class="post-action-btn btn btn--default tooltip--top" href="/2018/03/16/tornado_wsgi/" data-tooltip="Tornado ä¹‹WSGI">
                
                    <span class="hide-xs hide-sm text-small icon-mr">ä¸‹ä¸€ç¯‡</span>
                    <i class="fa fa-angle-right"></i>
                </a>
            </li>
        </ul>
    </nav>
    <ul class="post-actions post-action-share">
        <li class="post-action hide-lg hide-md hide-sm">
            <a class="post-action-btn btn btn--default btn-open-shareoptions"  href="#btn-open-shareoptions">
                <i class="fa fa-share-alt"></i>
            </a>
        </li>
        <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://plus.google.com/share?url=https://www.zoulei.net/2018/03/16/Tornado_StackContext/">
                <i class="fa fa-google-plus"></i>
            </a>
        </li>
        <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://www.zoulei.net/2018/03/16/Tornado_StackContext/">
                <i class="fa fa-facebook-official"></i>
            </a>
        </li>
        <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://twitter.com/intent/tweet?text=https://www.zoulei.net/2018/03/16/Tornado_StackContext/">
                <i class="fa fa-twitter"></i>
            </a>
        </li>
        
            <li class="post-action">
                <a class="post-action-btn btn btn--default" href="#disqus_thread">
                    <i class="fa fa-comment-o"></i>
                </a>
            </li>
        
        <li class="post-action">
            
                <a class="post-action-btn btn btn--default" href="#">
            
                <i class="fa fa-list"></i>
            </a>
        </li>
    </ul>
</div>


        
            
                <div id="disqus_thread">
    <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
            
        
    </div>
</article>



                <footer id="footer" class="main-content-wrap">
    <span class="copyrights">
        Copyrights &copy; 2018 ficapy. All Rights Reserved.
    </span>
</footer>

            </div>
            
                <div id="bottom-bar" class="post-bottom-bar" data-behavior="4">
                    <div class="post-actions-wrap">
    <nav>
        <ul class="post-actions post-action-nav">
            <li class="post-action">
                
                    <a class="post-action-btn btn btn--default tooltip--top" href="/2018/03/17/tornado_gen_engine/"  data-tooltip="Tornado ä¹‹gen.engine">
                
                    <i class="fa fa-angle-left"></i>
                    <span class="hide-xs hide-sm text-small icon-ml">ä¸Šä¸€ç¯‡</span>
                </a>
            </li>
            <li class="post-action">
                
                    <a class="post-action-btn btn btn--default tooltip--top" href="/2018/03/16/tornado_wsgi/" data-tooltip="Tornado ä¹‹WSGI">
                
                    <span class="hide-xs hide-sm text-small icon-mr">ä¸‹ä¸€ç¯‡</span>
                    <i class="fa fa-angle-right"></i>
                </a>
            </li>
        </ul>
    </nav>
    <ul class="post-actions post-action-share">
        <li class="post-action hide-lg hide-md hide-sm">
            <a class="post-action-btn btn btn--default btn-open-shareoptions"  href="#btn-open-shareoptions">
                <i class="fa fa-share-alt"></i>
            </a>
        </li>
        <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://plus.google.com/share?url=https://www.zoulei.net/2018/03/16/Tornado_StackContext/">
                <i class="fa fa-google-plus"></i>
            </a>
        </li>
        <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://www.zoulei.net/2018/03/16/Tornado_StackContext/">
                <i class="fa fa-facebook-official"></i>
            </a>
        </li>
        <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://twitter.com/intent/tweet?text=https://www.zoulei.net/2018/03/16/Tornado_StackContext/">
                <i class="fa fa-twitter"></i>
            </a>
        </li>
        
            <li class="post-action">
                <a class="post-action-btn btn btn--default" href="#disqus_thread">
                    <i class="fa fa-comment-o"></i>
                </a>
            </li>
        
        <li class="post-action">
            
                <a class="post-action-btn btn btn--default" href="#">
            
                <i class="fa fa-list"></i>
            </a>
        </li>
    </ul>
</div>


                </div>
                <div id="share-options-bar" class="share-options-bar" data-behavior="4">
    <ul class="share-options">
        <li class="share-option">
            <a class="share-option-btn" target="new" href="https://plus.google.com/share?url=https://www.zoulei.net/2018/03/16/Tornado_StackContext/">
                <i class="fa fa-google-plus"></i><span>åˆ†äº«åˆ° Google+</span>
            </a>
        </li>
        <li class="share-option">
            <a class="share-option-btn" target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://www.zoulei.net/2018/03/16/Tornado_StackContext/">
                <i class="fa fa-facebook-official"></i><span>åˆ†äº«åˆ° Facebook</span>
            </a>
        </li>
        <li class="share-option">
            <a class="share-option-btn" target="new" href="https://twitter.com/intent/tweet?text=https://www.zoulei.net/2018/03/16/Tornado_StackContext/">
                <i class="fa fa-twitter"></i><span>åˆ†äº«åˆ° Twitter</span>
            </a>
        </li>
    </ul>
</div>
<div id="share-options-mask" class="share-options-mask"></div>

            
        </div>
        


    
        
    

<div id="about">
    <div id="about-card">
        <div id="about-btn-close">
            <i class="fa fa-remove"></i>
        </div>
        
            <img id="about-card-picture" src="https://ficapy.b0.upaiyun.com/blogimg/logo.jpg" alt="ä½œè€…çš„å›¾ç‰‡"/>
        
            <h4 id="about-card-name">ficapy</h4>
        
            <div id="about-card-bio"><p>author.bio</p>
</div>
        
        
            <div id="about-card-job">
                <i class="fa fa-briefcase"></i>
                <br/>
                <p>author.job</p>

            </div>
        
        
            <div id="about-card-location">
                <i class="fa fa-map-marker"></i>
                <br/>
                å¹¿ä¸œæ·±åœ³
            </div>
        
    </div>
</div>

        <div id="algolia-search-modal" class="modal-container">
    <div class="modal">
        <div class="modal-header">
            <span class="close-button"><i class="fa fa-close"></i></span>
            <a href="https://algolia.com" target="_blank" class="searchby-algolia text-color-light link-unstyled">
                <span class="searchby-algolia-text text-color-light text-small">by</span>
                <img class="searchby-algolia-logo" src="https://www.algolia.com/static_assets/images/press/downloads/algolia-light.svg">
            </a>
            <i class="search-icon fa fa-search"></i>
            <form id="algolia-search-form">
                <input type="text" id="algolia-search-input" name="search"
                    class="form-control input--large search-input" placeholder="Search "
                    autofocus="autofocus"/>
            </form>
        </div>
        <div class="modal-body">
            <div class="no-result text-color-light text-center">æ²¡æœ‰æ‰¾åˆ°æ–‡ç« </div>
            <div class="results">
                
                <div class="media">
                    
                    <div class="media-body">
                        <a class="link-unstyled" href="https://www.zoulei.net/2013/09/29/hello_world/">
                            <h3 class="media-heading">åšå®¢èµ·èˆª</h3>
                        </a>
                        <span class="media-meta">
                            <span class="media-date text-small">
                                
                                    2013å¹´9æœˆ29æ—¥
                                
                            </span>
                        </span>
                        <div class="media-content hide-xs font-merryweather"><p>ä¸çŸ¥é“ä»æŸå¹´æŸæœˆèµ·ï¼Œæˆ‘æ¥è§¦äº†ç”µè„‘ï¼Œæ¥è§¦äº†ç½‘ç»œï¼Œæ·±æ·±çš„ä¸ºå®ƒç€è¿·~~~~~~</p>
<p>ï¼š</p>
<p>ä¸ºäº†å è¡Œæ­¤å¤„æ— è€»çš„æ è¿‡Nä¸ªå­—</p>
<p>:<br></div>
                    </div>
                    <div style="clear:both;"></div>
                    <hr>
                </div>
                
                <div class="media">
                    
                    <div class="media-body">
                        <a class="link-unstyled" href="https://www.zoulei.net/2013/09/30/idm-internet-download-manager/">
                            <h3 class="media-heading">IDM-Internet Download Manager</h3>
                        </a>
                        <span class="media-meta">
                            <span class="media-date text-small">
                                
                                    2013å¹´9æœˆ30æ—¥
                                
                            </span>
                        </span>
                        <div class="media-content hide-xs font-merryweather"><p>åˆ›å»ºä¸€ä¸ªæ–°ç›®å½•ï¼Œå–„ç”¨ä½³è½¯</p>
<p>åå­—æ²¡ä»€ä¹ˆæ–°æ„ï¼Œå› ä¸ºæœ‰ä¸ªæ¨èå¥½è½¯ä»¶çš„åå­—å°±æ˜¯å–„ç”¨ä½³è½¯:<a href="http://xbeta.info/">http://xbeta.info/</a>ï¼Œæˆ‘ä¹Ÿåœ¨ä¸Šé¢æ‰¾åˆ°è¿‡å‡ ä¸ªé€‚åˆè‡ªå·±çš„å¥½è½¯ä»¶ã€‚å¥½è½¯ä»¶ä½•å…¶å¤šï¼Œæ‰¾åˆ°é€‚åˆè‡ªå·±çš„å¹¶ä¸é‚£ä¹ˆå®¹æ˜“ï¼Œè£…äº†å¸ï¼Œå¸äº†è£…ï¼Œååå¤å¤ã€å¤§æµªæ·˜æ²™ï¼Œæœ€åç•™ä¸‹çš„æˆ‘è®¤ä¸ºå°±æ˜¯å¯¹è‡ªå·±å‹å¥½çš„ã€æœ‰ä»·å€¼çš„å¥½è½¯ä»¶ã€‚ä½œä¸ºä¸€ä¸ªåšå®¢ï¼Œæˆ‘ä¼šæ¨èæˆ‘è‡ªå·±ä¸€ç›´ç”¨çš„ï¼Œæ„Ÿè§‰å¾ˆä¸é”™çš„è½¯ä»¶åˆ†äº«ç»™å¤§å®¶ã€‚<br></div>
                    </div>
                    <div style="clear:both;"></div>
                    <hr>
                </div>
                
                <div class="media">
                    
                    <div class="media-body">
                        <a class="link-unstyled" href="https://www.zoulei.net/2013/10/02/everything_magical_file_search_software/">
                            <h3 class="media-heading">everything--æ–‡ä»¶æœç´¢ç¥å™¨</h3>
                        </a>
                        <span class="media-meta">
                            <span class="media-date text-small">
                                
                                    2013å¹´10æœˆ2æ—¥
                                
                            </span>
                        </span>
                        <div class="media-content hide-xs font-merryweather"><p><img src="https://ficapy.b0.upaiyun.com/blogimg/everything.jpg" alt="everything"></p>
<p>å®˜æ–¹ç½‘ç«™:<a href="http://www.voidtools.com/">www.voidtools.com</a></p>
<p>ç®—æ˜¯ä¸€æ¬¾ç‰›Båˆ°çˆ†ï¼Œå¦‚æœä½ æ˜¯å°ç™½ç¬¬ä¸€æ¬¡ç”¨ç±»ä¼¼çš„è½¯ä»¶ï¼Œç»å¯¹ä¼šäº§ç”Ÿä¸€ç§æƒ³è§æ¨æ™šçš„æ„Ÿè§‰ã€‚å¯¹æ¯”windowsè‡ªå¸¦çš„æœç´¢ï¼Œeverythingå‡ ç§’é’Ÿå®Œæˆç´¢å¼•ï¼Œç¬é—´æœç´¢å®Œæˆã€‚å†æ ¹æ®æ–‡ä»¶ä¿®æ”¹æ—¥æœŸæˆ–è€…è·¯å¾„å°±èƒ½ç¬é—´æ‰¾åˆ°æƒ³è¦çš„æ–‡ä»¶ã€‚æœ‰äººç”¨äº†è¿™ä¸ªè½¯ä»¶ä¹‹åæˆç§°å¹³æ—¶çƒ­è¡·æ–‡ä»¶ç®¡ç†çš„äººè‡ªä»ç”¨äº†å®ƒæ–‡ä»¶éƒ½æ˜¯éšå¤„ä¹±æ”¾ï¼Œåæ­£æ ¹æ®æ–‡ä»¶åé©¬ä¸Šå°±èƒ½æ‰¾åˆ°ã€‚å‘µå‘µï¼Œè™½ç„¶æ˜¯ä¸ªç¬‘è¯ï¼ˆä¸ªäººè®¤ä¸ºæœ‰æ¡ç†çš„æ•´ç†æ–‡ä»¶è¿˜æ˜¯å¾ˆæœ‰é“ç†çš„ï¼Œæ¯”å¦‚è¦è°ƒå‡ºæŸä¸ªæœˆå’ŒæŸä¸ªäººçš„æ‰€æœ‰æ–‡ä»¶å¾€æ¥ï¼Œéšä¾¿æ”¾ä½ å°±åªèƒ½å‘µå‘µäº†ï¼‰ï¼Œä½†æ˜¯å®ƒç»™æˆ‘ä»¬æœç´¢æ–‡æ¡£å¸¦æ¥çš„ä¾¿åˆ©æ€§å¯è§ä¸€æ–‘ã€‚åŠå…¬æ—å¿…å¤‡ï¼<br></div>
                    </div>
                    <div style="clear:both;"></div>
                    <hr>
                </div>
                
                <div class="media">
                    
                    <div class="media-body">
                        <a class="link-unstyled" href="https://www.zoulei.net/2013/10/06/everything_tutorial/">
                            <h3 class="media-heading">everythingè¿›é˜¶æ•™ç¨‹</h3>
                        </a>
                        <span class="media-meta">
                            <span class="media-date text-small">
                                
                                    2013å¹´10æœˆ6æ—¥
                                
                            </span>
                        </span>
                        <div class="media-content hide-xs font-merryweather"><p>ä½ æ˜¯å¦åªä¼šåœ¨everythingçš„æœç´¢æ é‡Œé¢è¾“å…¥å‡ ä¸ªå…³é”®å­—ï¼Œä¹‹åç‚¹å‡»æ–‡ä»¶å¤§å°æˆ–è€…æ›´æ–°æ—¶é—´æ’åˆ—è¿›è¡Œç­›é€‰æ‰¾åˆ°ç›®æ ‡ã€‚æˆ‘ä¸€å¼€å§‹ä¹Ÿæ˜¯è¿™æ ·è¿›è¡Œæ“ä½œçš„ï¼Œéœ€æ±‚ä¸é«˜çš„æ—¶å€™å€ŸåŠ©å®ƒçš„é«˜é€Ÿæœç´¢æ˜¯å®Œå…¨æ²¡é—®é¢˜çš„ã€‚<br></div>
                    </div>
                    <div style="clear:both;"></div>
                    <hr>
                </div>
                
                <div class="media">
                    
                    <div class="media-body">
                        <a class="link-unstyled" href="https://www.zoulei.net/2013/10/12/cputure_image_and_convert_software/">
                            <h3 class="media-heading">Snagit-æˆªå›¾å…¼å›¾ç‰‡è½¬æ¢è½¯ä»¶</h3>
                        </a>
                        <span class="media-meta">
                            <span class="media-date text-small">
                                
                                    2013å¹´10æœˆ12æ—¥
                                
                            </span>
                        </span>
                        <div class="media-content hide-xs font-merryweather"><p>å¥½å‡ å¤©æ²¡å†™æ–‡ç« äº†ï¼Œä¸æ˜¯å› ä¸ºä¸æƒ³å†™ï¼Œåªæ˜¯è¢«ä¸€äº›å°é—®é¢˜æŠ˜è…¾çš„å¤ªè›‹ç–¼äº†ï¼Œå…±äº«æ‰«æä»ªã€VBAã€wordpressæ’ç‰ˆã€å…±äº«Xå¢™äº‘äº‘ï¼Œä¸€ä¸€è§£å†³åæœ‰å…´è¶£æˆ‘ä¼šå‘ä¸Šæ¥~~~~</p>
<p>ä»Šå¤©ä»‹ç»çš„æ˜¯ä¸€æ¬¾æ®è¯´ä¸»æ‰“æˆªå›¾çš„è½¯ä»¶-snagit</p>
<p><img src="https://ficapy.b0.upaiyun.com/blogimg/snagit.png" alt="snagit"> å®˜æ–¹ç½‘ç«™ï¼š<a href="http://www.techsmith.com/">http://www.techsmith.com/</a></p>
<p>ä¸»ç•Œé¢å¯ä»¥çœ‹åˆ°åŠŸèƒ½å…¨éƒ¨å’Œæˆªå›¾ä¹‹åçš„å¤„ç†æœ‰å…³ï¼Œæ·»åŠ æ–‡å­—ã€æ·»åŠ å„ç§æ•ˆæœç­‰ç­‰ï¼Œç”¨å›¾å±‚ç®¡ç†ç”¨èµ·æ¥ä¸é”™ï¼Œè€Œä¸”ç›®æµ‹å¾ˆå¼ºè°ƒåˆ†äº«åŠŸèƒ½ï¼Œæˆªå›¾æ’å…¥åˆ°officeã€é‚®ä»¶ã€camtasia<br>studioç”šè‡³æ˜¯youtubeç­‰ç­‰ã€‚ä½¿ç”¨èµ·æ¥éå¸¸å®¹æ˜“ä¸Šæ‰‹ã€‚æ­¤åŠŸèƒ½ç•¥è¿‡~~~~</p></div>
                    </div>
                    <div style="clear:both;"></div>
                    <hr>
                </div>
                
                <div class="media">
                    
                    <div class="media-body">
                        <a class="link-unstyled" href="https://www.zoulei.net/2013/10/25/xnview_image_view/">
                            <h3 class="media-heading">xnview-å›¾ç‰‡æŸ¥çœ‹</h3>
                        </a>
                        <span class="media-meta">
                            <span class="media-date text-small">
                                
                                    2013å¹´10æœˆ25æ—¥
                                
                            </span>
                        </span>
                        <div class="media-content hide-xs font-merryweather"><p><img src="https://ficapy.b0.upaiyun.com/blogimg/xnview.jpg" alt="xnview"></p>
<p>å®˜ç½‘åœ°å€ï¼š<a href="http://www.xnview.com">http://www.xnview.com</a></p>
<p>XnViewç‚ºä¸€åœ–ç‰‡ç€è¦½ã€è½‰æ›ã€ç·¨è¼¯çš„å¤šå¹³å°è»Ÿé«”ï¼Œå¯æ”¹è®Šå…¶ä»‹é¢èªè¨€ï¼Œäº¦å¯æ˜“å…¶å·¥å…·æ æŒ‰éˆ•è‡³æŸä¸€ç¨‹åº¦ï¼Œæˆ–ä»¥æ›é¢æ¿æ–¹å¼æ˜“å·¥å…·åˆ—æŒ‰éˆ•ã€‚ä¸¦æ”¯æ´è®€å–è¶…é400ç¨®çš„åœ–æª”æ ¼å¼åŠéƒ¨ä»½éŸ³é¢‘æ–‡ä»¶æ ¼å¼åŠè§†é¢‘æ–‡ä»¶æ ¼å¼ï¼Œäº¦æ”¯æ´å¯«å…¥75ç¨®åœ–ç‰‡æ ¼å¼ã€‚æä¾›å…è²»çš„å€‹äººä½¿ç”¨åŠç°¡æ˜“æ“ä½œã€‚å¯å°‡å£“ç¸®æª”ä»¥è³‡æ–™å¤¾æ–¹å¼é–‹å•Ÿã€ä¾EXIFåŠIPTCä½œåœ–ç‰‡æœå°‹ã€åœ–ç‰‡ç›¸ä¼¼æ¯”å°ã€å°åœ–ç‰‡ä½œæ‰¹æ¬¡å‘½åã€æ ¼å¼è½‰æ›åŠå¥—ç”¨å½±åƒèª¿æ•´ï¼Œä¸¦æ”¯æ´ç„¡æè€—æ—‹è½‰ã€‚é¡ä¼¼åŠŸèƒ½ä¹‹è»Ÿé«”æœ‰ACDSeeã€‚â€”â€“æ‘˜è‡ª<a href="http://zh.wikipedia.org/wiki/XnView">ç»´åŸºç™¾ç§‘</a><br></div>
                    </div>
                    <div style="clear:both;"></div>
                    <hr>
                </div>
                
            </div>
        </div>
        <div class="modal-footer">
            <p class="results-count text-medium"
                data-message-zero="æ²¡æœ‰æ‰¾åˆ°æ–‡ç« "
                data-message-one="æ‰¾åˆ° 1 ç¯‡æ–‡ç« "
                data-message-other="æ‰¾åˆ° {n} ç¯‡æ–‡ç« ">
                æ‰¾åˆ° 85 ç¯‡æ–‡ç« 
            </p>
        </div>
    </div>
</div>
        
<div id="cover" style="background-image:url('/assets/images/cover.jpg');"></div>
        <!--SCRIPTS-->
<script src="/assets/js/script-rt08quwts7iav5x0cfd2ym0gb5qkd1lvrsmwrakxtkhefmaaes4ywkmnjnwf.min.js"></script>
<!--SCRIPTS END-->

    
        <script>
             var disqus_config = function () {
                 this.page.url = 'https://www.zoulei.net/2018/03/16/Tornado_StackContext/';
                 
                    this.page.identifier = '2018/03/16/Tornado_StackContext/';
                 
             };
            (function() {
                var d = document, s = d.createElement('script');
                var disqus_shortname = 'ficapy';
                s.src = '//' + disqus_shortname + '.disqus.com/embed.js';

                s.setAttribute('data-timestamp', +new Date());
                (d.head || d.body).appendChild(s);
            })();
        </script>
    



    <script src="https://ficapy.b0.upaiyun.com/blogimg/moment-with-locales.min.js"></script>
    <script src="https://ficapy.b0.upaiyun.com/blogimg/algoliasearch.min.js"></script>
    <script>
        var algoliaClient = algoliasearch('CREC5R0ZWC', '64a7e5eda349fbe7f5a8987e8a7c834e');
        var algoliaIndex = algoliaClient.initIndex('my-hexo-blog');
    </script>


    </body>
</html>
