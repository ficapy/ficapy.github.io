
<!DOCTYPE html>
<html lang="zh-cn">
    
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="é‚¹é›·">
    <title>Tornado ä¹‹StackContext - é‚¹é›·</title>
    <meta name="author" content="ficapy">
    
    
    
    <script type="application/ld+json">{"@context":"http://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"ficapy","sameAs":["https://github.com/ficapy","mailto:afexcg@gmail.com"],"image":"https://www.gravatar.com/avatar/be6268177c26b987066b089d191aea66"},"articleBody":"yieldè¿™ä¸ªå…³é”®å­—åœ¨2001å¹´2.2ç‰ˆæœ¬çš„æ—¶å€™å°±å‡ºç°äº†ã€‚2006åŠ å…¥yield.sendåŠŸèƒ½ã€‚ç„¶è€Œç›´åˆ°2006å¹´2.5ç‰ˆæœ¬æ‰çœ‹åˆ°ä½¿ç”¨åœ¨contextmanagerä¸Šï¼Œtornado 2011å¹´æ‰ç”¨å®ƒå®ç°äº†ç¥å¥‡çš„gené€»è¾‘ã€‚ä»¤æˆ‘æ²¡æƒ³åˆ°çš„æ˜¯\n\n yieldå‡ºç°çš„è¿™ä¹ˆæ—©\n yieldå‰å®³ä¸€ç‚¹çš„åº”ç”¨(contentmanager)å±…ç„¶è¿‡äº†äº”å¹´æ‰åŠ å…¥åˆ°æ ‡å‡†åº“ã€‚\n tornadoçš„1.0.0ç‰ˆæ ¹æœ¬å’Œyieldæ²¡æœ‰ä¸€æ¯›é’±å…³ç³»\n tornadoæœ€å…ˆå¼•å…¥yieldå±…ç„¶å¹¶ä¸æ˜¯å®ç°äº†gen\n\nyieldæœ€å…ˆåœ¨tornadoé‡Œé¢å±•éœ²å¤´è§’æ˜¯åœ¨è¿™ä¸ªcommité‡Œé¢ã€‚å¤§ç¥å°±æ˜¯å¤§ç¥ï¼Œè™½ç„¶è¿™ä¸ªä»£ç ä»…ä»…åªæœ‰å‡ åè¡Œã€‚å¯æ˜¯æˆ‘è§‰å¾—æ€è·¯å¾ˆæ–°å¥‡ï¼Œè†œæ‹œğŸ˜€(ä»£ç åŸºäºv1.0.0å’Œv1.1.0)\n\n\nå»ºè®®æ‰“å¼€è¯¥commitï¼Œå…ˆçœ‹ä¸€çœ‹å®ƒåšäº†ä»€ä¹ˆäº‹æƒ…ã€‚é™¤å»æµ‹è¯•ç”¨ä¾‹ï¼Œå®ƒæ”¹åŠ¨çš„åœ°æ–¹å¯è°“éå¸¸å°‘äº†\nèµ·å› è§‚å¯Ÿä¸‹é¢çš„ä»£ç (å¯ä»¥å°†tornadoçš„æºç åœ¨1.0.0ç‰ˆæœ¬å’Œ1.1.0ç‰ˆæœ¬åˆ‡æ¢å‘ç°ä¸åŒï¼Œåœ¨1.0.0ç‰ˆæœ¬å®¢æˆ·ç«¯æ— æ³•å¾—åˆ°å“åº”ï¼Œ1.1.0ç‰ˆæœ¬å®¢æˆ·ç«¯å¾—åˆ°500é”™è¯¯)\n123456789101112131415import tornado.ioloopimport tornado.webimport tornado.httpserverclass Index(tornado.web.RequestHandler):    @tornado.web.asynchronous    def get(self):        tornado.ioloop.IOLoop.instance().add_callback(self.callback)    def callback(self,*args):        raise Exception(&quot;Error&quot;)application = tornado.web.Application(handlers=[(&#x27;/&#x27;, Index)])tornado.httpserver.HTTPServer(application).listen(8888)tornado.ioloop.IOLoop.instance().start()\nè¿™æ˜¯ä¸€ä¸ªå¼‚æ­¥çš„httpå“åº”ã€‚åœ¨æ¥å—åˆ°è¯·æ±‚ä¹‹åæ‰§è¡Œgetå‡½æ•°ä½“ï¼Œæœ€ç»ˆå®ƒå°†self.callbackåŠ å…¥åˆ°IOLoopå¾ªç¯åˆ—è¡¨ï¼Œgetå‡½æ•°ç»“æŸã€‚å› ä¸ºå­˜åœ¨asynchronousè£…é¥°å™¨ï¼Œæ‰€ä»¥å¹¶æ²¡æœ‰ä¸»åŠ¨è°ƒç”¨self.finish()ã€‚å¾…IOLoopæ‰§è¡Œself.callbackå›è°ƒæ—¶ã€‚æ­¤æ—¶å¹¶å‡½æ•°å†…éƒ¨è§¦å‘äº†å¼‚å¸¸ã€‚ä½†æ˜¯è¿™ä¸ªå¼‚å¸¸å·²ç»å’Œgetå‡½æ•°æ²¡æœ‰ä»»ä½•å…³ç³»ï¼Œå› æ­¤getå‡½æ•°æ— æ³•æ•è·åˆ°è¿™ä¸ªå¼‚å¸¸å¯¹æ¯”ä¸€ä¸‹getå‡½æ•°ä½“è‡ªèº«è§¦å‘å¼‚å¸¸ã€‚ç”±web.RequestHandler._executeè°ƒç”¨getå‡½æ•°ã€‚æ­¤æ—¶å®ƒå°†æ•è·å¼‚å¸¸å¹¶è°ƒç”¨self._handle_request_exception.æœ€ç®€æµç¨‹å¦‚ä¸‹\n12345678def _execute(self, transforms, *args, **kwargs):    self._transforms = transforms    try:        getattr(self, self.request.method.lower())(*args, **kwargs)        if self._auto_finish and not self._finished:            self.finish()    except Exception, e:        self._handle_request_exception(e)\nself._handler_request_exceptionçš„æµç¨‹ä¹Ÿæ¯”è¾ƒç®€å•è¾“å‡ºå¼‚å¸¸è°ƒç”¨æ ˆã€‚è¿”å›å®¢æˆ·ç«¯500é”™è¯¯ï¼Œè¯¥httpæµç¨‹ç»“æŸ\nå¯æ˜¯å¯¹äºä¸€ä¸ªå›è°ƒï¼Œå®ƒçš„å¼‚å¸¸ç”±IOLoopæ•è·ï¼Œç„¶è€Œå¯æ‚²çš„æ˜¯å®ƒæ•è·åˆ°å¼‚å¸¸å´å¹¶ä¸èƒ½ç¡®å®šæ˜¯è°æ·»åŠ åˆ°IOLoopé‡Œé¢çš„ï¼Œå¼‚å¸¸æ•è·ä¹‹åæ˜¯ä¸æ˜¯åªç”¨è¾“å‡ºè°ƒç”¨æ ˆå°±å¥½ã€‚æ‰€ä»¥éœ€æ±‚å‡ºæ¥äº†ï¼Œå¯¹äºå‡¡æ˜¯ç”±getæ“ä½œä¸‹é¢åŠ å…¥åˆ°IOLoopçš„å›è°ƒï¼Œæˆ‘ä»¬æœŸå¾…èƒ½å’Œgetçš„å¼‚å¸¸å¤„ç†é€»è¾‘ä¸€è‡´\nå†å²ä¸Šè¿™ä¸ªé—®é¢˜æ˜¯æ€ä¹ˆå¤„ç†çš„è¿™è‚¯å®šæ˜¯ä¸€ä¸ªéå¸¸å¸¸è§çš„é—®é¢˜ï¼Œå½“æ‰§è¡Œioloop.IOLoop.instance().add_callbackä¹‹åã€‚callbackå‡½æ•°è§¦å‘çš„å¼‚å¸¸æ·»åŠ å›è°ƒçš„å‡½æ•°æ— æ³•æ„ŸçŸ¥ã€‚æœ€å®¹æ˜“æƒ³åˆ°çš„æ–¹æ³•å°±æ˜¯æˆ‘ä»¬æŠŠcallbackæ•´ä½“åŠ ä¸Šå¼‚å¸¸æ•æ‰é€»è¾‘\n12345def callback(self,*args):        try:                ...        except Exception as e:                self._handle_request_exception(e)\nä½†æ˜¯è¿™ä¹ˆæ¶å¿ƒçš„æ–¹æ³•æ˜æ˜¾æ˜¯ä¸å¯å–çš„ã€‚æ„å‘³ç€æˆ‘ä»¬æ¯å†™ä¸€ä¸ªå›è°ƒé€»è¾‘éƒ½éœ€è¦åœ¨å¤–éƒ¨åŠ ä¸Štry..exceptã€‚åœ¨1.0.0ç‰ˆæœ¬æä¾›äº†ä¸€ä¸ªè£…é¥°å™¨å‡½æ•°æä¾›ç±»ä¼¼çš„åŠŸèƒ½async_callback,æ‰€ä»¥ä¸Šé¢çš„å†™æ³•åªéœ€è¦å°†tornado.ioloop.IOLoop.instance().add_callback(self.callback)å˜æ›´æˆtornado.ioloop.IOLoop.instance().add_callback(self.async_callback(self.callback))å°±å¯ä»¥äº†ã€‚è™½ç„¶æ–¹æ³•å¾ˆä¸å¥½ï¼Œå¯æ˜¯ä¸´æ—¶è§£å†³äº†é—®é¢˜ï¼Œåœ¨1.1.0ç‰ˆæœ¬å°±å¼•å…¥äº†StackContexté€»è¾‘ï¼Œè§£å†³äº†è¿™ä¸ªé—®é¢˜\né¢„å¤‡çŸ¥è¯†Yield12345678910111213141516def gen_fn():    result = yield 1    print(&quot;result of yueld: &quot;+result)    result2 = yield  2    print(&quot;result of 2nd yield: &quot; + result2)    return &#x27;we are done&#x27;caller = gen_fn()x = caller.send(None)print(x)y = caller.send(&#x27;joe&#x27;)print(y)try:    caller.send(&quot;bob&quot;)except StopIteration:    print()\n\nå¯¹äºä¸€ä¸ªç”Ÿæˆå™¨æ¥è¯´ï¼Œè°ƒç”¨å®ƒ(gen())å¹¶ä¸ä¼šç«‹å³è¢«æ‰§è¡Œã€‚åªæ˜¯ç”Ÿæˆäº†ä¸€ä¸ªç”Ÿæˆå™¨å¯¹è±¡\nnex(g)ç­‰åŒäºg.send(None)ã€‚æ‰€ä»¥å¯¹äºç”Ÿæˆå™¨åªéœ€è¦æŒæ¡sendå‡½æ•°å°±å¯ä»¥äº†\nsend(value)è¿”å›çš„æ˜¯yieldå³è¾¹çš„å€¼ï¼ŒåŒæ—¶valueèµ‹å€¼ç»™yieldå·¦è¾¹çš„å¯¹è±¡ï¼Œåƒä¸‡ä¸è¦è¢«ç¬¬ä¸€æ¬¡çš„send(None)è¯¯å¯¼ï¼Œè®¤ä¸ºç»è¿‡ç¬¬ä¸€æ¬¡send(None)åresultçš„å€¼ä¸ºNone,ä½ å¯ä»¥åœ¨å¿ƒç›®ä¸­å°†æ²¡ä¸€ä¸ªyieldåˆ’ä¸Šç«–çº¿ï¼Œè¿è¡Œåˆ°é‚£é‡Œå°±è¿”å›ï¼Œç„¶åä¸‹ä¸€æ¬¡sendçš„å€¼è¢«èµ‹å€¼ç»™yieldå·¦è¾¹\nä¸Šä¾‹ä¸­we are doneæ²¡æœ‰è¢«æ‰“å°ï¼Œå› ä¸ºä¸æ–­çš„è¢«sendåç”Ÿæˆå™¨ä¼šè§¦å‘StopIterationå¼‚å¸¸ã€‚æœ€ç»ˆè¢«except StopIterationæ‰€æ•è·ã€‚å¯æ˜¯ä»–å¹¶æ²¡æœ‰å°†æ•è·çš„å€¼è¾“å‡ºï¼Œå› è€Œæ²¡æœ‰è¢«æ˜¾ç¤ºå¤„ç†ã€‚åŒæ—¶python2ä¸å…è®¸åœ¨ç”Ÿæˆå™¨æ‰§è¡Œreturnï¼Œæ‰€ä»¥åœ¨tornadoä¸­ç»å¸¸çœ‹åˆ°raise gen.Return(value)è¿™ç§å†™æ³•ï¼Œå®ƒå®è´¨å°±æ˜¯è§¦å‘StopIterationå¼‚å¸¸ï¼Œç„¶åè¢«exceptæ•è·åå¾—åˆ°å€¼ï¼Œå®Œæˆä¼ é€’è¿‡ç¨‹ï¼Œåˆ°äº†python3è¯­æ³•å°±ç›´æ¥å…è®¸æ‰§è¡Œreturnäº†\n\né¢„å¤‡çŸ¥è¯† withpythonæœ‰å¾ˆå¤šé­”æœ¯æ–¹æ³•(å¯ä»¥å‚è€ƒè¿™ç¯‡æ–‡ç« )ã€‚å…¶ä¸­å¦‚æœä¸€ä¸ªç±»å­˜åœ¨__enter__å’Œ__exit__æ–¹æ³•ã€‚é‚£ä¹ˆå½“ä½¿ç”¨withè¯­å¥ä¹‹åã€‚ä¼šæ‰§è¡Œ__enter__åå¾—åˆ°å¯¹è±¡è¿”å›ç»™with asåé¢çš„å˜é‡ã€‚åœ¨é€€å‡ºçš„æ—¶å€™æ‰§è¡Œ__exit__æ–¹æ³•ï¼Œæœ€å¸¸è§çš„å°±æ˜¯æˆ‘ä»¬ä½¿ç”¨with open() as få»æ‰“å¼€ä¸€ä¸ªæ–‡ä»¶äº†ï¼Œå¤„ç†å®Œæˆåè‡ªåŠ¨å…³é—­æ–‡ä»¶ï¼Œé¿å…äº†å†…å­˜æ³„æ¼ã€‚ä»”ç»†æƒ³ä¸€ä¸‹ï¼Œå…¶å®ç”¨è£…é¥°å™¨æ˜¯å¾ˆå®¹æ˜“å®ç°çš„ã€‚å¯æ˜¯withè¯­å¥è¿˜æœ‰ä»¥ä¸€ä¸ªå¾ˆå¤§çš„ä¼˜ç‚¹ï¼ŒPythonçš„ç¼–ç æ˜¯åŸºäºç¼©è¿›æ¥å†³å®šä»£ç å—çš„ï¼Œè£…é¥°å™¨æ˜¯ä½œç”¨åœ¨å‡½æ•°ä¸Šï¼Œè€Œwithæ˜¯å½“è·³å‡ºå®ƒçš„ç¼©è¿›åˆ™æ‰§è¡Œ__exit__(å¯èƒ½æè¿°çš„ä¸å¤ªå¥½)ï¼Œå¾ˆå¤šæƒ…å†µä¸‹withè¦æ¯”è£…é¥°å™¨çš„å†™æ³•ä¼˜ç¾å¾ˆå¤šã€‚\nå°†withå’Œyieldè”åˆèµ·æ¥ä½¿ç”¨è¿˜çœŸçš„æ˜¯æŒºç¥å¥‡çš„ã€‚from contextlib import contextmanagerï¼Œè¯¥æ¨¡å—å°†withè¯­å¥åšåˆ°äº†è£…é¥°å™¨çš„æ•ˆæœã€‚æ¯”å¦‚è®¡ç®—ä¸€ä¸ªwithè¯­å¥ä¸‹é¢çš„æ‰§è¡Œæ—¶é—´\n12345678910111213import timefrom contextlib import contextmanager@contextmanagerdef timeit():    start = time.time()    try:        yield    finally:        print(&quot;elapsed time: &#123;&#125;&quot;.format(time.time() - start))with timeit():    time.sleep(1)\nä½œä¸ºä¸æ˜ç™½å®ƒå®ç°çš„äººï¼Œä¹Ÿèƒ½å¤Ÿå¾ˆå®¹æ˜“çœ‹å‡ºæ¥ã€‚yieldå°†timeitåˆ’åˆ†ä¸ºäº†ä¸¤éƒ¨åˆ†ã€‚å‰é¢çš„ç›¸å½“äºæ‰§è¡Œ__enter__åŠ¨ä½œï¼Œåé¢çš„ç›¸å½“äºæ‰§è¡Œ__exit__åŠ¨ä½œã€‚\næƒ³è±¡ä¸€ä¸‹å®ƒçš„å†…éƒ¨contextmanagerè£…é¥°å™¨æ˜¯å¦‚ä½•å®ç°çš„ã€‚é¦–å…ˆè¢«è£…é¥°çš„å‡½æ•°timeitæ˜¯ä¸€ä¸ªç”Ÿæˆå™¨ã€‚å› æ­¤ï¼Œåœ¨æ‰§è¡Œ__enter__çš„æ—¶å€™åªéœ€è¦æ‰§è¡Œsend(None)æ“ä½œå°±èƒ½åˆ°è¾¾yieldçš„å³è¾¹å¹¶æš‚åœï¼Œå†__exit__çš„æ—¶å€™å†æ¬¡æ‰§è¡Œsend(None)ï¼Œæ­¤æ—¶æ‰§è¡Œåˆ°äº†finallyè¯­å¥å¹¶è§¦å‘StopIterationå¼‚å¸¸ï¼Œæµç¨‹ç»“æŸã€‚æ•´ä¸ªè¿‡ç¨‹å¯ä»¥è¿™æ ·è®¤ä¸º\n1234567891011121314151617181920212223242526def contextmanager(func):    def inner(*args, **kwargs):        g = func(*args,**kwargs)        class w():            def __enter__(self):                g.send(None)            def __exit__(self, exc_type, exc_val, exc_tb):                try:                    g.send(None)                except Exception:                    print(&quot;4&quot;)        return w()    return inner@contextmanagerdef log():    try:        print(&quot;1&quot;)        yield        raise Exception(&quot;E&quot;)    finally:        print(&quot;3&quot;)with log():    print(&quot;2&quot;)\næ˜¯å¦è¿˜æ˜¯æ„Ÿè§‰ç›¸å¯¹æ¯”è¾ƒç®€å•å‘¢\nStackContextçš„å®ç°åœ¨èµ·å› éƒ¨åˆ†ï¼Œè§£é‡Šäº†callbackä¸­ä¼šå­˜åœ¨çš„é—®é¢˜(æœŸå¾…RequestHandler.geté‡Œé¢æ‰€æœ‰ç›¸å…³å†…å®¹å‘ç”Ÿé”™è¯¯éƒ½ä¼šå¯¼è‡´è¿”å›500é”™è¯¯ç»™å®¢æˆ·ç«¯)ã€‚1.0ç‰ˆæœ¬çš„è§£å†³æ–¹æ¡ˆå°±æ˜¯ç»™æ¯ä¸ªå›è°ƒå‡½æ•°å¥—ä¸Šä¸€ä¸ªè£…é¥°å™¨ã€‚è§¦å‘é”™è¯¯çš„æ—¶å€™å°±å¯ä»¥è¿”å›500äº†ï¼Œæ„Ÿè§‰ä¸å¤ªå¥½è®²è¿°è¿™æ®µå¤©æ‰èˆ¬çš„ä»£ç äº†ğŸ˜•\n1234567891011121314151617181920212223242526import contextlib_state = ()@contextlib.contextmanagerdef StackContext(context_factory):    global _state    old_contexts = _state    try:        _state = old_contexts + (context_factory,)        with context_factory():            yield    finally:        _state = old_contexts@contextlib.contextmanagerdef ErrorCapture():    try:        yield    except Exception:        passwith StackContext(ErrorCapture):    print(_state)    raise Exception(&quot;Error&quot;)print(_state)\nè¿™ä¸ªåœ°æ–¹StackContextæ˜¯ä¸€ä¸ªå·¥å‚æ¨¡å¼ï¼Œå®ƒä¼ å…¥çš„å‚æ•°context_factoryä¹Ÿæ˜¯ä¸€ä¸ªè¢«contextlib.contextmanagerè£…é¥°çš„å¯¹è±¡ã€‚åœ¨StackContextçš„å†…éƒ¨å®ƒåˆæ‰§è¡Œäº†withè¯­å¥æ¥åˆå§‹åŒ–æˆ‘ä»¬çš„context_factoryï¼Œemmm.è¿™ä¸ªå…¶å®å’Œå¤šå±‚åµŒå¥—è£…é¥°å™¨å¹¶æ²¡æœ‰å¤ªå¤§çš„åŒºåˆ«ï¼Œå®ƒå®ç°äº†ä»€ä¹ˆæ•ˆæœå‘¢ï¼Œåœ¨è°ƒç”¨with StackContext(context_factory)çš„æ—¶å€™å°†context_factoryåŠ å…¥åˆ°è€çš„é‡Œé¢ã€‚æ³¨æ„ï¼Œå½“å‰çš„context_factoryå’Œ1.0.0ç‰ˆæœ¬é‡Œé¢çš„async_callbackæ•ˆæœæ˜¯ä¸€æ ·æ ·çš„ï¼Œåœ¨withçš„è¯­å¥å—ä¸‹é¢ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨_stateå˜é‡ã€‚å½“è·³å‡ºwithä¹‹å_stateå°±è¢«æ¢å¤åˆ°åŸæ¥çš„æ ·å­ã€‚\né‚£ä¹ˆæˆ‘ä»¬è¯¥å¦‚ä½•ä½¿ç”¨è¿™ä¸ª_stateå˜é‡å‘¢ï¼Œæ³¨æ„åˆ°withè¯­å¥è¿›å…¥çš„æ—¶å€™ä¼šåŠ å…¥context_factoryï¼Œé€€å‡ºçš„æ—¶å€™ä¼šæ¸…é™¤ã€‚è¿™æ„å‘³ç€åœ¨withä¸‹é¢çš„ä»£ç å—é‡Œé¢æˆ‘ä»¬å¯ä»¥å®‰å…¨çš„ä½¿ç”¨å®ƒ\n1234567def wrap(fn):    def wrapped(callback, contexts):        with contextlib.nested(*[i() for i in contexts]):            callback()    contexts = _state    result = functools.partial(wrapped, fn, contexts)    return result\nè¿™é‡Œï¼Œæˆ‘ä»¬æ·»åŠ ä¸€ä¸ªè£…é¥°å™¨ã€‚åœ¨IOLoopä¸­æ‰€æœ‰éœ€è¦æ·»åŠ å›è°ƒçš„åœ°æ–¹å‡ç”±wrapåŒ…è£…èµ·æ¥\n     def add_callback(self, callback):\n         &quot;&quot;&quot;Calls the given callback on the next I/O loop iteration.&quot;&quot;&quot;\n-        self._callbacks.add(callback)\n+        self._callbacks.add(stack_context.wrap(callback))\n         self._wake()\n\né‚£ä¹ˆï¼Œåœ¨å®ƒè¢«è°ƒç”¨çš„æ—¶å€™å®é™…æ‰§è¡Œçš„æ˜¯wrappedå‡½æ•°ï¼Œå®ƒä¼šå…ˆè°ƒç”¨with contextlib.nested(*[i() for i in contexts]).æ­¤æ­¥éª¤æ¢å¤äº†with StackContextæ—¶æœŸåŠ å…¥çš„å¯¹è±¡(å³äººä»¬å¸¸è¯´çš„ä¸Šä¸‹æ–‡)ã€‚å¯¹äºå¼‚å¸¸æ•è·æ¥è¯´ï¼Œå°±æ˜¯èƒ½å¤Ÿæ­£ç¡®çš„æ•è·callbackçš„å¼‚å¸¸å¹¶ä¸”è¿”å›500ç»™å®¢æˆ·ç«¯ã€‚å¦å¤–ï¼Œæœ€å¼€å§‹çš„æ—¶å€™æ•è·RequestHandle.getçš„å¼‚å¸¸æ˜¯åœ¨_executeå¥—ä¸Štryâ€¦except,å°†ä»–å˜åŠ¨ä¸ºwith StackContextå°±å¥½äº†ã€‚è¿™é‡Œåº”è¯¥è°¨è®°ä¸‹é¢ä¸¤ç‚¹\n\nTornadoçš„è¿è¡Œæ˜¯å•çº¿ç¨‹çš„,with StackContextè¿è¡Œçš„è¿‡ç¨‹ä¸­ä¸å¯èƒ½å­˜åœ¨åˆ«çš„æ­¥éª¤å¦å¤–å»æ”¹å˜äº†_stateçš„å€¼(è¿™ä¸ªå€¼å¾ˆé‡è¦)\n StackContextæ˜¯å¯ä»¥è¿›è¡ŒåµŒå¥—çš„\n\næ”¹è¿›å½“ç„¶ä»¥ä¸Šåªæ˜¯ä¸ºäº†è¡¨è¿°åŸç†è®²è§£çš„æœ€ç®€ä»£ç ï¼Œå®é™…ä¸Šæºç ä¸­ç•¥æœ‰ä¸åŒã€‚é¦–å…ˆè€ƒè™‘å¤šçº¿ç¨‹çš„æƒ…å†µï¼Œåœ¨å•çº¿ç¨‹ä¸­_stateçš„æ”¹åŠ¨æ˜¯å¾ˆæ˜¾ç„¶çš„ï¼Œæ‰§è¡Œwith StackContextå³å…è®¸æ”¹åŠ¨ã€‚åœ¨å¤šçº¿ç¨‹ä¸­å°±ä¸å¤ªä¸€æ ·äº†ã€‚å¤šçº¿ç¨‹ä¸­å¦‚æœä¹Ÿæ‰§è¡Œäº†with StackContextæ“ä½œï¼Œé‚£ä¹ˆæœ‰å¯èƒ½é€ æˆ_stateè¢«æ”¹åŠ¨ã€‚å› æ­¤ï¼Œ_stateè¢«ç»§æ‰¿è‡ªthread.localå¯¹è±¡ã€‚é‚£ä¹ˆä¸åŒçº¿ç¨‹å†…çš„ä¿®æ”¹æ˜¯äº’ç›¸ç‹¬ç«‹çš„å…¶æ¬¡å¦‚æœä¸€ä¸ªå‡½æ•°å·²ç»è¢«wrappedåŒ…è£…ï¼Œé‚£ä¹ˆå°±ä¸å¿…è¦å†æ¬¡è¿›è¡ŒåŒ…è£…äº†(æƒ³è±¡ä¸€ä¸‹é€’å½’è°ƒç”¨add_callback)ã€‚å¯¹äºä¸å­˜åœ¨çš„with StackContextä¹Ÿéœ€è¦è€ƒè™‘ï¼Œå¦‚æœæ‰§è¡Œcontextlib.nestedçš„å‚æ•°ä¸ºç©ºï¼Œæ— ç–‘æ˜¯ä¼šæŠ¥é”™çš„ã€‚å…¶ä»–æœ‰çš„ç‹¬ç«‹çš„è¿è¡Œçš„æ¨¡å—ä¸å¸Œæœ›è¢«å·²å­˜åœ¨çš„_stateå½±å“ï¼Œå› æ­¤ç‹¬ç«‹è®¾ç½®äº†NullContext\n12345678@contextlib.contextmanagerdef NullContext():    old_contexts = _state.contexts    try:        _state.contexts = ()        yield    finally:        _state.contexts = old_contexts\nå¦‚æœä¸å¸Œæœ›è¢«_stateå¹²æ‰°ï¼Œé‚£ä¹ˆåœ¨å‰é¢åŠ ä¸Šwith StackContext(NullContext)ã€‚_stateå³è¢«ç½®ä¸ºç©ºã€‚æ˜¾ç„¶add_callbackä¼ å…¥çš„contextsä¸ºç©ºã€‚åœ¨å®ƒè¢«æ‰§è¡Œçš„æ—¶å€™ï¼Œä¹Ÿå’Œwithè¯­å¥æ²¡ä»€ä¹ˆäº‹æƒ…äº†\nåº”ç”¨æˆ‘æœ€å¼€å§‹çœ‹åˆ°çš„åº”ç”¨æ˜¯è¿™ä¸ª,åœ¨Tornadoé‡Œé¢ä½¿ç”¨Sqlalchemyã€‚é»˜è®¤Sqlalchemyå­˜åœ¨sessionmakerä¸€ä¸ªå·¥å‚å‡½æ•°ï¼Œå®ƒä¼šç¡®å®šå¦‚ä½•ç”Ÿæˆä¸€ä¸ªsessionä¼šè¯å¯¹è±¡ä»¥ä¾›ä½¿ç”¨ã€‚é»˜è®¤çš„æƒ…å†µæ˜¯ä½¿ç”¨çº¿ç¨‹idï¼Œè¿™å¯¹äºå¤šçº¿ç¨‹ç¯å¢ƒéå¸¸éå¸¸æ–¹ä¾¿ã€‚å› ä¸ºå¤šçº¿ç¨‹webæ¡†æ¶ä¸­æ¯ä¸€ä¸ªHTTPè¯·æ±‚çš„å¤„ç†éƒ½æ˜¯åœ¨ç‹¬ç«‹çš„çº¿ç¨‹å†…è¿›è¡Œçš„ï¼Œé‚£ä¹ˆä¸€ä¸ªhttpå¤„ç†ç”Ÿå‘½å‘¨æœŸå¯¹åº”ä¸€ä¸ªsqlalchemyçš„sessionç”Ÿå‘½å‘¨æœŸéå¸¸å®Œç¾ã€‚å¯æ˜¯åœ¨Tornadoè¿™ç§å•çº¿ç¨‹çš„æ¡†æ¶ä¸­å‘ç”Ÿäº†å˜åŒ–ï¼Œå› ä¸ºå®ƒä¸å¥½ç¡®å®šæ¯ä¸€ä¸ªhttpçš„ç”Ÿå‘½å‘¨æœŸæ ‡è¯†ã€‚StackContextç»™äº†æˆ‘ä»¬æ–¹æ³•ï¼Œè™½ç„¶èµ·å› æ˜¯callbackçš„å¼‚å¸¸å¤„ç†ï¼Œå¯æ˜¯æˆ‘ä»¬ä¸€æ ·å¯ä»¥å‚ç…§å®ƒçš„å¥—è·¯ï¼Œåœ¨_executeæ‰§è¡ŒæœŸé—´å†™å…¥å˜é‡ï¼Œåœ¨å•ä¸ªhttpç”Ÿå‘½å‘¨æœŸå‡å¯ä»¥è®¿é—®å˜é‡ï¼Œhttpå®Œç»“åæ¸…é™¤å®ƒã€‚ä»£ç å¯ä»¥å‚è€ƒç»™å‡ºçš„gisté“¾æ¥\nç”¨ä¾‹ä¸‹é¢ç»™ä¸€ä¸ªæ•´ç¯‡æ–‡ç« çš„ä»£ç æ€»ç»“\n1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677try:    from contextlib import nestedexcept ImportError:    from contextlib import ExitStack, contextmanager    @contextmanager    def nested(*contexts):        with ExitStack() as stack:            for ctx in contexts:                stack.enter_context(ctx)            yield contextsimport functools@contextmanagerdef StackContext(context_factory):    global _state    old_contexts = _state    try:        _state = old_contexts + (context_factory,)        with context_factory():            yield    finally:        _state = old_contexts@contextmanagerdef ErrorCapture():    try:        yield    except Exception:        pass_state = ()def wrap(fn):    def wrapped(callback, contexts):        with nested(*[i() for i in contexts]):            callback()    contexts = _state    result = functools.partial(wrapped, fn, contexts)    return resultloop_list = []def call_back():    print(&quot;WTF&quot;)    print(get_current_request_id())g = &#123;&#125;@contextmanagerdef ThreadRequestContext(**data):    global g    try:        g = data        yield    finally:        g.clear()def get_current_request_id():    return g[&#x27;request_id&#x27;]global_data = &#123;&quot;request_id&quot;: 12&#125;with StackContext(functools.partial(ThreadRequestContext, **global_data)):    with StackContext(ErrorCapture):        loop_list.append(wrap(call_back))        print(get_current_request_id())for i in loop_list:    i()\n\n","dateCreated":"2018-03-16T16:14:25+08:00","dateModified":"2018-03-17T12:01:17+08:00","datePublished":"2018-03-16T16:14:25+08:00","description":"yieldè¿™ä¸ªå…³é”®å­—åœ¨2001å¹´2.2ç‰ˆæœ¬çš„æ—¶å€™å°±å‡ºç°äº†ã€‚2006åŠ å…¥yield.sendåŠŸèƒ½ã€‚ç„¶è€Œç›´åˆ°2006å¹´2.5ç‰ˆæœ¬æ‰çœ‹åˆ°ä½¿ç”¨åœ¨contextmanagerä¸Šï¼Œtornado 2011å¹´æ‰ç”¨å®ƒå®ç°äº†ç¥å¥‡çš„gené€»è¾‘ã€‚ä»¤æˆ‘æ²¡æƒ³åˆ°çš„æ˜¯\n\n yieldå‡ºç°çš„è¿™ä¹ˆæ—©\n yieldå‰å®³ä¸€ç‚¹çš„åº”ç”¨(contentmanager)å±…ç„¶è¿‡äº†äº”å¹´æ‰åŠ å…¥åˆ°æ ‡å‡†åº“ã€‚\n tornadoçš„1.0.0ç‰ˆæ ¹æœ¬å’Œyieldæ²¡æœ‰ä¸€æ¯›é’±å…³ç³»\n tornadoæœ€å…ˆå¼•å…¥yieldå±…ç„¶å¹¶ä¸æ˜¯å®ç°äº†gen\n\nyieldæœ€å…ˆåœ¨tornadoé‡Œé¢å±•éœ²å¤´è§’æ˜¯åœ¨è¿™ä¸ªcommité‡Œé¢ã€‚å¤§ç¥å°±æ˜¯å¤§ç¥ï¼Œè™½ç„¶è¿™ä¸ªä»£ç ä»…ä»…åªæœ‰å‡ åè¡Œã€‚å¯æ˜¯æˆ‘è§‰å¾—æ€è·¯å¾ˆæ–°å¥‡ï¼Œè†œæ‹œğŸ˜€(ä»£ç åŸºäºv1.0.0å’Œv1.1.0)","headline":"Tornado ä¹‹StackContext","image":[],"mainEntityOfPage":{"@type":"WebPage","@id":"https://www.zoulei.net/2018/03/16/Tornado_StackContext/"},"publisher":{"@type":"Organization","name":"ficapy","sameAs":["https://github.com/ficapy","mailto:afexcg@gmail.com"],"image":"https://www.gravatar.com/avatar/be6268177c26b987066b089d191aea66","logo":{"@type":"ImageObject","url":"https://www.gravatar.com/avatar/be6268177c26b987066b089d191aea66"}},"url":"https://www.zoulei.net/2018/03/16/Tornado_StackContext/"}</script>
    <meta name="description" content="yieldè¿™ä¸ªå…³é”®å­—åœ¨2001å¹´2.2ç‰ˆæœ¬çš„æ—¶å€™å°±å‡ºç°äº†ã€‚2006åŠ å…¥yield.sendåŠŸèƒ½ã€‚ç„¶è€Œç›´åˆ°2006å¹´2.5ç‰ˆæœ¬æ‰çœ‹åˆ°ä½¿ç”¨åœ¨contextmanagerä¸Šï¼Œtornado 2011å¹´æ‰ç”¨å®ƒå®ç°äº†ç¥å¥‡çš„gené€»è¾‘ã€‚ä»¤æˆ‘æ²¡æƒ³åˆ°çš„æ˜¯   yieldå‡ºç°çš„è¿™ä¹ˆæ—©  yieldå‰å®³ä¸€ç‚¹çš„åº”ç”¨(contentmanager)å±…ç„¶è¿‡äº†äº”å¹´æ‰åŠ å…¥åˆ°æ ‡å‡†åº“ã€‚  tornadoçš„1.0.0ç‰ˆæ ¹æœ¬å’Œyiel">
<meta property="og:type" content="blog">
<meta property="og:title" content="Tornado ä¹‹StackContext">
<meta property="og:url" content="https://www.zoulei.net/2018/03/16/Tornado_StackContext/index.html">
<meta property="og:site_name" content="é‚¹é›·">
<meta property="og:description" content="yieldè¿™ä¸ªå…³é”®å­—åœ¨2001å¹´2.2ç‰ˆæœ¬çš„æ—¶å€™å°±å‡ºç°äº†ã€‚2006åŠ å…¥yield.sendåŠŸèƒ½ã€‚ç„¶è€Œç›´åˆ°2006å¹´2.5ç‰ˆæœ¬æ‰çœ‹åˆ°ä½¿ç”¨åœ¨contextmanagerä¸Šï¼Œtornado 2011å¹´æ‰ç”¨å®ƒå®ç°äº†ç¥å¥‡çš„gené€»è¾‘ã€‚ä»¤æˆ‘æ²¡æƒ³åˆ°çš„æ˜¯   yieldå‡ºç°çš„è¿™ä¹ˆæ—©  yieldå‰å®³ä¸€ç‚¹çš„åº”ç”¨(contentmanager)å±…ç„¶è¿‡äº†äº”å¹´æ‰åŠ å…¥åˆ°æ ‡å‡†åº“ã€‚  tornadoçš„1.0.0ç‰ˆæ ¹æœ¬å’Œyiel">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2018-03-16T08:14:25.000Z">
<meta property="article:modified_time" content="2018-03-17T04:01:17.000Z">
<meta property="article:author" content="ficapy">
<meta name="twitter:card" content="summary">
    
    
        
    
    
    
    
    
    <!--STYLES-->
    
<link rel="stylesheet" href="/assets/css/style-vmyldjpouxmbykub3bplp6yx2cdfiohdin8psfrhaiwtjsy1h8z42722ngua.min.css">

    <!--STYLES END-->
    

    

    
        
    
<!-- hexo injector head_end start -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-math@4.0.0/dist/style.css">
<!-- hexo injector head_end end --></head>

    <body>
        <div id="blog">
            <!-- Define author's picture -->


    

<header id="header" data-behavior="4">
    <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
    <div class="header-title">
        <a
            class="header-title-link"
            href="/"
            aria-label=""
        >
            é‚¹é›·
        </a>
    </div>
    
        
            <a
                class="header-right-picture "
                href="#about"
                aria-label="æ‰“å¼€é“¾æ¥: /#about"
            >
        
        
        </a>
    
</header>

            <!-- Define author's picture -->


<nav id="sidebar" data-behavior="4">
    <div class="sidebar-container">
        
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/"
                            
                            rel="noopener"
                            title="é¦–é¡µ"
                        >
                        <i class="sidebar-button-icon fa fa-home" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">é¦–é¡µ</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/all-categories"
                            
                            rel="noopener"
                            title="åˆ†ç±»"
                        >
                        <i class="sidebar-button-icon fa fa-bookmark" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">åˆ†ç±»</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/all-tags"
                            
                            rel="noopener"
                            title="æ ‡ç­¾"
                        >
                        <i class="sidebar-button-icon fa fa-tags" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">æ ‡ç­¾</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/all-archives"
                            
                            rel="noopener"
                            title="å½’æ¡£"
                        >
                        <i class="sidebar-button-icon fa fa-archive" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">å½’æ¡£</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link open-algolia-search"
                            href="#search"
                            
                            rel="noopener"
                            title="æœç´¢"
                        >
                        <i class="sidebar-button-icon fa fa-search" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">æœç´¢</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="#about"
                            
                            rel="noopener"
                            title="å…³äº"
                        >
                        <i class="sidebar-button-icon fa fa-question" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">å…³äº</span>
                    </a>
            </li>
            
        </ul>
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="https://github.com/ficapy"
                            
                                target="_blank"
                            
                            rel="noopener"
                            title="GitHub"
                        >
                        <i class="sidebar-button-icon fab fa-github" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">GitHub</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="mailto:afexcg@gmail.com"
                            
                                target="_blank"
                            
                            rel="noopener"
                            title="é‚®ç®±"
                        >
                        <i class="sidebar-button-icon fa fa-envelope" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">é‚®ç®±</span>
                    </a>
            </li>
            
        </ul>
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/atom.xml"
                            
                            rel="noopener"
                            title="RSS"
                        >
                        <i class="sidebar-button-icon fa fa-rss" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">RSS</span>
                    </a>
            </li>
            
        </ul>
        
    </div>
</nav>

            
            <div id="main" data-behavior="4"
                 class="
                        hasCoverMetaIn
                        ">
                
<article class="post">
    
    
        <div class="post-header main-content-wrap text-left">
    
        <h1 class="post-title">
            Tornado ä¹‹StackContext
        </h1>
    
    
        <div class="post-meta">
    <time datetime="2018-03-16T16:14:25+08:00">
	
		    3æœˆ 16, 2018
    	
    </time>
    
        <span>å‘å¸ƒåœ¨ </span>
        
    <a class="category-link" href="/categories/Tornado/">Tornado</a>


    
</div>

    
</div>

    
    <div class="post-content markdown">
        <div class="main-content-wrap">
            <p>yieldè¿™ä¸ªå…³é”®å­—åœ¨2001å¹´2.2ç‰ˆæœ¬çš„æ—¶å€™å°±å‡ºç°äº†ã€‚2006åŠ å…¥yield.sendåŠŸèƒ½ã€‚ç„¶è€Œç›´åˆ°2006å¹´2.5ç‰ˆæœ¬æ‰çœ‹åˆ°ä½¿ç”¨åœ¨contextmanagerä¸Šï¼Œtornado 2011å¹´æ‰ç”¨å®ƒå®ç°äº†ç¥å¥‡çš„gené€»è¾‘ã€‚ä»¤æˆ‘æ²¡æƒ³åˆ°çš„æ˜¯</p>
<ol>
<li> yieldå‡ºç°çš„è¿™ä¹ˆæ—©</li>
<li> yieldå‰å®³ä¸€ç‚¹çš„åº”ç”¨(contentmanager)å±…ç„¶è¿‡äº†äº”å¹´æ‰åŠ å…¥åˆ°æ ‡å‡†åº“ã€‚</li>
<li> tornadoçš„1.0.0ç‰ˆæ ¹æœ¬å’Œyieldæ²¡æœ‰ä¸€æ¯›é’±å…³ç³»</li>
<li> tornadoæœ€å…ˆå¼•å…¥yieldå±…ç„¶å¹¶ä¸æ˜¯å®ç°äº†gen</li>
</ol>
<p>yieldæœ€å…ˆåœ¨tornadoé‡Œé¢å±•éœ²å¤´è§’æ˜¯åœ¨<span style="color:red"><strong><a href="https://github.com/tornadoweb/tornado/commit/721e25d0acc68d751073261bec150ac12a9f88ab">è¿™ä¸ªcommit</a></strong></span>é‡Œé¢ã€‚å¤§ç¥å°±æ˜¯å¤§ç¥ï¼Œè™½ç„¶è¿™ä¸ªä»£ç ä»…ä»…åªæœ‰å‡ åè¡Œã€‚å¯æ˜¯æˆ‘è§‰å¾—æ€è·¯å¾ˆæ–°å¥‡ï¼Œè†œæ‹œğŸ˜€(ä»£ç åŸºäºv1.0.0å’Œv1.1.0)</p>
<a id="more"></a>

<p>å»ºè®®æ‰“å¼€è¯¥commitï¼Œå…ˆçœ‹ä¸€çœ‹å®ƒåšäº†ä»€ä¹ˆäº‹æƒ…ã€‚é™¤å»æµ‹è¯•ç”¨ä¾‹ï¼Œå®ƒæ”¹åŠ¨çš„åœ°æ–¹å¯è°“éå¸¸å°‘äº†</p>
<h3 id="èµ·å› "><a href="#èµ·å› " class="headerlink" title="èµ·å› "></a>èµ·å› </h3><p>è§‚å¯Ÿä¸‹é¢çš„ä»£ç (å¯ä»¥å°†tornadoçš„æºç åœ¨1.0.0ç‰ˆæœ¬å’Œ1.1.0ç‰ˆæœ¬åˆ‡æ¢å‘ç°ä¸åŒï¼Œåœ¨1.0.0ç‰ˆæœ¬å®¢æˆ·ç«¯æ— æ³•å¾—åˆ°å“åº”ï¼Œ1.1.0ç‰ˆæœ¬å®¢æˆ·ç«¯å¾—åˆ°500é”™è¯¯)</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> tornado.ioloop</span><br><span class="line"><span class="keyword">import</span> tornado.web</span><br><span class="line"><span class="keyword">import</span> tornado.httpserver</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Index</span>(<span class="params">tornado.web.RequestHandler</span>):</span></span><br><span class="line"><span class="meta">    @tornado.web.asynchronous</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span>(<span class="params">self</span>):</span></span><br><span class="line">        tornado.ioloop.IOLoop.instance().add_callback(self.callback)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">callback</span>(<span class="params">self,*args</span>):</span></span><br><span class="line">        <span class="keyword">raise</span> Exception(<span class="string">&quot;Error&quot;</span>)</span><br><span class="line"></span><br><span class="line">application = tornado.web.Application(handlers=[(<span class="string">&#x27;/&#x27;</span>, Index)])</span><br><span class="line">tornado.httpserver.HTTPServer(application).listen(<span class="number">8888</span>)</span><br><span class="line">tornado.ioloop.IOLoop.instance().start()</span><br></pre></td></tr></table></figure>
<p>è¿™æ˜¯ä¸€ä¸ªå¼‚æ­¥çš„httpå“åº”ã€‚åœ¨æ¥å—åˆ°è¯·æ±‚ä¹‹åæ‰§è¡Œgetå‡½æ•°ä½“ï¼Œæœ€ç»ˆå®ƒå°†self.callbackåŠ å…¥åˆ°IOLoopå¾ªç¯åˆ—è¡¨ï¼Œgetå‡½æ•°ç»“æŸã€‚å› ä¸ºå­˜åœ¨asynchronousè£…é¥°å™¨ï¼Œæ‰€ä»¥å¹¶æ²¡æœ‰ä¸»åŠ¨è°ƒç”¨self.finish()ã€‚å¾…IOLoopæ‰§è¡Œself.callbackå›è°ƒæ—¶ã€‚æ­¤æ—¶å¹¶å‡½æ•°å†…éƒ¨è§¦å‘äº†å¼‚å¸¸ã€‚<span style="color:red"><strong>ä½†æ˜¯è¿™ä¸ªå¼‚å¸¸å·²ç»å’Œgetå‡½æ•°æ²¡æœ‰ä»»ä½•å…³ç³»ï¼Œå› æ­¤getå‡½æ•°æ— æ³•æ•è·åˆ°è¿™ä¸ªå¼‚å¸¸</strong></span><br>å¯¹æ¯”ä¸€ä¸‹getå‡½æ•°ä½“è‡ªèº«è§¦å‘å¼‚å¸¸ã€‚ç”±web.RequestHandler._executeè°ƒç”¨getå‡½æ•°ã€‚æ­¤æ—¶å®ƒå°†æ•è·å¼‚å¸¸å¹¶è°ƒç”¨self._handle_request_exception.æœ€ç®€æµç¨‹å¦‚ä¸‹</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_execute</span>(<span class="params">self, transforms, *args, **kwargs</span>):</span></span><br><span class="line">    self._transforms = transforms</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="built_in">getattr</span>(self, self.request.method.lower())(*args, **kwargs)</span><br><span class="line">        <span class="keyword">if</span> self._auto_finish <span class="keyword">and</span> <span class="keyword">not</span> self._finished:</span><br><span class="line">            self.finish()</span><br><span class="line">    <span class="keyword">except</span> Exception, e:</span><br><span class="line">        self._handle_request_exception(e)</span><br></pre></td></tr></table></figure>
<p>self._handler_request_exceptionçš„æµç¨‹ä¹Ÿæ¯”è¾ƒç®€å•è¾“å‡ºå¼‚å¸¸è°ƒç”¨æ ˆã€‚è¿”å›å®¢æˆ·ç«¯500é”™è¯¯ï¼Œè¯¥httpæµç¨‹ç»“æŸ</p>
<p>å¯æ˜¯å¯¹äºä¸€ä¸ªå›è°ƒï¼Œå®ƒçš„å¼‚å¸¸ç”±IOLoopæ•è·ï¼Œç„¶è€Œå¯æ‚²çš„æ˜¯å®ƒæ•è·åˆ°å¼‚å¸¸å´å¹¶ä¸èƒ½ç¡®å®šæ˜¯è°æ·»åŠ åˆ°IOLoopé‡Œé¢çš„ï¼Œå¼‚å¸¸æ•è·ä¹‹åæ˜¯ä¸æ˜¯åªç”¨è¾“å‡ºè°ƒç”¨æ ˆå°±å¥½ã€‚æ‰€ä»¥éœ€æ±‚å‡ºæ¥äº†ï¼Œå¯¹äºå‡¡æ˜¯ç”±getæ“ä½œä¸‹é¢åŠ å…¥åˆ°IOLoopçš„å›è°ƒï¼Œæˆ‘ä»¬æœŸå¾…èƒ½å’Œgetçš„å¼‚å¸¸å¤„ç†é€»è¾‘ä¸€è‡´</p>
<h3 id="å†å²ä¸Šè¿™ä¸ªé—®é¢˜æ˜¯æ€ä¹ˆå¤„ç†çš„"><a href="#å†å²ä¸Šè¿™ä¸ªé—®é¢˜æ˜¯æ€ä¹ˆå¤„ç†çš„" class="headerlink" title="å†å²ä¸Šè¿™ä¸ªé—®é¢˜æ˜¯æ€ä¹ˆå¤„ç†çš„"></a>å†å²ä¸Šè¿™ä¸ªé—®é¢˜æ˜¯æ€ä¹ˆå¤„ç†çš„</h3><p>è¿™è‚¯å®šæ˜¯ä¸€ä¸ªéå¸¸å¸¸è§çš„é—®é¢˜ï¼Œå½“æ‰§è¡Œ<code>ioloop.IOLoop.instance().add_callback</code>ä¹‹åã€‚callbackå‡½æ•°è§¦å‘çš„å¼‚å¸¸æ·»åŠ å›è°ƒçš„å‡½æ•°æ— æ³•æ„ŸçŸ¥ã€‚æœ€å®¹æ˜“æƒ³åˆ°çš„æ–¹æ³•å°±æ˜¯æˆ‘ä»¬æŠŠcallbackæ•´ä½“åŠ ä¸Šå¼‚å¸¸æ•æ‰é€»è¾‘</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">callback</span>(<span class="params">self,*args</span>):</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">                ...</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">                self._handle_request_exception(e)</span><br></pre></td></tr></table></figure>
<p>ä½†æ˜¯è¿™ä¹ˆæ¶å¿ƒçš„æ–¹æ³•æ˜æ˜¾æ˜¯ä¸å¯å–çš„ã€‚æ„å‘³ç€æˆ‘ä»¬æ¯å†™ä¸€ä¸ªå›è°ƒé€»è¾‘éƒ½éœ€è¦åœ¨å¤–éƒ¨åŠ ä¸Štry..exceptã€‚åœ¨1.0.0ç‰ˆæœ¬æä¾›äº†ä¸€ä¸ªè£…é¥°å™¨å‡½æ•°æä¾›ç±»ä¼¼çš„åŠŸèƒ½async_callback,æ‰€ä»¥ä¸Šé¢çš„å†™æ³•åªéœ€è¦å°†<code>tornado.ioloop.IOLoop.instance().add_callback(self.callback)</code>å˜æ›´æˆ<code>tornado.ioloop.IOLoop.instance().add_callback(self.async_callback(self.callback))</code>å°±å¯ä»¥äº†ã€‚è™½ç„¶æ–¹æ³•å¾ˆä¸å¥½ï¼Œå¯æ˜¯ä¸´æ—¶è§£å†³äº†é—®é¢˜ï¼Œåœ¨1.1.0ç‰ˆæœ¬å°±å¼•å…¥äº†StackContexté€»è¾‘ï¼Œè§£å†³äº†è¿™ä¸ªé—®é¢˜</p>
<h3 id="é¢„å¤‡çŸ¥è¯†Yield"><a href="#é¢„å¤‡çŸ¥è¯†Yield" class="headerlink" title="é¢„å¤‡çŸ¥è¯†Yield"></a>é¢„å¤‡çŸ¥è¯†Yield</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">gen_fn</span>():</span></span><br><span class="line">    result = <span class="keyword">yield</span> <span class="number">1</span></span><br><span class="line">    print(<span class="string">&quot;result of yueld: &quot;</span>+result)</span><br><span class="line">    result2 = <span class="keyword">yield</span>  <span class="number">2</span></span><br><span class="line">    print(<span class="string">&quot;result of 2nd yield: &quot;</span> + result2)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;we are done&#x27;</span></span><br><span class="line"></span><br><span class="line">caller = gen_fn()</span><br><span class="line">x = caller.send(<span class="literal">None</span>)</span><br><span class="line">print(x)</span><br><span class="line">y = caller.send(<span class="string">&#x27;joe&#x27;</span>)</span><br><span class="line">print(y)</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    caller.send(<span class="string">&quot;bob&quot;</span>)</span><br><span class="line"><span class="keyword">except</span> StopIteration:</span><br><span class="line">    print()</span><br></pre></td></tr></table></figure>
<ol>
<li>å¯¹äºä¸€ä¸ªç”Ÿæˆå™¨æ¥è¯´ï¼Œè°ƒç”¨å®ƒ(gen())å¹¶ä¸ä¼šç«‹å³è¢«æ‰§è¡Œã€‚åªæ˜¯ç”Ÿæˆäº†ä¸€ä¸ªç”Ÿæˆå™¨å¯¹è±¡</li>
<li>nex(g)ç­‰åŒäºg.send(None)ã€‚æ‰€ä»¥å¯¹äºç”Ÿæˆå™¨åªéœ€è¦æŒæ¡sendå‡½æ•°å°±å¯ä»¥äº†</li>
<li>send(value)è¿”å›çš„æ˜¯yieldå³è¾¹çš„å€¼ï¼ŒåŒæ—¶valueèµ‹å€¼ç»™yieldå·¦è¾¹çš„å¯¹è±¡ï¼Œ<span style="color:red"><strong>åƒä¸‡ä¸è¦è¢«ç¬¬ä¸€æ¬¡çš„send(None)è¯¯å¯¼ï¼Œè®¤ä¸ºç»è¿‡ç¬¬ä¸€æ¬¡send(None)åresultçš„å€¼ä¸ºNone</strong></span>,ä½ å¯ä»¥åœ¨å¿ƒç›®ä¸­å°†æ²¡ä¸€ä¸ªyieldåˆ’ä¸Šç«–çº¿ï¼Œè¿è¡Œåˆ°é‚£é‡Œå°±è¿”å›ï¼Œç„¶åä¸‹ä¸€æ¬¡sendçš„å€¼è¢«èµ‹å€¼ç»™yieldå·¦è¾¹</li>
<li>ä¸Šä¾‹ä¸­<code>we are done</code>æ²¡æœ‰è¢«æ‰“å°ï¼Œå› ä¸ºä¸æ–­çš„è¢«sendåç”Ÿæˆå™¨ä¼šè§¦å‘StopIterationå¼‚å¸¸ã€‚æœ€ç»ˆè¢«except StopIterationæ‰€æ•è·ã€‚å¯æ˜¯ä»–å¹¶æ²¡æœ‰å°†æ•è·çš„å€¼è¾“å‡ºï¼Œå› è€Œæ²¡æœ‰è¢«æ˜¾ç¤ºå¤„ç†ã€‚åŒæ—¶python2ä¸å…è®¸åœ¨ç”Ÿæˆå™¨æ‰§è¡Œreturnï¼Œæ‰€ä»¥åœ¨tornadoä¸­ç»å¸¸çœ‹åˆ°raise gen.Return(value)è¿™ç§å†™æ³•ï¼Œå®ƒå®è´¨å°±æ˜¯è§¦å‘StopIterationå¼‚å¸¸ï¼Œç„¶åè¢«exceptæ•è·åå¾—åˆ°å€¼ï¼Œå®Œæˆä¼ é€’è¿‡ç¨‹ï¼Œåˆ°äº†python3è¯­æ³•å°±ç›´æ¥å…è®¸æ‰§è¡Œreturnäº†</li>
</ol>
<h3 id="é¢„å¤‡çŸ¥è¯†-with"><a href="#é¢„å¤‡çŸ¥è¯†-with" class="headerlink" title="é¢„å¤‡çŸ¥è¯† with"></a>é¢„å¤‡çŸ¥è¯† with</h3><p>pythonæœ‰å¾ˆå¤šé­”æœ¯æ–¹æ³•(å¯ä»¥å‚è€ƒ<a href="https://pycoders-weekly-chinese.readthedocs.io/en/latest/issue6/a-guide-to-pythons-magic-methods.html">è¿™ç¯‡æ–‡ç« </a>)ã€‚å…¶ä¸­å¦‚æœä¸€ä¸ªç±»å­˜åœ¨<code>__enter__</code>å’Œ<code>__exit__</code>æ–¹æ³•ã€‚é‚£ä¹ˆå½“ä½¿ç”¨withè¯­å¥ä¹‹åã€‚ä¼šæ‰§è¡Œ<code>__enter__</code>åå¾—åˆ°å¯¹è±¡è¿”å›ç»™<code>with as</code>åé¢çš„å˜é‡ã€‚åœ¨é€€å‡ºçš„æ—¶å€™æ‰§è¡Œ<code>__exit__</code>æ–¹æ³•ï¼Œæœ€å¸¸è§çš„å°±æ˜¯æˆ‘ä»¬ä½¿ç”¨<code>with open() as f</code>å»æ‰“å¼€ä¸€ä¸ªæ–‡ä»¶äº†ï¼Œå¤„ç†å®Œæˆåè‡ªåŠ¨å…³é—­æ–‡ä»¶ï¼Œé¿å…äº†å†…å­˜æ³„æ¼ã€‚ä»”ç»†æƒ³ä¸€ä¸‹ï¼Œå…¶å®ç”¨è£…é¥°å™¨æ˜¯å¾ˆå®¹æ˜“å®ç°çš„ã€‚å¯æ˜¯withè¯­å¥è¿˜æœ‰ä»¥ä¸€ä¸ªå¾ˆå¤§çš„ä¼˜ç‚¹ï¼ŒPythonçš„ç¼–ç æ˜¯åŸºäºç¼©è¿›æ¥å†³å®šä»£ç å—çš„ï¼Œè£…é¥°å™¨æ˜¯ä½œç”¨åœ¨å‡½æ•°ä¸Šï¼Œè€Œwithæ˜¯å½“è·³å‡ºå®ƒçš„ç¼©è¿›åˆ™æ‰§è¡Œ<code>__exit__</code>(å¯èƒ½æè¿°çš„ä¸å¤ªå¥½)ï¼Œå¾ˆå¤šæƒ…å†µä¸‹withè¦æ¯”è£…é¥°å™¨çš„å†™æ³•ä¼˜ç¾å¾ˆå¤šã€‚</p>
<p>å°†withå’Œyieldè”åˆèµ·æ¥ä½¿ç”¨è¿˜çœŸçš„æ˜¯æŒºç¥å¥‡çš„ã€‚from contextlib import contextmanagerï¼Œè¯¥æ¨¡å—å°†withè¯­å¥åšåˆ°äº†è£…é¥°å™¨çš„æ•ˆæœã€‚æ¯”å¦‚è®¡ç®—ä¸€ä¸ªwithè¯­å¥ä¸‹é¢çš„æ‰§è¡Œæ—¶é—´</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> contextlib <span class="keyword">import</span> contextmanager</span><br><span class="line"></span><br><span class="line"><span class="meta">@contextmanager</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">timeit</span>():</span></span><br><span class="line">    start = time.time()</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">yield</span></span><br><span class="line">    <span class="keyword">finally</span>:</span><br><span class="line">        print(<span class="string">&quot;elapsed time: &#123;&#125;&quot;</span>.<span class="built_in">format</span>(time.time() - start))</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> timeit():</span><br><span class="line">    time.sleep(<span class="number">1</span>)</span><br></pre></td></tr></table></figure>
<p>ä½œä¸ºä¸æ˜ç™½å®ƒå®ç°çš„äººï¼Œä¹Ÿèƒ½å¤Ÿå¾ˆå®¹æ˜“çœ‹å‡ºæ¥ã€‚yieldå°†timeitåˆ’åˆ†ä¸ºäº†ä¸¤éƒ¨åˆ†ã€‚å‰é¢çš„ç›¸å½“äºæ‰§è¡Œ<code>__enter__</code>åŠ¨ä½œï¼Œåé¢çš„ç›¸å½“äºæ‰§è¡Œ<code>__exit__</code>åŠ¨ä½œã€‚</p>
<p>æƒ³è±¡ä¸€ä¸‹å®ƒçš„å†…éƒ¨contextmanagerè£…é¥°å™¨æ˜¯å¦‚ä½•å®ç°çš„ã€‚é¦–å…ˆè¢«è£…é¥°çš„å‡½æ•°timeitæ˜¯ä¸€ä¸ªç”Ÿæˆå™¨ã€‚å› æ­¤ï¼Œåœ¨æ‰§è¡Œ<code>__enter__</code>çš„æ—¶å€™åªéœ€è¦æ‰§è¡Œsend(None)æ“ä½œå°±èƒ½åˆ°è¾¾yieldçš„å³è¾¹å¹¶æš‚åœï¼Œå†<code>__exit__</code>çš„æ—¶å€™å†æ¬¡æ‰§è¡Œsend(None)ï¼Œæ­¤æ—¶æ‰§è¡Œåˆ°äº†finallyè¯­å¥å¹¶è§¦å‘StopIterationå¼‚å¸¸ï¼Œæµç¨‹ç»“æŸã€‚æ•´ä¸ªè¿‡ç¨‹å¯ä»¥è¿™æ ·è®¤ä¸º</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">contextmanager</span>(<span class="params">func</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">inner</span>(<span class="params">*args, **kwargs</span>):</span></span><br><span class="line">        g = func(*args,**kwargs)</span><br><span class="line">        <span class="class"><span class="keyword">class</span> <span class="title">w</span>():</span></span><br><span class="line">            <span class="function"><span class="keyword">def</span> <span class="title">__enter__</span>(<span class="params">self</span>):</span></span><br><span class="line">                g.send(<span class="literal">None</span>)</span><br><span class="line"></span><br><span class="line">            <span class="function"><span class="keyword">def</span> <span class="title">__exit__</span>(<span class="params">self, exc_type, exc_val, exc_tb</span>):</span></span><br><span class="line">                <span class="keyword">try</span>:</span><br><span class="line">                    g.send(<span class="literal">None</span>)</span><br><span class="line">                <span class="keyword">except</span> Exception:</span><br><span class="line">                    print(<span class="string">&quot;4&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> w()</span><br><span class="line">    <span class="keyword">return</span> inner</span><br><span class="line"></span><br><span class="line"><span class="meta">@contextmanager</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">log</span>():</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        print(<span class="string">&quot;1&quot;</span>)</span><br><span class="line">        <span class="keyword">yield</span></span><br><span class="line">        <span class="keyword">raise</span> Exception(<span class="string">&quot;E&quot;</span>)</span><br><span class="line">    <span class="keyword">finally</span>:</span><br><span class="line">        print(<span class="string">&quot;3&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> log():</span><br><span class="line">    print(<span class="string">&quot;2&quot;</span>)</span><br></pre></td></tr></table></figure>
<p>æ˜¯å¦è¿˜æ˜¯æ„Ÿè§‰ç›¸å¯¹æ¯”è¾ƒç®€å•å‘¢</p>
<h3 id="StackContextçš„å®ç°"><a href="#StackContextçš„å®ç°" class="headerlink" title="StackContextçš„å®ç°"></a>StackContextçš„å®ç°</h3><p>åœ¨èµ·å› éƒ¨åˆ†ï¼Œè§£é‡Šäº†callbackä¸­ä¼šå­˜åœ¨çš„é—®é¢˜(æœŸå¾…RequestHandler.geté‡Œé¢æ‰€æœ‰ç›¸å…³å†…å®¹å‘ç”Ÿé”™è¯¯éƒ½ä¼šå¯¼è‡´è¿”å›500é”™è¯¯ç»™å®¢æˆ·ç«¯)ã€‚1.0ç‰ˆæœ¬çš„è§£å†³æ–¹æ¡ˆå°±æ˜¯ç»™æ¯ä¸ªå›è°ƒå‡½æ•°å¥—ä¸Šä¸€ä¸ªè£…é¥°å™¨ã€‚è§¦å‘é”™è¯¯çš„æ—¶å€™å°±å¯ä»¥è¿”å›500äº†ï¼Œæ„Ÿè§‰ä¸å¤ªå¥½è®²è¿°è¿™æ®µå¤©æ‰èˆ¬çš„ä»£ç äº†ğŸ˜•</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> contextlib</span><br><span class="line"></span><br><span class="line">_state = ()</span><br><span class="line"></span><br><span class="line"><span class="meta">@contextlib.contextmanager</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">StackContext</span>(<span class="params">context_factory</span>):</span></span><br><span class="line">    <span class="keyword">global</span> _state</span><br><span class="line">    old_contexts = _state</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        _state = old_contexts + (context_factory,)</span><br><span class="line">        <span class="keyword">with</span> context_factory():</span><br><span class="line">            <span class="keyword">yield</span></span><br><span class="line">    <span class="keyword">finally</span>:</span><br><span class="line">        _state = old_contexts</span><br><span class="line"></span><br><span class="line"><span class="meta">@contextlib.contextmanager</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">ErrorCapture</span>():</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">yield</span></span><br><span class="line">    <span class="keyword">except</span> Exception:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> StackContext(ErrorCapture):</span><br><span class="line">    print(_state)</span><br><span class="line">    <span class="keyword">raise</span> Exception(<span class="string">&quot;Error&quot;</span>)</span><br><span class="line">print(_state)</span><br></pre></td></tr></table></figure>
<p>è¿™ä¸ªåœ°æ–¹StackContextæ˜¯ä¸€ä¸ªå·¥å‚æ¨¡å¼ï¼Œå®ƒä¼ å…¥çš„å‚æ•°context_factoryä¹Ÿæ˜¯ä¸€ä¸ªè¢«contextlib.contextmanagerè£…é¥°çš„å¯¹è±¡ã€‚åœ¨StackContextçš„å†…éƒ¨å®ƒåˆæ‰§è¡Œäº†withè¯­å¥æ¥åˆå§‹åŒ–æˆ‘ä»¬çš„context_factoryï¼Œemmm.è¿™ä¸ªå…¶å®å’Œå¤šå±‚åµŒå¥—è£…é¥°å™¨å¹¶æ²¡æœ‰å¤ªå¤§çš„åŒºåˆ«ï¼Œå®ƒå®ç°äº†ä»€ä¹ˆæ•ˆæœå‘¢ï¼Œåœ¨è°ƒç”¨with StackContext(context_factory)çš„æ—¶å€™å°†context_factoryåŠ å…¥åˆ°è€çš„é‡Œé¢ã€‚<span style="color:red"><strong>æ³¨æ„ï¼Œå½“å‰çš„context_factoryå’Œ1.0.0ç‰ˆæœ¬é‡Œé¢çš„async_callbackæ•ˆæœæ˜¯ä¸€æ ·æ ·çš„ï¼Œåœ¨withçš„è¯­å¥å—ä¸‹é¢ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨_stateå˜é‡ã€‚å½“è·³å‡ºwithä¹‹å_stateå°±è¢«æ¢å¤åˆ°åŸæ¥çš„æ ·å­</strong></span>ã€‚</p>
<p>é‚£ä¹ˆæˆ‘ä»¬è¯¥å¦‚ä½•ä½¿ç”¨è¿™ä¸ª_stateå˜é‡å‘¢ï¼Œæ³¨æ„åˆ°withè¯­å¥è¿›å…¥çš„æ—¶å€™ä¼šåŠ å…¥context_factoryï¼Œé€€å‡ºçš„æ—¶å€™ä¼šæ¸…é™¤ã€‚è¿™æ„å‘³ç€åœ¨withä¸‹é¢çš„ä»£ç å—é‡Œé¢æˆ‘ä»¬å¯ä»¥å®‰å…¨çš„ä½¿ç”¨å®ƒ</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">wrap</span>(<span class="params">fn</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">wrapped</span>(<span class="params">callback, contexts</span>):</span></span><br><span class="line">        <span class="keyword">with</span> contextlib.nested(*[i() <span class="keyword">for</span> i <span class="keyword">in</span> contexts]):</span><br><span class="line">            callback()</span><br><span class="line">    contexts = _state</span><br><span class="line">    result = functools.partial(wrapped, fn, contexts)</span><br><span class="line">    <span class="keyword">return</span> result</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œï¼Œæˆ‘ä»¬æ·»åŠ ä¸€ä¸ªè£…é¥°å™¨ã€‚åœ¨IOLoopä¸­æ‰€æœ‰éœ€è¦æ·»åŠ å›è°ƒçš„åœ°æ–¹å‡ç”±wrapåŒ…è£…èµ·æ¥</p>
<pre><code>     def add_callback(self, callback):
         &quot;&quot;&quot;Calls the given callback on the next I/O loop iteration.&quot;&quot;&quot;
-        self._callbacks.add(callback)
+        self._callbacks.add(stack_context.wrap(callback))
         self._wake()
</code></pre>
<p>é‚£ä¹ˆï¼Œåœ¨å®ƒè¢«è°ƒç”¨çš„æ—¶å€™å®é™…æ‰§è¡Œçš„æ˜¯wrappedå‡½æ•°ï¼Œå®ƒä¼šå…ˆè°ƒç”¨with contextlib.nested(*[i() for i in contexts]).æ­¤æ­¥éª¤æ¢å¤äº†with StackContextæ—¶æœŸåŠ å…¥çš„å¯¹è±¡(å³äººä»¬å¸¸è¯´çš„ä¸Šä¸‹æ–‡)ã€‚å¯¹äºå¼‚å¸¸æ•è·æ¥è¯´ï¼Œå°±æ˜¯èƒ½å¤Ÿæ­£ç¡®çš„æ•è·callbackçš„å¼‚å¸¸å¹¶ä¸”è¿”å›500ç»™å®¢æˆ·ç«¯ã€‚å¦å¤–ï¼Œæœ€å¼€å§‹çš„æ—¶å€™æ•è·RequestHandle.getçš„å¼‚å¸¸æ˜¯åœ¨_executeå¥—ä¸Štryâ€¦except,å°†ä»–å˜åŠ¨ä¸ºwith StackContextå°±å¥½äº†ã€‚è¿™é‡Œåº”è¯¥è°¨è®°ä¸‹é¢ä¸¤ç‚¹</p>
<ul>
<li>Tornadoçš„è¿è¡Œæ˜¯å•çº¿ç¨‹çš„,with StackContextè¿è¡Œçš„è¿‡ç¨‹ä¸­ä¸å¯èƒ½å­˜åœ¨åˆ«çš„æ­¥éª¤å¦å¤–å»æ”¹å˜äº†_stateçš„å€¼(è¿™ä¸ªå€¼å¾ˆé‡è¦)</li>
<li> StackContextæ˜¯å¯ä»¥è¿›è¡ŒåµŒå¥—çš„</li>
</ul>
<h3 id="æ”¹è¿›"><a href="#æ”¹è¿›" class="headerlink" title="æ”¹è¿›"></a>æ”¹è¿›</h3><p>å½“ç„¶ä»¥ä¸Šåªæ˜¯ä¸ºäº†è¡¨è¿°åŸç†è®²è§£çš„æœ€ç®€ä»£ç ï¼Œå®é™…ä¸Šæºç ä¸­ç•¥æœ‰ä¸åŒã€‚é¦–å…ˆè€ƒè™‘å¤šçº¿ç¨‹çš„æƒ…å†µï¼Œåœ¨å•çº¿ç¨‹ä¸­_stateçš„æ”¹åŠ¨æ˜¯å¾ˆæ˜¾ç„¶çš„ï¼Œæ‰§è¡Œ<code>with StackContext</code>å³å…è®¸æ”¹åŠ¨ã€‚åœ¨å¤šçº¿ç¨‹ä¸­å°±ä¸å¤ªä¸€æ ·äº†ã€‚å¤šçº¿ç¨‹ä¸­å¦‚æœä¹Ÿæ‰§è¡Œäº†<code>with StackContext</code>æ“ä½œï¼Œé‚£ä¹ˆæœ‰å¯èƒ½é€ æˆ_stateè¢«æ”¹åŠ¨ã€‚å› æ­¤ï¼Œ_stateè¢«ç»§æ‰¿è‡ªthread.localå¯¹è±¡ã€‚é‚£ä¹ˆä¸åŒçº¿ç¨‹å†…çš„ä¿®æ”¹æ˜¯äº’ç›¸ç‹¬ç«‹çš„<br>å…¶æ¬¡å¦‚æœä¸€ä¸ªå‡½æ•°å·²ç»è¢«wrappedåŒ…è£…ï¼Œé‚£ä¹ˆå°±ä¸å¿…è¦å†æ¬¡è¿›è¡ŒåŒ…è£…äº†(æƒ³è±¡ä¸€ä¸‹é€’å½’è°ƒç”¨add_callback)ã€‚å¯¹äºä¸å­˜åœ¨çš„<code>with StackContext</code>ä¹Ÿéœ€è¦è€ƒè™‘ï¼Œå¦‚æœæ‰§è¡Œcontextlib.nestedçš„å‚æ•°ä¸ºç©ºï¼Œæ— ç–‘æ˜¯ä¼šæŠ¥é”™çš„ã€‚<br>å…¶ä»–æœ‰çš„ç‹¬ç«‹çš„è¿è¡Œçš„æ¨¡å—ä¸å¸Œæœ›è¢«å·²å­˜åœ¨çš„_stateå½±å“ï¼Œå› æ­¤ç‹¬ç«‹è®¾ç½®äº†NullContext</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@contextlib.contextmanager</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">NullContext</span>():</span></span><br><span class="line">    old_contexts = _state.contexts</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        _state.contexts = ()</span><br><span class="line">        <span class="keyword">yield</span></span><br><span class="line">    <span class="keyword">finally</span>:</span><br><span class="line">        _state.contexts = old_contexts</span><br></pre></td></tr></table></figure>
<p>å¦‚æœä¸å¸Œæœ›è¢«_stateå¹²æ‰°ï¼Œé‚£ä¹ˆåœ¨å‰é¢åŠ ä¸Š<code>with StackContext(NullContext)</code>ã€‚_stateå³è¢«ç½®ä¸ºç©ºã€‚æ˜¾ç„¶add_callbackä¼ å…¥çš„contextsä¸ºç©ºã€‚åœ¨å®ƒè¢«æ‰§è¡Œçš„æ—¶å€™ï¼Œä¹Ÿå’Œwithè¯­å¥æ²¡ä»€ä¹ˆäº‹æƒ…äº†</p>
<h3 id="åº”ç”¨"><a href="#åº”ç”¨" class="headerlink" title="åº”ç”¨"></a>åº”ç”¨</h3><p>æˆ‘æœ€å¼€å§‹çœ‹åˆ°çš„åº”ç”¨æ˜¯è¿™ä¸ª,<a href="https://gist.github.com/Hackforid/7130a5d59463186e217e">åœ¨Tornadoé‡Œé¢ä½¿ç”¨Sqlalchemy</a>ã€‚é»˜è®¤Sqlalchemyå­˜åœ¨sessionmakerä¸€ä¸ªå·¥å‚å‡½æ•°ï¼Œå®ƒä¼šç¡®å®šå¦‚ä½•ç”Ÿæˆä¸€ä¸ªsessionä¼šè¯å¯¹è±¡ä»¥ä¾›ä½¿ç”¨ã€‚é»˜è®¤çš„æƒ…å†µæ˜¯ä½¿ç”¨çº¿ç¨‹idï¼Œè¿™å¯¹äºå¤šçº¿ç¨‹ç¯å¢ƒéå¸¸éå¸¸æ–¹ä¾¿ã€‚å› ä¸ºå¤šçº¿ç¨‹webæ¡†æ¶ä¸­æ¯ä¸€ä¸ªHTTPè¯·æ±‚çš„å¤„ç†éƒ½æ˜¯åœ¨ç‹¬ç«‹çš„çº¿ç¨‹å†…è¿›è¡Œçš„ï¼Œé‚£ä¹ˆä¸€ä¸ªhttpå¤„ç†ç”Ÿå‘½å‘¨æœŸå¯¹åº”ä¸€ä¸ªsqlalchemyçš„sessionç”Ÿå‘½å‘¨æœŸéå¸¸å®Œç¾ã€‚<br>å¯æ˜¯åœ¨Tornadoè¿™ç§å•çº¿ç¨‹çš„æ¡†æ¶ä¸­å‘ç”Ÿäº†å˜åŒ–ï¼Œå› ä¸ºå®ƒä¸å¥½ç¡®å®šæ¯ä¸€ä¸ªhttpçš„ç”Ÿå‘½å‘¨æœŸæ ‡è¯†ã€‚StackContextç»™äº†æˆ‘ä»¬æ–¹æ³•ï¼Œè™½ç„¶èµ·å› æ˜¯callbackçš„å¼‚å¸¸å¤„ç†ï¼Œå¯æ˜¯æˆ‘ä»¬ä¸€æ ·å¯ä»¥å‚ç…§å®ƒçš„å¥—è·¯ï¼Œåœ¨_executeæ‰§è¡ŒæœŸé—´å†™å…¥å˜é‡ï¼Œåœ¨å•ä¸ªhttpç”Ÿå‘½å‘¨æœŸå‡å¯ä»¥è®¿é—®å˜é‡ï¼Œhttpå®Œç»“åæ¸…é™¤å®ƒã€‚ä»£ç å¯ä»¥å‚è€ƒç»™å‡ºçš„gisté“¾æ¥</p>
<h3 id="ç”¨ä¾‹"><a href="#ç”¨ä¾‹" class="headerlink" title="ç”¨ä¾‹"></a>ç”¨ä¾‹</h3><p>ä¸‹é¢ç»™ä¸€ä¸ªæ•´ç¯‡æ–‡ç« çš„ä»£ç æ€»ç»“</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    <span class="keyword">from</span> contextlib <span class="keyword">import</span> nested</span><br><span class="line"><span class="keyword">except</span> ImportError:</span><br><span class="line">    <span class="keyword">from</span> contextlib <span class="keyword">import</span> ExitStack, contextmanager</span><br><span class="line"></span><br><span class="line"><span class="meta">    @contextmanager</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">nested</span>(<span class="params">*contexts</span>):</span></span><br><span class="line">        <span class="keyword">with</span> ExitStack() <span class="keyword">as</span> stack:</span><br><span class="line">            <span class="keyword">for</span> ctx <span class="keyword">in</span> contexts:</span><br><span class="line">                stack.enter_context(ctx)</span><br><span class="line">            <span class="keyword">yield</span> contexts</span><br><span class="line"><span class="keyword">import</span> functools</span><br><span class="line"></span><br><span class="line"><span class="meta">@contextmanager</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">StackContext</span>(<span class="params">context_factory</span>):</span></span><br><span class="line">    <span class="keyword">global</span> _state</span><br><span class="line">    old_contexts = _state</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        _state = old_contexts + (context_factory,)</span><br><span class="line">        <span class="keyword">with</span> context_factory():</span><br><span class="line">            <span class="keyword">yield</span></span><br><span class="line">    <span class="keyword">finally</span>:</span><br><span class="line">        _state = old_contexts</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@contextmanager</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">ErrorCapture</span>():</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">yield</span></span><br><span class="line">    <span class="keyword">except</span> Exception:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">_state = ()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">wrap</span>(<span class="params">fn</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">wrapped</span>(<span class="params">callback, contexts</span>):</span></span><br><span class="line">        <span class="keyword">with</span> nested(*[i() <span class="keyword">for</span> i <span class="keyword">in</span> contexts]):</span><br><span class="line">            callback()</span><br><span class="line"></span><br><span class="line">    contexts = _state</span><br><span class="line">    result = functools.partial(wrapped, fn, contexts)</span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">loop_list = []</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">call_back</span>():</span></span><br><span class="line">    print(<span class="string">&quot;WTF&quot;</span>)</span><br><span class="line">    print(get_current_request_id())</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">g = &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@contextmanager</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">ThreadRequestContext</span>(<span class="params">**data</span>):</span></span><br><span class="line">    <span class="keyword">global</span> g</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        g = data</span><br><span class="line">        <span class="keyword">yield</span></span><br><span class="line">    <span class="keyword">finally</span>:</span><br><span class="line">        g.clear()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_current_request_id</span>():</span></span><br><span class="line">    <span class="keyword">return</span> g[<span class="string">&#x27;request_id&#x27;</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">global_data = &#123;<span class="string">&quot;request_id&quot;</span>: <span class="number">12</span>&#125;</span><br><span class="line"><span class="keyword">with</span> StackContext(functools.partial(ThreadRequestContext, **global_data)):</span><br><span class="line">    <span class="keyword">with</span> StackContext(ErrorCapture):</span><br><span class="line">        loop_list.append(wrap(call_back))</span><br><span class="line">        print(get_current_request_id())</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> loop_list:</span><br><span class="line">    i()</span><br></pre></td></tr></table></figure>


            


        </div>
    </div>
    <div id="post-footer" class="post-footer main-content-wrap">
        
        
            <div class="post-actions-wrap">
    <nav>
        <ul class="post-actions post-action-nav">
            <li class="post-action">
                
                    
                <a
                    class="post-action-btn btn btn--default tooltip--top"
                    href="/2018/03/17/tornado_gen_engine/"
                    data-tooltip="Tornado ä¹‹gen.engine"
                    aria-label="ä¸Šä¸€ç¯‡: Tornado ä¹‹gen.engine"
                >
                    
                        <i class="fa fa-angle-left" aria-hidden="true"></i>
                        <span class="hide-xs hide-sm text-small icon-ml">ä¸Šä¸€ç¯‡</span>
                    </a>
            </li>
            <li class="post-action">
                
                    
                <a
                    class="post-action-btn btn btn--default tooltip--top"
                    href="/2018/03/16/tornado_wsgi/"
                    data-tooltip="Tornado ä¹‹WSGI"
                    aria-label="ä¸‹ä¸€ç¯‡: Tornado ä¹‹WSGI"
                >
                    
                        <span class="hide-xs hide-sm text-small icon-mr">ä¸‹ä¸€ç¯‡</span>
                        <i class="fa fa-angle-right" aria-hidden="true"></i>
                    </a>
            </li>
        </ul>
    </nav>
    <ul class="post-actions post-action-share">
        <li class="post-action hide-lg hide-md hide-sm">
            <a
                class="post-action-btn btn btn--default btn-open-shareoptions"
                href="#btn-open-shareoptions"
                aria-label="Diesen Beitrag teilen"
            >
                <i class="fa fa-share-alt" aria-hidden="true"></i>
            </a>
        </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://www.zoulei.net/2018/03/16/Tornado_StackContext/"
                    title="åˆ†äº«åˆ° Facebook"
                    aria-label="åˆ†äº«åˆ° Facebook"
                >
                    <i class="fab fa-facebook" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://twitter.com/intent/tweet?text=https://www.zoulei.net/2018/03/16/Tornado_StackContext/"
                    title="åˆ†äº«åˆ° Twitter"
                    aria-label="åˆ†äº«åˆ° Twitter"
                >
                    <i class="fab fa-twitter" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://plus.google.com/share?url=https://www.zoulei.net/2018/03/16/Tornado_StackContext/"
                    title="åˆ†äº«åˆ° Google+"
                    aria-label="åˆ†äº«åˆ° Google+"
                >
                    <i class="fab fa-google-plus" aria-hidden="true"></i>
                </a>
            </li>
        
        
            
        
        <li class="post-action">
            
                <a class="post-action-btn btn btn--default" href="#" aria-label="Nach oben">
            
                <i class="fa fa-list" aria-hidden="true"></i>
            </a>
        </li>
    </ul>
</div>


        
        
            
        
    </div>
</article>



                <footer id="footer" class="main-content-wrap">
    <span class="copyrights">
        Copyrights &copy; 2021 ficapy. <a href="https://beian.miit.gov.cn/">ç²¤ICPå¤‡17077609å·</a>All Rights Reserved.
    </span>
</footer>

            </div>
            
                <div id="bottom-bar" class="post-bottom-bar" data-behavior="4">
                    <div class="post-actions-wrap">
    <nav>
        <ul class="post-actions post-action-nav">
            <li class="post-action">
                
                    
                <a
                    class="post-action-btn btn btn--default tooltip--top"
                    href="/2018/03/17/tornado_gen_engine/"
                    data-tooltip="Tornado ä¹‹gen.engine"
                    aria-label="ä¸Šä¸€ç¯‡: Tornado ä¹‹gen.engine"
                >
                    
                        <i class="fa fa-angle-left" aria-hidden="true"></i>
                        <span class="hide-xs hide-sm text-small icon-ml">ä¸Šä¸€ç¯‡</span>
                    </a>
            </li>
            <li class="post-action">
                
                    
                <a
                    class="post-action-btn btn btn--default tooltip--top"
                    href="/2018/03/16/tornado_wsgi/"
                    data-tooltip="Tornado ä¹‹WSGI"
                    aria-label="ä¸‹ä¸€ç¯‡: Tornado ä¹‹WSGI"
                >
                    
                        <span class="hide-xs hide-sm text-small icon-mr">ä¸‹ä¸€ç¯‡</span>
                        <i class="fa fa-angle-right" aria-hidden="true"></i>
                    </a>
            </li>
        </ul>
    </nav>
    <ul class="post-actions post-action-share">
        <li class="post-action hide-lg hide-md hide-sm">
            <a
                class="post-action-btn btn btn--default btn-open-shareoptions"
                href="#btn-open-shareoptions"
                aria-label="Diesen Beitrag teilen"
            >
                <i class="fa fa-share-alt" aria-hidden="true"></i>
            </a>
        </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://www.zoulei.net/2018/03/16/Tornado_StackContext/"
                    title="åˆ†äº«åˆ° Facebook"
                    aria-label="åˆ†äº«åˆ° Facebook"
                >
                    <i class="fab fa-facebook" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://twitter.com/intent/tweet?text=https://www.zoulei.net/2018/03/16/Tornado_StackContext/"
                    title="åˆ†äº«åˆ° Twitter"
                    aria-label="åˆ†äº«åˆ° Twitter"
                >
                    <i class="fab fa-twitter" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://plus.google.com/share?url=https://www.zoulei.net/2018/03/16/Tornado_StackContext/"
                    title="åˆ†äº«åˆ° Google+"
                    aria-label="åˆ†äº«åˆ° Google+"
                >
                    <i class="fab fa-google-plus" aria-hidden="true"></i>
                </a>
            </li>
        
        
            
        
        <li class="post-action">
            
                <a class="post-action-btn btn btn--default" href="#" aria-label="Nach oben">
            
                <i class="fa fa-list" aria-hidden="true"></i>
            </a>
        </li>
    </ul>
</div>


                </div>
                
    <div id="share-options-bar" class="share-options-bar" data-behavior="4">
        <i id="btn-close-shareoptions" class="fa fa-times"></i>
        <ul class="share-options">
            
                
                
                <li class="share-option">
                    <a
                        class="share-option-btn"
                        target="new"
                        href="https://www.facebook.com/sharer/sharer.php?u=https://www.zoulei.net/2018/03/16/Tornado_StackContext/"
                        aria-label="åˆ†äº«åˆ° Facebook"
                    >
                        <i class="fab fa-facebook" aria-hidden="true"></i><span>åˆ†äº«åˆ° Facebook</span>
                    </a>
                </li>
            
                
                
                <li class="share-option">
                    <a
                        class="share-option-btn"
                        target="new"
                        href="https://twitter.com/intent/tweet?text=https://www.zoulei.net/2018/03/16/Tornado_StackContext/"
                        aria-label="åˆ†äº«åˆ° Twitter"
                    >
                        <i class="fab fa-twitter" aria-hidden="true"></i><span>åˆ†äº«åˆ° Twitter</span>
                    </a>
                </li>
            
                
                
                <li class="share-option">
                    <a
                        class="share-option-btn"
                        target="new"
                        href="https://plus.google.com/share?url=https://www.zoulei.net/2018/03/16/Tornado_StackContext/"
                        aria-label="åˆ†äº«åˆ° Google+"
                    >
                        <i class="fab fa-google-plus" aria-hidden="true"></i><span>åˆ†äº«åˆ° Google+</span>
                    </a>
                </li>
            
        </ul>
    </div>


            
        </div>
        


<div id="about">
    <div id="about-card">
        <div id="about-btn-close">
            <i class="fa fa-times"></i>
        </div>
        
            <h4 id="about-card-name">ficapy</h4>
        
            <div id="about-card-bio"><p>author.bio</p>
</div>
        
        
            <div id="about-card-job">
                <i class="fa fa-briefcase"></i>
                <br/>
                <p>author.job</p>

            </div>
        
        
            <div id="about-card-location">
                <i class="fa fa-map-marker-alt"></i>
                <br/>
                æ·±åœ³
            </div>
        
    </div>
</div>

        
            <div id="algolia-search-modal" class="modal-container">
    <div class="modal">
        <div class="modal-header">
            <span class="close-button"><i class="fa fa-times"></i></span>
            <a href="https://algolia.com" target="_blank" rel="noopener" class="searchby-algolia text-color-light link-unstyled">
                <span class="searchby-algolia-text text-color-light text-small">by</span>
                <img class="searchby-algolia-logo" src="/assets/images/logo-algolia-nebula-blue-full.svg">
            </a>
            <i class="search-icon fa fa-search"></i>
            <form id="algolia-search-form">
                <input type="text" id="algolia-search-input" name="search"
                    class="form-control input--large search-input" placeholder="Search "
                    />
            </form>
        </div>
        <div class="modal-body">
            <div class="no-result text-color-light text-center">æ²¡æœ‰æ‰¾åˆ°æ–‡ç« </div>
            <div class="results">
                
                <div class="media">
                    
                    <div class="media-body">
                        <a
                            class="link-unstyled"
                            href="https://www.zoulei.net/2013/09/29/hello_world/"
                            aria-label=": åšå®¢èµ·èˆª"
                        >
                            <h3 class="media-heading">åšå®¢èµ·èˆª</h3>
                        </a>
                        <span class="media-meta">
                            <span class="media-date text-small">
                                
                                    2013å¹´9æœˆ29æ—¥
                                
                            </span>
                        </span>
                        <div class="media-content hide-xs font-merryweather"><p>ä¸çŸ¥é“ä»æŸå¹´æŸæœˆèµ·ï¼Œæˆ‘æ¥è§¦äº†ç”µè„‘ï¼Œæ¥è§¦äº†ç½‘ç»œï¼Œæ·±æ·±çš„ä¸ºå®ƒç€è¿·~~~~~~</p>
<p>ï¼š</p>
<p>ä¸ºäº†å è¡Œæ­¤å¤„æ— è€»çš„æ è¿‡Nä¸ªå­—</p>
<p>:</p></div>
                    </div>
                    <div style="clear:both;"></div>
                    <hr>
                </div>
                
                <div class="media">
                    
                    <div class="media-body">
                        <a
                            class="link-unstyled"
                            href="https://www.zoulei.net/2013/09/30/idm-internet-download-manager/"
                            aria-label=": IDM-Internet Download Manager"
                        >
                            <h3 class="media-heading">IDM-Internet Download Manager</h3>
                        </a>
                        <span class="media-meta">
                            <span class="media-date text-small">
                                
                                    2013å¹´9æœˆ30æ—¥
                                
                            </span>
                        </span>
                        <div class="media-content hide-xs font-merryweather"><p>åˆ›å»ºä¸€ä¸ªæ–°ç›®å½•ï¼Œå–„ç”¨ä½³è½¯</p>
<p>åå­—æ²¡ä»€ä¹ˆæ–°æ„ï¼Œå› ä¸ºæœ‰ä¸ªæ¨èå¥½è½¯ä»¶çš„åå­—å°±æ˜¯å–„ç”¨ä½³è½¯:<a href="http://xbeta.info/">http://xbeta.info/</a>ï¼Œæˆ‘ä¹Ÿåœ¨ä¸Šé¢æ‰¾åˆ°è¿‡å‡ ä¸ªé€‚åˆè‡ªå·±çš„å¥½è½¯ä»¶ã€‚å¥½è½¯ä»¶ä½•å…¶å¤šï¼Œæ‰¾åˆ°é€‚åˆè‡ªå·±çš„å¹¶ä¸é‚£ä¹ˆå®¹æ˜“ï¼Œè£…äº†å¸ï¼Œå¸äº†è£…ï¼Œååå¤å¤ã€å¤§æµªæ·˜æ²™ï¼Œæœ€åç•™ä¸‹çš„æˆ‘è®¤ä¸ºå°±æ˜¯å¯¹è‡ªå·±å‹å¥½çš„ã€æœ‰ä»·å€¼çš„å¥½è½¯ä»¶ã€‚ä½œä¸ºä¸€ä¸ªåšå®¢ï¼Œæˆ‘ä¼šæ¨èæˆ‘è‡ªå·±ä¸€ç›´ç”¨çš„ï¼Œæ„Ÿè§‰å¾ˆä¸é”™çš„è½¯ä»¶åˆ†äº«ç»™å¤§å®¶ã€‚</p></div>
                    </div>
                    <div style="clear:both;"></div>
                    <hr>
                </div>
                
                <div class="media">
                    
                    <div class="media-body">
                        <a
                            class="link-unstyled"
                            href="https://www.zoulei.net/2013/10/02/everything_magical_file_search_software/"
                            aria-label=": everything--æ–‡ä»¶æœç´¢ç¥å™¨"
                        >
                            <h3 class="media-heading">everything--æ–‡ä»¶æœç´¢ç¥å™¨</h3>
                        </a>
                        <span class="media-meta">
                            <span class="media-date text-small">
                                
                                    2013å¹´10æœˆ2æ—¥
                                
                            </span>
                        </span>
                        <div class="media-content hide-xs font-merryweather"><p><img src="https://blogimg.ficapy.com/blogimg/everything.jpg" alt="everything"></p>
<p>å®˜æ–¹ç½‘ç«™:<a href="http://www.voidtools.com/">www.voidtools.com</a></p>
<p>ç®—æ˜¯ä¸€æ¬¾ç‰›Båˆ°çˆ†ï¼Œå¦‚æœä½ æ˜¯å°ç™½ç¬¬ä¸€æ¬¡ç”¨ç±»ä¼¼çš„è½¯ä»¶ï¼Œç»å¯¹ä¼šäº§ç”Ÿä¸€ç§æƒ³è§æ¨æ™šçš„æ„Ÿè§‰ã€‚å¯¹æ¯”windowsè‡ªå¸¦çš„æœç´¢ï¼Œeverythingå‡ ç§’é’Ÿå®Œæˆç´¢å¼•ï¼Œç¬é—´æœç´¢å®Œæˆã€‚å†æ ¹æ®æ–‡ä»¶ä¿®æ”¹æ—¥æœŸæˆ–è€…è·¯å¾„å°±èƒ½ç¬é—´æ‰¾åˆ°æƒ³è¦çš„æ–‡ä»¶ã€‚æœ‰äººç”¨äº†è¿™ä¸ªè½¯ä»¶ä¹‹åæˆç§°å¹³æ—¶çƒ­è¡·æ–‡ä»¶ç®¡ç†çš„äººè‡ªä»ç”¨äº†å®ƒæ–‡ä»¶éƒ½æ˜¯éšå¤„ä¹±æ”¾ï¼Œåæ­£æ ¹æ®æ–‡ä»¶åé©¬ä¸Šå°±èƒ½æ‰¾åˆ°ã€‚å‘µå‘µï¼Œè™½ç„¶æ˜¯ä¸ªç¬‘è¯ï¼ˆä¸ªäººè®¤ä¸ºæœ‰æ¡ç†çš„æ•´ç†æ–‡ä»¶è¿˜æ˜¯å¾ˆæœ‰é“ç†çš„ï¼Œæ¯”å¦‚è¦è°ƒå‡ºæŸä¸ªæœˆå’ŒæŸä¸ªäººçš„æ‰€æœ‰æ–‡ä»¶å¾€æ¥ï¼Œéšä¾¿æ”¾ä½ å°±åªèƒ½å‘µå‘µäº†ï¼‰ï¼Œä½†æ˜¯å®ƒç»™æˆ‘ä»¬æœç´¢æ–‡æ¡£å¸¦æ¥çš„ä¾¿åˆ©æ€§å¯è§ä¸€æ–‘ã€‚åŠå…¬æ—å¿…å¤‡ï¼</p></div>
                    </div>
                    <div style="clear:both;"></div>
                    <hr>
                </div>
                
                <div class="media">
                    
                    <div class="media-body">
                        <a
                            class="link-unstyled"
                            href="https://www.zoulei.net/2013/10/06/everything_tutorial/"
                            aria-label=": everythingè¿›é˜¶æ•™ç¨‹"
                        >
                            <h3 class="media-heading">everythingè¿›é˜¶æ•™ç¨‹</h3>
                        </a>
                        <span class="media-meta">
                            <span class="media-date text-small">
                                
                                    2013å¹´10æœˆ6æ—¥
                                
                            </span>
                        </span>
                        <div class="media-content hide-xs font-merryweather"><p>ä½ æ˜¯å¦åªä¼šåœ¨everythingçš„æœç´¢æ é‡Œé¢è¾“å…¥å‡ ä¸ªå…³é”®å­—ï¼Œä¹‹åç‚¹å‡»æ–‡ä»¶å¤§å°æˆ–è€…æ›´æ–°æ—¶é—´æ’åˆ—è¿›è¡Œç­›é€‰æ‰¾åˆ°ç›®æ ‡ã€‚æˆ‘ä¸€å¼€å§‹ä¹Ÿæ˜¯è¿™æ ·è¿›è¡Œæ“ä½œçš„ï¼Œéœ€æ±‚ä¸é«˜çš„æ—¶å€™å€ŸåŠ©å®ƒçš„é«˜é€Ÿæœç´¢æ˜¯å®Œå…¨æ²¡é—®é¢˜çš„ã€‚</p></div>
                    </div>
                    <div style="clear:both;"></div>
                    <hr>
                </div>
                
                <div class="media">
                    
                    <div class="media-body">
                        <a
                            class="link-unstyled"
                            href="https://www.zoulei.net/2013/10/12/cputure_image_and_convert_software/"
                            aria-label=": Snagit-æˆªå›¾å…¼å›¾ç‰‡è½¬æ¢è½¯ä»¶"
                        >
                            <h3 class="media-heading">Snagit-æˆªå›¾å…¼å›¾ç‰‡è½¬æ¢è½¯ä»¶</h3>
                        </a>
                        <span class="media-meta">
                            <span class="media-date text-small">
                                
                                    2013å¹´10æœˆ12æ—¥
                                
                            </span>
                        </span>
                        <div class="media-content hide-xs font-merryweather"><p>å¥½å‡ å¤©æ²¡å†™æ–‡ç« äº†ï¼Œä¸æ˜¯å› ä¸ºä¸æƒ³å†™ï¼Œåªæ˜¯è¢«ä¸€äº›å°é—®é¢˜æŠ˜è…¾çš„å¤ªè›‹ç–¼äº†ï¼Œå…±äº«æ‰«æä»ªã€VBAã€wordpressæ’ç‰ˆã€å…±äº«Xå¢™äº‘äº‘ï¼Œä¸€ä¸€è§£å†³åæœ‰å…´è¶£æˆ‘ä¼šå‘ä¸Šæ¥~~~~</p>
<p>ä»Šå¤©ä»‹ç»çš„æ˜¯ä¸€æ¬¾æ®è¯´ä¸»æ‰“æˆªå›¾çš„è½¯ä»¶-snagit</p>
<p><img src="https://blogimg.ficapy.com/blogimg/snagit.png" alt="snagit">Â å®˜æ–¹ç½‘ç«™ï¼š<a href="http://www.techsmith.com/">http://www.techsmith.com/</a></p>
<p>ä¸»ç•Œé¢å¯ä»¥çœ‹åˆ°åŠŸèƒ½å…¨éƒ¨å’Œæˆªå›¾ä¹‹åçš„å¤„ç†æœ‰å…³ï¼Œæ·»åŠ æ–‡å­—ã€æ·»åŠ å„ç§æ•ˆæœç­‰ç­‰ï¼Œç”¨å›¾å±‚ç®¡ç†ç”¨èµ·æ¥ä¸é”™ï¼Œè€Œä¸”ç›®æµ‹å¾ˆå¼ºè°ƒåˆ†äº«åŠŸèƒ½ï¼Œæˆªå›¾æ’å…¥åˆ°officeã€é‚®ä»¶ã€camtasia<br>studioç”šè‡³æ˜¯youtubeç­‰ç­‰ã€‚ä½¿ç”¨èµ·æ¥éå¸¸å®¹æ˜“ä¸Šæ‰‹ã€‚æ­¤åŠŸèƒ½ç•¥è¿‡~~~~</p></div>
                    </div>
                    <div style="clear:both;"></div>
                    <hr>
                </div>
                
                <div class="media">
                    
                    <div class="media-body">
                        <a
                            class="link-unstyled"
                            href="https://www.zoulei.net/2013/10/25/xnview_image_view/"
                            aria-label=": xnview-å›¾ç‰‡æŸ¥çœ‹"
                        >
                            <h3 class="media-heading">xnview-å›¾ç‰‡æŸ¥çœ‹</h3>
                        </a>
                        <span class="media-meta">
                            <span class="media-date text-small">
                                
                                    2013å¹´10æœˆ25æ—¥
                                
                            </span>
                        </span>
                        <div class="media-content hide-xs font-merryweather"><p><img src="https://blogimg.ficapy.com/blogimg/xnview.jpg" alt="xnview"></p>
<p>å®˜ç½‘åœ°å€ï¼š<a href="http://www.xnview.com/">http://www.xnview.com</a></p>
<p>XnViewç‚ºä¸€åœ–ç‰‡ç€è¦½ã€è½‰æ›ã€ç·¨è¼¯çš„å¤šå¹³å°è»Ÿé«”ï¼Œå¯æ”¹è®Šå…¶ä»‹é¢èªè¨€ï¼Œäº¦å¯æ˜“å…¶å·¥å…·æ æŒ‰éˆ•è‡³æŸä¸€ç¨‹åº¦ï¼Œæˆ–ä»¥æ›é¢æ¿æ–¹å¼æ˜“å·¥å…·åˆ—æŒ‰éˆ•ã€‚ä¸¦æ”¯æ´è®€å–è¶…é400ç¨®çš„åœ–æª”æ ¼å¼åŠéƒ¨ä»½éŸ³é¢‘æ–‡ä»¶æ ¼å¼åŠè§†é¢‘æ–‡ä»¶æ ¼å¼ï¼Œäº¦æ”¯æ´å¯«å…¥75ç¨®åœ–ç‰‡æ ¼å¼ã€‚æä¾›å…è²»çš„å€‹äººä½¿ç”¨åŠç°¡æ˜“æ“ä½œã€‚å¯å°‡å£“ç¸®æª”ä»¥è³‡æ–™å¤¾æ–¹å¼é–‹å•Ÿã€ä¾EXIFåŠIPTCä½œåœ–ç‰‡æœå°‹ã€åœ–ç‰‡ç›¸ä¼¼æ¯”å°ã€å°åœ–ç‰‡ä½œæ‰¹æ¬¡å‘½åã€æ ¼å¼è½‰æ›åŠå¥—ç”¨å½±åƒèª¿æ•´ï¼Œä¸¦æ”¯æ´ç„¡æè€—æ—‹è½‰ã€‚é¡ä¼¼åŠŸèƒ½ä¹‹è»Ÿé«”æœ‰ACDSeeã€‚â€”â€“æ‘˜è‡ª<a href="http://zh.wikipedia.org/wiki/XnView">ç»´åŸºç™¾ç§‘</a></p></div>
                    </div>
                    <div style="clear:both;"></div>
                    <hr>
                </div>
                
                <div class="media">
                    
                    <div class="media-body">
                        <a
                            class="link-unstyled"
                            href="https://www.zoulei.net/2013/11/05/deskpins_top_window/"
                            aria-label=": DeskPins-çª—å£ç½®é¡¶"
                        >
                            <h3 class="media-heading">DeskPins-çª—å£ç½®é¡¶</h3>
                        </a>
                        <span class="media-meta">
                            <span class="media-date text-small">
                                
                                    2013å¹´11æœˆ5æ—¥
                                
                            </span>
                        </span>
                        <div class="media-content hide-xs font-merryweather"></div>
                    </div>
                    <div style="clear:both;"></div>
                    <hr>
                </div>
                
                <div class="media">
                    
                    <div class="media-body">
                        <a
                            class="link-unstyled"
                            href="https://www.zoulei.net/2013/11/28/disktool_recommend/"
                            aria-label=": å‚²æ¢…åˆ†åŒºåŠ©æ‰‹--å‚»ç“œåŒ–åˆ†åŒºè½¯ä»¶"
                        >
                            <h3 class="media-heading">å‚²æ¢…åˆ†åŒºåŠ©æ‰‹--å‚»ç“œåŒ–åˆ†åŒºè½¯ä»¶</h3>
                        </a>
                        <span class="media-meta">
                            <span class="media-date text-small">
                                
                                    2013å¹´11æœˆ28æ—¥
                                
                            </span>
                        </span>
                        <div class="media-content hide-xs font-merryweather"><p>å¾ˆä¹…æ²¡æ›´æ–°åšå®¢äº†ï¼Œä¸èƒ½æŠŠå®ƒå½“åšä¸€ä»½å·¥ä½œï¼Œå½“åšçˆ±å¥½è¿˜å¾—é è‡ªå·±çš„çƒ­æƒ…æ›´æ–°~~~~~~å¯¼è‡´çš„ç»“æœå°±æ˜¯å¦‚æ­¤å§ï¼Œç¨å¾®å¿™é‚£ä¹ˆä¸€ç‚¹ç‚¹å°±æ‡’å¾—æ›´æ–°åšå®¢äº†ã€‚æœ€è¿‘å¼€å§‹è‡ªå­¦æˆ‘å¾ˆä¹…å‰å°±æƒ³è¸å…¥ä½†æ˜¯æ—¶è‡³ä»Šæ—¥æ‰çœŸæ­£è¸å…¥çš„é¢†åŸŸ~~~ç¼–ç¨‹ï¼Œå­¦ä¹ å¤§ä¼™è¯´æœ€ç®€å•æœ€æ˜äº†çš„è¯­è¨€Pythonã€‚èº«è¾¹æ²¡æœ‰ç¯å¢ƒè‡ªå­¦è¿™ç©æ„å„¿å°±æ„Ÿè§‰ç—›è‹¦å¤šæ¬¢ä¹å°‘ã€‚ä¸«çš„èƒœåˆ©çš„å–œæ‚¦æ€»æ˜¯è¢«ä¸‹ä¸€ä¸ªæœªçŸ¥çš„é—®é¢˜å¾ˆå¿«æ·¹æ²¡ã€‚å°±åæ§½è¿™ä¹ˆå¤šå§~~~å¸Œæœ›æˆ‘çš„ç¬¬ä¸€ä¸ªdemoèƒ½åœ¨å›å®¶å‰åšå‡ºæ¥ã€‚</p></div>
                    </div>
                    <div style="clear:both;"></div>
                    <hr>
                </div>
                
                <div class="media">
                    
                    <div class="media-body">
                        <a
                            class="link-unstyled"
                            href="https://www.zoulei.net/2013/12/20/excel_batch_print/"
                            aria-label=": excelæ•°å­—é€’å¢æ‰¹é‡æ‰“å°"
                        >
                            <h3 class="media-heading">excelæ•°å­—é€’å¢æ‰¹é‡æ‰“å°</h3>
                        </a>
                        <span class="media-meta">
                            <span class="media-date text-small">
                                
                                    2013å¹´12æœˆ20æ—¥
                                
                            </span>
                        </span>
                        <div class="media-content hide-xs font-merryweather"><p>å·¥ä½œä¸­ç»å¸¸éœ€è¦æ‰“å°è¾“å‡ºèµ„æ–™ã€‚å…¶ä¸­åˆæœ‰ç‰¹åˆ«å¤šçš„èµ„æ–™æ‰“å°çš„æ­¥éª¤æ˜¯è¿™æ ·çš„ã€‚ä¸€ä¸ªexcelå·¥ä½œè–„ä¸­æœ‰Nä¸ªå·¥ä½œè¡¨ã€‚æŠŠæ‰€æœ‰å·¥ä½œè¡¨æ‰“å°â†’æ›¿æ¢å­—ç¬¦â€Næ ‹â€åˆ°â€N+1æ ‹â€æ‰“å°â†’æ›¿æ¢å­—ç¬¦â€N+1æ ‹â€åˆ°â€N+2æ ‹â€æ‰“å°â€¦â€¦â€¦..ï¼ˆæ‰€æœ‰æ ‹å·ä¸åŒ…å«4ï¼‰</p>
<p>ç»å¸¸ä¸€æ¬¡æ€§ä¼šæ‰“å°ä¸Šåƒå¼ ï¼Œè¿™æ ·ä¸€ä¸ªç®€å•çš„æ´»å„¿å´ä¹Ÿèƒ½ç”Ÿå‡ºå¾ˆå¤šäº‹å„¿ã€‚å°±åƒä¸‹é¢è¿™æ ·ï¼š</p></div>
                    </div>
                    <div style="clear:both;"></div>
                    <hr>
                </div>
                
                <div class="media">
                    
                    <div class="media-body">
                        <a
                            class="link-unstyled"
                            href="https://www.zoulei.net/2013/12/27/pip_use_china_mirror/"
                            aria-label=": pipä½¿ç”¨å›½å†…é•œåƒ"
                        >
                            <h3 class="media-heading">pipä½¿ç”¨å›½å†…é•œåƒ</h3>
                        </a>
                        <span class="media-meta">
                            <span class="media-date text-small">
                                
                                    2013å¹´12æœˆ27æ—¥
                                
                            </span>
                        </span>
                        <div class="media-content hide-xs font-merryweather"><p>ä½œä¸ºä¸€ä¸ªä¸æ‡‚ä¸ä¼šç”¨linuxçš„å°ç™½å´æƒ³å­¦ç¼–ç¨‹çš„è¡¨ç¤ºå¾ˆæ— å¥ˆï¼Œå„ç§æŠ˜è…¾ä¼¤ä¸èµ·~~~~~<br>ç”¨çš„pycharmçš„IDEï¼Œç»å¤§å¤šæ•°æ—¶å€™ä½¿ç”¨pipå®‰è£…ç¬¬ä¸‰æ–¹åº“çš„æ—¶å€™éƒ½æ˜¯å¤±è´¥çš„ã€‚è™½ç„¶æœ‰è¯¦å°½çš„é”™è¯¯æŠ¥å‘Šã€‚ä½†æ˜¯çœŸå¿ƒçœ‹ä¸æ‡‚ã€‚</p>
<p>ä»Šæ—¥çªé—»å¯èƒ½æ˜¯ä¼Ÿå¤§çš„å¢™åœ¨ä½œæ€ªï¼Œæ¢æˆå›½å†…é•œåƒå¯èƒ½ä¼šæœ‰æ‰€å¥½è½¬ã€‚ä½œä¸ºä¸€ä¸ªå°ç™½ï¼Œå‘ç°æœ‰æ•™ç¨‹å¯ä»¥è§£å†³ä¸€ç›´ä»¥æ¥çš„çƒ¦å¿ƒäº‹å½“ç„¶æ˜¯ä¸‡åˆ†æ¬£å–œæ»´ã€‚ï¼ˆå¿ƒé‡Œé»˜å¿µ100éshitï¼‰ä½†æ˜¯åæ¥æ‰å‘ç°è¿™TMæ‰æ˜¯æœ€çƒ¦å¿ƒæ—¶åˆ»çš„å¼€å§‹ã€‚äºæ˜¯æœ‰äº†ä¸‹é¢è¿™äº›æŠ˜è…¾.</p></div>
                    </div>
                    <div style="clear:both;"></div>
                    <hr>
                </div>
                
            </div>
        </div>
        <div class="modal-footer">
            <p class="results-count text-medium"
                data-message-zero="æ²¡æœ‰æ‰¾åˆ°æ–‡ç« "
                data-message-one="æ‰¾åˆ° 1 ç¯‡æ–‡ç« "
                data-message-other="æ‰¾åˆ° {n} ç¯‡æ–‡ç« ">
                æ‰¾åˆ° 102 ç¯‡æ–‡ç« 
            </p>
        </div>
    </div>
</div>

        
        
<div id="cover" style="background-image:url('/assets/images/cover.jpg');"></div>
        <!--SCRIPTS-->

<script src="/assets/js/script-mdmhmndjqtxgrnbcqxwfotdukip0lyvqjtoun1q59tiszh2pjvmu0dun2kvx.min.js"></script>

<!--SCRIPTS END-->


    



    
<script src="/assets/js/moment-with-locales.js"></script>

    
<script src="/assets/js/algoliasearch.js"></script>

    <script>
      var algoliaClient = algoliasearch('CX8LZHBELF', '3fcc4f94219bf4d5f5714b449373ba3c');
      var algoliaIndex = algoliaClient.initIndex('Blog');
    </script>


    </body>
</html>
